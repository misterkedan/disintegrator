!function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var n=function(){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,n),this.callbacks="function"==typeof e?[e]:e,this.fps=r,this.elapsed=0,this._last=0,this._deltaOffset=0,this._isPlaying=!1,this._update=this.update.bind(this)}var r,o,i;return r=n,(o=[{key:"add",value:function(t){this.has(t)||this.callbacks.push(t)}},{key:"remove",value:function(t){this.has(t)&&this.callbacks.splice(this.callbacks.indexOf(t),1)}},{key:"has",value:function(t){return this.callbacks.includes(t)}},{key:"reset",value:function(){this.elapsed=0}},{key:"start",value:function(){this._last=this.now,this._deltaOffset=0,this._isPlaying=!0,this.requestFrame()}},{key:"pause",value:function(){this._isPlaying=!1}},{key:"stop",value:function(){this.pause(),this.reset()}},{key:"update",value:function(){if(this.isPlaying){this.requestFrame();var t=Math.min(this.now-this._last,n.maxDelta);if(this._last=this.now,this.elapsed+=t,t>=this._frameDuration)return this.tick(t);this._deltaOffset+=t;var e=this._frameDuration-this._deltaOffset;e<=0&&(this.tick(this._frameDuration),this._deltaOffset=Math.abs(e)%this._frameDuration)}}},{key:"tick",value:function(t){var e=this;this.callbacks.forEach((function(n){return n(t,e.elapsed)}))}},{key:"requestFrame",value:function(){requestAnimationFrame(this._update)}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps=t,this._frameDuration=t>0?Math.floor(1e3/t):0}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"now",get:function(){return n.time.now()}}])&&e(r.prototype,o),i&&e(r,i),Object.defineProperty(r,"prototype",{writable:!1}),n}();n.maxDelta=100,n.time=Date||performance;var r=THREE,o=new r.Scene;o.background=new r.Color(2236967),o.fog=new r.Fog(o.background,1,60);var i=new THREE.DirectionalLight(16768477,.5);i.position.set(5,5,5),o.add(i);var a=new r.HemisphereLight(16777198,3158325,1.5);o.add(a);var u,c,s,f,l={hemisphere:a},p=window.innerWidth/window.innerHeight,y=new r.PerspectiveCamera(45,p,.1,1e3);y.lookAt(0,0,0),u=y.aspect>=1?1:1.5,c=3.5*u,s=2.5*u,f=4.5*u,y.position.set(c,s,f);var h=3158069,d=new r.GridHelper(100,40,h,h);d.position.y=-2,o.add(d);var v={scene:o,camera:y,lights:l,grid:d,add:function(t){o.add(t)},remove:function(t){o.remove(t)},resize:function(t,e){y.aspect=t/e,y.updateProjectionMatrix()}},m={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"};function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function w(t,e,n){return e&&g(t.prototype,e),n&&g(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var O=function(){function t(){b(this,t),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}return w(t,[{key:"setSize",value:function(){}},{key:"render",value:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}]),t}(),x=new r.OrthographicCamera(-1,1,1,-1,0,1),_=new r.BufferGeometry;_.setAttribute("position",new r.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),_.setAttribute("uv",new r.Float32BufferAttribute([0,2,0,0,2,0],2));var P=function(){function t(e){b(this,t),this._mesh=new r.Mesh(_,e)}return w(t,[{key:"dispose",value:function(){this._mesh.geometry.dispose()}},{key:"render",value:function(t){t.render(this._mesh,x)}},{key:"material",get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}]),t}();function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function T(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function A(t,e){return A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},A(t,e)}function N(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=F(t);if(e){var o=F(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return R(this,n)}}function R(t,e){if(e&&("object"===S(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function F(t){return F=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},F(t)}var j=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&A(t,e)}(a,t);var e,n,o,i=N(a);function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this)).textureID=void 0!==e?e:"tDiffuse",t instanceof r.ShaderMaterial?(n.uniforms=t.uniforms,n.material=t):t&&(n.uniforms=r.UniformsUtils.clone(t.uniforms),n.material=new r.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:n.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),n.fsQuad=new P(n.material),n}return e=a,n=[{key:"render",value:function(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}],n&&T(e.prototype,n),o&&T(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(O);function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function I(t,e,n){return e&&k(t.prototype,e),n&&k(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function C(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&D(t,e)}function D(t,e){return D=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},D(t,e)}function U(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=X(t);if(e){var o=X(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return M(this,n)}}function M(t,e){if(e&&("object"===E(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function X(t){return X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},X(t)}var z=function(t){C(n,t);var e=U(n);function n(t,r){var o;return L(this,n),(o=e.call(this)).scene=t,o.camera=r,o.clear=!0,o.needsSwap=!1,o.inverse=!1,o}return I(n,[{key:"render",value:function(t,e,n){var r,o,i=t.getContext(),a=t.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(r=0,o=1):(r=1,o=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),a.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),a.buffers.stencil.setClear(o),a.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(i.EQUAL,1,4294967295),a.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),a.buffers.stencil.setLocked(!0)}}]),n}(O),B=function(t){C(n,t);var e=U(n);function n(){var t;return L(this,n),(t=e.call(this)).needsSwap=!1,t}return I(n,[{key:"render",value:function(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}]),n}(O);function J(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Q(t,e,n){return e&&Y(t.prototype,e),n&&Y(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var H=function(){function t(e,n){if(J(this,t),this.renderer=e,void 0===n){var o={minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat},i=e.getSize(new r.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(n=new r.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,o)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===m&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===j&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new j(m),this.clock=new r.Clock}return Q(t,[{key:"swapBuffers",value:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}},{key:"addPass",value:function(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"insertPass",value:function(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"removePass",value:function(t){var e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}},{key:"isLastEnabledPass",value:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}},{key:"render",value:function(t){void 0===t&&(t=this.clock.getDelta());for(var e=this.renderer.getRenderTarget(),n=!1,r=0,o=this.passes.length;r<o;r++){var i=this.passes[r];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),i.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),i.needsSwap){if(n){var a=this.renderer.getContext(),u=this.renderer.state.buffers.stencil;u.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),u.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==z&&(i instanceof z?n=!0:i instanceof B&&(n=!1))}}this.renderer.setRenderTarget(e)}},{key:"reset",value:function(t){if(void 0===t){var e=this.renderer.getSize(new r.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}},{key:"setSize",value:function(t,e){this._width=t,this._height=e;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var o=0;o<this.passes.length;o++)this.passes[o].setSize(n,r)}},{key:"setPixelRatio",value:function(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}]),t}(),V=(new r.OrthographicCamera(-1,1,1,-1,0,1),new r.BufferGeometry);V.setAttribute("position",new r.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),V.setAttribute("uv",new r.Float32BufferAttribute([0,2,0,0,2,0],2));function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function W(t,e){return W=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},W(t,e)}function K(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=$(t);if(e){var o=$(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Z(this,n)}}function Z(t,e){if(e&&("object"===G(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function $(t){return $=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$(t)}var tt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&W(t,e)}(a,t);var e,n,o,i=K(a);function a(t,e,n,o,u){var c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(c=i.call(this)).scene=t,c.camera=e,c.overrideMaterial=n,c.clearColor=o,c.clearAlpha=void 0!==u?u:0,c.clear=!0,c.clearDepth=!1,c.needsSwap=!1,c._oldClearColor=new r.Color,c}return e=a,n=[{key:"render",value:function(t,e,n){var r,o,i=t.autoClear;t.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),r=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),t.autoClear=i}}],n&&q(e.prototype,n),o&&q(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(O),et={glsl:"\n\t\nvec4 pack( float value ) {\n\n\tif ( value == 0.0 ) return vec4( 0.0, 0.0, 0.0, 0.0 );\n\n\tfloat mag = abs( value );\n\t\n\tfloat exponent = floor( log2( mag ) );\n\texponent += float( exp2( exponent ) <= mag / 2.0 );\n\texponent -= float( exp2( exponent ) > mag );\n\n\tfloat mantissa = ( exponent > 100.0 )\n\t\t? mag / 1024.0 / exp2( exponent - 10.0 ) - 1.0\n\t\t: mag / float( exp2( exponent ) ) - 1.0;\n\n\tfloat r = exponent + 127.0;\n\tmantissa *= 256.0;\n\n\tfloat g = floor( mantissa );\n\tmantissa -= g;\n\tmantissa *= 256.0;\n\n\tfloat b = floor( mantissa );\n\tmantissa -= b;\n\tmantissa *= 128.0;\n\n\tfloat a = floor( mantissa ) * 2.0 + float( value < 0.0 );\n\n\treturn vec4( r, g, b, a ) / 255.0;\n\n}\n\nfloat unpack( vec4 value ) {\n\n\tfloat r = floor( value.r * 255.0 + 0.5 );\n\tfloat g = floor( value.g * 255.0 + 0.5 );\n\tfloat b = floor( value.b * 255.0 + 0.5 );\n\tfloat a = floor( value.a * 255.0 + 0.5 );\n\n\tfloat exponent = r - 127.0;\n\tfloat sign = 1.0 - mod( a, 2.0 ) * 2.0;\n\tfloat mantissa = float( r > 0.0 ) + g / 256.0 + b / 65536.0\n\t\t+ floor( a / 2.0 ) / 8388608.0;\n\treturn sign * mantissa * exp2( exponent );\n\n}\n\n",pack:function(t,e){var n,r,o,i,a,u,c;e||(e=new Uint8Array(4*t.length));for(var s=0,f=0,l=t.length;s<l;s++)0!==(n=t[s])&&(r=Math.abs(n),o=Math.floor(Math.log2(r)),o+=(i=Math.pow(2,o))<=r/2,a=(o-=i>r)>100?r/1024/Math.pow(2,o-10)-1:r/i-1,e[f]=o+127,a*=256,u=Math.floor(a),e[f+1]=u,a=256*(a-u),c=Math.floor(a),e[f+2]=c,a=128*(a-c),e[f+3]=2*Math.floor(a)+(n<0)),f+=4;return e},unpack:function(t,e){var n,r,o,i,a,u;e||(e=new Float32Array(t.length/4));for(var c=0,s=0,f=t.length;c<f;c+=4)n=t[c],r=t[c+1],o=t[c+2],a=n-127,u=(1-(i=t[c+3])%2*2)*((n>0)+r/256+o/65536+Math.floor(i/2)/8388608)*Math.pow(2,a),e[s]=u,s++}};function nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ot=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.DEFAULT_FRAGMENT,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(nt(this,t),!t.renderer)throw new Error("Use TextureComputer.init( renderer ) before instancing.");this._shader=n,this._uniforms=r,this.data=e}var e,n,o;return e=t,n=[{key:"compute",value:function(){this.renderTarget=this.renderTarget===this._rt1?this._rt2:this._rt1,t.render(this.material,this.renderTarget),this.material.uniforms.tData.value=this.renderTarget.texture}},{key:"fill",value:function(t){this._data.fill(t),et.pack(this._data,this.tData.image.data)}},{key:"dispose",value:function(){this._rt1.dispose(),this._rt2.dispose(),this.tData.dispose()}},{key:"data",get:function(){return t.renderer.readRenderTargetPixels(this.renderTarget,0,0,this._size,this._size,this._buffer),et.unpack(this._buffer,this._data),this._data},set:function(e){var n=Array.isArray(e),r=n?t.getRequiredSize(e.length):t.getRequiredSize(e);this._size=r,this.tData=t.createTexture(r),this._buffer=this.tData.image.data,this._data=n?e:new Float32Array(r*r),n&&et.pack(e,this.tData.image.data),this.uniforms=this._uniforms,this._rt1=t.createRenderTarget(r),this._rt2=t.createRenderTarget(r),this.renderTarget=this._rt1}},{key:"shader",get:function(){return this._shader},set:function(e){this._shader=e,this.material=new r.ShaderMaterial({uniforms:this._uniforms,vertexShader:t.DEFAULT_VERTEX,fragmentShader:e});var n=this.size.toFixed(1);this.material.defines.resolution="vec2( ".concat(n,", ").concat(n," )")}},{key:"uniforms",get:function(){return this._uniforms},set:function(t){t.tData={value:this.tData},this._uniforms=t,this.shader=this._shader}},{key:"size",get:function(){return this._size}},{key:"texture",get:function(){return this.material.uniforms.tData.value}}],n&&rt(e.prototype,n),o&&rt(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();function it(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function at(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}ot.init=function(t){return ot.renderer||(ot.renderer=t,ot.scene=new r.Scene,ot.camera=new r.Camera,ot.mesh=new r.Mesh(new r.PlaneBufferGeometry(2,2)),ot.scene.add(ot.mesh)),ot.checkHardwareCompatibility()},ot.checkHardwareCompatibility=function(){return ot.isCompatible=!0,0===ot.renderer.capabilities.maxVertexTextures&&(console.warn("No support for vertex textures."),ot.isCompatible=!1),ot.isCompatible||window.alert("Incompatible hardware."),ot.isCompatible},ot.render=function(t,e){ot.mesh.material=t,ot.renderer.setRenderTarget(e),ot.renderer.render(ot.scene,ot.camera),ot.renderer.setRenderTarget(null)},ot.DEFAULT_VERTEX="\n\n    void main() {\n\n        gl_Position = vec4( position, 1.0 );\n\n    }\n\n",ot.DEFAULT_FRAGMENT="\n\n    uniform sampler2D tData;\n\n    ".concat(et.GLSL,"\n\n    void main() {\n        \n        vec2 uv = gl_FragCoord.xy / resolution.xy;\n        float data = unpack( texture2D( tData, uv ) );\n\n        // Modify data...\n\n        gl_FragColor = pack( data );\n\n    }\n\n"),ot.createTexture=function(t){return new r.DataTexture(new Uint8Array(t*t*4),t,t,r.RGBAFormat,r.UnsignedByteType)},ot.createRenderTarget=function(t){return new r.WebGLRenderTarget(t,t,{wrapS:r.ClampToEdgeWrapping,wrapT:r.ClampToEdgeWrapping,minFilter:r.NearestFilter,magFilter:r.NearestFilter,stencilBuffer:!1,depthBuffer:!1,format:r.RGBAFormat,type:r.UnsignedByteType})},ot.getRequiredSize=function(t){if(isNaN(t)||!isFinite(t)||!Number.isInteger(t)||t<1)throw new RangeError("Length must be a natural number.");for(var e=1,n=2;n*n<t;)n=Math.pow(2,e),e++;return n},ot.round=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=Math.pow(10,e);return Math.round(t*n)/n};var ut=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};it(this,t),this.name=e.name,this.type=e.type,this.node=e.node,this.needsUpdate=e.needsUpdate}var e,n,r;return e=t,(n=[{key:"value",get:function(){return this.node.value},set:function(t){this.node.value=t}}])&&at(e.prototype,n),r&&at(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),ct={elements:["x","y","z","w"],addShortcuts:function(){function t(t,e,n){return n?{get:function(){return this[t][e][n]},set:function(r){this[t][e][n]=r}}:{get:function(){return this[t][e]},set:function(n){this[t][e]=n}}}return function(e,n,r){for(var o={},i=0;i<r.length;++i){var a=r[i].split("."),u=a[0],c=a[1];o[u]=t(n,u,c)}Object.defineProperties(e,o)}}()},st={nodes:{},keywords:{},add:function(t){this.nodes[t.name]=t},addKeyword:function(t,e,n){n=void 0===n||n,this.keywords[t]={callback:e,cache:n}},remove:function(t){delete this.nodes[t.name]},removeKeyword:function(t){delete this.keywords[t]},get:function(t){return this.nodes[t]},getKeyword:function(t,e){return this.keywords[t].callback.call(this,e)},getKeywordData:function(t){return this.keywords[t]},contains:function(t){return void 0!==this.nodes[t]},containsKeyword:function(t){return void 0!==this.keywords[t]}};function ft(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var lt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.uuid=r.MathUtils.generateUUID(),this.name="",this.type=e,this.userData={}}var e,n,o;return e=t,n=[{key:"analyze",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.analyzing=!0,this.build(t.addFlow(e.slot,e.cache,e.context),"v4"),t.clearVertexNodeCode(),t.clearFragmentNodeCode(),t.removeFlow(),t.analyzing=!1}},{key:"analyzeAndFlow",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.analyze(t,n),this.flow(t,e,n)}},{key:"flow",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t.addFlow(n.slot,n.cache,n.context);var r={};return r.result=this.build(t,e),r.code=t.clearNodeCode(),r.extra=t.context.extra,t.removeFlow(),r}},{key:"build",value:function(t,e,n){e=e||this.getType(t,e);var r=t.getNodeData(n||this);return t.analyzing&&this.appendDepsNode(t,r,e),-1===t.nodes.indexOf(this)&&t.nodes.push(this),void 0!==this.updateFrame&&-1===t.updaters.indexOf(this)&&t.updaters.push(this),this.generate(t,e,n)}},{key:"generate",value:function(){}},{key:"getHash",value:function(){var e,n,r="{";for(e in this)(n=this[e])instanceof t&&(r+='"'+e+'":'+n.getHash()+",");if(this.hashProperties)for(var o=0;o<this.hashProperties.length;o++)n=this[e=this.hashProperties[o]],r+='"'+e+'":"'+String(n)+'",';return r+='"id":"'+this.uuid+'"}'}},{key:"appendDepsNode",value:function(t,e,n){e.deps=(e.deps||0)+1;var r=t.getTypeLength(n);(r>(e.outputMax||0)||this.getType(t,n))&&(e.outputMax=r,e.output=n)}},{key:"setName",value:function(t){return this.name=t,this}},{key:"getName",value:function(){return this.name}},{key:"getType",value:function(t,e){return"sampler2D"===e||"samplerCube"===e?e:this.type}},{key:"getJSONNode",value:function(t){if(void 0!==t&&"string"!=typeof t&&void 0!==t.nodes[this.uuid])return t.nodes[this.uuid]}},{key:"copy",value:function(t){return void 0!==t.name&&(this.name=t.name),void 0!==t.userData&&(this.userData=JSON.parse(JSON.stringify(t.userData))),this}},{key:"createJSONNode",value:function(t){var e=void 0===t||"string"==typeof t,n={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return n.uuid=this.uuid,n.nodeType=this.nodeType,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.nodes[this.uuid]=n),n}},{key:"toJSON",value:function(t){return this.getJSONNode(t)||this.createJSONNode(t)}}],n&&ft(e.prototype,n),o&&ft(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();function pt(t){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(t)}function yt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ht(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function dt(){return dt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=vt(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},dt.apply(this,arguments)}function vt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=wt(t)););return t}function mt(t,e){return mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},mt(t,e)}function bt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=wt(t);if(e){var o=wt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return gt(this,n)}}function gt(t,e){if(e&&("object"===pt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function wt(t){return wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},wt(t)}lt.prototype.isNode=!0,lt.prototype.hashProperties=void 0;var Ot=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mt(t,e)}(a,t);var e,n,o,i=bt(a);function a(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return yt(this,a),(e=i.call(this,t)).shared=void 0===n.shared||n.shared,e.unique=void 0!==n.unique&&n.unique,e}return e=a,(n=[{key:"build",value:function(t,e,n,o){if(e=e||this.getType(t),this.getShared(t,e)){var i=this.getUnique(t,e);i&&void 0===this.constructor.uuid&&(this.constructor.uuid=r.MathUtils.generateUUID()),n=t.getUuid(n||this.getUuid(),!i);var u=t.getNodeData(n),c=u.output||this.getType(t);if(t.analyzing)return(u.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,u,e),this.generate(t,e,n)):dt(wt(a.prototype),"build",this).call(this,t,e,n);if(i)return u.name=u.name||dt(wt(a.prototype),"build",this).call(this,t,e,n),u.name;if(!this.getLabel()&&(!this.getShared(t,c)||t.context.ignoreCache||1===u.deps))return dt(wt(a.prototype),"build",this).call(this,t,e,n);n=this.getUuid(!1);var s=this.getTemp(t,n);if(s)return t.format(s,c,e);s=a.prototype.generate.call(this,t,e,n,u.output,o);var f=this.generate(t,c,n);return t.addNodeCode(s+" = "+f+";"),t.format(s,c,e)}return dt(wt(a.prototype),"build",this).call(this,t,e,n)}},{key:"getShared",value:function(t,e){return"sampler2D"!==e&&"samplerCube"!==e&&this.shared}},{key:"getUnique",value:function(){return this.unique}},{key:"setLabel",value:function(t){return this.label=t,this}},{key:"getLabel",value:function(){return this.label}},{key:"getUuid",value:function(t){var e=(t||null==t)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(e=this.scope+"-"+e),e}},{key:"getTemp",value:function(t,e){e=e||this.uuid;var n=t.getVars()[e];return n?n.name:void 0}},{key:"generate",value:function(t,e,n,r,o){return this.getShared(t,e)||console.error("THREE.TempNode is not shared!"),n=n||this.uuid,t.getTempVar(n,r||this.getType(t),o,this.getLabel()).name}}])&&ht(e.prototype,n),o&&ht(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(lt);function xt(t){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xt(t)}function _t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pt(){return Pt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=St(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Pt.apply(this,arguments)}function St(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Rt(t)););return t}function Tt(t,e){return Tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Tt(t,e)}function At(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Rt(t);if(e){var o=Rt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Nt(this,n)}}function Nt(t,e){if(e&&("object"===xt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Rt(t){return Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Rt(t)}var Ft=/^\s*([a-z_0-9]+)\s+([a-z_0-9]+)\s*\(([\s\S]*?)\)/i,jt=/[a-z_0-9]+/gi,Et=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Tt(t,e)}(i,t);var e,n,r,o=At(i);function i(t,e,n,r,a){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(u=o.call(this,a)).isMethod=void 0===a,u.isInterface=!1,u.parse(t,e,n,r),u}return e=i,n=[{key:"getShared",value:function(){return!this.isMethod}},{key:"getType",value:function(t){return t.getTypeByFormat(this.type)}},{key:"getInputByName",value:function(t){for(var e=this.inputs.length;e--;)if(this.inputs[e].name===t)return this.inputs[e]}},{key:"getIncludeByName",value:function(t){for(var e=this.includes.length;e--;)if(this.includes[e].name===t)return this.includes[e]}},{key:"generate",value:function(t,e){for(var n,r=0,o=this.src,i=0;i<this.includes.length;i++)t.include(this.includes[i],this);for(var a in this.extensions)t.extensions[a]=!0;for(var u=[];n=jt.exec(this.src);)u.push(n);for(var c=0;c<u.length;c++){var s=u[c],f=s[0],l=!this.isMethod||!this.getInputByName(f),p=f;if(this.keywords[f]||this.useKeywords&&l&&st.containsKeyword(f)){var y=this.keywords[f];if(!y){var h=st.getKeywordData(f);h.cache&&(y=t.keywords[f]),y=y||st.getKeyword(f,t),h.cache&&(t.keywords[f]=y)}p=y.build(t)}f!==p&&(o=o.substring(0,s.index+r)+p+o.substring(s.index+f.length+r),r+=p.length-f.length),void 0===this.getIncludeByName(p)&&st.contains(p)&&t.include(st.get(p))}return"source"===e?o:this.isMethod?(this.isInterface||t.include(this,!1,o),this.name):t.format("( "+o+" )",this.getType(t),e)}},{key:"parse",value:function(t,e,n,r){if(this.src=t||"",this.includes=e||[],this.extensions=n||{},this.keywords=r||{},this.isMethod){var o=this.src.match(Ft);if(this.inputs=[],o&&4==o.length){this.type=o[1],this.name=o[2];var i=o[3].match(jt);if(i)for(var a=0;a<i.length;){var u=i[a++],c=void 0;"in"===u||"out"===u||"inout"===u?c=i[a++]:(c=u,u="");var s=i[a++];this.inputs.push({name:s,type:c,qualifier:u})}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},{key:"copy",value:function(t){return Pt(Rt(i.prototype),"copy",this).call(this,t),this.isMethod=t.isMethod,this.useKeywords=t.useKeywords,this.parse(t.src,t.includes,t.extensions,t.keywords),void 0!==t.type&&(this.type=t.type),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);if(!e){for(var n in(e=this.createJSONNode(t)).src=this.src,e.isMethod=this.isMethod,e.useKeywords=this.useKeywords,this.isMethod||(e.type=this.type),e.extensions=JSON.parse(JSON.stringify(this.extensions)),e.keywords={},this.keywords)e.keywords[n]=this.keywords[n].toJSON(t).uuid;if(this.includes.length){e.includes=[];for(var r=0;r<this.includes.length;r++)e.includes.push(this.includes[r].toJSON(t).uuid)}}return e}}],n&&_t(e.prototype,n),r&&_t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function It(){return It="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Ct(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},It.apply(this,arguments)}function Ct(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Xt(t)););return t}function Dt(t,e){return Dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Dt(t,e)}function Ut(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Xt(t);if(e){var o=Xt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Mt(this,n)}}function Mt(t,e){if(e&&("object"===Lt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Xt(t){return Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Xt(t)}Et.prototype.nodeType="Function",Et.prototype.useKeywords=!0;var zt=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,Bt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Dt(t,e)}(i,t);var e,n,r,o=Ut(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this)).parse(t||i.PI,e),n}return e=i,(n=[{key:"getType",value:function(t){return t.getTypeByFormat(this.type)}},{key:"parse",value:function(t,e){this.src=t||"";var n,r,o="",i=this.src.match(zt);this.useDefine=e||"#"===this.src.charAt(0),i&&i.length>1?(r=i[1],n=i[2],o=i[3]):(n=this.src,r="f"),this.name=n,this.type=r,this.value=o}},{key:"build",value:function(t,e){return"source"!==e?(t.include(this),t.format(this.name,this.getType(t),e)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":this.useDefine?this.src:void 0}},{key:"generate",value:function(t,e){return t.format(this.name,this.getType(t),e)}},{key:"copy",value:function(t){return It(Xt(i.prototype),"copy",this).call(this,t),this.parse(t.src,t.useDefine),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).src=this.src,!0===e.useDefine&&(e.useDefine=!0)),e}}])&&kt(e.prototype,n),r&&kt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Jt(t){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jt(t)}function Yt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Qt(t,e){return Qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Qt(t,e)}function Ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Gt(t);if(e){var o=Gt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Vt(this,n)}}function Vt(t,e){if(e&&("object"===Jt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Gt(t){return Gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Gt(t)}Bt.prototype.nodeType="Const",Bt.PI="PI",Bt.PI2="PI2",Bt.RECIPROCAL_PI="RECIPROCAL_PI",Bt.RECIPROCAL_PI2="RECIPROCAL_PI2",Bt.LOG2="LOG2",Bt.EPSILON="EPSILON";var qt=/^struct\s*([a-z_0-9]+)\s*{\s*((.|\n)*?)}/gim,Wt=/\s*(\w*?)\s*(\w*?)(\=|\;)/gim,Kt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qt(t,e)}(i,t);var e,n,r,o=Ht(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this)).parse(t),e}return e=i,n=[{key:"getType",value:function(t){return t.getTypeByFormat(this.name)}},{key:"getInputByName",value:function(t){for(var e=this.inputs.length;e--;)if(this.inputs[e].name===t)return this.inputs[e]}},{key:"generate",value:function(t,e){return"source"===e?this.src+";":t.format("( "+this.src+" )",this.getType(t),e)}},{key:"parse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.src=t,this.inputs=[];var e=qt.exec(this.src);if(e){for(var n,r=e[2];n=Wt.exec(r);)this.inputs.push({type:n[1],name:n[2]});this.name=e[1]}else this.name="";this.type=this.name}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).src=this.src),e}}],n&&Yt(e.prototype,n),r&&Yt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Zt(t){return Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zt(t)}function $t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function te(){return te="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=ee(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},te.apply(this,arguments)}function ee(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ie(t)););return t}function ne(t,e){return ne=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ne(t,e)}function re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ie(t);if(e){var o=ie(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return oe(this,n)}}function oe(t,e){if(e&&("object"===Zt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ie(t){return ie=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ie(t)}Kt.prototype.nodeType="Struct";var ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ne(t,e)}(i,t);var e,n,r,o=re(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=e||{}).shared=void 0!==e.shared&&e.shared,(n=o.call(this,t,e)).readonly=!1,n}return e=i,(n=[{key:"setReadonly",value:function(t){return this.readonly=t,this.hashProperties=this.readonly?["value"]:void 0,this}},{key:"getReadonly",value:function(){return this.readonly}},{key:"copy",value:function(t){return te(ie(i.prototype),"copy",this).call(this,t),void 0!==t.readonly&&(this.readonly=t.readonly),this}},{key:"createJSONNode",value:function(t){var e=te(ie(i.prototype),"createJSONNode",this).call(this,t);return!0===this.readonly&&(e.readonly=this.readonly),e}},{key:"generate",value:function(t,e,n,r,o,i){n=t.getUuid(n||this.getUuid()),r=r||this.getType(t);var a=t.getNodeData(n);return this.getReadonly(t)&&void 0!==this.generateReadonly?this.generateReadonly(t,e,n,r,o,i):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(r,this,o,i,this.getLabel())),t.format(a.vertex.name,r,e)):(a.fragment||(a.fragment=t.createFragmentUniform(r,this,o,i,this.getLabel())),t.format(a.fragment.name,r,e))}}])&&$t(e.prototype,n),r&&$t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function ue(t){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ue(t)}function ce(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function se(){return se="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=fe(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},se.apply(this,arguments)}function fe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=he(t)););return t}function le(t,e){return le=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},le(t,e)}function pe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=he(t);if(e){var o=he(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ye(this,n)}}function ye(t,e){if(e&&("object"===ue(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function he(t){return he=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},he(t)}var de=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&le(t,e)}(a,t);var e,n,o,i=pe(a);function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,"v2")).value=t instanceof r.Vector2?t:new r.Vector2(t,e),n}return e=a,(n=[{key:"generateReadonly",value:function(t,e,n,r){return t.format("vec2( "+this.x+", "+this.y+" )",r,e)}},{key:"copy",value:function(t){return se(he(a.prototype),"copy",this).call(this,t),this.value.copy(t),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,!0===this.readonly&&(e.readonly=!0)),e}}])&&ce(e.prototype,n),o&&ce(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(ae);function ve(t){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ve(t)}function me(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function be(){return be="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=ge(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},be.apply(this,arguments)}function ge(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_e(t)););return t}function we(t,e){return we=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},we(t,e)}function Oe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=_e(t);if(e){var o=_e(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return xe(this,n)}}function xe(t,e){if(e&&("object"===ve(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _e(t){return _e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},_e(t)}de.prototype.nodeType="Vector2",ct.addShortcuts(de.prototype,"value",["x","y"]);var Pe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&we(t,e)}(a,t);var e,n,o,i=Oe(a);function a(t,e,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(o=i.call(this,"v3")).value=t instanceof r.Vector3?t:new r.Vector3(t,e,n),o}return e=a,(n=[{key:"generateReadonly",value:function(t,e,n,r){return t.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",r,e)}},{key:"copy",value:function(t){return be(_e(a.prototype),"copy",this).call(this,t),this.value.copy(t),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,e.z=this.z,!0===this.readonly&&(e.readonly=!0)),e}}])&&me(e.prototype,n),o&&me(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(ae);function Se(t){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Se(t)}function Te(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ae(){return Ae="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Ne(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ae.apply(this,arguments)}function Ne(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ee(t)););return t}function Re(t,e){return Re=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Re(t,e)}function Fe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ee(t);if(e){var o=Ee(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return je(this,n)}}function je(t,e){if(e&&("object"===Se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ee(t){return Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ee(t)}Pe.prototype.nodeType="Vector3",ct.addShortcuts(Pe.prototype,"value",["x","y","z"]);var Le=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Re(t,e)}(a,t);var e,n,o,i=Fe(a);function a(t,e,n,o){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(u=i.call(this,"v4")).value=t instanceof r.Vector4?t:new r.Vector4(t,e,n,o),u}return e=a,(n=[{key:"generateReadonly",value:function(t,e,n,r){return t.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",r,e)}},{key:"copy",value:function(t){return Ae(Ee(a.prototype),"copy",this).call(this,t),this.value.copy(t),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,!0===this.readonly&&(e.readonly=!0)),e}}])&&Te(e.prototype,n),o&&Te(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(ae);function ke(t){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ke(t)}function Ie(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ce(){return Ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=De(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ce.apply(this,arguments)}function De(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ze(t)););return t}function Ue(t,e){return Ue=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ue(t,e)}function Me(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var o=ze(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Xe(this,n)}}function Xe(t,e){if(e&&("object"===ke(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ze(t){return ze=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ze(t)}Le.prototype.nodeType="Vector4",ct.addShortcuts(Le.prototype,"value",["x","y","z","w"]);var Be=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ue(t,e)}(i,t);var e,n,r,o=Me(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"v2",{shared:!1})).index=t||0,e}return e=i,(n=[{key:"generate",value:function(t,e){t.requires.uv[this.index]=!0;var n=this.index>0?this.index+1:"",r=t.isShader("vertex")?"uv"+n:"vUv"+n;return t.format(r,this.getType(t),e)}},{key:"copy",value:function(t){return Ce(ze(i.prototype),"copy",this).call(this,t),this.index=t.index,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).index=this.index),e}}])&&Ie(e.prototype,n),r&&Ie(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Je(t){return Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Je(t)}function Ye(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Qe(){return Qe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=He(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Qe.apply(this,arguments)}function He(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=We(t)););return t}function Ve(t,e){return Ve=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ve(t,e)}function Ge(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=We(t);if(e){var o=We(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return qe(this,n)}}function qe(t,e){if(e&&("object"===Je(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function We(t){return We=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},We(t)}Be.prototype.nodeType="UV",st.addKeyword("uv",(function(){return new Be})),st.addKeyword("uv2",(function(){return new Be(1)}));var Ke=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ve(t,e)}(i,t);var e,n,r,o=Ge(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this,"v4")).input=t,n.method=e||i.LINEAR_TO_LINEAR,n}return e=i,(n=[{key:"generate",value:function(t,e){var n=this.input.build(t,"v4"),r=this.getType(t),o=i.Nodes[this.method],a=t.include(o);if(a===i.LINEAR_TO_LINEAR)return t.format(n,r,e);if(2===o.inputs.length){var u=this.factor.build(t,"f");return t.format(a+"( "+n+", "+u+" )",r,e)}return t.format(a+"( "+n+" )",r,e)}},{key:"fromEncoding",value:function(t){var e=i.getEncodingComponents(t);this.method="LinearTo"+e[0],this.factor=e[1]}},{key:"fromDecoding",value:function(t){var e=i.getEncodingComponents(t);this.method=e[0]+"ToLinear",this.factor=e[1]}},{key:"copy",value:function(t){return Qe(We(i.prototype),"copy",this).call(this,t),this.input=t.input,this.method=t.method,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).input=this.input.toJSON(t).uuid,e.method=this.method),e}}])&&Ye(e.prototype,n),r&&Ye(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Ze(t){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ze(t)}function $e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function tn(t,e){return tn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},tn(t,e)}function en(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=rn(t);if(e){var o=rn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return nn(this,n)}}function nn(t,e){if(e&&("object"===Ze(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function rn(t){return rn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},rn(t)}Ke.Nodes={LinearToLinear:new Et("\n\t\tvec4 LinearToLinear( in vec4 value ) {\n\n\t\t\treturn value;\n\n\t\t}"),sRGBToLinear:new Et("\n\t\tvec4 sRGBToLinear( in vec4 value ) {\n\n\t\t\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n\n\t\t}"),LinearTosRGB:new Et("\n\t\tvec4 LinearTosRGB( in vec4 value ) {\n\n\t\t\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n\n\t\t}")},Ke.LINEAR_TO_LINEAR="LinearToLinear",Ke.SRGB_TO_LINEAR="sRGBToLinear",Ke.LINEAR_TO_SRGB="LinearTosRGB",Ke.getEncodingComponents=function(t){switch(t){case r.LinearEncoding:return["Linear"];case r.sRGBEncoding:return["sRGB"]}},Ke.prototype.nodeType="ColorSpace",Ke.prototype.hashProperties=["method"];var on=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tn(t,e)}(i,t);var e,n,r,o=en(i);function i(t,e,n,r,a){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),o.call(this,t,a,r,n,e)}return e=i,n&&$e(e.prototype,n),r&&$e(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(Et);function an(t){return an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},an(t)}function un(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function cn(){return cn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=sn(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},cn.apply(this,arguments)}function sn(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=yn(t)););return t}function fn(t,e){return fn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},fn(t,e)}function ln(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=yn(t);if(e){var o=yn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return pn(this,n)}}function pn(t,e){if(e&&("object"===an(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function yn(t){return yn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},yn(t)}on.prototype.nodeType="Expression";var hn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fn(t,e)}(i,t);var e,n,r,o=ln(i);function i(t,e,n,r){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(a=o.call(this,"v4",{shared:!0})).value=t,a.uv=e||new Be,a.bias=n,a.project=void 0!==r&&r,a}return e=i,(n=[{key:"getTexture",value:function(t,e){return cn(yn(i.prototype),"generate",this).call(this,t,e,this.value.uuid,"t")}},{key:"generate",value:function(t,e){if("sampler2D"===e)return this.getTexture(t,e);var n,r,o=this.getTexture(t,e),i=this.uv.build(t,this.project?"v4":"v2"),a=this.bias?this.bias.build(t,"f"):void 0;void 0===a&&t.context.bias&&(a=t.context.bias.setTexture(this).build(t,"f")),n=this.project?"texture2DProj":a?"tex2DBias":"tex2D",r=a?n+"( "+o+", "+i+", "+a+" )":n+"( "+o+", "+i+" )";var u={include:t.isShader("vertex"),ignoreCache:!0},c=this.getType(t);return t.addContext(u),this.colorSpace=this.colorSpace||new Ke(new on("",c)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(r),r=this.colorSpace.build(t,c),t.removeContext(),t.format(r,c,e)}},{key:"copy",value:function(t){return cn(yn(i.prototype),"copy",this).call(this,t),t.value&&(this.value=t.value),this.uv=t.uv,t.bias&&(this.bias=t.bias),void 0!==t.project&&(this.project=t.project),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.value&&(e.value=this.value.uuid),e.uv=this.uv.toJSON(t).uuid,e.project=this.project,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e}}])&&un(e.prototype,n),r&&un(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(ae);function dn(t){return dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dn(t)}function vn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mn(){return mn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=bn(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},mn.apply(this,arguments)}function bn(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=xn(t)););return t}function gn(t,e){return gn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},gn(t,e)}function wn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=xn(t);if(e){var o=xn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return On(this,n)}}function On(t,e){if(e&&("object"===dn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function xn(t){return xn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},xn(t)}hn.prototype.nodeType="Texture";var _n=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gn(t,e)}(i,t);var e,n,r,o=wn(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"v3")).scope=t||i.LOCAL,e}return e=i,(n=[{key:"getType",value:function(){return this.scope===i.PROJECTION?"v4":this.type}},{key:"getShared",value:function(){switch(this.scope){case i.LOCAL:case i.WORLD:return!1}return!0}},{key:"generate",value:function(t,e){var n;switch(this.scope){case i.LOCAL:t.isShader("vertex")?n="transformed":(t.requires.position=!0,n="vPosition");break;case i.WORLD:if(t.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";t.requires.worldPosition=!0,n="vWPosition";break;case i.VIEW:n=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case i.PROJECTION:n=t.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return t.format(n,this.getType(t),e)}},{key:"copy",value:function(t){return mn(xn(i.prototype),"copy",this).call(this,t),this.scope=t.scope,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e}}])&&vn(e.prototype,n),r&&vn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Pn(t){return Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pn(t)}function Sn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Tn(){return Tn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=An(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Tn.apply(this,arguments)}function An(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=jn(t)););return t}function Nn(t,e){return Nn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Nn(t,e)}function Rn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=jn(t);if(e){var o=jn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Fn(this,n)}}function Fn(t,e){if(e&&("object"===Pn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function jn(t){return jn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},jn(t)}_n.LOCAL="local",_n.WORLD="world",_n.VIEW="view",_n.PROJECTION="projection",_n.prototype.nodeType="Position",st.addKeyword("position",(function(){return new _n})),st.addKeyword("worldPosition",(function(){return new _n(_n.WORLD)})),st.addKeyword("viewPosition",(function(){return new _n(_n.VIEW)}));var En=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nn(t,e)}(i,t);var e,n,r,o=Rn(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"v3")).scope=t||i.VIEW,e}return e=i,(n=[{key:"getShared",value:function(){return this.scope===i.WORLD}},{key:"build",value:function(t,e,n,r){var o=t.context[this.scope+"Normal"];return o?o.build(t,e,n,r):Tn(jn(i.prototype),"build",this).call(this,t,e,n)}},{key:"generate",value:function(t,e){var n;switch(this.scope){case i.VIEW:n=t.isShader("vertex")?"transformedNormal":"geometryNormal";break;case i.LOCAL:t.isShader("vertex")?n="objectNormal":(t.requires.normal=!0,n="vObjectNormal");break;case i.WORLD:t.isShader("vertex")?n="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(t.requires.worldNormal=!0,n="vWNormal")}return t.format(n,this.getType(t),e)}},{key:"copy",value:function(t){return Tn(jn(i.prototype),"copy",this).call(this,t),this.scope=t.scope,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e}}])&&Sn(e.prototype,n),r&&Sn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Ln(t){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ln(t)}function kn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function In(t,e){return In=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},In(t,e)}function Cn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Un(t);if(e){var o=Un(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Dn(this,n)}}function Dn(t,e){if(e&&("object"===Ln(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Un(t){return Un=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Un(t)}En.LOCAL="local",En.WORLD="world",En.VIEW="view",En.prototype.nodeType="Normal",st.addKeyword("viewNormal",(function(){return new En(En.VIEW)})),st.addKeyword("localNormal",(function(){return new En(En.NORMAL)})),st.addKeyword("worldNormal",(function(){return new En(En.WORLD)}));var Mn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&In(t,e)}(i,t);var e,n,r,o=Cn(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"v3")).scope=t||i.CUBE,e}return e=i,(n=[{key:"getUnique",value:function(t){return!t.context.viewNormal}},{key:"getType",value:function(){return this.scope===i.SPHERE?"v2":this.type}},{key:"generate",value:function(t,e){var n=this.getUnique(t);if(t.isShader("fragment")){var r,o,a;switch(this.scope){case i.VECTOR:var u=new En(En.VIEW),c=t.context.roughness,s=u.build(t,"v3"),f=new _n(_n.VIEW).build(t,"v3"),l=c?c.build(t,"f"):void 0,p="reflect( -normalize( ".concat(f," ), ").concat(s," )");l&&(p="normalize( mix( ".concat(p,", ").concat(s,", ").concat(l," * ").concat(l," ) )")),o="inverseTransformDirection( ".concat(p,", viewMatrix )"),n?(t.addNodeCode("vec3 reflectVec = ".concat(o,";")),r="reflectVec"):r=o;break;case i.CUBE:o="vec3( -"+(a=new i(i.VECTOR).build(t,"v3"))+".x, "+a+".yz )",n?(t.addNodeCode("vec3 reflectCubeVec = ".concat(o,";")),r="reflectCubeVec"):r=o;break;case i.SPHERE:o="normalize( ( viewMatrix * vec4( "+(a=new i(i.VECTOR).build(t,"v3"))+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5",n?(t.addNodeCode("vec2 reflectSphereVec = ".concat(o,";")),r="reflectSphereVec"):r=o}return t.format(r,this.getType(t),e)}return console.warn("THREE.ReflectNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.type,e)}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e}}])&&kn(e.prototype,n),r&&kn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Xn(t){return Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xn(t)}function zn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Bn(){return Bn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Jn(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Bn.apply(this,arguments)}function Jn(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Vn(t)););return t}function Yn(t,e){return Yn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Yn(t,e)}function Qn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Vn(t);if(e){var o=Vn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Hn(this,n)}}function Hn(t,e){if(e&&("object"===Xn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Vn(t){return Vn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Vn(t)}Mn.CUBE="cube",Mn.SPHERE="sphere",Mn.VECTOR="vector",Mn.prototype.nodeType="Reflect";var Gn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yn(t,e)}(i,t);var e,n,r,o=Qn(i);function i(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this,"v4",{shared:!0})).value=t,r.uv=e||new Mn,r.bias=n,r}return e=i,(n=[{key:"getTexture",value:function(t,e){return Bn(Vn(i.prototype),"generate",this).call(this,t,e,this.value.uuid,"tc")}},{key:"generate",value:function(t,e){if("samplerCube"===e)return this.getTexture(t,e);var n,r=this.getTexture(t,e),o=this.uv.build(t,"v3"),i=this.bias?this.bias.build(t,"f"):void 0;void 0===i&&t.context.bias&&(i=t.context.bias.setTexture(this).build(t,"f")),n=i?"texCubeBias( "+r+", "+o+", "+i+" )":"texCube( "+r+", "+o+" )";var a={include:t.isShader("vertex"),ignoreCache:!0},u=this.getType(t);return t.addContext(a),this.colorSpace=this.colorSpace||new Ke(new on("",u)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(t,u),t.removeContext(),t.format(n,u,e)}},{key:"copy",value:function(t){return Bn(Vn(i.prototype),"copy",this).call(this,t),t.value&&(this.value=t.value),this.uv=t.uv,t.bias&&(this.bias=t.bias),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.uuid,e.uv=this.uv.toJSON(t).uuid,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e}}])&&zn(e.prototype,n),r&&zn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(ae);function qn(t){return qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qn(t)}function Wn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Kn(){return Kn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Zn(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Kn.apply(this,arguments)}function Zn(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=nr(t)););return t}function $n(t,e){return $n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},$n(t,e)}function tr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=nr(t);if(e){var o=nr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return er(this,n)}}function er(t,e){if(e&&("object"===qn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function nr(t){return nr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},nr(t)}Gn.prototype.nodeType="CubeTexture";var rr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$n(t,e)}(i,t);var e,n,r,o=tr(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"f")).value=t||0,e}return e=i,(n=[{key:"generateReadonly",value:function(t,e,n,r){return t.format(this.value+(this.value%1?"":".0"),r,e)}},{key:"copy",value:function(t){return Kn(nr(i.prototype),"copy",this).call(this,t),this.value=t.value,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value,!0===this.readonly&&(e.readonly=!0)),e}}])&&Wn(e.prototype,n),r&&Wn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(ae);function or(t){return or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},or(t)}function ir(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ar(){return ar="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=ur(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},ar.apply(this,arguments)}function ur(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=lr(t)););return t}function cr(t,e){return cr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},cr(t,e)}function sr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=lr(t);if(e){var o=lr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return fr(this,n)}}function fr(t,e){if(e&&("object"===or(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function lr(t){return lr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},lr(t)}rr.prototype.nodeType="Float";var pr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cr(t,e)}(i,t);var e,n,r,o=sr(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this)).setFunction(t,e),n}return e=i,n=[{key:"setFunction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.value=t,this.inputs=e}},{key:"getFunction",value:function(){return this.value}},{key:"getType",value:function(t){return this.value.getType(t)}},{key:"generate",value:function(t,e){for(var n=this.getType(t),r=this.value,o=r.build(t,e)+"( ",i=[],a=0;a<r.inputs.length;a++){var u=r.inputs[a],c=this.inputs[a]||this.inputs[u.name];i.push(c.build(t,t.getTypeByFormat(u.type)))}return o+=i.join(", ")+" )",t.format(o,n,e)}},{key:"copy",value:function(t){for(var e in ar(lr(i.prototype),"copy",this).call(this,t),t.inputs)this.inputs[e]=t.inputs[e];return this.value=t.value,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);if(!e){var n=this.value;if((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,n.inputs.length){e.inputs={};for(var r=0;r<n.inputs.length;r++){var o=n.inputs[r],i=this.inputs[r]||this.inputs[o.name];e.inputs[o.name]=i.toJSON(t).uuid}}}return e}}],n&&ir(e.prototype,n),r&&ir(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function yr(t){return yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yr(t)}function hr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function dr(){return dr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=vr(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},dr.apply(this,arguments)}function vr(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=wr(t)););return t}function mr(t,e){return mr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},mr(t,e)}function br(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=wr(t);if(e){var o=wr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return gr(this,n)}}function gr(t,e){if(e&&("object"===yr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function wr(t){return wr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},wr(t)}pr.prototype.nodeType="FunctionCall";var Or=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mr(t,e)}(i,t);var e,n,r,o=br(i);function i(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this)).a=t,r.b=e,r.op=n,r}return e=i,(n=[{key:"getType",value:function(t){var e=this.a.getType(t),n=this.b.getType(t);return t.isTypeMatrix(e)?"v4":t.getTypeLength(n)>t.getTypeLength(e)?n:e}},{key:"generate",value:function(t,e){var n=this.getType(t),r=this.a.build(t,n),o=this.b.build(t,n);return t.format("( "+r+" "+this.op+" "+o+" )",n,e)}},{key:"copy",value:function(t){return dr(wr(i.prototype),"copy",this).call(this,t),this.a=t.a,this.b=t.b,this.op=t.op,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.op=this.op),e}}])&&hr(e.prototype,n),r&&hr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function xr(t){return xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xr(t)}function _r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pr(){return Pr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Sr(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Pr.apply(this,arguments)}function Sr(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Rr(t)););return t}function Tr(t,e){return Tr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Tr(t,e)}function Ar(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Rr(t);if(e){var o=Rr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Nr(this,n)}}function Nr(t,e){if(e&&("object"===xr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Rr(t){return Rr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Rr(t)}Or.ADD="+",Or.SUB="-",Or.MUL="*",Or.DIV="/",Or.prototype.nodeType="Operator";var Fr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Tr(t,e)}(i,t);var e,n,r,o=Ar(i);function i(t,e,n,r){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(a=o.call(this)).a=t,"string"!=typeof e?a.b=e:r=e,"string"!=typeof n?a.c=n:r=n,a.method=r,a}return e=i,(n=[{key:"getNumInputs",value:function(){switch(this.method){case i.ARCTAN:return this.b?2:1;case i.MIX:case i.CLAMP:case i.REFRACT:case i.SMOOTHSTEP:case i.FACEFORWARD:return 3;case i.MIN:case i.MAX:case i.MOD:case i.STEP:case i.REFLECT:case i.DISTANCE:case i.DOT:case i.CROSS:case i.POW:return 2;default:return 1}}},{key:"getInputType",value:function(t){var e=t.getTypeLength(this.a.getType(t)),n=this.b?t.getTypeLength(this.b.getType(t)):0,r=this.c?t.getTypeLength(this.c.getType(t)):0;return e>n&&e>r?this.a.getType(t):n>r?this.b.getType(t):this.c.getType(t)}},{key:"getType",value:function(t){switch(this.method){case i.LENGTH:case i.DISTANCE:case i.DOT:return"f";case i.CROSS:return"v3"}return this.getInputType(t)}},{key:"generate",value:function(t,e){var n,r,o,a=this.a?t.getTypeLength(this.a.getType(t)):0,u=this.b?t.getTypeLength(this.b.getType(t)):0,c=this.c?t.getTypeLength(this.c.getType(t)):0,s=this.getInputType(t),f=this.getType(t);switch(this.method){case i.NEGATE:return t.format("( -"+this.a.build(t,s)+" )",s,e);case i.INVERT:return t.format("( 1.0 - "+this.a.build(t,s)+" )",s,e);case i.CROSS:n=this.a.build(t,"v3"),r=this.b.build(t,"v3");break;case i.STEP:n=this.a.build(t,1===a?"f":s),r=this.b.build(t,s);break;case i.MIN:case i.MAX:case i.MOD:n=this.a.build(t,s),r=this.b.build(t,1===u?"f":s);break;case i.REFRACT:n=this.a.build(t,s),r=this.b.build(t,s),o=this.c.build(t,"f");break;case i.MIX:n=this.a.build(t,s),r=this.b.build(t,s),o=this.c.build(t,1===c?"f":s);break;default:n=this.a.build(t,s),this.b&&(r=this.b.build(t,s)),this.c&&(o=this.c.build(t,s))}var l=[];l.push(n),r&&l.push(r),o&&l.push(o);var p=this.getNumInputs(t);if(l.length!==p)throw Error('Arguments not match used in "'.concat(this.method,'". Require ').concat(p,", currently ").concat(l.length,"."));return t.format(this.method+"( "+l.join(", ")+" )",f,e)}},{key:"copy",value:function(t){return Pr(Rr(i.prototype),"copy",this).call(this,t),this.a=t.a,this.b=t.b,this.c=t.c,this.method=t.method,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,this.b&&(e.b=this.b.toJSON(t).uuid),this.c&&(e.c=this.c.toJSON(t).uuid),e.method=this.method),e}}])&&_r(e.prototype,n),r&&_r(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function jr(t){return jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jr(t)}function Er(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Lr(t,e){return Lr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Lr(t,e)}function kr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Cr(t);if(e){var o=Cr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ir(this,n)}}function Ir(t,e){if(e&&("object"===jr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Cr(t){return Cr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Cr(t)}Fr.RAD="radians",Fr.DEG="degrees",Fr.EXP="exp",Fr.EXP2="exp2",Fr.LOG="log",Fr.LOG2="log2",Fr.SQRT="sqrt",Fr.INV_SQRT="inversesqrt",Fr.FLOOR="floor",Fr.CEIL="ceil",Fr.NORMALIZE="normalize",Fr.FRACT="fract",Fr.SATURATE="saturate",Fr.SIN="sin",Fr.COS="cos",Fr.TAN="tan",Fr.ASIN="asin",Fr.ACOS="acos",Fr.ARCTAN="atan",Fr.ABS="abs",Fr.SIGN="sign",Fr.LENGTH="length",Fr.NEGATE="negate",Fr.INVERT="invert",Fr.MIN="min",Fr.MAX="max",Fr.MOD="mod",Fr.STEP="step",Fr.REFLECT="reflect",Fr.DISTANCE="distance",Fr.DOT="dot",Fr.CROSS="cross",Fr.POW="pow",Fr.MIX="mix",Fr.CLAMP="clamp",Fr.REFRACT="refract",Fr.SMOOTHSTEP="smoothstep",Fr.FACEFORWARD="faceforward",Fr.prototype.nodeType="Math",Fr.prototype.hashProperties=["method"];var Dr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lr(t,e)}(i,t);var e,n,r,o=kr(i);function i(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this,"v4")).value=t,r.uv=e,r.bias=n,r}return e=i,(n=[{key:"bilinearCubeUV",value:function(t,e,n,r){var o=new pr(i.Nodes.bilinearCubeUV,[e,n,r]);this.colorSpaceTL=this.colorSpaceTL||new Ke(new on("","v4")),this.colorSpaceTL.input.parse(o.build(t)+".tl"),this.colorSpaceTR=this.colorSpaceTR||new Ke(new on("","v4")),this.colorSpaceTR.input.parse(o.build(t)+".tr"),this.colorSpaceBL=this.colorSpaceBL||new Ke(new on("","v4")),this.colorSpaceBL.input.parse(o.build(t)+".bl"),this.colorSpaceBR=this.colorSpaceBR||new Ke(new on("","v4")),this.colorSpaceBR.input.parse(o.build(t)+".br");var a={include:t.isShader("vertex"),ignoreCache:!0};t.addContext(a),this.colorSpaceTLExp=new on(this.colorSpaceTL.build(t,"v4"),"v4"),this.colorSpaceTRExp=new on(this.colorSpaceTR.build(t,"v4"),"v4"),this.colorSpaceBLExp=new on(this.colorSpaceBL.build(t,"v4"),"v4"),this.colorSpaceBRExp=new on(this.colorSpaceBR.build(t,"v4"),"v4"),t.removeContext();var u=new on("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return u.keywords.cubeUV_TL=this.colorSpaceTLExp,u.keywords.cubeUV_TR=this.colorSpaceTRExp,u.keywords.cubeUV_BL=this.colorSpaceBLExp,u.keywords.cubeUV_BR=this.colorSpaceBRExp,u.keywords.cubeUV=o,u}},{key:"generate",value:function(t,e){if(t.isShader("fragment")){var n=this.uv,r=this.bias||t.context.roughness,o=new pr(i.Nodes.roughnessToMip,[r]),a=new Fr(o,i.Nodes.m0,i.Nodes.cubeUV_maxMipLevel,Fr.CLAMP),u=new Fr(a,Fr.FLOOR),c=new Fr(a,Fr.FRACT),s=this.bilinearCubeUV(t,this.value,n,u),f=this.bilinearCubeUV(t,this.value,n,new Or(u,new rr(1).setReadonly(!0),Or.ADD)),l=new Fr(s,f,c,Fr.MIX);return t.format(l.build(t),"v4",e)}return console.warn("THREE.TextureCubeUVNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.uv=this.uv.toJSON(t).uuid,e.bias=this.bias.toJSON(t).uuid),e}}])&&Er(e.prototype,n),r&&Er(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Ur(t){return Ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ur(t)}function Mr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Xr(){return Xr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=zr(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Xr.apply(this,arguments)}function zr(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Qr(t)););return t}function Br(t,e){return Br=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Br(t,e)}function Jr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Qr(t);if(e){var o=Qr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Yr(this,n)}}function Yr(t,e){if(e&&("object"===Ur(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Qr(t){return Qr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Qr(t)}Dr.Nodes=function(){var t=new Kt("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),e=new Bt("float cubeUV_maxMipLevel 8.0",!0),n=new Bt("float cubeUV_minMipLevel 4.0",!0),r=new Bt("float cubeUV_maxTileSize 256.0",!0),o=new Bt("float cubeUV_minTileSize 16.0",!0),i=new Et("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");i.useKeywords=!1;var a=new Et("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");a.useKeywords=!1;var u=new Et("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[t,i,a,e,n,r,o]);u.useKeywords=!1;var c=new Bt("float r0 1.0",!0),s=new Bt("float v0 0.339",!0),f=new Bt("float m0 -2.0",!0),l=new Bt("float r1 0.8",!0),p=new Bt("float v1 0.276",!0),y=new Bt("float m1 -1.0",!0),h=new Bt("float r4 0.4",!0),d=new Bt("float v4 0.046",!0),v=new Bt("float m4 2.0",!0),m=new Bt("float r5 0.305",!0),b=new Bt("float v5 0.016",!0),g=new Bt("float m5 3.0",!0),w=new Bt("float r6 0.21",!0),O=new Bt("float v6 0.0038",!0),x=new Bt("float m6 4.0",!0);return{bilinearCubeUV:u,roughnessToMip:new Et("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[c,s,f,l,p,y,h,d,v,m,b,g,w,O,x]),m0:f,cubeUV_maxMipLevel:e}}(),Dr.prototype.nodeType="TextureCubeUV";var Hr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Br(t,e)}(i,t);var e,n,r,o=Jr(i);function i(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this,"v4")).value=t,r.radianceNode=new Dr(r.value,e||new Mn(Mn.VECTOR),n),r.irradianceNode=new Dr(r.value,new En(En.WORLD),new rr(1).setReadonly(!0)),r}return e=i,(n=[{key:"generate",value:function(t,e){return t.isShader("fragment")?(t.require("irradiance"),t.context.bias&&t.context.bias.setTexture(this.value),("irradiance"===t.slot?this.irradianceNode:this.radianceNode).build(t,e)):(console.warn("THREE.TextureCubeNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e))}},{key:"copy",value:function(t){return Xr(Qr(i.prototype),"copy",this).call(this,t),this.value=t.value,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid),e}}])&&Mr(e.prototype,n),r&&Mr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Vr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Hr.prototype.nodeType="TextureCube";var Gr=ct.elements,qr=["float","vec2","vec3","vec4"],Wr={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b"},Kr={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"},Zr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.requires={uv:[],color:[],lights:!1,fog:!1,transparent:!1,irradiance:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode="\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\t#define texCube(a, b) textureCube(a, b)\n\t\t\t\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)\n\n\t\t\t\t#define tex2D(a, b) texture2D(a, b)\n\t\t\t\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)\n\n\t\t\t#else\n\n\t\t\t\t#define texCube(a, b) textureCube(a, b)\n\t\t\t\t#define texCubeBias(a, b, c) textureCube(a, b, c)\n\n\t\t\t\t#define tex2D(a, b) texture2D(a, b)\n\t\t\t\t#define tex2DBias(a, b, c) texture2D(a, b, c)\n\n\t\t\t#endif\n\n\t\t\t#include <packing>\n\t\t\t#include <common>",this.parsCode={vertex:"",fragment:""},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={},this.updaters=[],this.nodes=[],this.analyzing=!1}var e,n,o;return e=t,n=[{key:"build",value:function(t,e){this.buildShader("vertex",t),this.buildShader("fragment",e);for(var n=0;n<this.requires.uv.length;n++)if(this.requires.uv[n]){var r=n>0?n+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),n>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVaryCode("varying vec3 vWPosition;"),this.addVertexFinalCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this}},{key:"buildShader",value:function(t,e){this.resultCode[t]=e.build(this.setShader(t),"v4")}},{key:"setMaterial",value:function(t,e){return this.material=t,this.renderer=e,this.requires.lights=t.lights,this.requires.fog=t.fog,this.mergeDefines(t.defines),this}},{key:"addFlow",value:function(t,e,n){return this.addSlot(t).addCache(e).addContext(n)}},{key:"removeFlow",value:function(){return this.removeSlot().removeCache().removeContext()}},{key:"addCache",value:function(t){return this.cache=t||"",this.caches.push(this.cache),this}},{key:"removeCache",value:function(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}},{key:"addContext",value:function(t){return this.context=Object.assign({},this.context,t),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}},{key:"removeContext",value:function(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}},{key:"addSlot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.slot=t,this.slots.push(this.slot),this}},{key:"removeSlot",value:function(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}},{key:"addVertexCode",value:function(t){this.addCode(t,"vertex")}},{key:"addFragmentCode",value:function(t){this.addCode(t,"fragment")}},{key:"addCode",value:function(t,e){this.code[e||this.shader]+=t+"\n"}},{key:"addVertexNodeCode",value:function(t){this.addNodeCode(t,"vertex")}},{key:"addFragmentNodeCode",value:function(t){this.addNodeCode(t,"fragment")}},{key:"addNodeCode",value:function(t,e){this.nodeCode[e||this.shader]+=t+"\n"}},{key:"clearNodeCode",value:function(t){t=t||this.shader;var e=this.nodeCode[t];return this.nodeCode[t]="",e}},{key:"clearVertexNodeCode",value:function(){return this.clearNodeCode("vertex")}},{key:"clearFragmentNodeCode",value:function(){return this.clearNodeCode("fragment")}},{key:"addVertexFinalCode",value:function(t){this.addFinalCode(t,"vertex")}},{key:"addFragmentFinalCode",value:function(t){this.addFinalCode(t,"fragment")}},{key:"addFinalCode",value:function(t,e){this.finalCode[e||this.shader]+=t+"\n"}},{key:"addVertexParsCode",value:function(t){this.addParsCode(t,"vertex")}},{key:"addFragmentParsCode",value:function(t){this.addParsCode(t,"fragment")}},{key:"addParsCode",value:function(t,e){this.parsCode[e||this.shader]+=t+"\n"}},{key:"addVaryCode",value:function(t){this.addVertexParsCode(t),this.addFragmentParsCode(t)}},{key:"isCache",value:function(t){return-1!==this.caches.indexOf(t)}},{key:"isSlot",value:function(t){return-1!==this.slots.indexOf(t)}},{key:"define",value:function(t,e){this.defines[t]=void 0===e?1:e}},{key:"require",value:function(t){this.requires[t]=!0}},{key:"isDefined",value:function(t){return void 0!==this.defines[t]}},{key:"getVar",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"varying",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"V",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",a=this.getVars(r),u=a[t];if(!u){var c=a.length,s=n||"node"+o+c+(i?"_"+i:"");u={name:s,type:e},a.push(u),a[t]=u}return u}},{key:"getTempVar",value:function(t,e,n,r){return this.getVar(t,e,n,this.shader,"T",r)}},{key:"getAttribute",value:function(t,e){if(!this.attributes[t]){var n=this.getVar(t,e);this.addVertexParsCode("attribute "+e+" "+t+";"),this.addVertexFinalCode(n.name+" = "+t+";"),this.attributes[t]={varying:n,name:t,type:e}}return this.attributes[t]}},{key:"getCode",value:function(t){return[this.prefixCode,this.parsCode[t],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[t],"uniform"),this.getIncludesCode("consts",t),this.getIncludesCode("structs",t),this.getIncludesCode("functions",t),"void main() {",this.getVarListCode(this.getVars(t)),this.code[t],this.resultCode[t],this.finalCode[t],"}"].join("\n")}},{key:"getVarListCode",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="",r=0,o=t.length;r<o;++r){var i=t[r],a=i.type,u=i.name,c=this.getFormatByType(a);if(void 0===c)throw new Error("Node pars "+c+" not found.");n+=e+" "+c+" "+u+";\n"}return n}},{key:"getVars",value:function(t){return this.inputs.vars[t||this.shader]}},{key:"getNodeData",value:function(t){var e=t.isNode?t.uuid:t;return this.nodeData[e]=this.nodeData[e]||{}}},{key:"createUniform",value:function(t,e,n,r,o,i){var a=this.inputs.uniforms,u=a.list.length,c=new ut({type:e,name:r||"nodeU"+u+(i?"_"+i:""),node:n,needsUpdate:o});return a.list.push(c),a[t].push(c),a[t][c.name]=c,this.uniforms[c.name]=c,c}},{key:"createVertexUniform",value:function(t,e,n,r,o){return this.createUniform("vertex",t,e,n,r,o)}},{key:"createFragmentUniform",value:function(t,e,n,r,o){return this.createUniform("fragment",t,e,n,r,o)}},{key:"include",value:function(t,e,n){var r;if(t="string"==typeof t?st.get(t):t,!1===this.context.include)return t.name;t instanceof Et?r=this.includes.functions:t instanceof Bt?r=this.includes.consts:t instanceof Kt&&(r=this.includes.structs);var o=r[this.shader]=r[this.shader]||[];if(t){var i=o[t.name];if(i||(i=o[t.name]={node:t,deps:[]},o.push(i),i.src=t.build(this,"source")),t instanceof Et&&e&&o[e.name]&&-1==o[e.name].deps.indexOf(t)&&(o[e.name].deps.push(t),t.includes&&t.includes.length)){var a=0;do{this.include(t.includes[a++],e)}while(a<t.includes.length)}return n&&(i.src=n),t.name}throw new Error("Include not found.")}},{key:"colorToVectorProperties",value:function(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}},{key:"colorToVector",value:function(t){return t.replace(/c/g,"v3")}},{key:"getIncludes",value:function(t,e){return this.includes[t][e||this.shader]}},{key:"getIncludesCode",value:function(t,e){var n=this.getIncludes(t,e);if(!n)return"";var r="";n=n.sort($r);for(var o=0;o<n.length;o++)n[o].src&&(r+=n[o].src+"\n");return r}},{key:"getConstructorFromLength",value:function(t){return qr[t-1]}},{key:"isTypeMatrix",value:function(t){return/^m/.test(t)}},{key:"getTypeLength",value:function(t){return"f"===t?1:parseInt(this.colorToVector(t).substr(1))}},{key:"getTypeFromLength",value:function(t){return 1===t?"f":"v"+t}},{key:"findNode",value:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if(void 0!==e&&e.isNode)return e}}},{key:"resolve",value:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if(void 0!==e){if(e.isNode)return e;if(e.isTexture)switch(e.mapping){case r.CubeReflectionMapping:case r.CubeRefractionMapping:return new Gn(e);case r.CubeUVReflectionMapping:case r.CubeUVRefractionMapping:return new Hr(new hn(e));default:return new hn(e)}else{if(e.isVector2)return new de(e);if(e.isVector3)return new Pe(e);if(e.isVector4)return new Le(e)}}}}},{key:"format",value:function(t,e,n){switch(this.colorToVector(n+" <- "+e)){case"f <- v2":case"f <- v3":case"f <- v4":return t+".x";case"f <- i":case"f <- b":return"float( "+t+" )";case"v2 <- f":return"vec2( "+t+" )";case"v2 <- v3":case"v2 <- v4":return t+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+t+" ) )";case"v3 <- f":return"vec3( "+t+" )";case"v3 <- v2":return"vec3( "+t+", 0.0 )";case"v3 <- v4":return t+".xyz";case"v4 <- f":return"vec4( "+t+" )";case"v4 <- v2":return"vec4( "+t+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+t+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+t+" ) )";case"i <- f":case"i <- b":return"int( "+t+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+t+".x )";case"b <- f":return"( "+t+" != 0.0 )";case"b <- v2":return"( "+t+" != vec2( 0.0 ) )";case"b <- v3":return"( "+t+" != vec3( 0.0 ) )";case"b <- v4":return"( "+t+" != vec4( 0.0 ) )";case"b <- i":return"( "+t+" != 0 )"}return t}},{key:"getTypeByFormat",value:function(t){return Wr[t]||t}},{key:"getFormatByType",value:function(t){return Kr[t]||t}},{key:"getUuid",value:function(t,e){return(e=void 0===e||e)&&this.cache&&(t=this.cache+"-"+t),t}},{key:"getElementByIndex",value:function(t){return Gr[t]}},{key:"getIndexByElement",value:function(t){return Gr.indexOf(t)}},{key:"isShader",value:function(t){return this.shader===t}},{key:"setShader",value:function(t){return this.shader=t,this}},{key:"mergeDefines",value:function(t){for(var e in t)this.defines[e]=t[e];return this.defines}},{key:"mergeUniform",value:function(t){for(var e in t)this.uniforms[e]=t[e];return this.uniforms}},{key:"getTextureEncodingFromMap",value:function(t){var e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=r.LinearEncoding,e===r.LinearEncoding&&this.context.gamma&&(e=r.sRGBEncoding),e}}],n&&Vr(e.prototype,n),o&&Vr(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();function $r(t,e){return t.deps.length-e.deps.length}function to(t){return to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},to(t)}function eo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function no(){return no="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=ro(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},no.apply(this,arguments)}function ro(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=uo(t)););return t}function oo(t,e){return oo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},oo(t,e)}function io(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=uo(t);if(e){var o=uo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ao(this,n)}}function ao(t,e){if(e&&("object"===to(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function uo(t){return uo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},uo(t)}var co=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&oo(t,e)}(a,t);var e,n,o,i=io(a);function a(t,e,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(o=i.call(this,"c")).value=t instanceof r.Color?t:new r.Color(t||0,e,n),o}return e=a,(n=[{key:"generateReadonly",value:function(t,e,n,r){return t.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",r,e)}},{key:"copy",value:function(t){return no(uo(a.prototype),"copy",this).call(this,t),this.value.copy(t),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).r=this.r,e.g=this.g,e.b=this.b,!0===this.readonly&&(e.readonly=!0)),e}}])&&eo(e.prototype,n),o&&eo(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(ae);function so(t){return so="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},so(t)}function fo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function lo(){return lo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=po(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},lo.apply(this,arguments)}function po(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=mo(t)););return t}function yo(t,e){return yo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},yo(t,e)}function ho(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=mo(t);if(e){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return vo(this,n)}}function vo(t,e){if(e&&("object"===so(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function mo(t){return mo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},mo(t)}co.prototype.nodeType="Color",ct.addShortcuts(co.prototype,"value",["r","g","b"]);var bo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yo(t,e)}(i,t);var e,n,r,o=ho(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"v4")).value=t,e}return e=i,(n=[{key:"generate",value:function(t){var e=this.value.analyzeAndFlow(t,this.type),n=e.code+"\n";return t.isShader("vertex")?n+="gl_Position = "+e.result+";":n+="gl_FragColor = "+e.result+";",n}},{key:"copy",value:function(t){return lo(mo(i.prototype),"copy",this).call(this,t),this.value=t.value,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid),e}}])&&fo(e.prototype,n),r&&fo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(lt);function go(t){return go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},go(t)}function wo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Oo(t,e){return Oo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Oo(t,e)}function xo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Po(t);if(e){var o=Po(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return _o(this,n)}}function _o(t,e){if(e&&("object"===go(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Po(t){return Po=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Po(t)}bo.prototype.nodeType="Raw";var So=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Oo(t,e)}(a,t);var e,n,o,i=xo(a);function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this)).vertex=t||new bo(new _n(_n.PROJECTION)),n.fragment=e||new bo(new co(16711680)),n.updaters=[],n.type="NodeMaterial",n}return e=a,n=[{key:"properties",get:function(){return this.fragment.properties}},{key:"needsUpdate",get:function(){return this.needsCompile},set:function(t){!0===t&&this.version++,this.needsCompile=t}},{key:"onBeforeCompile",value:function(t,e){this.build({renderer:e}),t.defines=this.defines,t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.extensionDerivatives=!0===this.extensions.derivatives,t.extensionFragDepth=!0===this.extensions.fragDepth,t.extensionDrawBuffers=!0===this.extensions.drawBuffers,t.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}},{key:"customProgramCacheKey",value:function(){return this.getHash()}},{key:"getHash",value:function(){var t="{";return t+='"vertex":'+this.vertex.getHash()+",",t+='"fragment":'+this.fragment.getHash(),t+="}"}},{key:"updateFrame",value:function(t){for(var e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])}},{key:"build",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.builder||new Zr;return e.setMaterial(this,t.renderer),e.build(this.vertex,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters,this.fog=e.requires.fog,this.lights=e.requires.lights,this.transparent=e.requires.transparent||this.blending>r.NormalBlending,this}},{key:"copy",value:function(t){var e=this.uuid;for(var n in t)this[n]=t[n];return this.uuid=e,void 0!==t.userData&&(this.userData=JSON.parse(JSON.stringify(t.userData))),this}},{key:"toJSON",value:function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.materials&&(t.materials={}),!t.materials[this.uuid]){var e={};e.uuid=this.uuid,e.type=this.type,t.materials[e.uuid]=e,""!==this.name&&(e.name=this.name),void 0!==this.size&&(e.size=this.size),void 0!==this.sizeAttenuation&&(e.sizeAttenuation=this.sizeAttenuation),this.blending!==r.NormalBlending&&(e.blending=this.blending),!0===this.flatShading&&(e.flatShading=this.flatShading),this.side!==r.FrontSide&&(e.side=this.side),this.vertexColors!==r.NoColors&&(e.vertexColors=this.vertexColors),this.depthFunc!==r.LessEqualDepth&&(e.depthFunc=this.depthFunc),!1===this.depthTest&&(e.depthTest=this.depthTest),!1===this.depthWrite&&(e.depthWrite=this.depthWrite),1!==this.linewidth&&(e.linewidth=this.linewidth),void 0!==this.dashSize&&(e.dashSize=this.dashSize),void 0!==this.gapSize&&(e.gapSize=this.gapSize),void 0!==this.scale&&(e.scale=this.scale),!0===this.dithering&&(e.dithering=!0),!0===this.wireframe&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(e.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(e.wireframeLinejoin=this.wireframeLinejoin),this.alphaTest>0&&(e.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(e.premultipliedAlpha=this.premultipliedAlpha),!1===this.visible&&(e.visible=!1),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.fog=this.fog,e.lights=this.lights,e.vertex=this.vertex.toJSON(t).uuid,e.fragment=this.fragment.toJSON(t).uuid}return t.material=this.uuid,t}}],n&&wo(e.prototype,n),o&&wo(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(r.ShaderMaterial);function To(t){return To="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},To(t)}function Ao(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function No(t,e){return No=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},No(t,e)}function Ro(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=jo(t);if(e){var o=jo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Fo(this,n)}}function Fo(t,e){if(e&&("object"===To(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function jo(t){return jo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},jo(t)}So.prototype.isNodeMaterial=!0;var Eo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&No(t,e)}(i,t);var e,n,r,o=Ro(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),o.call(this,void 0,t)}return e=i,(n=[{key:"getUnique",value:function(){return!0}},{key:"getTexture",value:function(t,e){return ae.prototype.generate.call(this,t,e,this.getUuid(),"t","renderTexture")}}])&&Ao(e.prototype,n),r&&Ao(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(hn);Eo.prototype.nodeType="Screen";function Lo(t){return Lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lo(t)}function ko(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Io(){return Io="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Co(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Io.apply(this,arguments)}function Co(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Xo(t)););return t}function Do(t,e){return Do=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Do(t,e)}function Uo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Xo(t);if(e){var o=Xo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Mo(this,n)}}function Mo(t,e){if(e&&("object"===Lo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Xo(t){return Xo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Xo(t)}function zo(t){return zo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zo(t)}function Bo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Jo(){return Jo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Yo(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Jo.apply(this,arguments)}function Yo(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Go(t)););return t}function Qo(t,e){return Qo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Qo(t,e)}function Ho(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Go(t);if(e){var o=Go(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Vo(this,n)}}function Vo(t,e){if(e&&("object"===zo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Go(t){return Go=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Go(t)}function qo(t){return qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qo(t)}function Wo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ko(){return Ko="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Zo(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ko.apply(this,arguments)}function Zo(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ni(t)););return t}function $o(t,e){return $o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},$o(t,e)}function ti(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ni(t);if(e){var o=ni(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ei(this,n)}}function ei(t,e){if(e&&("object"===qo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ni(t){return ni=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ni(t)}function ri(t){return ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ri(t)}function oi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ii(){return ii="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=ai(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},ii.apply(this,arguments)}function ai(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=fi(t)););return t}function ui(t,e){return ui=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ui(t,e)}function ci(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=fi(t);if(e){var o=fi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return si(this,n)}}function si(t,e){if(e&&("object"===ri(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function fi(t){return fi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},fi(t)}(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Do(t,e)}(i,t);var e,n,r,o=Uo(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this,t)).value=e,n}return e=i,(n=[{key:"getType",value:function(t){return t.getTypeByFormat(this.type)}},{key:"generate",value:function(t,e){var n=t.getVar(this.uuid,this.type);return this.value&&t.isShader("vertex")&&t.addNodeCode(n.name+" = "+this.value.build(t,this.getType(t))+";"),t.format(n.name,this.getType(t),e)}},{key:"copy",value:function(t){return Io(Xo(i.prototype),"copy",this).call(this,t),this.type=t.type,this.value=t.value,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).type=this.type,this.value&&(e.value=this.value.toJSON(t).uuid)),e}}])&&ko(e.prototype,n),r&&ko(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i})(lt).prototype.nodeType="Var",function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qo(t,e)}(i,t);var e,n,r,o=Ho(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this,e)).name=t,n}return e=i,(n=[{key:"getAttributeType",value:function(t){return"number"==typeof this.type?t.getConstructorFromLength(this.type):this.type}},{key:"getType",value:function(t){var e=this.getAttributeType(t);return t.getTypeByFormat(e)}},{key:"generate",value:function(t,e){var n=this.getAttributeType(t),r=t.getAttribute(this.name,n),o=t.isShader("vertex")?this.name:r.varying.name;return t.format(o,this.getType(t),e)}},{key:"copy",value:function(t){return Jo(Go(i.prototype),"copy",this).call(this,t),this.type=t.type,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).type=this.type),e}}])&&Bo(e.prototype,n),r&&Bo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(lt).prototype.nodeType="Attribute",function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$o(t,e)}(i,t);var e,n,r,o=ti(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"b")).value=Boolean(t),e}return e=i,(n=[{key:"generateReadonly",value:function(t,e,n,r){return t.format(this.value,r,e)}},{key:"copy",value:function(t){return Ko(ni(i.prototype),"copy",this).call(this,t),this.value=t.value,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value,!0===this.readonly&&(e.readonly=!0)),e}}])&&Wo(e.prototype,n),r&&Wo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(ae).prototype.nodeType="Bool";var li=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ui(t,e)}(i,t);var e,n,r,o=ci(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"i")).value=Math.floor(t||0),e}return e=i,(n=[{key:"generateReadonly",value:function(t,e,n,r){return t.format(this.value,r,e)}},{key:"copy",value:function(t){return ii(fi(i.prototype),"copy",this).call(this,t),this.value=t.value,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value,!0===this.readonly&&(e.readonly=!0)),e}}])&&oi(e.prototype,n),r&&oi(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(ae);function pi(t){return pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pi(t)}function yi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function hi(){return hi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=di(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},hi.apply(this,arguments)}function di(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=gi(t)););return t}function vi(t,e){return vi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},vi(t,e)}function mi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=gi(t);if(e){var o=gi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return bi(this,n)}}function bi(t,e){if(e&&("object"===pi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function gi(t){return gi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},gi(t)}li.prototype.nodeType="Int";var wi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vi(t,e)}(a,t);var e,n,o,i=mi(a);function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,"m3")).value=t||new r.Matrix3,e}return e=a,(n=[{key:"elements",get:function(){return this.value.elements},set:function(t){this.value.elements=t}},{key:"generateReadonly",value:function(t,e,n,r){return t.format("mat3( "+this.value.elements.join(", ")+" )",r,e)}},{key:"copy",value:function(t){return hi(gi(a.prototype),"copy",this).call(this,t),this.value.fromArray(t.elements),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).elements=this.value.elements.concat()),e}}])&&yi(e.prototype,n),o&&yi(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(ae);function Oi(t){return Oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oi(t)}function xi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _i(){return _i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Pi(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},_i.apply(this,arguments)}function Pi(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ni(t)););return t}function Si(t,e){return Si=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Si(t,e)}function Ti(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ni(t);if(e){var o=Ni(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ai(this,n)}}function Ai(t,e){if(e&&("object"===Oi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ni(t){return Ni=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ni(t)}wi.prototype.nodeType="Matrix3";var Ri=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Si(t,e)}(a,t);var e,n,o,i=Ti(a);function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,"m4")).value=t||new r.Matrix4,e}return e=a,(n=[{key:"elements",get:function(){return this.value.elements},set:function(t){this.value.elements=t}},{key:"generateReadonly",value:function(t,e,n,r){return t.format("mat4( "+this.value.elements.join(", ")+" )",r,e)}},{key:"copy",value:function(t){return _i(Ni(a.prototype),"copy",this).call(this,t),this.scope.value.fromArray(t.elements),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).elements=this.value.elements.concat()),e}}])&&xi(e.prototype,n),o&&xi(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(ae);function Fi(t){return Fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fi(t)}function ji(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ei(t,e){return Ei=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ei(t,e)}function Li(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ii(t);if(e){var o=Ii(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ki(this,n)}}function ki(t,e){if(e&&("object"===Fi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ii(t){return Ii=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ii(t)}function Ci(t){return Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ci(t)}function Di(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ui(t,e){return Ui=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ui(t,e)}function Mi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=zi(t);if(e){var o=zi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Xi(this,n)}}function Xi(t,e){if(e&&("object"===Ci(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function zi(t){return zi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},zi(t)}Ri.prototype.nodeType="Matrix4",function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ei(t,e)}(i,t);var e,n,r,o=Li(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),e=o.call(this,"v4"),t&&e.setMirror(t),e}return e=i,(n=[{key:"setMirror",value:function(t){this.mirror=t,this.textureMatrix=new Ri(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new _n(_n.LOCAL),this.uv=new Or(this.textureMatrix,this.localPosition,Or.MUL),this.uvResult=new Or(null,this.uv,Or.ADD),this.texture=new hn(this.mirror.material.uniforms.tDiffuse.value,this.uv,null,!0)}},{key:"generate",value:function(t,e){return t.isShader("fragment")?(this.uvResult.a=this.offset,this.texture.uv=this.offset?this.uvResult:this.uv,"sampler2D"===e?this.texture.build(t,e):t.format(this.texture.build(t,this.type),this.type,e)):(console.warn("THREE.ReflectorNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.type,e))}},{key:"copy",value:function(t){return ae.prototype.copy.call(this,t),this.scope.mirror=t.mirror,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).mirror=this.mirror.uuid,this.offset&&(e.offset=this.offset.toJSON(t).uuid)),e}}])&&ji(e.prototype,n),r&&ji(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot).prototype.nodeType="Reflector";var Bi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ui(t,e)}(i,t);var e,n,r,o=Mi(i);function i(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this,n)).object=t,r.property=e,r}return e=i,(n=[{key:"value",get:function(){return this.object[this.property]},set:function(t){this.object[this.property]=t}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value,e.property=this.property),e}}])&&Di(e.prototype,n),r&&Di(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(ae);function Ji(t){return Ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ji(t)}function Yi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Hi(){return Hi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Vi(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Hi.apply(this,arguments)}function Vi(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ki(t)););return t}function Gi(t,e){return Gi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Gi(t,e)}function qi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ki(t);if(e){var o=Ki(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Wi(this,n)}}function Wi(t,e){if(e&&("object"===Ji(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ki(t){return Ki=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ki(t)}Bi.prototype.nodeType="Property";var Zi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gi(t,e)}(a,t);var e,n,o,i=qi(a);function a(t,e,n){var o,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Yi(this,a);var c=new r.WebGLRenderTarget(t,e,u);return(o=i.call(this,c.texture)).input=n,o.clear=void 0===u.clear||u.clear,o.renderTarget=c,o.material=new So,o.camera=new r.OrthographicCamera(-1,1,1,-1,0,1),o.scene=new r.Scene,o.quad=new r.Mesh(new r.PlaneGeometry(2,2),o.material),o.quad.frustumCulled=!1,o.scene.add(o.quad),o.render=!0,o}return e=a,n=[{key:"build",value:function(t,e,n){var r=new Zr;return r.nodes=t.nodes,r.updaters=t.updaters,this.material.fragment.value=this.input,this.material.build({builder:r}),Hi(Ki(a.prototype),"build",this).call(this,t,e,n)}},{key:"updateFramesaveTo",value:function(t){if(this.saveTo.render=!1,this.saveTo!==this.saveToCurrent){this.saveToMaterial&&this.saveToMaterial.dispose();var e=new So;e.fragment.value=this,e.build();var n=new r.Scene,o=new r.Mesh(new r.PlaneGeometry(2,2),e);o.frustumCulled=!1,n.add(o),this.saveToScene=n,this.saveToMaterial=e}this.saveToCurrent=this.saveTo,t.renderer.setRenderTarget(this.saveTo.renderTarget),this.saveTo.clear&&t.renderer.clear(),t.renderer.render(this.saveToScene,this.camera)}},{key:"updateFrame",value:function(t){t.renderer?(this.saveTo&&!1===this.saveTo.render&&this.updateFramesaveTo(t),this.render&&(this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=t.renderTexture),t.renderer.setRenderTarget(this.renderTarget),this.clear&&t.renderer.clear(),t.renderer.render(this.scene,this.camera)),this.saveTo&&!0===this.saveTo.render&&this.updateFramesaveTo(t)):console.warn("RTTNode need a renderer in NodeFrame")}},{key:"copy",value:function(t){return Hi(Ki(a.prototype),"copy",this).call(this,t),this.saveTo=t.saveTo,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||(e=Hi(Ki(a.prototype),"toJSON",this).call(this,t),this.saveTo&&(e.saveTo=this.saveTo.toJSON(t).uuid)),e}}],n&&Qi(e.prototype,n),o&&Qi(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(hn);function $i(t){return $i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$i(t)}function ta(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ea(){return ea="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=na(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},ea.apply(this,arguments)}function na(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=aa(t)););return t}function ra(t,e){return ra=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ra(t,e)}function oa(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=aa(t);if(e){var o=aa(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ia(this,n)}}function ia(t,e){if(e&&("object"===$i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function aa(t){return aa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},aa(t)}Zi.prototype.nodeType="RTT";var ua=["color","color2"],ca=["vColor","vColor2"];function sa(t){return sa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sa(t)}function fa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function la(){return la="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=pa(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},la.apply(this,arguments)}function pa(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=va(t)););return t}function ya(t,e){return ya=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ya(t,e)}function ha(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=va(t);if(e){var o=va(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return da(this,n)}}function da(t,e){if(e&&("object"===sa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function va(t){return va=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},va(t)}(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ra(t,e)}(i,t);var e,n,r,o=oa(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"v4",{shared:!1})).index=t||0,e}return e=i,(n=[{key:"generate",value:function(t,e){t.requires.color[this.index]=!0;var n=t.isShader("vertex")?ua[this.index]:ca[this.index];return t.format(n,this.getType(t),e)}},{key:"copy",value:function(t){return ea(aa(i.prototype),"copy",this).call(this,t),this.index=t.index,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).index=this.index),e}}])&&ta(e.prototype,n),r&&ta(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i})(Ot).prototype.nodeType="Colors";var ma=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ya(t,e)}(i,t);var e,n,r,o=ha(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this,"v3")).setScope(t||i.POSITION),n.setCamera(e),n}return e=i,n=[{key:"setCamera",value:function(t){this.camera=t,this.updateFrame=void 0!==t?this.onUpdateFrame:void 0}},{key:"setScope",value:function(t){if(this.scope===i.DEPTH&&(delete this.near,delete this.far),this.scope=t,t===i.DEPTH){var e=this.camera;this.near=new rr(e?e.near:1),this.far=new rr(e?e.far:1200)}}},{key:"getType",value:function(){return this.scope===i.DEPTH?"f":this.type}},{key:"getUnique",value:function(){switch(this.scope){case i.DEPTH:case i.TO_VERTEX:return!0}return!1}},{key:"getShared",value:function(){return this.scope!==i.POSITION}},{key:"generate",value:function(t,e){var n;switch(this.scope){case i.POSITION:n="cameraPosition";break;case i.DEPTH:n=t.include(i.Nodes.depthColor)+"( "+this.near.build(t,"f")+", "+this.far.build(t,"f")+" )";break;case i.TO_VERTEX:n="normalize( "+new _n(_n.WORLD).build(t,"v3")+" - cameraPosition )"}return t.format(n,this.getType(t),e)}},{key:"onUpdateFrame",value:function(){if(this.scope===i.DEPTH){var t=this.camera;this.near.value=t.near,this.far.value=t.far}}},{key:"copy",value:function(t){return la(va(i.prototype),"copy",this).call(this,t),this.setScope(t.scope),t.camera&&this.setCamera(t.camera),t.scope===i.DEPTH&&(this.near.number=t.near,this.far.number=t.far),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope,this.camera&&(e.camera=this.camera.uuid),this.scope!==i.DEPTH)||(e.near=this.near.value,e.far=this.far.value),e}}],n&&fa(e.prototype,n),r&&fa(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function ba(t){return ba="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ba(t)}function ga(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function wa(){return wa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Oa(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},wa.apply(this,arguments)}function Oa(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Sa(t)););return t}function xa(t,e){return xa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},xa(t,e)}function _a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Sa(t);if(e){var o=Sa(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Pa(this,n)}}function Pa(t,e){if(e&&("object"===ba(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Sa(t){return Sa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Sa(t)}ma.Nodes={depthColor:new Et("\n\t\tfloat depthColor( float mNear, float mFar ) {\n\n\t\t\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t\t\t#else\n\n\t\t\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t\t\t#endif\n\n\t\t\treturn 1.0 - smoothstep( mNear, mFar, depth );\n\n\t\t}")},ma.POSITION="position",ma.DEPTH="depth",ma.TO_VERTEX="toVertex",ma.prototype.nodeType="Camera";var Ta=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xa(t,e)}(i,t);var e,n,r,o=_a(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"v3",{shared:!1})).scope=t||i.TOTAL,e}return e=i,(n=[{key:"generate",value:function(t,e){return t.isCache("light")?t.format("reflectedLight.directDiffuse",this.type,e):(console.warn('THREE.LightNode is only compatible in "light" channel.'),t.format("vec3( 0.0 )",this.type,e))}},{key:"copy",value:function(t){return wa(Sa(i.prototype),"copy",this).call(this,t),this.scope=t.scope,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e}}])&&ga(e.prototype,n),r&&ga(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Aa(t){return Aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Aa(t)}function Na(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ra(){return Ra="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Fa(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ra.apply(this,arguments)}function Fa(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ka(t)););return t}function ja(t,e){return ja=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ja(t,e)}function Ea(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ka(t);if(e){var o=ka(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return La(this,n)}}function La(t,e){if(e&&("object"===Aa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ka(t){return ka=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ka(t)}Ta.TOTAL="total",Ta.prototype.nodeType="Light";var Ia=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ja(t,e)}(a,t);var e,n,o,i=Ea(a);function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this)).size=new r.Vector2,t}return e=a,(n=[{key:"updateFrame",value:function(t){if(t.renderer){t.renderer.getSize(this.size);var e=t.renderer.getPixelRatio();this.x=this.size.width*e,this.y=this.size.height*e}else console.warn("ResolutionNode need a renderer in NodeFrame")}},{key:"copy",value:function(t){return Ra(ka(a.prototype),"copy",this).call(this,t),this.renderer=t.renderer,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).renderer=this.renderer.uuid),e}}])&&Na(e.prototype,n),o&&Na(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(de);function Ca(t){return Ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ca(t)}function Da(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ua(){return Ua="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Ma(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ua.apply(this,arguments)}function Ma(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ja(t)););return t}function Xa(t,e){return Xa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Xa(t,e)}function za(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ja(t);if(e){var o=Ja(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ba(this,n)}}function Ba(t,e){if(e&&("object"===Ca(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ja(t){return Ja=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ja(t)}function Ya(t){return Ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ya(t)}function Qa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ha(){return Ha="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Va(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ha.apply(this,arguments)}function Va(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ka(t)););return t}function Ga(t,e){return Ga=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ga(t,e)}function qa(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ka(t);if(e){var o=Ka(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Wa(this,n)}}function Wa(t,e){if(e&&("object"===Ya(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ka(t){return Ka=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ka(t)}Ia.prototype.nodeType="Resolution",function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xa(t,e)}(i,t);var e,n,r,o=za(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"v2")).resolution=t||new Ia,e}return e=i,(n=[{key:"generate",value:function(t,e){var n;return t.isShader("fragment")?n="( gl_FragCoord.xy / "+this.resolution.build(t,"v2")+")":(console.warn("THREE.ScreenUVNode is not compatible with "+t.shader+" shader."),n="vec2( 0.0 )"),t.format(n,this.getType(t),e)}},{key:"copy",value:function(t){return Ua(Ja(i.prototype),"copy",this).call(this,t),this.resolution=t.resolution,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).resolution=this.resolution.toJSON(t).uuid),e}}])&&Da(e.prototype,n),r&&Da(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot).prototype.nodeType="ScreenUV";var Za=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ga(t,e)}(i,t);var e,n,r,o=qa(i);function i(t,e,n,r,a){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(u=o.call(this)).a=t,u.b=e,u.op=n,u.ifNode=r,u.elseNode=a,u}return e=i,(n=[{key:"getType",value:function(t){if(this.ifNode){var e=this.ifNode.getType(t),n=this.elseNode.getType(t);return t.getTypeLength(n)>t.getTypeLength(e)?n:e}return"b"}},{key:"getCondType",value:function(t){return t.getTypeLength(this.b.getType(t))>t.getTypeLength(this.a.getType(t))?this.b.getType(t):this.a.getType(t)}},{key:"generate",value:function(t,e){var n,r=this.getType(t),o=this.getCondType(t),i=this.a.build(t,o),a=this.b.build(t,o);if(this.ifNode){var u=this.ifNode.build(t,r),c=this.elseNode.build(t,r);n="( "+[i,this.op,a,"?",u,":",c].join(" ")+" )"}else n="( "+i+" "+this.op+" "+a+" )";return t.format(n,this.getType(t),e)}},{key:"copy",value:function(t){return Ha(Ka(i.prototype),"copy",this).call(this,t),this.a=t.a,this.b=t.b,this.op=t.op,this.ifNode=t.ifNode,this.elseNode=t.elseNode,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.op=this.op,e.ifNode&&(e.ifNode=this.ifNode.toJSON(t).uuid),e.elseNode&&(e.elseNode=this.elseNode.toJSON(t).uuid)),e}}])&&Qa(e.prototype,n),r&&Qa(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function $a(t){return $a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$a(t)}function tu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function eu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nu(){return nu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=ru(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},nu.apply(this,arguments)}function ru(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=uu(t)););return t}function ou(t,e){return ou=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ou(t,e)}function iu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=uu(t);if(e){var o=uu(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return au(this,n)}}function au(t,e){if(e&&("object"===$a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function uu(t){return uu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},uu(t)}Za.EQUAL="==",Za.NOT_EQUAL="!=",Za.GREATER=">",Za.GREATER_EQUAL=">=",Za.LESS="<",Za.LESS_EQUAL="<=",Za.AND="&&",Za.OR="||",Za.prototype.nodeType="Cond";var cu,su,fu="\nvec3 mod289( vec3 x ) {\n\n\treturn x - floor( x * ( 1.0 / 289.0 ) ) * 289.0;\n\n}\n\nvec4 mod289( vec4 x ) {\n\n\treturn x - floor( x * ( 1.0 / 289.0 ) ) * 289.0;\n\n}\n\nvec4 permute( vec4 x ) {\n\n\treturn mod289( ( ( x * 34.0 ) + 1.0 ) * x );\n\n}\n\nvec4 taylorInvSqrt( vec4 r ) {\n\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n\n}\n\nvec2 fade( vec2 t ) {\n\n\treturn t * t * t * ( t * ( t * 6.0 - 15.0 ) + 10.0 );\n\n}\n\nvec3 fade( vec3 t ) {\n\n\treturn t * t * t * ( t * ( t * 6.0 - 15.0 ) + 10.0 );\n\n}\n".trim(),lu="\nfloat noise2d( vec2 P, float amplitude, float pivot ) {\n\n\tvec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n\tvec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n\tPi = mod289(Pi); // To avoid truncation effects in permutation\n\tvec4 ix = Pi.xzxz;\n\tvec4 iy = Pi.yyww;\n\tvec4 fx = Pf.xzxz;\n\tvec4 fy = Pf.yyww;\n\n\tvec4 i = permute(permute(ix) + iy);\n\n\tvec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n\tvec4 gy = abs(gx) - 0.5 ;\n\tvec4 tx = floor(gx + 0.5);\n\tgx = gx - tx;\n\n\tvec2 g00 = vec2(gx.x,gy.x);\n\tvec2 g10 = vec2(gx.y,gy.y);\n\tvec2 g01 = vec2(gx.z,gy.z);\n\tvec2 g11 = vec2(gx.w,gy.w);\n\n\tvec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n\tg00 *= norm.x;\n\tg01 *= norm.y;\n\tg10 *= norm.z;\n\tg11 *= norm.w;\n\n\tfloat n00 = dot(g00, vec2(fx.x, fy.x));\n\tfloat n10 = dot(g10, vec2(fx.y, fy.y));\n\tfloat n01 = dot(g01, vec2(fx.z, fy.z));\n\tfloat n11 = dot(g11, vec2(fx.w, fy.w));\n\n\tvec2 fade_xy = fade(Pf.xy);\n\tvec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n\tfloat n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n\treturn 2.3 * n_xy * amplitude + pivot;\n\n}\n".trim(),pu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ou(t,e)}(i,t);var e,n,r,o=iu(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Be,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rr(1),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new rr(0);return tu(this,i),(t=o.call(this,"f")).uv=e,t.amplitude=n,t.pivot=r,t}return e=i,(n=[{key:"generate",value:function(t,e){var n=new pr(i.Nodes.noise2d,[this.uv,this.amplitude,this.pivot]);return t.format(n.generate(t,e),this.getType(t),e)}},{key:"copy",value:function(t){nu(uu(i.prototype),"copy",this).call(this,t),this.uv=t.uv,this.amplitude=t.amplitude,this.pivot=t.pivot}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid,e.amplitude=this.amplitude.toJSON(t).uuid,e.pivot=this.pivot.toJSON(t).uuid),e}}])&&eu(e.prototype,n),r&&eu(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function yu(t){return yu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yu(t)}function hu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function du(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vu(){return vu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=mu(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},vu.apply(this,arguments)}function mu(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ou(t)););return t}function bu(t,e){return bu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},bu(t,e)}function gu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ou(t);if(e){var o=Ou(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return wu(this,n)}}function wu(t,e){if(e&&("object"===yu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ou(t){return Ou=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ou(t)}pu.prototype.nodeType="Noise2D",pu.Nodes=(cu=new Et(fu),(su=new Et(lu)).includes=[cu],{noiseCommon:cu,noise2d:su});var xu,_u="\nfloat noise3d( vec3 P, float amplitude, float pivot ) {\n\n\tvec3 Pi0 = floor(P); // Integer part for indexing\n\tvec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n\tPi0 = mod289(Pi0);\n\tPi1 = mod289(Pi1);\n\tvec3 Pf0 = fract(P); // Fractional part for interpolation\n\tvec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n\tvec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\tvec4 iy = vec4(Pi0.yy, Pi1.yy);\n\tvec4 iz0 = Pi0.zzzz;\n\tvec4 iz1 = Pi1.zzzz;\n\n\tvec4 ixy = permute(permute(ix) + iy);\n\tvec4 ixy0 = permute(ixy + iz0);\n\tvec4 ixy1 = permute(ixy + iz1);\n\n\tvec4 gx0 = ixy0 * (1.0 / 7.0);\n\tvec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n\tgx0 = fract(gx0);\n\tvec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\tvec4 sz0 = step(gz0, vec4(0.0));\n\tgx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\tgy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n\tvec4 gx1 = ixy1 * (1.0 / 7.0);\n\tvec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n\tgx1 = fract(gx1);\n\tvec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\tvec4 sz1 = step(gz1, vec4(0.0));\n\tgx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\tgy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n\tvec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\tvec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\tvec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\tvec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\tvec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\tvec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\tvec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\tvec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n\tvec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\tg000 *= norm0.x;\n\tg010 *= norm0.y;\n\tg100 *= norm0.z;\n\tg110 *= norm0.w;\n\tvec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\tg001 *= norm1.x;\n\tg011 *= norm1.y;\n\tg101 *= norm1.z;\n\tg111 *= norm1.w;\n\n\tfloat n000 = dot(g000, Pf0);\n\tfloat n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\tfloat n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\tfloat n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\tfloat n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\tfloat n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\tfloat n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\tfloat n111 = dot(g111, Pf1);\n\n\tvec3 fade_xyz = fade(Pf0);\n\tvec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\tvec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\tfloat n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n\treturn 2.2 * n_xyz * amplitude + pivot;\n\n}\n".trim(),Pu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bu(t,e)}(i,t);var e,n,r,o=gu(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _n,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rr(1),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new rr(0);return hu(this,i),(t=o.call(this,"f")).position=e,t.amplitude=n,t.pivot=r,t}return e=i,(n=[{key:"generate",value:function(t,e){var n=new pr(i.Nodes.noise3d,[this.position,this.amplitude,this.pivot]);return t.format(n.generate(t,e),this.getType(t),e)}},{key:"copy",value:function(t){vu(Ou(i.prototype),"copy",this).call(this,t),this.position=t.position,this.amplitude=t.amplitude,this.pivot=t.pivot}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).position=this.position.toJSON(t).uuid,e.amplitude=this.amplitude.toJSON(t).uuid,e.pivot=this.pivot.toJSON(t).uuid),e}}])&&du(e.prototype,n),r&&du(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Su(t){return Su="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Su(t)}function Tu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Au(){return Au="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Nu(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Au.apply(this,arguments)}function Nu(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Eu(t)););return t}function Ru(t,e){return Ru=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ru(t,e)}function Fu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Eu(t);if(e){var o=Eu(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ju(this,n)}}function ju(t,e){if(e&&("object"===Su(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Eu(t){return Eu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Eu(t)}Pu.prototype.nodeType="Noise3D",Pu.Nodes=((xu=new Et(_u)).includes=[pu.Nodes.noiseCommon],{noise3d:xu});var Lu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ru(t,e)}(i,t);var e,n,r,o=Fu(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"f")).uv=t||new Be,e}return e=i,(n=[{key:"generate",value:function(t,e){var n=t.include(i.Nodes.checker);return t.format(n+"( "+this.uv.build(t,"v2")+" )",this.getType(t),e)}},{key:"copy",value:function(t){return Au(Eu(i.prototype),"copy",this).call(this,t),this.uv=t.uv,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid),e}}])&&Tu(e.prototype,n),r&&Tu(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function ku(t){return ku="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ku(t)}function Iu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Cu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Du(){return Du="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Uu(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Du.apply(this,arguments)}function Uu(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Bu(t)););return t}function Mu(t,e){return Mu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Mu(t,e)}function Xu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Bu(t);if(e){var o=Bu(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return zu(this,n)}}function zu(t,e){if(e&&("object"===ku(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Bu(t){return Bu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Bu(t)}Lu.Nodes={checker:new Et("\n\t\tfloat checker( vec2 uv ) {\n\n\t\t\tfloat cx = floor( uv.x );\n\t\t\tfloat cy = floor( uv.y );\n\t\t\tfloat result = mod( cx + cy, 2.0 );\n\n\t\t\treturn sign( result );\n\n\t\t}")},Lu.prototype.nodeType="Noise";var Ju,Yu="\nfloat fractal3d( vec3 p, float amplitude, int octaves, float lacunarity, float diminish ) {\n\n\tfloat result = 0.0;\n\n\tfor (int i = 0;  i < octaves; ++i) {\n\n\t\tresult += noise3d(p, amplitude, 0.0);\n\t\tamplitude *= diminish;\n\t\tp *= lacunarity;\n\n\t}\n\n\treturn result;\n\n}\n".trim(),Qu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Mu(t,e)}(i,t);var e,n,r,o=Xu(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _n,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rr(1),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;return Iu(this,i),(t=o.call(this,"f")).position=e,t.amplitude=n,t.octaves=new li(r).setReadonly(!0),t.lacunarity=new rr(a).setReadonly(!0),t.diminish=new rr(u).setReadonly(!0),t}return e=i,(n=[{key:"generate",value:function(t,e){var n=new pr(i.Nodes.fractal3d,[this.position,this.amplitude,this.octaves,this.lacunarity,this.diminish]);return t.format(n.generate(t,e),this.getType(t),e)}},{key:"copy",value:function(t){Du(Bu(i.prototype),"copy",this).call(this,t),this.position=t.position,this.amplitude=t.amplitude,this.octaves=t.octaves,this.lacunarity=t.lacunarity,this.diminish=t.diminish}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).position=this.position.toJSON(t).uuid,e.amplitude=this.amplitude.toJSON(t).uuid,e.octaves=this.octaves.toJSON(t).uuid,e.lacunarity=this.lacunarity.toJSON(t).uuid,e.diminish=this.diminish.toJSON(t).uuid),e}}])&&Cu(e.prototype,n),r&&Cu(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Hu(t){return Hu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hu(t)}function Vu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Gu(){return Gu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=qu(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Gu.apply(this,arguments)}function qu(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=$u(t)););return t}function Wu(t,e){return Wu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Wu(t,e)}function Ku(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=$u(t);if(e){var o=$u(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Zu(this,n)}}function Zu(t,e){if(e&&("object"===Hu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function $u(t){return $u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$u(t)}Qu.prototype.nodeType="Fractal3D",Qu.Nodes=((Ju=new Et(Yu)).includes=[Pu.Nodes.noise3d],{fractal3d:Ju});var tc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wu(t,e)}(a,t);var e,n,o,i=Ku(a);function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,"v3")).value=t,n.scale=e||new de(1,1),n}return e=a,n=[{key:"generate",value:function(t,e){if(t.isShader("fragment")){var n=t.include(a.Nodes.perturbNormal2Arb);this.normal=this.normal||new En,this.position=this.position||new _n(_n.VIEW),this.uv=this.uv||new Be;var o=this.scale.build(t,"v2");return t.material.side===r.BackSide&&(o="-"+o),t.format(n+"( -"+this.position.build(t,"v3")+", "+this.normal.build(t,"v3")+", "+this.value.build(t,"v3")+", "+this.uv.build(t,"v2")+", "+o+" )",this.getType(t),e)}return console.warn("THREE.NormalMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},{key:"copy",value:function(t){return Gu($u(a.prototype),"copy",this).call(this,t),this.value=t.value,this.scale=t.scale,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.scale=this.scale.toJSON(t).uuid),e}}],n&&Vu(e.prototype,n),o&&Vu(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ot);function ec(t){return ec="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ec(t)}function nc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function rc(){return rc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=oc(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},rc.apply(this,arguments)}function oc(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=cc(t)););return t}function ic(t,e){return ic=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ic(t,e)}function ac(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=cc(t);if(e){var o=cc(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return uc(this,n)}}function uc(t,e){if(e&&("object"===ec(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function cc(t){return cc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},cc(t)}tc.Nodes={perturbNormal2Arb:new Et("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 vUv, vec2 normalScale ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = map * 2.0 - 1.0;\n\n\t\tmapN.xy *= normalScale;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t// Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331\n\n\t\t\tif ( dot( cross( S, T ), N ) < 0.0 ) mapN.xy *= - 1.0;\n\n\t\t#else\n\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}",null,{derivatives:!0})},tc.prototype.nodeType="NormalMap";var sc,fc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ic(t,e)}(i,t);var e,n,r,o=ac(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this,"v3")).value=t,n.scale=e||new rr(1),n.toNormalMap=!1,n}return e=i,(n=[{key:"generate",value:function(t,e){if(t.isShader("fragment")){if(this.toNormalMap){var n=t.include(i.Nodes.bumpToNormal);return t.format(n+"( "+this.value.build(t,"sampler2D")+", "+this.value.uv.build(t,"v2")+", "+this.scale.build(t,"f")+" )",this.getType(t),e)}var r=t.include(i.Nodes.dHdxy_fwd),o=t.include(i.Nodes.perturbNormalArb);this.normal=this.normal||new En,this.position=this.position||new _n(_n.VIEW);var a=r+"( "+this.value.build(t,"sampler2D")+", "+this.value.uv.build(t,"v2")+", "+this.scale.build(t,"f")+" )";return t.format(o+"( -"+this.position.build(t,"v3")+", "+this.normal.build(t,"v3")+", "+a+" )",this.getType(t),e)}return console.warn("THREE.BumpMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},{key:"copy",value:function(t){return rc(cc(i.prototype),"copy",this).call(this,t),this.value=t.value,this.scale=t.scale,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.scale=this.scale.toJSON(t).uuid),e}}])&&nc(e.prototype,n),r&&nc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function lc(t){return lc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lc(t)}function pc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function yc(){return yc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=hc(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},yc.apply(this,arguments)}function hc(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=bc(t)););return t}function dc(t,e){return dc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},dc(t,e)}function vc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=bc(t);if(e){var o=bc(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return mc(this,n)}}function mc(t,e){if(e&&("object"===lc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function bc(t){return bc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},bc(t)}function gc(t){return gc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gc(t)}function wc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Oc(){return Oc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=xc(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Oc.apply(this,arguments)}function xc(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Tc(t)););return t}function _c(t,e){return _c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_c(t,e)}function Pc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Tc(t);if(e){var o=Tc(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Sc(this,n)}}function Sc(t,e){if(e&&("object"===gc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Tc(t){return Tc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Tc(t)}fc.Nodes={dHdxy_fwd:sc=new Et("\n\n\t\tvec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {\n\n\t\t\tvec2 dSTdx = dFdx( vUv );\n\t\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\t\treturn vec2( dBx, dBy );\n\n\t\t}",null,{derivatives:!0}),perturbNormalArb:new Et("\n\n\t\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\t\tvec3 vN = surf_norm; // normalized\n\n\t\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\n\t\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t\t}",[sc],{derivatives:!0}),bumpToNormal:new Et("\n\t\tvec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {\n\n\t\t\tvec2 dSTdx = dFdx( uv );\n\t\t\tvec2 dSTdy = dFdy( uv );\n\n\t\t\tfloat Hll = texture2D( bumpMap, uv ).x;\n\t\t\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;\n\t\t\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;\n\n\t\t\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );\n\n\t\t}",null,{derivatives:!0})},fc.prototype.nodeType="BumpMap",fc.prototype.hashProperties=["toNormalMap"],function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dc(t,e)}(i,t);var e,n,r,o=vc(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this)).code=t,n.value=e,n}return e=i,(n=[{key:"getType",value:function(t){return this.value?this.value.getType(t):t.isShader("fragment")?"f":"void"}},{key:"generate",value:function(t,e){var n=this.code.build(t,e)+";";return t.addNodeCode(n),t.isShader("vertex")?this.value?this.value.build(t,e):void 0:this.value?this.value.build(t,e):t.format("0.0","f",e)}},{key:"copy",value:function(t){return yc(bc(i.prototype),"copy",this).call(this,t),this.code=t.code,this.value=t.value,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).code=this.code.toJSON(t).uuid,this.value&&(e.value=this.value.toJSON(t).uuid)),e}}])&&pc(e.prototype,n),r&&pc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(lt).prototype.nodeType="Bypass";var Ac=ct.elements,Nc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_c(t,e)}(i,t);var e,n,r,o=Pc(i);function i(t,e,n,r){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(a=o.call(this,"f")).x=t,a.y=e,a.z=n,a.w=r,a}return e=i,(n=[{key:"getNumElements",value:function(){for(var t=Ac.length;t--;)if(void 0!==this[Ac[t]]){++t;break}return Math.max(t,2)}},{key:"getType",value:function(t){return t.getTypeFromLength(this.getNumElements())}},{key:"generate",value:function(t,e){for(var n=this.getType(t),r=this.getNumElements(),o=[],i=0;i<r;i++){var a=this[Ac[i]];o.push(a?a.build(t,"f"):"0.0")}var u=(r>1?t.getConstructorFromLength(r):"")+"( "+o.join(", ")+" )";return t.format(u,n,e)}},{key:"copy",value:function(t){for(var e in Oc(Tc(i.prototype),"copy",this).call(this,t),t.inputs)this[e]=t.inputs[e];return this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);if(!e){(e=this.createJSONNode(t)).inputs={};for(var n=this.getNumElements(),r=0;r<n;r++){var o=this[Ac[r]];o&&(e.inputs[Ac[r]]=o.toJSON(t).uuid)}}return e}}])&&wc(e.prototype,n),r&&wc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Rc(t){return Rc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rc(t)}function Fc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function jc(){return jc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Ec(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},jc.apply(this,arguments)}function Ec(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Cc(t)););return t}function Lc(t,e){return Lc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Lc(t,e)}function kc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Cc(t);if(e){var o=Cc(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ic(this,n)}}function Ic(t,e){if(e&&("object"===Rc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Cc(t){return Cc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Cc(t)}Nc.prototype.nodeType="Join";var Dc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lc(t,e)}(i,t);var e,n,r,o=kc(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this)).node=t,n.components=e||"x",n}return e=i,(n=[{key:"getType",value:function(t){return t.getTypeFromLength(this.components.length)}},{key:"generate",value:function(t,e){var n=this.node.getType(t),r=t.getTypeLength(n)-1,o=this.node.build(t,n);if(r>0){var i,a=0,u=t.colorToVectorProperties(this.components),c=u.length;for(i=0;i<c;i++)a=Math.max(a,t.getIndexByElement(u.charAt(i)));for(a>r&&(a=r),o+=".",i=0;i<c;i++){var s=t.getIndexByElement(u.charAt(i));s>a&&(s=a),o+=t.getElementByIndex(s)}return t.format(o,this.getType(t),e)}return t.format(o,n,e)}},{key:"copy",value:function(t){return jc(Cc(i.prototype),"copy",this).call(this,t),this.node=t.node,this.components=t.components,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).node=this.node.toJSON(t).uuid,e.components=this.components),e}}])&&Fc(e.prototype,n),r&&Fc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(lt);function Uc(t){return Uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uc(t)}function Mc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Xc(){return Xc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=zc(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Xc.apply(this,arguments)}function zc(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Qc(t)););return t}function Bc(t,e){return Bc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Bc(t,e)}function Jc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Qc(t);if(e){var o=Qc(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Yc(this,n)}}function Yc(t,e){if(e&&("object"===Uc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Qc(t){return Qc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Qc(t)}Dc.prototype.nodeType="Switch";var Hc="\nfloat remap( float value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\tfloat x = ( value - inLow ) / ( inHigh - inLow );\n\treturn outLow + ( outHigh - outLow ) * x;\n\n}\n\nvec2 remap( vec2 value, vec2 inLow, vec2 inHigh, vec2 outLow, vec2 outHigh ) {\n\n\treturn vec2(\n\t\tremap( value.x, inLow.x, inHigh.x, outLow.x, outHigh.x ),\n\t\tremap( value.y, inLow.y, inHigh.y, outLow.y, outHigh.y )\n\t);\n\n}\n\nvec2 remap( vec2 value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\treturn vec2(\n\t\tremap( value.x, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.y, inLow, inHigh, outLow, outHigh )\n\t);\n\n}\n\nvec3 remap( vec3 value, vec3 inLow, vec3 inHigh, vec3 outLow, vec3 outHigh ) {\n\n\treturn vec3(\n\t\tremap( value.x, inLow.x, inHigh.x, outLow.x, outHigh.x ),\n\t\tremap( value.y, inLow.y, inHigh.y, outLow.y, outHigh.y ),\n\t\tremap( value.z, inLow.z, inHigh.z, outLow.z, outHigh.z )\n\t);\n\n}\n\nvec3 remap( vec3 value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\treturn vec3(\n\t\tremap( value.x, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.y, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.z, inLow, inHigh, outLow, outHigh )\n\t);\n\n}\n\nvec4 remap( vec4 value, vec4 inLow, vec4 inHigh, vec4 outLow, vec4 outHigh ) {\n\n\treturn vec4(\n\t\tremap( value.x, inLow.x, inHigh.x, outLow.x, outHigh.x ),\n\t\tremap( value.y, inLow.y, inHigh.y, outLow.y, outHigh.y ),\n\t\tremap( value.z, inLow.z, inHigh.z, outLow.z, outHigh.z ),\n\t\tremap( value.w, inLow.w, inHigh.w, outLow.w, outHigh.w )\n\t);\n\n}\n\nvec4 remap( vec4 value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\treturn vec4(\n\t\tremap( value.x, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.y, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.z, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.w, inLow, inHigh, outLow, outHigh )\n\t);\n\n}\n".trim(),Vc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bc(t,e)}(i,t);var e,n,r,o=Jc(i);function i(t,e,n,r,a){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(u=o.call(this,"f")).value=t,u.inLow=e,u.inHigh=n,u.outLow=r,u.outHigh=a,u}return e=i,(n=[{key:"generate",value:function(t,e){var n=t.include(i.Nodes.remap);return t.format(n+"( "+[this.value.build(t),this.inLow.build(t),this.inHigh.build(t),this.outLow.build(t),this.outHigh.build(t)].join(", ")+" )",this.getType(t),e)}},{key:"getType",value:function(t){return this.value.getType(t)}},{key:"copy",value:function(t){Xc(Qc(i.prototype),"copy",this).call(this,t),this.value=t.value,this.inLow=t.inLow,this.inHigh=t.inHigh,this.outLow=t.outLow,this.outHigh=t.outHigh}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.inLow=this.inLow.toJSON(t).uuid,e.inHigh=this.inHigh.toJSON(t).uuid,e.outLow=this.outLow.toJSON(t).uuid,e.outHigh=this.outHigh.toJSON(t).uuid),e}}])&&Mc(e.prototype,n),r&&Mc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Gc(t){return Gc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gc(t)}function qc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Wc(){return Wc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Kc(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Wc.apply(this,arguments)}function Kc(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=es(t)););return t}function Zc(t,e){return Zc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Zc(t,e)}function $c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=es(t);if(e){var o=es(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ts(this,n)}}function ts(t,e){if(e&&("object"===Gc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function es(t){return es=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},es(t)}Vc.prototype.nodeType="Remap",Vc.Nodes={remap:new Et(Hc)};var ns=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zc(t,e)}(i,t);var e,n,r,o=$c(i);function i(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this)).scale=void 0!==t?t:1,r.scope=e||i.GLOBAL,r.timeScale=void 0!==n?n:void 0!==t,r}return e=i,n=[{key:"getReadonly",value:function(){return!1}},{key:"getUnique",value:function(){return this.timeScale&&(this.scope===i.GLOBAL||this.scope===i.DELTA)}},{key:"updateFrame",value:function(t){var e=this.timeScale?this.scale:1;switch(this.scope){case i.LOCAL:this.value+=t.delta*e;break;case i.DELTA:this.value=t.delta*e;break;default:this.value=t.time*e}}},{key:"copy",value:function(t){return Wc(es(i.prototype),"copy",this).call(this,t),this.scope=t.scope,this.scale=t.scale,this.timeScale=t.timeScale,this}},{key:"toJSON",value:function(t){var e=Wc(es(i.prototype),"toJSON",this).call(this,t);return e.scope=this.scope,e.scale=this.scale,e.timeScale=this.timeScale,e}}],n&&qc(e.prototype,n),r&&qc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(rr);function rs(t){return rs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rs(t)}function os(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function is(){return is="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=as(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},is.apply(this,arguments)}function as(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=fs(t)););return t}function us(t,e){return us=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},us(t,e)}function cs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=fs(t);if(e){var o=fs(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ss(this,n)}}function ss(t,e){if(e&&("object"===rs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function fs(t){return fs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},fs(t)}function ls(t){return ls="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ls(t)}function ps(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ys(){return ys="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=hs(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},ys.apply(this,arguments)}function hs(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=bs(t)););return t}function ds(t,e){return ds=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ds(t,e)}function vs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=bs(t);if(e){var o=bs(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ms(this,n)}}function ms(t,e){if(e&&("object"===ls(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function bs(t){return bs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},bs(t)}function gs(t){return gs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gs(t)}function ws(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Os(t,e){return Os=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Os(t,e)}function xs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ps(t);if(e){var o=Ps(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return _s(this,n)}}function _s(t,e){if(e&&("object"===gs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ps(t){return Ps=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ps(t)}ns.GLOBAL="global",ns.LOCAL="local",ns.DELTA="delta",ns.prototype.nodeType="Timer",st.addKeyword("time",(function(){return new ns})),function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&us(t,e)}(a,t);var e,n,o,i=cs(a);function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this)).params={},n.velocity=new r.Vector3,n.setTarget(t),n.setParams(e),n}return e=a,(n=[{key:"getReadonly",value:function(){return!1}},{key:"setParams",value:function(t){"elastic"===this.params.type&&(delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity),this.params=t||{},"elastic"===this.params.type&&(this.moment=new r.Vector3,this.speed=new r.Vector3,this.springVelocity=new r.Vector3,this.lastVelocity=new r.Vector3)}},{key:"setTarget",value:function(t){this.target&&(delete this.position,delete this.oldPosition),this.target=t,t&&(this.position=t.getWorldPosition(this.position||new r.Vector3),this.oldPosition=this.position.clone())}},{key:"updateFrameVelocity",value:function(){this.target&&(this.position=this.target.getWorldPosition(this.position||new r.Vector3),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))}},{key:"updateFrame",value:function(t){if(this.updateFrameVelocity(t),"elastic"===this.params.type){var e=t.delta*(this.params.fps||60),n=Math.pow(this.params.spring,e),r=Math.pow(this.params.damping,e);this.velocity.multiplyScalar(Math.exp(-this.params.damping*e)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(r).multiplyScalar(1-n)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(n),this.moment.add(this.springVelocity),this.moment.multiplyScalar(r),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment)}else this.value.copy(this.velocity)}},{key:"copy",value:function(t){return is(fs(a.prototype),"copy",this).call(this,t),t.target&&this.setTarget(t.target),this.setParams(t.params),this}},{key:"toJSON",value:function(t){var e=is(fs(a.prototype),"toJSON",this).call(this,t);return this.target&&(e.target=this.target.uuid),e.params=JSON.parse(JSON.stringify(this.params)),e}}])&&os(e.prototype,n),o&&os(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(Pe).prototype.nodeType="Velocity",function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ds(t,e)}(i,t);var e,n,r,o=vs(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2")).uv=t||new Be,n.position=e||new wi,n}return e=i,(n=[{key:"generate",value:function(t,e){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.position,ys(bs(i.prototype),"generate",this).call(this,t,e)}},{key:"setUvTransform",value:function(t,e,n,r,o,i,a){i=void 0!==i?i:.5,a=void 0!==a?a:.5,this.position.value.setUvTransform(t,e,n,r,o,i,a)}},{key:"copy",value:function(t){return ys(bs(i.prototype),"copy",this).call(this,t),this.uv=t.uv,this.position=t.position,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid,e.position=this.position.toJSON(t).uuid),e}}])&&ps(e.prototype,n),r&&ps(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(on).prototype.nodeType="UVTransform";var Ss=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Os(t,e)}(i,t);var e,n,r,o=xs(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this)).texture=t,e.maxMIPLevel=0,e}return e=i,(n=[{key:"value",get:function(){if(0===this.maxMIPLevel){var t=this.texture.value.image;Array.isArray(t)&&(t=t[0]),this.maxMIPLevel=void 0!==t?Math.log(Math.max(t.width,t.height))*Math.LOG2E:0}return this.maxMIPLevel},set:function(t){}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).texture=this.texture.uuid),e}}])&&ws(e.prototype,n),r&&ws(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(rr);function Ts(t){return Ts="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ts(t)}function As(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ns(){return Ns="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Rs(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ns.apply(this,arguments)}function Rs(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ls(t)););return t}function Fs(t,e){return Fs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Fs(t,e)}function js(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ls(t);if(e){var o=Ls(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Es(this,n)}}function Es(t,e){if(e&&("object"===Ts(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ls(t){return Ls=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ls(t)}Ss.prototype.nodeType="MaxMIPLevel";var ks=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fs(t,e)}(i,t);var e,n,r,o=js(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this,"f")).roughness=t,n.texture=e,n.maxMIPLevel=void 0,n}return e=i,(n=[{key:"setTexture",value:function(t){return this.texture=t,this}},{key:"generate",value:function(t,e){if(t.isShader("fragment")){this.maxMIPLevel=this.maxMIPLevel||new Ss,this.maxMIPLevel.texture=this.texture;var n=t.include(i.Nodes.getSpecularMIPLevel);return t.format(n+"( "+this.roughness.build(t,"f")+", "+this.maxMIPLevel.build(t,"f")+" )",this.type,e)}return console.warn("THREE.SpecularMIPLevelNode is not compatible with "+t.shader+" shader."),t.format("0.0",this.type,e)}},{key:"copy",value:function(t){return Ns(Ls(i.prototype),"copy",this).call(this,t),this.texture=t.texture,this.roughness=t.roughness,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).texture=this.texture,e.roughness=this.roughness),e}}])&&As(e.prototype,n),r&&As(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function Is(t){return Is="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Is(t)}function Cs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ds(){return Ds="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Us(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ds.apply(this,arguments)}function Us(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Bs(t)););return t}function Ms(t,e){return Ms=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ms(t,e)}function Xs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Bs(t);if(e){var o=Bs(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return zs(this,n)}}function zs(t,e){if(e&&("object"===Is(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Bs(t){return Bs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Bs(t)}function Js(t){return Js="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Js(t)}function Ys(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Qs(){return Qs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Hs(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Qs.apply(this,arguments)}function Hs(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ws(t)););return t}function Vs(t,e){return Vs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Vs(t,e)}function Gs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ws(t);if(e){var o=Ws(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return qs(this,n)}}function qs(t,e){if(e&&("object"===Js(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ws(t){return Ws=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ws(t)}ks.Nodes={getSpecularMIPLevel:new Et("\n\n\t\tfloat getSpecularMIPLevel( const in float roughness, const in float maxMIPLevelScalar ) {\n\n\t\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t\t}")},ks.prototype.nodeType="SpecularMIPLevel",function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ms(t,e)}(i,t);var e,n,r,o=Xs(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this)).slots=t||{},e}return e=i,(n=[{key:"getType",value:function(t,e){return e}},{key:"generate",value:function(t,e){return this.slots[t.slot]?this.slots[t.slot].build(t,e):t.format("0.0","f",e)}},{key:"copy",value:function(t){for(var e in Ds(Bs(i.prototype),"copy",this).call(this,t),t.slots)this.slots[e]=t.slots[e];return this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);if(!e)for(var n in(e=this.createJSONNode(t)).slots={},this.slots){var r=this.slots[n];r&&(e.slots[n]=r.toJSON(t).uuid)}return e}}])&&Cs(e.prototype,n),r&&Cs(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot).prototype.nodeType="SubSlot";var Ks=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vs(t,e)}(a,t);var e,n,o,i=Gs(a);function a(t,e,n,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(o=i.call(this,"v4")).value=t,o.uv=e||new Be,o.radius=n||new de(1,1),o.size=r,o.blurX=!0,o.blurY=!0,o.horizontal=new rr(1/64),o.vertical=new rr(1/64),o}return e=a,(n=[{key:"updateFrame",value:function(){if(this.size)this.horizontal.value=this.radius.x/this.size.x,this.vertical.value=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){var t=this.value.value.image;this.horizontal.value=this.radius.x/t.width,this.vertical.value=this.radius.y/t.height}}},{key:"generate",value:function(t,e){if(t.isShader("fragment")){var n,r=[],o=t.include(a.Nodes.blurX),i=t.include(a.Nodes.blurY);return this.blurX&&r.push(o+"( "+this.value.build(t,"sampler2D")+", "+this.uv.build(t,"v2")+", "+this.horizontal.build(t,"f")+" )"),this.blurY&&r.push(i+"( "+this.value.build(t,"sampler2D")+", "+this.uv.build(t,"v2")+", "+this.vertical.build(t,"f")+" )"),n=2==r.length?"( "+r.join(" + ")+" / 2.0 )":r.length?"( "+r[0]+" )":"vec4( 0.0 )",t.format(n,this.getType(t),e)}return console.warn("THREE.BlurNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}},{key:"copy",value:function(t){return Qs(Ws(a.prototype),"copy",this).call(this,t),this.value=t.value,this.uv=t.uv,this.radius=t.radius,void 0!==t.size&&(this.size=new r.Vector2(t.size.x,t.size.y)),this.blurX=t.blurX,this.blurY=t.blurY,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.uv=this.uv.toJSON(t).uuid,e.radius=this.radius.toJSON(t).uuid,this.size&&(e.size={x:this.size.x,y:this.size.y}),e.blurX=this.blurX,e.blurY=this.blurY),e}}])&&Ys(e.prototype,n),o&&Ys(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ot);function Zs(t){return Zs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zs(t)}function $s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function tf(){return tf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=ef(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},tf.apply(this,arguments)}function ef(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=af(t)););return t}function nf(t,e){return nf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},nf(t,e)}function rf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=af(t);if(e){var o=af(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return of(this,n)}}function of(t,e){if(e&&("object"===Zs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function af(t){return af=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},af(t)}Ks.Nodes={blurX:new Et("\n\t\tvec4 blurX( sampler2D tex, vec2 uv, float s ) {\n\t\t\tvec4 sum = vec4( 0.0 );\n\t\t\tsum += texture2D( tex, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tex, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;\n\t\t\treturn sum * .667;\n\t\t}"),blurY:new Et("\n\t\tvec4 blurY( sampler2D tex, vec2 uv, float s ) {\n\t\t\tvec4 sum = vec4( 0.0 );\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;\n\t\t\treturn sum * .667;\n\t\t}")},Ks.prototype.nodeType="Blur",Ks.prototype.hashProperties=["blurX","blurY"];var uf,cf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&nf(t,e)}(i,t);var e,n,r,o=rf(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,"f")).rgb=t,e}return e=i,(n=[{key:"generate",value:function(t,e){var n=t.include(i.Nodes.luminance);return t.format(n+"( "+this.rgb.build(t,"v3")+" )",this.getType(t),e)}},{key:"copy",value:function(t){return tf(af(i.prototype),"copy",this).call(this,t),this.rgb=t.rgb,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid),e}}])&&$s(e.prototype,n),r&&$s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function sf(t){return sf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sf(t)}function ff(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function lf(){return lf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=pf(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},lf.apply(this,arguments)}function pf(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=vf(t)););return t}function yf(t,e){return yf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},yf(t,e)}function hf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=vf(t);if(e){var o=vf(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return df(this,n)}}function df(t,e){if(e&&("object"===sf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function vf(t){return vf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},vf(t)}cf.Nodes={LUMA:uf=new Bt("vec3 LUMA vec3( 0.2125, 0.7154, 0.0721 )"),luminance:new Et("\n\n\t\tfloat luminance( vec3 rgb ) {\n\n\t\t\treturn dot( rgb, LUMA );\n\n\t\t}",[uf])},cf.prototype.nodeType="Luminance";var mf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yf(t,e)}(i,t);var e,n,r,o=hf(i);function i(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this,"v3")).rgb=t,r.adjustment=e,r.method=n||i.SATURATION,r}return e=i,(n=[{key:"generate",value:function(t,e){var n=this.rgb.build(t,"v3"),r=this.adjustment.build(t,"f");switch(this.method){case i.BRIGHTNESS:return t.format("( "+n+" + "+r+" )",this.getType(t),e);case i.CONTRAST:return t.format("( "+n+" * "+r+" )",this.getType(t),e)}var o=t.include(i.Nodes[this.method]);return t.format(o+"( "+n+", "+r+" )",this.getType(t),e)}},{key:"copy",value:function(t){return lf(vf(i.prototype),"copy",this).call(this,t),this.rgb=t.rgb,this.adjustment=t.adjustment,this.method=t.method,this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid,e.adjustment=this.adjustment.toJSON(t).uuid,e.method=this.method),e}}])&&ff(e.prototype,n),r&&ff(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ot);function bf(t){return bf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bf(t)}function gf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function wf(){return wf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Of(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},wf.apply(this,arguments)}function Of(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Sf(t)););return t}function xf(t,e){return xf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},xf(t,e)}function _f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Sf(t);if(e){var o=Sf(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Pf(this,n)}}function Pf(t,e){if(e&&("object"===bf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Sf(t){return Sf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Sf(t)}mf.Nodes={hue:new Et("\n\t\tvec3 hue(vec3 rgb, float adjustment) {\n\n\t\t\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);\n\t\t\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);\n\n\t\t\tvec3 yiq = RGBtoYIQ * rgb;\n\n\t\t\tfloat hue = atan(yiq.z, yiq.y) + adjustment;\n\t\t\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);\n\n\t\t\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));\n\n\t\t}"),saturation:new Et("\n\t\tvec3 saturation(vec3 rgb, float adjustment) {\n\n\t\t\tvec3 intensity = vec3( luminance( rgb ) );\n\n\t\t\treturn mix( intensity, rgb, adjustment );\n\n\t\t}",[cf.Nodes.luminance]),vibrance:new Et("\n\n\t\tvec3 vibrance(vec3 rgb, float adjustment) {\n\n\t\t\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;\n\n\t\t\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));\n\t\t\tfloat amt = (mx - average) * (-3.0 * adjustment);\n\n\t\t\treturn mix(rgb.rgb, vec3(mx), amt);\n\n\t\t}")},mf.SATURATION="saturation",mf.HUE="hue",mf.VIBRANCE="vibrance",mf.BRIGHTNESS="brightness",mf.CONTRAST="contrast",mf.prototype.nodeType="ColorAdjustment",mf.prototype.hashProperties=["method"];var Tf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xf(t,e)}(i,t);var e,n,r,o=_f(i);function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this)).color=new co(16777215),t}return e=i,n=[{key:"generate",value:function(t){var e;if(t.isShader("vertex")){var n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0,r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>"];r.push("#include <begin_vertex>"),n&&r.push(n.code,n.result?"transformed = "+n.result+";":""),r.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <logdepthbuf_vertex>","#include <worldpos_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>"),e=r.join("\n")}else{this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.mask&&this.mask.analyze(t);var o=this.color.flow(t,"c",{slot:"color"}),i=this.alpha?this.alpha.flow(t,"f"):void 0,a=this.mask?this.mask.flow(t,"b"):void 0;t.requires.transparent=void 0!==i;var u=[o.code];a&&u.push(a.code,"if ( ! "+a.result+" ) discard;"),i&&u.push(i.code,"#ifdef ALPHATEST"," if ( "+i.result+" <= ALPHATEST ) discard;","#endif"),i?u.push("gl_FragColor = vec4("+o.result+", "+i.result+" );"):u.push("gl_FragColor = vec4("+o.result+", 1.0 );"),e=u.join("\n")}return e}},{key:"copy",value:function(t){return wf(Sf(i.prototype),"copy",this).call(this,t),this.color=t.color,t.position&&(this.position=t.position),t.alpha&&(this.alpha=t.alpha),t.mask&&(this.mask=t.mask),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).color=this.color.toJSON(t).uuid,this.position&&(e.position=this.position.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.mask&&(e.mask=this.mask.toJSON(t).uuid)),e}}],n&&gf(e.prototype,n),r&&gf(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(lt);function Af(t){return Af="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Af(t)}function Nf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Rf(){return Rf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Ff(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Rf.apply(this,arguments)}function Ff(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=kf(t)););return t}function jf(t,e){return jf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},jf(t,e)}function Ef(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=kf(t);if(e){var o=kf(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Lf(this,n)}}function Lf(t,e){if(e&&("object"===Af(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function kf(t){return kf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},kf(t)}Tf.prototype.nodeType="Basic";var If=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jf(t,e)}(a,t);var e,n,o,i=Ef(a);function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this)).color=new co(15658734),t.spherical=!0,t}return e=a,n=[{key:"build",value:function(t){var e;if(t.define("SPRITE"),t.requires.lights=!1,t.requires.transparent=void 0!==this.alpha,t.isShader("vertex")){var n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(r.UniformsUtils.merge([r.UniformsLib.fog])),t.addParsCode("\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>"),e=["#include <clipping_planes_fragment>","#include <begin_vertex>"],n&&e.push(n.code,n.result?"transformed = "+n.result+";":""),e.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||e.push("modelMtx[1][1] = 1.0;"),e.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&e.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),e.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>")}else{t.addParsCode("\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <clipping_planes_pars_fragment>"),t.addCode("\n\t\t\t\t#include <clipping_planes_fragment>\n\t\t\t\t#include <logdepthbuf_fragment>"),this.mask&&this.mask.analyze(t),this.alpha&&this.alpha.analyze(t),this.color.analyze(t,{slot:"color"});var o=this.mask?this.mask.flow(t,"b"):void 0,i=this.alpha?this.alpha.flow(t,"f"):void 0,a=this.color.flow(t,"c",{slot:"color"});e=[],o&&e.push(o.code,"if ( ! "+o.result+" ) discard;"),i?e.push(i.code,"#ifdef ALPHATEST","if ( "+i.result+" <= ALPHATEST ) discard;","#endif",a.code,"gl_FragColor = vec4( "+a.result+", "+i.result+" );"):e.push(a.code,"gl_FragColor = vec4( "+a.result+", 1.0 );"),e.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>")}return e.join("\n")}},{key:"copy",value:function(t){return Rf(kf(a.prototype),"copy",this).call(this,t),t.position&&(this.position=t.position),this.color=t.color,void 0!==t.spherical&&(this.spherical=t.spherical),t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,!1===this.spherical&&(e.spherical=!1),this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid)),e}}],n&&Nf(e.prototype,n),o&&Nf(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(lt);function Cf(t){return Cf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cf(t)}function Df(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Uf(){return Uf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Mf(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Uf.apply(this,arguments)}function Mf(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Jf(t)););return t}function Xf(t,e){return Xf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Xf(t,e)}function zf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Jf(t);if(e){var o=Jf(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Bf(this,n)}}function Bf(t,e){if(e&&("object"===Cf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Jf(t){return Jf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Jf(t)}If.prototype.nodeType="Sprite";var Yf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xf(t,e)}(a,t);var e,n,o,i=zf(a);function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this)).color=new co(15658734),t.specular=new co(1118481),t.shininess=new rr(30),t}return e=a,n=[{key:"build",value:function(t){var e;if(t.define("PHONG"),t.requires.lights=!0,t.isShader("vertex")){var n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(r.UniformsUtils.merge([r.UniformsLib.fog,r.UniformsLib.lights])),t.addParsCode('\n\t\t\t\tvarying vec3 vViewPosition;\n\n\t\t\t\t//"#include <encodings_pars_fragment> // encoding functions\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <normal_pars_vertex>\n\t\t\t\t#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\t\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>');var o=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <normal_vertex>","#include <begin_vertex>"];n&&o.push(n.code,n.result?"transformed = "+n.result+";":""),o.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),e=o.join("\n")}else{this.mask&&this.mask.analyze(t),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t),this.alpha&&this.alpha.analyze(t),this.normal&&this.normal.analyze(t),this.light&&this.light.analyze(t,{cache:"light"}),this.ao&&this.ao.analyze(t),this.ambient&&this.ambient.analyze(t),this.shadow&&this.shadow.analyze(t),this.emissive&&this.emissive.analyze(t,{slot:"emissive"}),this.environment&&this.environment.analyze(t,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.analyze(t);var i=this.mask?this.mask.flow(t,"b"):void 0,a=this.color.flow(t,"c",{slot:"color"}),u=this.specular.flow(t,"c"),c=this.shininess.flow(t,"f"),s=this.alpha?this.alpha.flow(t,"f"):void 0,f=this.normal?this.normal.flow(t,"v3"):void 0,l=this.light?this.light.flow(t,"v3",{cache:"light"}):void 0,p=this.ao?this.ao.flow(t,"f"):void 0,y=this.ambient?this.ambient.flow(t,"c"):void 0,h=this.shadow?this.shadow.flow(t,"c"):void 0,d=this.emissive?this.emissive.flow(t,"c",{slot:"emissive"}):void 0,v=this.environment?this.environment.flow(t,"c",{slot:"environment"}):void 0,m=this.environmentAlpha&&this.environment?this.environmentAlpha.flow(t,"f"):void 0;t.requires.transparent=void 0!==s,t.addParsCode("\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <bsdfs>\n\t\t\t\t#include <lights_pars_begin>\n\t\t\t\t#include <normal_pars_fragment>\n\t\t\t\t#include <lights_phong_pars_fragment>\n\t\t\t\t#include <shadowmap_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>");var b=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;"];i&&b.push(i.code,"if ( ! "+i.result+" ) discard;"),b.push(a.code,"\tvec3 diffuseColor = "+a.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",u.code,"\tvec3 specular = "+u.result+";",c.code,"\tfloat shininess = max( 0.0001, "+c.result+" );","\tfloat specularStrength = 1.0;"),s&&b.push(s.code,"#ifdef ALPHATEST","if ( "+s.result+" <= ALPHATEST ) discard;","#endif"),f&&b.push(f.code,"normal = "+f.result+";"),b.push("material.diffuseColor = "+(l?"vec3( 1.0 )":"diffuseColor")+";"),b.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),l&&(b.push(l.code,"reflectedLight.directDiffuse = "+l.result+";"),b.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),p&&b.push(p.code,"reflectedLight.indirectDiffuse *= "+p.result+";"),y&&b.push(y.code,"reflectedLight.indirectDiffuse += "+y.result+";"),h&&b.push(h.code,"reflectedLight.directDiffuse *= "+h.result+";","reflectedLight.directSpecular *= "+h.result+";"),d&&b.push(d.code,"reflectedLight.directDiffuse += "+d.result+";"),b.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),v&&(b.push(v.code),m?b.push(m.code,"outgoingLight = mix( outgoingLight, "+v.result+", "+m.result+" );"):b.push("outgoingLight = "+v.result+";")),s?b.push("gl_FragColor = vec4( outgoingLight, "+s.result+" );"):b.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),b.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>"),e=b.join("\n")}return e}},{key:"copy",value:function(t){return Uf(Jf(a.prototype),"copy",this).call(this,t),t.position&&(this.position=t.position),this.color=t.color,this.specular=t.specular,this.shininess=t.shininess,t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),t.normal&&(this.normal=t.normal),t.light&&(this.light=t.light),t.shadow&&(this.shadow=t.shadow),t.ao&&(this.ao=t.ao),t.emissive&&(this.emissive=t.emissive),t.ambient&&(this.ambient=t.ambient),t.environment&&(this.environment=t.environment),t.environmentAlpha&&(this.environmentAlpha=t.environmentAlpha),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.specular=this.specular.toJSON(t).uuid,e.shininess=this.shininess.toJSON(t).uuid,this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid),this.environmentAlpha&&(e.environmentAlpha=this.environmentAlpha.toJSON(t).uuid)),e}}],n&&Df(e.prototype,n),o&&Df(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(lt);function Qf(t){return Qf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qf(t)}function Hf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Vf(){return Vf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Gf(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Vf.apply(this,arguments)}function Gf(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Zf(t)););return t}function qf(t,e){return qf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},qf(t,e)}function Wf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Zf(t);if(e){var o=Zf(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Kf(this,n)}}function Kf(t,e){if(e&&("object"===Qf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Zf(t){return Zf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Zf(t)}Yf.prototype.nodeType="Phong";var $f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qf(t,e)}(a,t);var e,n,o,i=Wf(a);function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this)).color=new co(16777215),t.roughness=new rr(1),t.metalness=new rr(0),t}return e=a,n=[{key:"build",value:function(t){var e;t.define("STANDARD");var n=this.clearcoat||this.clearcoatRoughness||this.clearCoatNormal;if(n&&(t.define("CLEARCOAT"),t.define("USE_CLEARCOAT")),t.requires.lights=!0,t.extensions.derivatives=!0,t.extensions.shaderTextureLOD=!0,t.isShader("vertex")){var o=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(r.UniformsUtils.merge([r.UniformsLib.fog,r.UniformsLib.lights])),r.UniformsLib.LTC_1&&(t.uniforms.ltc_1={value:void 0},t.uniforms.ltc_2={value:void 0}),t.addParsCode('\n\t\t\t\tvarying vec3 vViewPosition;\n\n\t\t\t\t#ifndef FLAT_SHADED\n\n\t\t\t\t\tvarying vec3 vNormal;\n\n\t\t\t\t#endif\n\n\t\t\t\t//"#include <encodings_pars_fragment> // encoding functions\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\t\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>');var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];o&&i.push(o.code,o.result?"transformed = "+o.result+";":""),i.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),e=i.join("\n")}else{var a=new on("material.roughness","f"),u=new on("material.clearcoatRoughness","f"),c={roughness:a,bias:new ks(a),viewNormal:new on("normal","v3"),worldNormal:new on("inverseTransformDirection( geometry.normal, viewMatrix )","v3"),gamma:!0},s={gamma:!0},f={roughness:u,bias:new ks(u),viewNormal:new on("clearcoatNormal","v3"),worldNormal:new on("inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )","v3"),gamma:!0};this.mask&&this.mask.analyze(t),this.color.analyze(t,{slot:"color",context:s}),this.roughness.analyze(t),this.metalness.analyze(t),this.alpha&&this.alpha.analyze(t),this.normal&&this.normal.analyze(t),this.clearcoat&&this.clearcoat.analyze(t),this.clearcoatRoughness&&this.clearcoatRoughness.analyze(t),this.clearcoatNormal&&this.clearcoatNormal.analyze(t),this.reflectivity&&this.reflectivity.analyze(t),this.light&&this.light.analyze(t,{cache:"light"}),this.ao&&this.ao.analyze(t),this.ambient&&this.ambient.analyze(t),this.shadow&&this.shadow.analyze(t),this.emissive&&this.emissive.analyze(t,{slot:"emissive"}),this.environment&&(this.environment.analyze(t,{cache:"radiance",context:c,slot:"radiance"}),t.requires.irradiance&&this.environment.analyze(t,{cache:"irradiance",context:c,slot:"irradiance"})),this.sheenColor&&this.sheenColor.analyze(t);var l,p=this.mask?this.mask.flow(t,"b"):void 0,y=this.color.flow(t,"c",{slot:"color",context:s}),h=this.roughness.flow(t,"f"),d=this.metalness.flow(t,"f"),v=this.alpha?this.alpha.flow(t,"f"):void 0,m=this.normal?this.normal.flow(t,"v3"):void 0,b=this.clearcoat?this.clearcoat.flow(t,"f"):void 0,g=this.clearcoatRoughness?this.clearcoatRoughness.flow(t,"f"):void 0,w=this.clearcoatNormal?this.clearcoatNormal.flow(t,"v3"):void 0,O=this.reflectivity?this.reflectivity.flow(t,"f"):void 0,x=this.light?this.light.flow(t,"v3",{cache:"light"}):void 0,_=this.ao?this.ao.flow(t,"f"):void 0,P=this.ambient?this.ambient.flow(t,"c"):void 0,S=this.shadow?this.shadow.flow(t,"c"):void 0,T=this.emissive?this.emissive.flow(t,"c",{slot:"emissive"}):void 0;this.environment&&(l={radiance:this.environment.flow(t,"c",{cache:"radiance",context:c,slot:"radiance"})},t.requires.irradiance&&(l.irradiance=this.environment.flow(t,"c",{cache:"irradiance",context:c,slot:"irradiance"})));var A=n&&l?this.environment.flow(t,"c",{cache:"clearcoat",context:f,slot:"environment"}):void 0,N=this.sheenColor?this.sheenColor.flow(t,"c"):void 0;t.requires.transparent=void 0!==v,t.addParsCode("\n\t\t\t\tvarying vec3 vViewPosition;\n\n\t\t\t\t#define NODE_MAXIMUM_SPECULAR_COEFFICIENT 0.16\n\t\t\t\t#define NODE_DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n\t\t\t\t#ifndef FLAT_SHADED\n\n\t\t\t\t\tvarying vec3 vNormal;\n\n\t\t\t\t#endif\n\n\t\t\t\t#include <dithering_pars_fragment>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <bsdfs>\n\t\t\t\t#include <lights_pars_begin>\n\t\t\t\t#include <lights_physical_pars_fragment>\n\t\t\t\t#include <shadowmap_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>");var R=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\t#include <clearcoat_normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];p&&R.push(p.code,"if ( ! "+p.result+" ) discard;"),R.push(y.code,"\tvec3 diffuseColor = "+y.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",h.code,"\tfloat roughnessFactor = "+h.result+";",d.code,"\tfloat metalnessFactor = "+d.result+";"),v&&R.push(v.code,"#ifdef ALPHATEST","\tif ( "+v.result+" <= ALPHATEST ) discard;","#endif"),m&&R.push(m.code,"normal = "+m.result+";"),w&&R.push(w.code,"clearcoatNormal = "+w.result+";"),R.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),R.push("material.diffuseColor = "+(x?"vec3( 1.0 )":"diffuseColor * ( 1.0 - metalnessFactor )")+";","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),b?R.push(b.code,"material.clearcoat = saturate( "+b.result+" );"):n&&R.push("material.clearcoat = 0.0;"),g?R.push(g.code,"material.clearcoatRoughness = max( "+g.result+", 0.0525 );","material.clearcoatRoughness += geometryRoughness;","material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );"):n&&R.push("material.clearcoatRoughness = 0.0;"),N&&R.push("material.sheenColor = "+N.result+";"),O?R.push(O.code,"material.specularColor = mix( vec3( NODE_MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+O.result+" ) ), diffuseColor, metalnessFactor );"):R.push("material.specularColor = mix( vec3( NODE_DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),R.push("#include <lights_fragment_begin>"),x&&(R.push(x.code,"reflectedLight.directDiffuse = "+x.result+";"),R.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),_&&R.push(_.code,"reflectedLight.indirectDiffuse *= "+_.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+_.result+", material.roughness );"),P&&R.push(P.code,"reflectedLight.indirectDiffuse += "+P.result+";"),S&&R.push(S.code,"reflectedLight.directDiffuse *= "+S.result+";","reflectedLight.directSpecular *= "+S.result+";"),T&&R.push(T.code,"reflectedLight.directDiffuse += "+T.result+";"),l&&(R.push(l.radiance.code),t.requires.irradiance&&R.push(l.irradiance.code),A&&R.push(A.code,"clearcoatRadiance += "+A.result+";"),R.push("radiance += "+l.radiance.result+";"),t.requires.irradiance&&R.push("iblIrradiance += PI * "+l.irradiance.result+";")),R.push("#include <lights_fragment_end>"),R.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),v?R.push("gl_FragColor = vec4( outgoingLight, "+v.result+" );"):R.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),R.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>","#include <dithering_fragment>"),e=R.join("\n")}return e}},{key:"copy",value:function(t){return Vf(Zf(a.prototype),"copy",this).call(this,t),t.position&&(this.position=t.position),this.color=t.color,this.roughness=t.roughness,this.metalness=t.metalness,t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),t.normal&&(this.normal=t.normal),t.clearcoat&&(this.clearcoat=t.clearcoat),t.clearcoatRoughness&&(this.clearcoatRoughness=t.clearcoatRoughness),t.clearcoatNormal&&(this.clearcoatNormal=t.clearcoatNormal),t.reflectivity&&(this.reflectivity=t.reflectivity),t.light&&(this.light=t.light),t.shadow&&(this.shadow=t.shadow),t.ao&&(this.ao=t.ao),t.emissive&&(this.emissive=t.emissive),t.ambient&&(this.ambient=t.ambient),t.environment&&(this.environment=t.environment),t.sheenColor&&(this.sheenColor=t.sheenColor),this}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.roughness=this.roughness.toJSON(t).uuid,e.metalness=this.metalness.toJSON(t).uuid,this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.clearcoat&&(e.clearcoat=this.clearcoat.toJSON(t).uuid),this.clearcoatRoughness&&(e.clearcoatRoughness=this.clearcoatRoughness.toJSON(t).uuid),this.clearcoatNormal&&(e.clearcoatNormal=this.clearcoatNormal.toJSON(t).uuid),this.reflectivity&&(e.reflectivity=this.reflectivity.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid),this.sheenColor&&(e.sheenColor=this.sheenColor.toJSON(t).uuid)),e}}],n&&Hf(e.prototype,n),o&&Hf(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(lt);function tl(t){return tl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tl(t)}function el(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nl(){return nl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=rl(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},nl.apply(this,arguments)}function rl(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ul(t)););return t}function ol(t,e){return ol=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ol(t,e)}function il(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ul(t);if(e){var o=ul(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return al(this,n)}}function al(t,e){if(e&&("object"===tl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ul(t){return ul=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ul(t)}$f.prototype.nodeType="Standard";var cl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ol(t,e)}(a,t);var e,n,o,i=il(a);function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this)).properties={color:new r.Color(16777215),roughness:.5,metalness:.5,normalScale:new r.Vector2(1,1)},t.inputs={color:new Bi(t.properties,"color","c"),roughness:new Bi(t.properties,"roughness","f"),metalness:new Bi(t.properties,"metalness","f"),normalScale:new Bi(t.properties,"normalScale","v2")},t}return e=a,n=[{key:"build",value:function(t){var e=this.properties,n=this.inputs;if(t.isShader("fragment")){var r=t.findNode(e.color,n.color),o=t.resolve(e.map);this.color=o?new Or(r,o,Or.MUL):r;var i=t.findNode(e.roughness,n.roughness),u=t.resolve(e.roughnessMap);this.roughness=u?new Or(i,new Dc(u,"g"),Or.MUL):i;var c=t.findNode(e.metalness,n.metalness),s=t.resolve(e.metalnessMap);this.metalness=s?new Or(c,new Dc(s,"b"),Or.MUL):c,e.normalMap?(this.normal=new tc(t.resolve(e.normalMap)),this.normal.scale=t.findNode(e.normalScale,n.normalScale)):this.normal=void 0,this.environment=t.resolve(e.envMap)}return nl(ul(a.prototype),"build",this).call(this,t)}},{key:"toJSON",value:function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),console.warn(".toJSON not implemented in",this)),e}}],n&&el(e.prototype,n),o&&el(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}($f);function sl(t){return sl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sl(t)}function fl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ll(t,e){return ll=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ll(t,e)}function pl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=hl(t);if(e){var o=hl(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return yl(this,n)}}function yl(t,e){if(e&&("object"===sl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function hl(t){return hl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},hl(t)}cl.prototype.nodeType="MeshStandard";var dl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ll(t,e)}(i,t);var e,n,r,o=pl(i);function i(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var e=new Tf;return(t=o.call(this,e,e)).type="BasicNodeMaterial",t}return e=i,n&&fl(e.prototype,n),r&&fl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(So);function vl(t){return vl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vl(t)}function ml(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function bl(t,e){return bl=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},bl(t,e)}function gl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ol(t);if(e){var o=Ol(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return wl(this,n)}}function wl(t,e){if(e&&("object"===vl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ol(t){return Ol=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ol(t)}ct.addShortcuts(dl.prototype,"fragment",["color","alpha","mask","position"]);var xl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bl(t,e)}(i,t);var e,n,r,o=gl(i);function i(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var e=new If;return(t=o.call(this,e,e)).type="SpriteNodeMaterial",t}return e=i,n&&ml(e.prototype,n),r&&ml(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(So);function _l(t){return _l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_l(t)}function Pl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Sl(t,e){return Sl=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Sl(t,e)}function Tl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Nl(t);if(e){var o=Nl(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Al(this,n)}}function Al(t,e){if(e&&("object"===_l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Nl(t){return Nl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Nl(t)}ct.addShortcuts(xl.prototype,"fragment",["color","alpha","mask","position","spherical"]);var Rl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Sl(t,e)}(i,t);var e,n,r,o=Tl(i);function i(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var e=new Yf;return(t=o.call(this,e,e)).type="PhongNodeMaterial",t}return e=i,n&&Pl(e.prototype,n),r&&Pl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(So);function Fl(t){return Fl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fl(t)}function jl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function El(t,e){return El=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},El(t,e)}function Ll(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Il(t);if(e){var o=Il(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return kl(this,n)}}function kl(t,e){if(e&&("object"===Fl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Il(t){return Il=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Il(t)}ct.addShortcuts(Rl.prototype,"fragment",["color","alpha","specular","shininess","normal","emissive","ambient","light","shadow","ao","environment","environmentAlpha","mask","position"]);var Cl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&El(t,e)}(i,t);var e,n,r,o=Ll(i);function i(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var e=new $f;return(t=o.call(this,e,e)).type="StandardNodeMaterial",t}return e=i,n&&jl(e.prototype,n),r&&jl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(So);function Dl(t){return Dl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dl(t)}function Ul(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ml(t,e){return Ml=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ml(t,e)}function Xl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Bl(t);if(e){var o=Bl(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return zl(this,n)}}function zl(t,e){if(e&&("object"===Dl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Bl(t){return Bl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Bl(t)}ct.addShortcuts(Cl.prototype,"fragment",["color","alpha","roughness","metalness","reflectivity","clearcoat","clearcoatRoughness","clearcoatNormal","normal","emissive","ambient","light","shadow","ao","environment","mask","position","sheenColor"]);var Jl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ml(t,e)}(i,t);var e,n,r,o=Xl(i);function i(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var e=new cl;return(t=o.call(this,e,e)).type="MeshStandardNodeMaterial",t}return e=i,n&&Ul(e.prototype,n),r&&Ul(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(So);ct.addShortcuts(Jl.prototype,"properties",["color","roughness","metalness","map","normalMap","normalScale","metalnessMap","roughnessMap","envMap"]);var Yl={uniforms:{tDiffuse:{value:null},resolution:{value:new r.Vector2(1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:'\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\t#define FXAA_PC 1\n\t\t#define FXAA_GLSL_100 1\n\t\t#define FXAA_QUALITY_PRESET 12\n\n\t\t#define FXAA_GREEN_AS_LUMA 1\n\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_PC_CONSOLE\n\t\t\t\t//\n\t\t\t\t// The console algorithm for PC is included\n\t\t\t\t// for developers targeting really low spec machines.\n\t\t\t\t// Likely better to just run FXAA_PC, and use a really low preset.\n\t\t\t\t//\n\t\t\t\t#define FXAA_PC_CONSOLE 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_120\n\t\t\t\t#define FXAA_GLSL_120 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_130\n\t\t\t\t#define FXAA_GLSL_130 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_3\n\t\t\t\t#define FXAA_HLSL_3 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_4\n\t\t\t\t#define FXAA_HLSL_4 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_5\n\t\t\t\t#define FXAA_HLSL_5 0\n\t\t#endif\n\t\t/*==========================================================================*/\n\t\t#ifndef FXAA_GREEN_AS_LUMA\n\t\t\t\t//\n\t\t\t\t// For those using non-linear color,\n\t\t\t\t// and either not able to get luma in alpha, or not wanting to,\n\t\t\t\t// this enables FXAA to run using green as a proxy for luma.\n\t\t\t\t// So with this enabled, no need to pack luma in alpha.\n\t\t\t\t//\n\t\t\t\t// This will turn off AA on anything which lacks some amount of green.\n\t\t\t\t// Pure red and blue or combination of only R and B, will get no AA.\n\t\t\t\t//\n\t\t\t\t// Might want to lower the settings for both,\n\t\t\t\t//\t\tfxaaConsoleEdgeThresholdMin\n\t\t\t\t//\t\tfxaaQualityEdgeThresholdMin\n\t\t\t\t// In order to insure AA does not get turned off on colors\n\t\t\t\t// which contain a minor amount of green.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_GREEN_AS_LUMA 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_EARLY_EXIT\n\t\t\t\t//\n\t\t\t\t// Controls algorithm\'s early exit path.\n\t\t\t\t// On PS3 turning this ON adds 2 cycles to the shader.\n\t\t\t\t// On 360 turning this OFF adds 10ths of a millisecond to the shader.\n\t\t\t\t// Turning this off on console will result in a more blurry image.\n\t\t\t\t// So this defaults to on.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_EARLY_EXIT 1\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_DISCARD\n\t\t\t\t//\n\t\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t\t//\n\t\t\t\t// 1 = Use discard on pixels which don\'t need AA.\n\t\t\t\t//\t\t For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t\t// 0 = Return unchanged color on pixels which don\'t need AA.\n\t\t\t\t//\n\t\t\t\t#define FXAA_DISCARD 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t//\n\t\t\t\t// Used for GLSL 120 only.\n\t\t\t\t//\n\t\t\t\t// 1 = GL API supports fast pixel offsets\n\t\t\t\t// 0 = do not use fast pixel offsets\n\t\t\t\t//\n\t\t\t\t#ifdef GL_EXT_gpu_shader4\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 0\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t//\n\t\t\t\t// 1 = API supports gather4 on alpha channel.\n\t\t\t\t// 0 = API does not support gather4 on alpha channel.\n\t\t\t\t//\n\t\t\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 0\n\t\t\t\t#endif\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFXAA QUALITY - TUNING KNOBS\n\t\t------------------------------------------------------------------------------\n\t\tNOTE the other tuning knobs are now in the shader function inputs!\n\t\t============================================================================*/\n\t\t#ifndef FXAA_QUALITY_PRESET\n\t\t\t\t//\n\t\t\t\t// Choose the quality preset.\n\t\t\t\t// This needs to be compiled into the shader as it effects code.\n\t\t\t\t// Best option to include multiple presets is to\n\t\t\t\t// in each shader define the preset, then include this file.\n\t\t\t\t//\n\t\t\t\t// OPTIONS\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n\t\t\t\t// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n\t\t\t\t// 39\t\t\t - no dither, very expensive\n\t\t\t\t//\n\t\t\t\t// NOTES\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n\t\t\t\t// 13 = about same speed as FXAA 3.9 and better than 12\n\t\t\t\t// 23 = closest to FXAA 3.9 visually and performance wise\n\t\t\t\t//\t_ = the lowest digit is directly related to performance\n\t\t\t\t// _\t= the highest digit is directly related to style\n\t\t\t\t//\n\t\t\t\t#define FXAA_QUALITY_PRESET 12\n\t\t#endif\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - PRESETS\n\n\t\t============================================================================*/\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - MEDIUM DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 10)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 3.0\n\t\t\t\t#define FXAA_QUALITY_P2 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 11)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 3.0\n\t\t\t\t#define FXAA_QUALITY_P3 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 12)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 4.0\n\t\t\t\t#define FXAA_QUALITY_P4 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 13)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 4.0\n\t\t\t\t#define FXAA_QUALITY_P5 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 14)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 4.0\n\t\t\t\t#define FXAA_QUALITY_P6 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 15)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 12.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - LOW DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 20)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 2.0\n\t\t\t\t#define FXAA_QUALITY_P2 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 21)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 22)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 23)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 24)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 3.0\n\t\t\t\t#define FXAA_QUALITY_P6 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 25)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 26)\n\t\t\t\t#define FXAA_QUALITY_PS 9\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 4.0\n\t\t\t\t#define FXAA_QUALITY_P8 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 27)\n\t\t\t\t#define FXAA_QUALITY_PS 10\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 4.0\n\t\t\t\t#define FXAA_QUALITY_P9 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 28)\n\t\t\t\t#define FXAA_QUALITY_PS 11\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 4.0\n\t\t\t\t#define FXAA_QUALITY_P10 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 29)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - EXTREME QUALITY\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 39)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.0\n\t\t\t\t#define FXAA_QUALITY_P2 1.0\n\t\t\t\t#define FXAA_QUALITY_P3 1.0\n\t\t\t\t#define FXAA_QUALITY_P4 1.0\n\t\t\t\t#define FXAA_QUALITY_P5 1.5\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI PORTING\n\n\t\t============================================================================*/\n\t\t#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard discard\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 vec2\n\t\t\t\t#define FxaaFloat3 vec3\n\t\t\t\t#define FxaaFloat4 vec4\n\t\t\t\t#define FxaaHalf float\n\t\t\t\t#define FxaaHalf2 vec2\n\t\t\t\t#define FxaaHalf3 vec3\n\t\t\t\t#define FxaaHalf4 vec4\n\t\t\t\t#define FxaaInt2 ivec2\n\t\t\t\t#define FxaaSat(x) clamp(x, 0.0, 1.0)\n\t\t\t\t#define FxaaTex sampler2D\n\t\t#else\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard clip(-1)\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 float2\n\t\t\t\t#define FxaaFloat3 float3\n\t\t\t\t#define FxaaFloat4 float4\n\t\t\t\t#define FxaaHalf half\n\t\t\t\t#define FxaaHalf2 half2\n\t\t\t\t#define FxaaHalf3 half3\n\t\t\t\t#define FxaaHalf4 half4\n\t\t\t\t#define FxaaSat(x) saturate(x)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t#define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n\t\t\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_120 == 1)\n\t\t\t\t// Requires,\n\t\t\t\t//\t#version 120\n\t\t\t\t// And at least,\n\t\t\t\t//\t#extension GL_EXT_gpu_shader4 : enable\n\t\t\t\t//\t(or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n\t\t\t\t#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n\t\t\t\t#if (FXAA_FAST_PIXEL_OFFSET == 1)\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n\t\t\t\t#else\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n\t\t\t\t#endif\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_130 == 1)\n\t\t\t\t// Requires "#version 130" or better\n\t\t\t\t#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_3 == 1)\n\t\t\t\t#define FxaaInt2 float2\n\t\t\t\t#define FxaaTex sampler2D\n\t\t\t\t#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n\t\t\t\t#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_4 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t\t\t#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n\t\t\t\t#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n\t\t\t\t#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t GREEN AS LUMA OPTION SUPPORT FUNCTION\n\t\t============================================================================*/\n\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n\t\t#else\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\t\t#endif\n\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA3 QUALITY - PC\n\n\t\t============================================================================*/\n\t\t#if (FXAA_PC == 1)\n\t\t/*--------------------------------------------------------------------------*/\n\t\tFxaaFloat4 FxaaPixelShader(\n\t\t\t\t//\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy} = center of pixel\n\t\t\t\tFxaaFloat2 pos,\n\t\t\t\t//\n\t\t\t\t// Used only for FXAA Console, and not used on the 360 version.\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy_} = upper left of pixel\n\t\t\t\t// {_zw} = lower right of pixel\n\t\t\t\tFxaaFloat4 fxaaConsolePosPos,\n\t\t\t\t//\n\t\t\t\t// Input color texture.\n\t\t\t\t// {rgb_} = color in linear or perceptual color space\n\t\t\t\t// if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t//\t\t {__a} = luma in perceptual color space (not linear)\n\t\t\t\tFxaaTex tex,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 2nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -1.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegOne,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 3nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -2.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegTwo,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x_} = 1.0/screenWidthInPixels\n\t\t\t\t// {_y} = 1.0/screenHeightInPixels\n\t\t\t\tFxaaFloat2 fxaaQualityRcpFrame,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// This effects sub-pixel AA quality and inversely sharpness.\n\t\t\t\t//\t Where N ranges between,\n\t\t\t\t//\t\t N = 0.50 (default)\n\t\t\t\t//\t\t N = 0.33 (sharper)\n\t\t\t\t// {x__} = -N/screenWidthInPixels\n\t\t\t\t// {_y_} = -N/screenHeightInPixels\n\t\t\t\t// {_z_} =\tN/screenWidthInPixels\n\t\t\t\t// {__w} =\tN/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Not used on 360, but used on PS3 and PC.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} = -2.0/screenWidthInPixels\n\t\t\t\t// {_y_} = -2.0/screenHeightInPixels\n\t\t\t\t// {_z_} =\t2.0/screenWidthInPixels\n\t\t\t\t// {__w} =\t2.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} =\t8.0/screenWidthInPixels\n\t\t\t\t// {_y_} =\t8.0/screenHeightInPixels\n\t\t\t\t// {_z_} = -4.0/screenWidthInPixels\n\t\t\t\t// {__w} = -4.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsole360RcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_SUBPIX define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Choose the amount of sub-pixel aliasing removal.\n\t\t\t\t// This can effect sharpness.\n\t\t\t\t//\t 1.00 - upper limit (softer)\n\t\t\t\t//\t 0.75 - default amount of filtering\n\t\t\t\t//\t 0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n\t\t\t\t//\t 0.25 - almost off\n\t\t\t\t//\t 0.00 - completely off\n\t\t\t\tFxaaFloat fxaaQualitySubpix,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// The minimum amount of local contrast required to apply algorithm.\n\t\t\t\t//\t 0.333 - too little (faster)\n\t\t\t\t//\t 0.250 - low quality\n\t\t\t\t//\t 0.166 - default\n\t\t\t\t//\t 0.125 - high quality\n\t\t\t\t//\t 0.063 - overkill (slower)\n\t\t\t\tFxaaFloat fxaaQualityEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t//\t 0.0833 - upper limit (default, the start of visible unfiltered edges)\n\t\t\t\t//\t 0.0625 - high quality (faster)\n\t\t\t\t//\t 0.0312 - visible limit (slower)\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaQualityEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only three safe values here: 2 and 4 and 8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// For all other platforms can be a non-power of two.\n\t\t\t\t//\t 8.0 is sharper (default!!!)\n\t\t\t\t//\t 4.0 is softer\n\t\t\t\t//\t 2.0 is really soft (good only for vector graphics inputs)\n\t\t\t\tFxaaFloat fxaaConsoleEdgeSharpness,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only two safe values here: 1/4 and 1/8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// Other platforms can use other values.\n\t\t\t\t//\t 0.125 leaves less aliasing, but is softer (default!!!)\n\t\t\t\t//\t 0.25 leaves more aliasing, and is sharper\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// This only applies when FXAA_EARLY_EXIT is 1.\n\t\t\t\t// This does not apply to PS3,\n\t\t\t\t// PS3 was simplified to avoid more shader instructions.\n\t\t\t\t//\t 0.06 - faster but more aliasing in darks\n\t\t\t\t//\t 0.05 - default\n\t\t\t\t//\t 0.04 - slower and less aliasing in darks\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Extra constants for 360 FXAA Console only.\n\t\t\t\t// Use zeros or anything else for other platforms.\n\t\t\t\t// These must be in physical constant registers and NOT immediates.\n\t\t\t\t// Immediates will result in compiler un-optimizing.\n\t\t\t\t// {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n\t\t\t\tFxaaFloat4 fxaaConsole360ConstDir\n\t\t) {\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posM;\n\t\t\t\tposM.x = pos.x;\n\t\t\t\tposM.y = pos.y;\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\t#define lumaM luma4A.w\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#define lumaE luma4A.z\n\t\t\t\t\t\t#define lumaS luma4A.x\n\t\t\t\t\t\t#define lumaSE luma4A.y\n\t\t\t\t\t\t#define lumaNW luma4B.w\n\t\t\t\t\t\t#define lumaN luma4B.z\n\t\t\t\t\t\t#define lumaW luma4B.x\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat maxSM = max(lumaS, lumaM);\n\t\t\t\tFxaaFloat minSM = min(lumaS, lumaM);\n\t\t\t\tFxaaFloat maxESM = max(lumaE, maxSM);\n\t\t\t\tFxaaFloat minESM = min(lumaE, minSM);\n\t\t\t\tFxaaFloat maxWN = max(lumaN, lumaW);\n\t\t\t\tFxaaFloat minWN = min(lumaN, lumaW);\n\t\t\t\tFxaaFloat rangeMax = max(maxWN, maxESM);\n\t\t\t\tFxaaFloat rangeMin = min(minWN, minESM);\n\t\t\t\tFxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n\t\t\t\tFxaaFloat range = rangeMax - rangeMin;\n\t\t\t\tFxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\t\t\t\tFxaaBool earlyExit = range < rangeMaxClamped;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(earlyExit)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\tFxaaDiscard;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\treturn rgbyM;\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 0)\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNS = lumaN + lumaS;\n\t\t\t\tFxaaFloat lumaWE = lumaW + lumaE;\n\t\t\t\tFxaaFloat subpixRcpRange = 1.0/range;\n\t\t\t\tFxaaFloat subpixNSWE = lumaNS + lumaWE;\n\t\t\t\tFxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n\t\t\t\tFxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNESE = lumaNE + lumaSE;\n\t\t\t\tFxaaFloat lumaNWNE = lumaNW + lumaNE;\n\t\t\t\tFxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n\t\t\t\tFxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNWSW = lumaNW + lumaSW;\n\t\t\t\tFxaaFloat lumaSWSE = lumaSW + lumaSE;\n\t\t\t\tFxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n\t\t\t\tFxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n\t\t\t\tFxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n\t\t\t\tFxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n\t\t\t\tFxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n\t\t\t\tFxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n\t\t\t\tFxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n\t\t\t\tFxaaBool horzSpan = edgeHorz >= edgeVert;\n\t\t\t\tFxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!horzSpan) lumaN = lumaW;\n\t\t\t\tif(!horzSpan) lumaS = lumaE;\n\t\t\t\tif(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n\t\t\t\tFxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat gradientN = lumaN - lumaM;\n\t\t\t\tFxaaFloat gradientS = lumaS - lumaM;\n\t\t\t\tFxaaFloat lumaNN = lumaN + lumaM;\n\t\t\t\tFxaaFloat lumaSS = lumaS + lumaM;\n\t\t\t\tFxaaBool pairN = abs(gradientN) >= abs(gradientS);\n\t\t\t\tFxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n\t\t\t\tif(pairN) lengthSign = -lengthSign;\n\t\t\t\tFxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posB;\n\t\t\t\tposB.x = posM.x;\n\t\t\t\tposB.y = posM.y;\n\t\t\t\tFxaaFloat2 offNP;\n\t\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\t\t\t\tif(!horzSpan) posB.x += lengthSign * 0.5;\n\t\t\t\tif( horzSpan) posB.y += lengthSign * 0.5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posN;\n\t\t\t\tposN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat2 posP;\n\t\t\t\tposP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n\t\t\t\tFxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n\t\t\t\tFxaaFloat subpixE = subpixC * subpixC;\n\t\t\t\tFxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!pairN) lumaNN = lumaSS;\n\t\t\t\tFxaaFloat gradientScaled = gradient * 1.0/4.0;\n\t\t\t\tFxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n\t\t\t\tFxaaFloat subpixF = subpixD * subpixE;\n\t\t\t\tFxaaBool lumaMLTZero = lumaMM < 0.0;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tlumaEndN -= lumaNN * 0.5;\n\t\t\t\tlumaEndP -= lumaNN * 0.5;\n\t\t\t\tFxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\tFxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n\t\t\t\tFxaaBool doneNP = (!doneN) || (!doneP);\n\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 3)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 4)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 5)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 6)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 7)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_QUALITY_PS > 8)\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 9)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 10)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 11)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 12)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat dstN = posM.x - posN.x;\n\t\t\t\tFxaaFloat dstP = posP.x - posM.x;\n\t\t\t\tif(!horzSpan) dstN = posM.y - posN.y;\n\t\t\t\tif(!horzSpan) dstP = posP.y - posM.y;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLength = (dstP + dstN);\n\t\t\t\tFxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLengthRcp = 1.0/spanLength;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool directionN = dstN < dstP;\n\t\t\t\tFxaaFloat dst = min(dstN, dstP);\n\t\t\t\tFxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n\t\t\t\tFxaaFloat subpixG = subpixF * subpixF;\n\t\t\t\tFxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n\t\t\t\tFxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n\t\t\t\tFxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n\t\t\t\tif(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n\t\t\t\tif( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\treturn FxaaTexTop(tex, posM);\n\t\t\t\t#else\n\t\t\t\t\t\treturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n\t\t\t\t#endif\n\t\t}\n\t\t/*==========================================================================*/\n\t\t#endif\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\tvUv,\n\t\t\t\tvec4(0.0),\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\tresolution,\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\t0.75,\n\t\t\t\t0.166,\n\t\t\t\t0.0833,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\tvec4(0.0)\n\t\t\t);\n\n\t\t\t// TODO avoid querying texture twice for same texel\n\t\t\tgl_FragColor.a = texture2D(tDiffuse, vUv).a;\n\t\t}'};function Ql(t){return Ql="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ql(t)}function Hl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Vl(t,e){return Vl=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Vl(t,e)}function Gl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Wl(t);if(e){var o=Wl(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ql(this,n)}}function ql(t,e){if(e&&("object"===Ql(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Wl(t){return Wl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Wl(t)}var Kl,Zl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vl(t,e)}(i,t);var e,n,r,o=Gl(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),o.call(this,Yl)}return e=i,(n=[{key:"setSize",value:function(t,e){var n=this.material.uniforms.resolution.value;n.x=1/t,n.y=1/e}}])&&Hl(e.prototype,n),r&&Hl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(j),$l=new r.WebGLRenderer({powerPreference:"high-performance",antialias:!1,stencil:!1,depth:!1});$l.toneMapping=r.ACESFilmicToneMapping,ot.init($l);var tp=$l.domElement;document.getElementById("main").appendChild(tp);var ep=new H($l);function np(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rp(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Kl={renderer:$l,canvas:tp,composer:ep,init:function(){var t=v.scene,e=v.camera,n={render:new tt(t,e),fxaa:new Zl};Object.values(n).forEach((function(t){return ep.addPass(t)})),Kl.post=n},resize:function(t,e,n){$l.setPixelRatio(n),$l.setSize(t,e),ep.setSize(t,e),Object.values(Kl.post).forEach((function(r){r.setSize&&r.setSize(t,e,n)}))},update:function(){ep.render()}};var op=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;np(this,t),this.maxEdgeLength=e,this.maxIterations=n}var e,n,o;return e=t,(n=[{key:"modify",value:function(t){if(!0===t.isGeometry)return console.error("THREE.TessellateModifier no longer supports Geometry. Use BufferGeometry instead."),t;null!==t.index&&(t=t.toNonIndexed());var e=this.maxIterations,n=this.maxEdgeLength*this.maxEdgeLength,o=new r.Vector3,i=new r.Vector3,a=new r.Vector3,u=new r.Vector3,c=[o,i,a,u],s=new r.Vector3,f=new r.Vector3,l=new r.Vector3,p=new r.Vector3,y=[s,f,l,p],h=new r.Color,d=new r.Color,v=new r.Color,m=new r.Color,b=[h,d,v,m],g=new r.Vector2,w=new r.Vector2,O=new r.Vector2,x=new r.Vector2,_=[g,w,O,x],P=new r.Vector2,S=new r.Vector2,T=new r.Vector2,A=new r.Vector2,N=[P,S,T,A],R=t.attributes,F=void 0!==R.normal,j=void 0!==R.color,E=void 0!==R.uv,L=void 0!==R.uv2,k=R.position.array,I=F?R.normal.array:null,C=j?R.color.array:null,D=E?R.uv.array:null,U=L?R.uv2.array:null,M=k,X=I,z=C,B=D,J=U,Y=0,Q=!0;function H(t,e,n){var r=c[t],o=c[e],i=c[n];if(M.push(r.x,r.y,r.z),M.push(o.x,o.y,o.z),M.push(i.x,i.y,i.z),F){var a=y[t],u=y[e],s=y[n];X.push(a.x,a.y,a.z),X.push(u.x,u.y,u.z),X.push(s.x,s.y,s.z)}if(j){var f=b[t],l=b[e],p=b[n];z.push(f.x,f.y,f.z),z.push(l.x,l.y,l.z),z.push(p.x,p.y,p.z)}if(E){var h=_[t],d=_[e],v=_[n];B.push(h.x,h.y),B.push(d.x,d.y),B.push(v.x,v.y)}if(L){var m=N[t],g=N[e],w=N[n];J.push(m.x,m.y),J.push(g.x,g.y),J.push(w.x,w.y)}}for(;Q&&Y<e;){Y++,Q=!1,k=M,M=[],F&&(I=X,X=[]),j&&(C=z,z=[]),E&&(D=B,B=[]),L&&(U=J,J=[]);for(var V=0,G=0,q=k.length;V<q;V+=9,G+=6){o.fromArray(k,V+0),i.fromArray(k,V+3),a.fromArray(k,V+6),F&&(s.fromArray(I,V+0),f.fromArray(I,V+3),l.fromArray(I,V+6)),j&&(h.fromArray(C,V+0),d.fromArray(C,V+3),v.fromArray(C,V+6)),E&&(g.fromArray(D,G+0),w.fromArray(D,G+2),O.fromArray(D,G+4)),L&&(P.fromArray(U,G+0),S.fromArray(U,G+2),T.fromArray(U,G+4));var W=o.distanceToSquared(i),K=i.distanceToSquared(a),Z=o.distanceToSquared(a);W>n||K>n||Z>n?(Q=!0,W>=K&&W>=Z?(u.lerpVectors(o,i,.5),F&&p.lerpVectors(s,f,.5),j&&m.lerpColors(h,d,.5),E&&x.lerpVectors(g,w,.5),L&&A.lerpVectors(P,S,.5),H(0,3,2),H(3,1,2)):K>=W&&K>=Z?(u.lerpVectors(i,a,.5),F&&p.lerpVectors(f,l,.5),j&&m.lerpColors(d,v,.5),E&&x.lerpVectors(w,O,.5),L&&A.lerpVectors(S,T,.5),H(0,1,3),H(3,2,0)):(u.lerpVectors(o,a,.5),F&&p.lerpVectors(s,l,.5),j&&m.lerpColors(h,v,.5),E&&x.lerpVectors(g,O,.5),L&&A.lerpVectors(P,T,.5),H(0,1,3),H(3,1,2))):H(0,1,2)}}var $=new r.BufferGeometry;return $.setAttribute("position",new r.Float32BufferAttribute(M,3)),F&&$.setAttribute("normal",new r.Float32BufferAttribute(X,3)),j&&$.setAttribute("color",new r.Float32BufferAttribute(z,3)),E&&$.setAttribute("uv",new r.Float32BufferAttribute(B,2)),L&&$.setAttribute("uv2",new r.Float32BufferAttribute(J,2)),$}}])&&rp(e.prototype,n),o&&rp(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ip(t){var e,n=this,r=(e=4022871197,function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.random=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1)}function ap(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function up(t){return ap(0,t)}var cp={random:{int:ap,uint:up,item:function(t){return t[up(t.length-1)]},boolean:function(){return Math.random()<.5}}},sp=[["black","white","red","green","blue","pink","purple","orange","silver","golden","iron","stone","velvet","opal","ivory","coral","broken","pearl","silk","fire","ice","thunder","falling","rising","diamond","turquoise","ruby","emerald","onyx","lapis","jade","amber"],["shield","sword","spear","arrow","knight","king","queen","phoenix","box","garden","flower","apple","echo","gambit","fist","dragon","sun","moon","star","cloud","rain","wind","dawn","storm","eagle","tiger","lion","puma","wolf","panther","dove","fox"]],fp=[["loud","adorab","glad","zealous","grumpi","happi","polite","expert","awkward","warm","sincere","shy","quiet","lazi","mad","bold"].map((function(t){return"".concat(t,"ly")})),["beam","giggl","paint","smil","danc","laugh","sing","sneez","clapp","whistl","hopp","cheer","fly","greet","wav","juggl"].map((function(t){return"".concat(t,"ing")})),["smart","creative","bubbly","fun","cute","tiny","giant","laidback","upbeat","kind","cool","brave","dumb","tipsy","popular","generous"],["puppy","kitten","monkey","pumpkin","robot","nun","ninja","giraffe","baby","penguin","panda","koala","bear","wizard","pirate","knight"]],lp="abcdefghijklmnopqrstuvwxyz".split(""),pp="aeiou".split(""),yp=lp.filter((function(t){return!pp.includes(t)})),hp={alphabet:lp,vowels:pp,consonnants:yp};function dp(t){return function(t){if(Array.isArray(t))return vp(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return vp(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vp(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var mp={CODENAME:"codename",DESCRIPTION:"description",GIBBERISH:"gibberish",SERIAL:"serial"},bp={NONE:"",DASH:"-",DOT:".",TILDE:"~",UNDERSCORE:"_"},gp="";function wp(t){return cp.random.item(t)}function Op(){var t=Tp.verbose,e=Tp.separator;return(t?[].concat(dp(sp.map(wp)),[cp.random.uint(999)]):sp.map(wp)).join(e)}function xp(){var t=Tp.verbose,e=Tp.separator;return(t?fp:[fp[1],fp[3]]).map(wp).join(e)}function _p(){var t=Tp.verbose,e=hp.vowels,n=hp.consonnants,r=t?8:4;return Array.from({length:r},(function(t,r){var o=r%2?e:n;return cp.random.item(o)})).join("")}function Pp(){var t=Tp.verbose?8:4,e=hp.alphabet.filter((function(t){return!"ilo".includes(t)}));return Array.from({length:t},(function(){return Tp.bool()?cp.random.item(e).toUpperCase():cp.random.int(1,9)})).join("")}function Sp(){var t={codename:Op,description:xp,gibberish:_p,serial:Pp}[Tp.mode]||Op;return Tp.seed=t(),Tp.seed}var Tp={modes:mp,mode:mp.CODENAME,separators:bp,separator:bp.NONE,verbose:!1,prng:new ip(gp),codename:Op,description:xp,gibberish:_p,serial:Pp,autoseed:Sp,reset:function(){Tp.prng=new ip(Tp.seed)},random:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Tp.prng,o=r.random();return isNaN(t)||isNaN(e)?o:n?Math.floor(o*(e-t+1)+t):o*(e-t)+t},int:function(t,e){return Tp.random(t,e,!0)},uint:function(t){return Tp.int(0,t)},item:function(t){return t[Tp.uint(t.length-1)]},bool:function(){return Tp.random()<.5},char:function(t){return t.charAt(Tp.uint(t.length-1))},get seed(){return gp},set seed(t){gp=t,this.reset()}};Sp();var Ap=Tp;function Np(t){return function(t){if(Array.isArray(t))return Rp(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Rp(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rp(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Fp(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var jp=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._f=e,this._category=n,this.update()}var e,n,r;return e=t,n=[{key:"update",value:function(){var e=this.f+this.category,n=t.glsl[e];n||(e="linear",n=t.glsl[e]),this._name=e,this._glsl=n}},{key:"f",get:function(){return this._f},set:function(t){this._f=t,this.update()}},{key:"category",get:function(){return this._category},set:function(t){this._category=t,this.update()}},{key:"name",get:function(){return this._name}},{key:"glsl",get:function(){return this._glsl}}],n&&Fp(e.prototype,n),r&&Fp(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ep(t){for(var e,n,o,i=0,a=0;a<t.length;++a){var u=t[a];if(u.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===e&&(e=u.array.constructor),e!==u.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=u.itemSize),n!==u.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===o&&(o=u.normalized),o!==u.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=u.array.length}for(var c=new e(i),s=0,f=0;f<t.length;++f)c.set(t[f].array,s),s+=t[f].array.length;return new r.BufferAttribute(c,n,o)}Object.assign(jp,{get glsl(){return{linear:"float linear( float t ) {\r\n\treturn t;\r\n}",quadIn:"float quadIn( float t ) {\r\n\treturn t * t;\r\n}",quadOut:"float quadOut( float t ) {\r\n\treturn -t * ( t - 2.0 );\r\n}",quadInOut:"float quadInOut( float t ) {\r\n\tfloat p = 2.0 * t * t;\r\n\treturn t < 0.5 ? p : -p + ( 4.0 * t ) - 1.0;\r\n}",cubicIn:"float cubicIn( float t ) {\r\n\treturn t * t * t;\r\n}",cubicOut:"float cubicOut( float t ) {\r\n\tfloat f = t - 1.0;\r\n\treturn f * f * f + 1.0;\r\n}",cubicInOut:"float cubicInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t? 4.0 * t * t * t\r\n\t\t: 0.5 * pow( 2.0 * t - 2.0, 3.0 ) + 1.0;\r\n}",quartIn:"float quartIn( float t ) {\r\n\treturn pow( t, 4.0 );\r\n}",quartOut:"float quartOut( float t ) {\r\n\treturn pow( t - 1.0, 3.0 ) * ( 1.0 - t ) + 1.0;\r\n}",quartInOut:"float quartInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t? + 8.0 * pow( t, 4.0 )\r\n\t\t: - 8.0 * pow( t - 1.0, 4.0 ) + 1.0;\r\n}",quintIn:"float quintIn( float t ) {\r\n\treturn pow( t, 5.0 );\r\n}",quintOut:"float quintOut( float t ) {\r\n\treturn 1.0 - ( pow( 1.0 - t, 5.0 ) );\r\n}",quintInOut:"float quintInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t\t? +16.0 * pow( t, 5.0 )\r\n\t\t\t: -0.5 * pow( 2.0 * t - 2.0, 5.0 ) + 1.0;\r\n}",expoIn:"float expoIn( float t ) {\r\n\treturn t == 0.0 ? t : pow( 2.0, 10.0 * ( t - 1.0 ) );\r\n}",expoOut:"float expoOut( float t ) {\r\n\treturn t == 1.0 ? t : 1.0 - pow( 2.0, -10.0 * t );\r\n}",expoInOut:"float expoInOut( float t ) {\r\n\treturn t == 0.0 || t == 1.0\r\n\t\t? t\r\n\t\t: t < 0.5\r\n\t\t\t? +0.5 * pow( 2.0, ( 20.0 * t ) - 10.0 )\r\n\t\t\t: -0.5 * pow( 2.0, 10.0 - ( t * 20.0 ) ) + 1.0;\r\n}",circIn:"float circIn( float t ) {\r\n\treturn 1.0 - sqrt( 1.0 - t * t );\r\n}",circOut:"float circOut( float t ) {\r\n\treturn sqrt( ( 2.0 - t ) * t );\r\n}",circInOut:"float circInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t? 0.5 * ( 1.0 - sqrt( 1.0 - 4.0 * t * t ) )\r\n\t\t: 0.5 * ( sqrt( ( 3.0 - 2.0 * t ) * ( 2.0 * t - 1.0 ) ) + 1.0 );\r\n}",sineIn:"#ifndef HALF_PI\r\n#define HALF_PI 1.5707963267948966\r\n#endif\r\n\r\nfloat sineIn( float t ) {\r\n\treturn sin( ( t - 1.0 ) * HALF_PI ) + 1.0;\r\n}",sineOut:"#ifndef HALF_PI\r\n#define HALF_PI 1.5707963267948966\r\n#endif\r\n\r\nfloat sineOut( float t ) {\r\n\treturn sin( t * HALF_PI );\r\n}",sineInOut:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\nfloat sineInOut( float t ) {\r\n\treturn -0.5 * ( cos( PI * t ) - 1.0 );\r\n}",backIn:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\nfloat backIn( float t ) {\r\n\treturn pow( t, 3.0 ) - t * sin( t * PI );\r\n}",backOut:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\nfloat backOut( float t ) {\r\n\tfloat f = 1.0 - t;\r\n\treturn 1.0 - ( pow( f, 3.0 ) - f * sin( f * PI ) );\r\n}",backInOut:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\nfloat backInOut( float t ) {\r\n\tfloat f = t < 0.5\r\n\t\t? 2.0 * t\r\n\t\t: 1.0 - ( 2.0 * t - 1.0 );\r\n\r\n\tfloat g = pow( f, 3.0 ) - f * sin( f * PI );\r\n\r\n\treturn t < 0.5\r\n\t\t? 0.5 * g\r\n\t\t: 0.5 * ( 1.0 - g ) + 0.5;\r\n}",bounceIn:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\n#ifndef bounceOut\r\nfloat bounceOut( float t ) {\r\n\tconst float a = 4.0 / 11.0;\r\n\tconst float b = 8.0 / 11.0;\r\n\tconst float c = 9.0 / 10.0;\r\n\r\n\tconst float ca = 4356.0 / 361.0;\r\n\tconst float cb = 35442.0 / 1805.0;\r\n\tconst float cc = 16061.0 / 1805.0;\r\n\r\n\tfloat t2 = t * t;\r\n\r\n\treturn t < a\r\n\t\t? 7.5625 * t2\r\n\t\t: t < b\r\n\t\t\t? 9.075 * t2 - 9.9 * t + 3.4\r\n\t\t\t: t < c\r\n\t\t\t\t? ca * t2 - cb * t + cc\r\n\t\t\t\t: 10.8 * t * t - 20.52 * t + 10.72;\r\n}\r\n#endif\r\n\r\nfloat bounceIn( float t ) {\r\n\treturn 1.0 - bounceOut( 1.0 - t );\r\n}",bounceOut:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\nfloat bounceOut( float t ) {\r\n\tconst float a = 4.0 / 11.0;\r\n\tconst float b = 8.0 / 11.0;\r\n\tconst float c = 9.0 / 10.0;\r\n\r\n\tconst float ca = 4356.0 / 361.0;\r\n\tconst float cb = 35442.0 / 1805.0;\r\n\tconst float cc = 16061.0 / 1805.0;\r\n\r\n\tfloat t2 = t * t;\r\n\r\n\treturn t < a\r\n\t\t? 7.5625 * t2\r\n\t\t: t < b\r\n\t\t\t? 9.075 * t2 - 9.9 * t + 3.4\r\n\t\t\t: t < c\r\n\t\t\t\t? ca * t2 - cb * t + cc\r\n\t\t\t\t: 10.8 * t * t - 20.52 * t + 10.72;\r\n}",bounceInOut:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\n#ifndef bounceOut\r\nfloat bounceOut( float t ) {\r\n\tconst float a = 4.0 / 11.0;\r\n\tconst float b = 8.0 / 11.0;\r\n\tconst float c = 9.0 / 10.0;\r\n\r\n\tconst float ca = 4356.0 / 361.0;\r\n\tconst float cb = 35442.0 / 1805.0;\r\n\tconst float cc = 16061.0 / 1805.0;\r\n\r\n\tfloat t2 = t * t;\r\n\r\n\treturn t < a\r\n\t\t? 7.5625 * t2\r\n\t\t: t < b\r\n\t\t\t? 9.075 * t2 - 9.9 * t + 3.4\r\n\t\t\t: t < c\r\n\t\t\t\t? ca * t2 - cb * t + cc\r\n\t\t\t\t: 10.8 * t * t - 20.52 * t + 10.72;\r\n}\r\n#endif\r\n\r\nfloat bounceInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t? 0.5 * ( 1.0 - bounceOut( 1.0 - t * 2.0 ) )\r\n\t\t: 0.5 * bounceOut( t * 2.0 - 1.0 ) + 0.5;\r\n}",elasticIn:"#ifndef HALF_PI\r\n#define HALF_PI 1.5707963267948966\r\n#endif\r\n\r\nfloat elasticIn( float t ) {\r\n\treturn sin( 13.0 * t * HALF_PI ) * pow( 2.0, 10.0 * ( t - 1.0 ) );\r\n}",elasticOut:"#ifndef HALF_PI\r\n#define HALF_PI 1.5707963267948966\r\n#endif\r\n\r\nfloat elasticOut( float t ) {\r\n\treturn sin( -13.0 * ( t + 1.0 ) * HALF_PI ) * pow( 2.0, -10.0 * t ) + 1.0;\r\n}",elasticInOut:"#ifndef HALF_PI\r\n#define HALF_PI 1.5707963267948966\r\n#endif\r\n\r\nfloat elasticInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t? 0.5 * sin( +13.0 * HALF_PI * 2.0 * t ) * pow( 2.0, 10.0 * ( 2.0 * t - 1.0 ) )\r\n\t\t: 0.5 * sin( -13.0 * HALF_PI * ( ( 2.0 * t - 1.0 ) + 1.0 ) ) * \r\n\t\t\tpow( 2.0, -10.0 * ( 2.0 * t - 1.0 ) ) + 1.0;\r\n}"}},get functions(){return Np(new Set(Object.keys(jp.glsl).map((function(t){return t.replace(/([a-z]*)(InOut|In|Out)/,"$1")}))))},get categories(){return["In","Out","InOut"]}});function Lp(t){return Lp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lp(t)}function kp(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ip(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Cp(t,e){return Cp=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Cp(t,e)}function Dp(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Mp(t);if(e){var o=Mp(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Up(this,n)}}function Up(t,e){if(e&&("object"===Lp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Mp(t){return Mp=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Mp(t)}var Xp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Cp(t,e)}(i,t);var e,n,r,o=Dp(i);function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.min,r=void 0===n?0:n,a=e.max,u=void 0===a?1:a,c=e.scale,s=void 0===c?1:c,f=e.seed,l=void 0===f?Math.random():f;return Ip(this,i),o.call(this,t,i.shader,{uMin:{value:r},uMax:{value:u},uScale:{value:s},uSeed:{value:l}})}return e=i,n&&kp(e.prototype,n),r&&kp(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(ot);function zp(t){return zp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zp(t)}function Bp(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jp(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Yp(t,e){return Yp=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Yp(t,e)}function Qp(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Gp(t);if(e){var o=Gp(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Hp(this,n)}}function Hp(t,e){if(e&&("object"===zp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Vp(t)}function Vp(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Gp(t){return Gp=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Gp(t)}Xp.formatUniforms=function(t){return{uMin:{value:t.min},uMax:{value:t.max},uScale:{value:t.scale},uSeed:{value:t.seed}}},Xp.shader="\n\n\tuniform float uMin;\n\tuniform float uMax;\n\tuniform float uScale;\n\tuniform float uSeed;\n\tuniform sampler2D tData;\n\n    ".concat(et.glsl,"\n\t").concat("//\tSimplex 3D Noise \n//\tby Ian McEwan, Ashima Arts\n//\nvec4 permute( vec4 x ){ return mod( ( ( x * 34.0 ) + 1.0 ) * x, 289.0 ); }\nvec4 taylorInvSqrt( vec4 r ){ return 1.79284291400159 - 0.85373472095314 * r; }\n\nfloat simplex3D( float vx, float vy, float vz ) {\n\n\tvec3 v = vec3( vx, vy, vz );\n\t\n\tconst vec2 C = vec2( 1.0/6.0, 1.0/3.0   );\n\tconst vec4 D = vec4( 0.0, 0.5, 1.0, 2.0 );\n\n\t// First corner\n\tvec3 i  = floor( v + dot( v, C.yyy ) );\n\tvec3 x0 =   v - i + dot( i, C.xxx ) ;\n\n\t// Other corners\n\tvec3 g = step( x0.yzx, x0.xyz );\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min(  g.xyz, l.zxy );\n\tvec3 i2 = max(  g.xyz, l.zxy );\n\n\t// x0 = x0 - 0. + 0.0 * C \n\tvec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\tvec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\tvec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\n\t// Permutations\n\ti = mod( i, 289.0 ); \n\tvec4 p = permute( permute( permute(\n\t\t\t i.z + vec4( 0.0, i1.z, i2.z, 1.0 ) )\n\t\t   + i.y + vec4( 0.0, i1.y, i2.y, 1.0 ) ) \n\t\t   + i.x + vec4( 0.0, i1.x, i2.x, 1.0 ) );\n\n\t// Gradients\n\t// ( N*N points uniformly over a square, mapped onto an octahedron.)\n  \tfloat n_ = 1.0/7.0; // N=7\n  \tvec3  ns = n_ * D.wyz - D.xzx;\n\n  \tvec4 j = p - 49.0 * floor( p * ns.z *ns.z ); //  mod( p,N*N)\n\n  \tvec4 x_ = floor( j * ns.z );\n  \tvec4 y_ = floor( j - 7.0 * x_ ); // mod( j,N)\n\n  \tvec4 x = x_ *ns.x + ns.yyyy;\n  \tvec4 y = y_ *ns.x + ns.yyyy;\n  \tvec4 h = 1.0 - abs( x ) - abs( y );\n\n  \tvec4 b0 = vec4( x.xy, y.xy );\n  \tvec4 b1 = vec4( x.zw, y.zw );\n\n  \tvec4 s0 = floor( b0 )*2.0 + 1.0;\n  \tvec4 s1 = floor( b1 )*2.0 + 1.0;\n  \tvec4 sh = -step( h, vec4( 0.0 ) );\n\n  \tvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  \tvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  \tvec3 p0 = vec3( a0.xy,h.x );\n  \tvec3 p1 = vec3( a0.zw,h.y );\n  \tvec3 p2 = vec3( a1.xy,h.z );\n  \tvec3 p3 = vec3( a1.zw,h.w );\n\n\t//Normalise gradients\n  \tvec4 norm = taylorInvSqrt( \n\t\tvec4( dot( p0, p0 ), dot( p1, p1 ), dot( p2, p2 ), dot( p3, p3 ) )\n\t);\n  \tp0 *= norm.x;\n  \tp1 *= norm.y;\n  \tp2 *= norm.z;\n  \tp3 *= norm.w;\n\n\t// Mix final noise value\n  \tvec4 m = max( \n\t\t0.6 - vec4( dot( x0, x0 ), dot( x1, x1 ), dot( x2, x2 ), dot( x3, x3 ) ), \n\t\t0.0\n\t);\n  \tm = m * m;\n  \treturn 42.0 * dot( \n\t\tm*m,\n\t\tvec4( dot( p0,x0 ), dot( p1,x1 ), dot( p2,x2 ), dot( p3,x3 ) )\n\t);\n\n}","\n\n    void main() {\n        \n        vec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\t\tfloat noise = 0.5 + simplex3D( \n\t\t\tuv.x * uScale, \n\t\t\tuv.y * uScale, \n\t\t\tuSeed * uScale\n\t\t) / 2.0;\n\n\t\tfloat data = noise * ( uMax - uMin ) + uMin;\n\n        gl_FragColor = pack( data );\n\n    }\n\n");var qp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yp(t,e)}(a,t);var e,n,o,i=Qp(a);function a(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.density,u=r.reversed,c=r.easing,s=r.maxEdgeLength,f=r.maxIterations,l=r.spread,p=r.turbulence,y=r.stagger,h=r.dynamics,d=r.delay,v=r.wind,m=r.duration;Bp(this,a);var b=new op(s,f);return t=b.modify(t),t=a.densify(t,o),(n=i.call(this,t,e)).options={reversed:u,easing:c,spread:l,turbulence:p,delay:d,duration:m,stagger:y,dynamics:h,wind:v},n.setAttributes(),n.setChunks(),n.material.onBeforeCompile=n.onBeforeCompile.bind(Vp(n)),n}return e=a,n=[{key:"setAttributes",value:function(){for(var t=this.geometry,e=t.attributes.position.array,n=t.attributes.position.count,o=Math.ceil(n/3),i=new Float32Array(n),u=new Float32Array(2*n),c=new Float32Array(3*n),s=a.computeCentroid,f=0;f<o;f++)for(var l=3*f,p=2*l,y=3*l,h=f%o/o,d=~~(f/o)/o,v=Math.random(),m=0;m<3;m++){i[l+m]=v;var b=p+2*m;u[b]=h,u[b+1]=d;var g=y+3*m;c[g]=s(y,e),c[g+1]=s(y+1,e),c[g+2]=s(y+2,e)}t.setAttribute("aNoise",new r.BufferAttribute(i,1)),t.setAttribute("aDataCoord",new r.BufferAttribute(u,2)),t.setAttribute("aCentroid",new r.BufferAttribute(c,3));var w=new Xp(o),O=new Xp(o),x=new Xp(o);this.gpgpu={x:w,y:O,z:x},this.compute()}},{key:"compute",value:function(){var t=this.gpgpu,e=this.shader,n=this.options,r=n.spread,o={uMin:{value:-r},uMax:{value:r},uScale:{value:n.turbulence}};if(Object.values(t).forEach((function(t){t.uniforms=JSON.parse(JSON.stringify(o)),t.uniforms.uSeed={value:Ap.random()},t.compute()})),e){var i=e.uniforms;i.tNoiseX.value=t.x.texture,i.tNoiseY.value=t.y.texture,i.tNoiseZ.value=t.z.texture}}},{key:"setChunks",value:function(){var t=this.options,e=t.easing,n="\n\n\t\t\tuniform float uTime;\n\t\t\tuniform float uStagger;\n\t\t\tuniform float uDynamics;\n\t\t\tuniform float uDelay;\n\t\t\tuniform float uDuration;\n\t\t\tuniform vec3 uWind;\n\t\t\tuniform sampler2D tNoiseX;\n\t\t\tuniform sampler2D tNoiseY;\n\t\t\tuniform sampler2D tNoiseZ;\n\n\t\t\tattribute float aNoise;\n\t\t\tattribute vec2 aDataCoord;\n\t\t\tattribute vec3 aCentroid;\n\n\t\t\t".concat(et.glsl,"\n\t\t\t").concat(e.glsl,"\n\t\t"),r=t.reversed?"progress = 1.0 - progress;":"",o="\n\n\t\t\tfloat bias = 0.9;\n\t\t\tfloat noiseDuration = clamp(\n\t\t\t\t( 1.0 - aNoise ) * uDynamics * uDuration,\n\t\t\t\t0.0,\n\t\t\t\t0.9 * uDuration\n\t\t\t);\n\t\t\tfloat duration = uDuration - noiseDuration;\n\n\t\t\tfloat noiseDelay = aNoise * uStagger;\n\t\t\tfloat delay = uDelay + noiseDelay;\n\n\t\t\tfloat time = clamp( uTime - delay, 0.0, duration );\n\t\t\tfloat progress =  clamp( time / duration, 0.0, 1.0 );\n\t\t\t".concat(r,"\n\t\t\tprogress = ").concat(e.name,"( progress );\n\t\t\n\t\t\tfloat scale = clamp( 1.0 - progress, 0.0, 1.0 );\n\t\t\ttransformed -= aCentroid;\n\t\t\ttransformed *= scale;\n\t\t\ttransformed += aCentroid;\n\t\t\n\t\t\tfloat noiseX = unpack( texture2D( tNoiseX, aDataCoord ) );\n\t\t\tfloat noiseY = unpack( texture2D( tNoiseY, aDataCoord ) );\n\t\t\tfloat noiseZ = unpack( texture2D( tNoiseZ, aDataCoord ) );\n\t\t\t\n\t\t\ttransformed.x += ( noiseX + uWind.x ) * progress;\n\t\t\ttransformed.y += ( noiseY + uWind.y ) * progress;\n\t\t\ttransformed.z += ( noiseZ + uWind.z ) * progress;\n\n\t\t");this.chunks={declarations:n,modifications:o},this.material.dispose()}},{key:"onBeforeCompile",value:function(t){var e=this.gpgpu,n=this.options,r=n.duration,o=n.stagger,i=n.dynamics,a=n.delay,u=n.wind;Object.assign(t.uniforms,{uTime:{value:0},uStagger:{value:o},uDynamics:{value:i},uDelay:{value:a},uDuration:{value:r},uWind:{value:u},tNoiseX:{value:e.x.texture},tNoiseY:{value:e.y.texture},tNoiseZ:{value:e.z.texture}});var c="void main()",s="#include <begin_vertex>",f=this.chunks,l=f.declarations,p=f.modifications,y=t.vertexShader;y=(y=y.replace(c,l+c)).replace(s,s+p),t.vertexShader=y,this.shader=t}},{key:"update",value:function(t){this.shader.uniforms.uTime.value=t}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose(),Object.values(this.gpgpu).forEach((function(t){return t.dispose()}))}},{key:"totalVertices",get:function(){return this.geometry.attributes.position.count}}],n&&Jp(e.prototype,n),o&&Jp(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(r.Mesh);qp.densify=function(t,e){if(e<2||!Number.isInteger(e)||!Number.isFinite(e))return t;t.computeBoundingBox();var n=t.boundingBox,o=.01*Math.min(n.max.x-n.min.x,n.max.y-n.min.y,n.max.z-n.min.z),i=Array.from({length:e-1},(function(e,n){var r=t.clone(),i=1-o*(n+1);return r.scale(i,i,i),r}));return i.unshift(t),function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null!==t[0].index,o=new Set(Object.keys(t[0].attributes)),i=new Set(Object.keys(t[0].morphAttributes)),a={},u={},c=t[0].morphTargetsRelative,s=new r.BufferGeometry,f=0,l=0;l<t.length;++l){var p=t[l],y=0;if(n!==(null!==p.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var h in p.attributes){if(!o.has(h))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+'. All geometries must have compatible attributes; make sure "'+h+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[h]&&(a[h]=[]),a[h].push(p.attributes[h]),y++}if(y!==o.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+". Make sure all geometries have the same number of attributes."),null;if(c!==p.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var d in p.morphAttributes){if(!i.has(d))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===u[d]&&(u[d]=[]),u[d].push(p.morphAttributes[d])}if(s.userData.mergedUserData=s.userData.mergedUserData||[],s.userData.mergedUserData.push(p.userData),e){var v=void 0;if(n)v=p.index.count;else{if(void 0===p.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+". The geometry must have either an index or a position attribute"),null;v=p.attributes.position.count}s.addGroup(f,v,l),f+=v}}if(n){for(var m=0,b=[],g=0;g<t.length;++g){for(var w=t[g].index,O=0;O<w.count;++O)b.push(w.getX(O)+m);m+=t[g].attributes.position.count}s.setIndex(b)}for(var x in a){var _=Ep(a[x]);if(!_)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+x+" attribute."),null;s.setAttribute(x,_)}for(var P in u){var S=u[P][0].length;if(0===S)break;s.morphAttributes=s.morphAttributes||{},s.morphAttributes[P]=[];for(var T=0;T<S;++T){for(var A=[],N=0;N<u[P].length;++N)A.push(u[P][N][T]);var R=Ep(A);if(!R)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+P+" morphAttribute."),null;s.morphAttributes[P].push(R)}}return s}(i)},qp.computeCentroid=function(t,e){return(e[t]+e[t+3]+e[t+6])/3};var Wp,Kp=window;function Zp(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return $p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $p(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ty={grid:!0,autohash:!1,maxEdgeLength:.05,maxIterations:6,geometry:"torus",density:4,spread:2,turbulence:12,stagger:300,dynamics:.5,wind:new r.Vector3(0,0,0),easing:new jp,easingFunction:"circ",easingCategory:"In",reversed:!1,duration:1e3,loopDuration:3e3,delay:850},ey={density:{min:1,max:10,step:1},spread:{min:1,max:10,step:.1},turbulence:{min:1,max:20,step:.1},stagger:{min:0,max:500,step:5},dynamics:{min:0,max:1,step:.01},x:{min:-5,max:5,step:.1},y:{min:-5,max:5,step:.1},z:{min:-5,max:5,step:.1},delay:{min:0,max:1e3,step:50},duration:{min:500,max:5e3,step:50},loopDuration:{min:1e3,max:7500,step:50}},ny=JSON.parse(JSON.stringify(ey));["x","y","z","loopDuration","defaultSeed"].forEach((function(t){return delete ny[t]})),ny.density.min=2,ny.density.max=6,ny.duration.min=1e3,Wp={title:"Disintegrator",defaultSeed:"keda",ranges:ey,reset:function(){Object.entries(ty).forEach((function(t){var e=Zp(t,2),n=e[0],r=e[1];Wp[n]=r}));var t=Wp,e=t.easingFunction,n=t.easingCategory;Wp.easing=new jp(e,n),Wp.wind.x=0,Wp.wind.y=0,Wp.wind.z=-4},random:ny};var ry,oy,iy=new Kp.GUI;function ay(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return uy(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return uy(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uy(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function cy(){var t=oy,e=t.loopDuration,n=t.duration,r=t.stagger,o=t.delay;0!==e&&(oy.loopDuration=n+r+2*o)}iy.init=function(){function t(t,e,n,r){if(Wp.ranges[n]){var o=Wp.ranges[n],i=o.min,a=o.max,u=o.step;return t.add(e,n,i,a).step(u)}return t.add(e,n,r)}var e=iy.addFolder("Geometry");t(e,oy,"geometry",Object.keys(oy.geometries)),t(e,oy,"density").onFinishChange(oy.generate),e.open();var n=iy.addFolder("Noise");t(n,oy,"spread"),t(n,oy,"turbulence"),t(n,oy,"stagger"),t(n,oy,"dynamics"),n.open();var r=iy.addFolder("Wind");t(r,oy.wind,"x"),t(r,oy.wind,"y"),t(r,oy.wind,"z"),t(r,oy,"zeroWind"),r.open();var o=iy.addFolder("Animation");t(o,oy,"easingFunction",jp.functions),t(o,oy,"easingCategory",jp.categories),t(o,oy,"reversed"),t(o,oy,"duration"),t(o,oy,"loopDuration").listen(),t(o,oy,"delay"),o.open();var i=iy.addFolder("Settings");t(i,oy,"grid"),t(i,oy,"reset"),t(i,oy,"random"),i.open(),iy.updateDisplay=function(){return iy.controllersRecursive().forEach((function(t){return t.updateDisplay()}))},iy.close()},ry={load:function(){return window.location.hash.replace("#","")},save:function(t){window.location.hash=t}},Ap.seed=Wp.defaultSeed;var sy={box:function(){return new r.BoxBufferGeometry(1.5,1.5,1.5,64,64,64)},circle:function(){return new r.CircleBufferGeometry(1.1,720)},cylinder:function(){return new r.CylinderBufferGeometry(.9,.9,1.5,96,96)},tetra:function(){var t=new r.TetrahedronBufferGeometry(1.5);return t.rotateX(r.MathUtils.degToRad(15)),function(t){return new op(.01,arguments.length>1&&void 0!==arguments[1]?arguments[1]:6).modify(t)}(t,14)},plane:function(){return new r.PlaneBufferGeometry(2,2,160,160)},sphere:function(){return new r.SphereBufferGeometry(1.1,128,128)},torus:function(){return new r.TorusBufferGeometry(.8,.35,128,128)},torusKnot:function(){return new r.TorusKnotBufferGeometry(.68,.28,256,64)}};function fy(){var t;!function(){var t=oy.mesh;t&&(t.dispose(),v.remove(t),delete oy.mesh)}();var e=sy[Wp.geometry]();"tetra"!==Wp.geometry&&(e=e.toNonIndexed());var n=new r.MeshStandardMaterial({side:r.DoubleSide}),o=new qp(e,n,Wp);oy.mesh=o,v.add(o),Wp.debug&&console.log({vertices:o.totalVertices}),cy(),null===(t=iy.updateDisplay)||void 0===t||t.call(iy),oy.ticker&&oy.ticker.reset();var i=Ap.seed&&Ap.seed!==Wp.defaultSeed?" #".concat(Ap.seed):"";document.title=Wp.title+i}function ly(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Wp.wind.x=0,Wp.wind.y=0,Wp.wind.z=0,t&&iy.updateDisplay()}function py(t){return py="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},py(t)}function yy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function hy(t,e,n){return e&&yy(t.prototype,e),n&&yy(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function dy(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vy(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&my(t,e)}function my(t,e){return my=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},my(t,e)}function by(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Oy(t);if(e){var o=Oy(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return gy(this,n)}}function gy(t,e){if(e&&("object"===py(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return wy(t)}function wy(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Oy(t){return Oy=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Oy(t)}oy={geometries:sy,init:function t(){var e=oy,n=e.reset,r=e.random,o=ry.load();o?o!==Ap.seed&&r(o):n(),Wp.autohash&&window.addEventListener("hashchange",t)},generate:fy,random:function(t){t?Ap.seed=t:(Ap.autoseed(),Wp.autohash&&ry.save(Ap.seed));var e=function(t,e,n){return Math.round(Ap.random(t,e)/n)*n},n=Ap.item(Object.keys(oy.geometries).filter((function(t){return t!==Wp.geometry})));if(Wp.reset(),Wp.geometry=n,Object.entries(Wp.random).forEach((function(t){var n=ay(t,2),r=n[0],o=n[1],i=o.min,a=o.max,u=o.step;Wp[r]=e(i,a,u)})),ly(!1),Ap.random()>.25){var r=Ap.item(["x","y","z"]),o=Wp.ranges[r],i=o.min,a=o.max,u=o.step;Wp.wind[r]=e(i,a,u)}var c=["back","bounce","elastic"];Wp.easingFunction=Ap.item(jp.functions.filter((function(t){return!c.includes(t)}))),Wp.easingCategory=Ap.item(["In","InOut"]),Wp.easing.f=Wp.easingFunction,Wp.easing.category=Wp.easingCategory,fy()},reset:function(){Ap.seed=Wp.initialSeed,Wp.reset(),oy.grid=Wp.grid,Wp.autohash&&ry.save(""),fy()},update:function(t){var e=oy,n=e.mesh,r=e.ticker,o=e.loopDuration;n&&n.update(t),o>0&&t>o&&r.reset()},zeroWind:ly,get geometry(){return Wp.geometry},set geometry(t){Wp.geometry=t,fy()},get density(){return Wp.density},set density(t){Wp.density=t},get spread(){return Wp.spread},set spread(t){Wp.spread=t,oy.mesh.options.spread=t,oy.mesh.compute()},get turbulence(){return Wp.turbulence},set turbulence(t){Wp.turbulence=t,oy.mesh.options.turbulence=t,oy.mesh.compute()},get delay(){return Wp.delay},set delay(t){Wp.delay=t,oy.mesh.shader.uniforms.uDelay.value=t,cy()},get duration(){return Wp.duration},set duration(t){Wp.duration=t,oy.mesh.shader.uniforms.uDuration.value=t,cy()},get stagger(){return Wp.stagger},set stagger(t){Wp.stagger=t,oy.mesh.shader.uniforms.uStagger.value=t,cy()},get dynamics(){return Wp.dynamics},set dynamics(t){Wp.dynamics=t,oy.mesh.shader.uniforms.uDynamics.value=t},get wind(){return Wp.wind},set wind(t){Wp.wind=t},get loopDuration(){return Wp.loopDuration},set loopDuration(t){Wp.loopDuration=t},get reversed(){return Wp.reversed},set reversed(t){Wp.reversed=t,oy.mesh.options.reversed=t,oy.mesh.setChunks()},get easingFunction(){return Wp.easingFunction},set easingFunction(t){Wp.easingFunction=t,Wp.easing.f=t,oy.mesh.setChunks()},get easingCategory(){return Wp.easingCategory},set easingCategory(t){Wp.easingCategory=t,Wp.easing.category=t,oy.mesh.setChunks()},get grid(){return Wp.grid},set grid(t){Wp.grid=t,v.grid.visible=t}};var xy,_y={type:"change"},Py={type:"start"},Sy={type:"end"},Ty=function(t){vy(n,t);var e=by(n);function n(t,o){var i,a,u,c,s,f,l;dy(this,n),i=e.call(this),void 0===o&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),o===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),i.object=t,i.domElement=o,i.domElement.style.touchAction="none",i.enabled=!0,i.target=new r.Vector3,i.minDistance=0,i.maxDistance=1/0,i.minZoom=0,i.maxZoom=1/0,i.minPolarAngle=0,i.maxPolarAngle=Math.PI,i.minAzimuthAngle=-1/0,i.maxAzimuthAngle=1/0,i.enableDamping=!1,i.dampingFactor=.05,i.enableZoom=!0,i.zoomSpeed=1,i.enableRotate=!0,i.rotateSpeed=1,i.enablePan=!0,i.panSpeed=1,i.screenSpacePanning=!0,i.keyPanSpeed=7,i.autoRotate=!1,i.autoRotateSpeed=2,i.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},i.mouseButtons={LEFT:r.MOUSE.ROTATE,MIDDLE:r.MOUSE.DOLLY,RIGHT:r.MOUSE.PAN},i.touches={ONE:r.TOUCH.ROTATE,TWO:r.TOUCH.DOLLY_PAN},i.target0=i.target.clone(),i.position0=i.object.position.clone(),i.zoom0=i.object.zoom,i._domElementKeyEvents=null,i.getPolarAngle=function(){return v.phi},i.getAzimuthalAngle=function(){return v.theta},i.getDistance=function(){return this.object.position.distanceTo(this.target)},i.listenToKeyEvents=function(t){t.addEventListener("keydown",tt),this._domElementKeyEvents=t},i.saveState=function(){p.target0.copy(p.target),p.position0.copy(p.object.position),p.zoom0=p.object.zoom},i.reset=function(){p.target.copy(p.target0),p.object.position.copy(p.position0),p.object.zoom=p.zoom0,p.object.updateProjectionMatrix(),p.dispatchEvent(_y),p.update(),h=y.NONE},i.update=(a=new r.Vector3,u=(new r.Quaternion).setFromUnitVectors(t.up,new r.Vector3(0,1,0)),c=u.clone().invert(),s=new r.Vector3,f=new r.Quaternion,l=2*Math.PI,function(){var t=p.object.position;a.copy(t).sub(p.target),a.applyQuaternion(u),v.setFromVector3(a),p.autoRotate&&h===y.NONE&&L(2*Math.PI/60/60*p.autoRotateSpeed),p.enableDamping?(v.theta+=m.theta*p.dampingFactor,v.phi+=m.phi*p.dampingFactor):(v.theta+=m.theta,v.phi+=m.phi);var e=p.minAzimuthAngle,n=p.maxAzimuthAngle;return isFinite(e)&&isFinite(n)&&(e<-Math.PI?e+=l:e>Math.PI&&(e-=l),n<-Math.PI?n+=l:n>Math.PI&&(n-=l),v.theta=e<=n?Math.max(e,Math.min(n,v.theta)):v.theta>(e+n)/2?Math.max(e,v.theta):Math.min(n,v.theta)),v.phi=Math.max(p.minPolarAngle,Math.min(p.maxPolarAngle,v.phi)),v.makeSafe(),v.radius*=b,v.radius=Math.max(p.minDistance,Math.min(p.maxDistance,v.radius)),!0===p.enableDamping?p.target.addScaledVector(g,p.dampingFactor):p.target.add(g),a.setFromSpherical(v),a.applyQuaternion(c),t.copy(p.target).add(a),p.object.lookAt(p.target),!0===p.enableDamping?(m.theta*=1-p.dampingFactor,m.phi*=1-p.dampingFactor,g.multiplyScalar(1-p.dampingFactor)):(m.set(0,0,0),g.set(0,0,0)),b=1,!!(w||s.distanceToSquared(p.object.position)>d||8*(1-f.dot(p.object.quaternion))>d)&&(p.dispatchEvent(_y),s.copy(p.object.position),f.copy(p.object.quaternion),w=!1,!0)}),i.dispose=function(){p.domElement.removeEventListener("contextmenu",et),p.domElement.removeEventListener("pointerdown",q),p.domElement.removeEventListener("pointercancel",Z),p.domElement.removeEventListener("wheel",$),p.domElement.removeEventListener("pointermove",W),p.domElement.removeEventListener("pointerup",K),null!==p._domElementKeyEvents&&p._domElementKeyEvents.removeEventListener("keydown",tt)};var p=wy(i),y={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},h=y.NONE,d=1e-6,v=new r.Spherical,m=new r.Spherical,b=1,g=new r.Vector3,w=!1,O=new r.Vector2,x=new r.Vector2,_=new r.Vector2,P=new r.Vector2,S=new r.Vector2,T=new r.Vector2,A=new r.Vector2,N=new r.Vector2,R=new r.Vector2,F=[],j={};function E(){return Math.pow(.95,p.zoomSpeed)}function L(t){m.theta-=t}function k(t){m.phi-=t}var I,C=(I=new r.Vector3,function(t,e){I.setFromMatrixColumn(e,0),I.multiplyScalar(-t),g.add(I)}),D=function(){var t=new r.Vector3;return function(e,n){!0===p.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(p.object.up,t)),t.multiplyScalar(e),g.add(t)}}(),U=function(){var t=new r.Vector3;return function(e,n){var r=p.domElement;if(p.object.isPerspectiveCamera){var o=p.object.position;t.copy(o).sub(p.target);var i=t.length();i*=Math.tan(p.object.fov/2*Math.PI/180),C(2*e*i/r.clientHeight,p.object.matrix),D(2*n*i/r.clientHeight,p.object.matrix)}else p.object.isOrthographicCamera?(C(e*(p.object.right-p.object.left)/p.object.zoom/r.clientWidth,p.object.matrix),D(n*(p.object.top-p.object.bottom)/p.object.zoom/r.clientHeight,p.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),p.enablePan=!1)}}();function M(t){p.object.isPerspectiveCamera?b/=t:p.object.isOrthographicCamera?(p.object.zoom=Math.max(p.minZoom,Math.min(p.maxZoom,p.object.zoom*t)),p.object.updateProjectionMatrix(),w=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),p.enableZoom=!1)}function X(t){p.object.isPerspectiveCamera?b*=t:p.object.isOrthographicCamera?(p.object.zoom=Math.max(p.minZoom,Math.min(p.maxZoom,p.object.zoom/t)),p.object.updateProjectionMatrix(),w=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),p.enableZoom=!1)}function z(t){O.set(t.clientX,t.clientY)}function B(t){P.set(t.clientX,t.clientY)}function J(){if(1===F.length)O.set(F[0].pageX,F[0].pageY);else{var t=.5*(F[0].pageX+F[1].pageX),e=.5*(F[0].pageY+F[1].pageY);O.set(t,e)}}function Y(){if(1===F.length)P.set(F[0].pageX,F[0].pageY);else{var t=.5*(F[0].pageX+F[1].pageX),e=.5*(F[0].pageY+F[1].pageY);P.set(t,e)}}function Q(){var t=F[0].pageX-F[1].pageX,e=F[0].pageY-F[1].pageY,n=Math.sqrt(t*t+e*e);A.set(0,n)}function H(t){if(1==F.length)x.set(t.pageX,t.pageY);else{var e=ot(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);x.set(n,r)}_.subVectors(x,O).multiplyScalar(p.rotateSpeed);var o=p.domElement;L(2*Math.PI*_.x/o.clientHeight),k(2*Math.PI*_.y/o.clientHeight),O.copy(x)}function V(t){if(1===F.length)S.set(t.pageX,t.pageY);else{var e=ot(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);S.set(n,r)}T.subVectors(S,P).multiplyScalar(p.panSpeed),U(T.x,T.y),P.copy(S)}function G(t){var e=ot(t),n=t.pageX-e.x,r=t.pageY-e.y,o=Math.sqrt(n*n+r*r);N.set(0,o),R.set(0,Math.pow(N.y/A.y,p.zoomSpeed)),M(R.y),A.copy(N)}function q(t){!1!==p.enabled&&(0===F.length&&(p.domElement.setPointerCapture(t.pointerId),p.domElement.addEventListener("pointermove",W),p.domElement.addEventListener("pointerup",K)),function(t){F.push(t)}(t),"touch"===t.pointerType?function(t){switch(rt(t),F.length){case 1:switch(p.touches.ONE){case r.TOUCH.ROTATE:if(!1===p.enableRotate)return;J(),h=y.TOUCH_ROTATE;break;case r.TOUCH.PAN:if(!1===p.enablePan)return;Y(),h=y.TOUCH_PAN;break;default:h=y.NONE}break;case 2:switch(p.touches.TWO){case r.TOUCH.DOLLY_PAN:if(!1===p.enableZoom&&!1===p.enablePan)return;p.enableZoom&&Q(),p.enablePan&&Y(),h=y.TOUCH_DOLLY_PAN;break;case r.TOUCH.DOLLY_ROTATE:if(!1===p.enableZoom&&!1===p.enableRotate)return;p.enableZoom&&Q(),p.enableRotate&&J(),h=y.TOUCH_DOLLY_ROTATE;break;default:h=y.NONE}break;default:h=y.NONE}h!==y.NONE&&p.dispatchEvent(Py)}(t):function(t){var e;switch(t.button){case 0:e=p.mouseButtons.LEFT;break;case 1:e=p.mouseButtons.MIDDLE;break;case 2:e=p.mouseButtons.RIGHT;break;default:e=-1}switch(e){case r.MOUSE.DOLLY:if(!1===p.enableZoom)return;!function(t){A.set(t.clientX,t.clientY)}(t),h=y.DOLLY;break;case r.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===p.enablePan)return;B(t),h=y.PAN}else{if(!1===p.enableRotate)return;z(t),h=y.ROTATE}break;case r.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===p.enableRotate)return;z(t),h=y.ROTATE}else{if(!1===p.enablePan)return;B(t),h=y.PAN}break;default:h=y.NONE}h!==y.NONE&&p.dispatchEvent(Py)}(t))}function W(t){!1!==p.enabled&&("touch"===t.pointerType?function(t){switch(rt(t),h){case y.TOUCH_ROTATE:if(!1===p.enableRotate)return;H(t),p.update();break;case y.TOUCH_PAN:if(!1===p.enablePan)return;V(t),p.update();break;case y.TOUCH_DOLLY_PAN:if(!1===p.enableZoom&&!1===p.enablePan)return;!function(t){p.enableZoom&&G(t),p.enablePan&&V(t)}(t),p.update();break;case y.TOUCH_DOLLY_ROTATE:if(!1===p.enableZoom&&!1===p.enableRotate)return;!function(t){p.enableZoom&&G(t),p.enableRotate&&H(t)}(t),p.update();break;default:h=y.NONE}}(t):function(t){if(!1===p.enabled)return;switch(h){case y.ROTATE:if(!1===p.enableRotate)return;!function(t){x.set(t.clientX,t.clientY),_.subVectors(x,O).multiplyScalar(p.rotateSpeed);var e=p.domElement;L(2*Math.PI*_.x/e.clientHeight),k(2*Math.PI*_.y/e.clientHeight),O.copy(x),p.update()}(t);break;case y.DOLLY:if(!1===p.enableZoom)return;!function(t){N.set(t.clientX,t.clientY),R.subVectors(N,A),R.y>0?M(E()):R.y<0&&X(E()),A.copy(N),p.update()}(t);break;case y.PAN:if(!1===p.enablePan)return;!function(t){S.set(t.clientX,t.clientY),T.subVectors(S,P).multiplyScalar(p.panSpeed),U(T.x,T.y),P.copy(S),p.update()}(t)}}(t))}function K(t){nt(t),0===F.length&&(p.domElement.releasePointerCapture(t.pointerId),p.domElement.removeEventListener("pointermove",W),p.domElement.removeEventListener("pointerup",K)),p.dispatchEvent(Sy),h=y.NONE}function Z(t){nt(t)}function $(t){!1!==p.enabled&&!1!==p.enableZoom&&h===y.NONE&&(t.preventDefault(),p.dispatchEvent(Py),function(t){t.deltaY<0?X(E()):t.deltaY>0&&M(E()),p.update()}(t),p.dispatchEvent(Sy))}function tt(t){!1!==p.enabled&&!1!==p.enablePan&&function(t){var e=!1;switch(t.code){case p.keys.UP:U(0,p.keyPanSpeed),e=!0;break;case p.keys.BOTTOM:U(0,-p.keyPanSpeed),e=!0;break;case p.keys.LEFT:U(p.keyPanSpeed,0),e=!0;break;case p.keys.RIGHT:U(-p.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),p.update())}(t)}function et(t){!1!==p.enabled&&t.preventDefault()}function nt(t){delete j[t.pointerId];for(var e=0;e<F.length;e++)if(F[e].pointerId==t.pointerId)return void F.splice(e,1)}function rt(t){var e=j[t.pointerId];void 0===e&&(e=new r.Vector2,j[t.pointerId]=e),e.set(t.pageX,t.pageY)}function ot(t){var e=t.pointerId===F[0].pointerId?F[1]:F[0];return j[e.pointerId]}return p.domElement.addEventListener("contextmenu",et),p.domElement.addEventListener("pointerdown",q),p.domElement.addEventListener("pointercancel",Z),p.domElement.addEventListener("wheel",$,{passive:!1}),i.update(),i}return hy(n)}(r.EventDispatcher),Ay=!0;function Ny(){var t=window,e=t.innerWidth,n=t.innerHeight,r=t.devicePixelRatio,o=e,i=n;[v,Kl].forEach((function(t){return t.resize(o,i,Math.min(r,2))}))}function Ry(t,e){[Kl,oy].forEach((function(t){return t.update(e)}))}xy={init:function(){var t=new Ty(v.camera,Kl.canvas);t.screenSpacePanning=!1,t.minDistance=4,t.maxDistance=20,t.maxPolarAngle=Math.PI/2,xy.orbit=t,document.getElementById("random").addEventListener("click",(function(){oy.random()})),window.addEventListener("keyup",(function(t){var e={" ":function(){return oy.random()},h:function(){return t=(Ay=!Ay)?"visible":"hidden",document.getElementById("overlay").style.visibility=t,void(document.querySelector(".lil-gui").style.visibility=t);var t}}[t.key];e&&e()}))}},function(){Kl.init(),oy.init(),iy.init(),xy.init(),window.addEventListener("resize",Ny),Ny();var t=new n(Ry,60);oy.ticker=t,t.start()}()}();