(()=>{"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var n=function(){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,n),this.callbacks="function"==typeof e?[e]:e,this.fps=i,this.elapsed=0,this._last=0,this._delta=0,this._isPlaying=!1,this._tick=this.tick.bind(this)}var i,r,o;return i=n,(r=[{key:"add",value:function(t){this.has(t)||this.callbacks.push(t)}},{key:"remove",value:function(t){this.has(t)&&this.callbacks.splice(this.callbacks.indexOf(t),1)}},{key:"has",value:function(t){return this.callbacks.includes(t)}},{key:"reset",value:function(){this.elapsed=0}},{key:"start",value:function(){this._last=this.now,this._delta=0,this._isPlaying=!0,this.requestFrame()}},{key:"pause",value:function(){this._isPlaying=!1}},{key:"stop",value:function(){this.pause(),this.reset()}},{key:"tick",value:function(){var t=this;if(this.isPlaying){this.requestFrame();var e=this.now,i=Math.min(n.maxDelta,e-this._last);this._last=e,this._delta+=i,this.elapsed+=i;var r=this._frameDuration-this._delta;r<=0&&(this.callbacks.forEach((function(e){return e.call(t,t.elapsed,t._delta)})),this._delta=Math.abs(r))}}},{key:"requestFrame",value:function(){requestAnimationFrame(this._tick)}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps=t,this._frameDuration=t>0?Math.floor(1e3/t):0}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"now",get:function(){return n.time.now()}}])&&e(i.prototype,r),o&&e(i,o),Object.defineProperty(i,"prototype",{writable:!1}),n}();n.maxDelta=100,n.time=void 0===performance?Date:performance;const i=THREE;var r=new i.Scene;r.background=new i.Color(2236967),r.fog=new i.Fog(r.background,1,60);var o=new THREE.DirectionalLight(16768477,.5);o.position.set(5,5,5),r.add(o);var s=new i.HemisphereLight(16777198,3158325,1.5);r.add(s);var a,l,u,d,c={hemisphere:s},h=window.innerWidth/window.innerHeight,p=new i.PerspectiveCamera(45,h,.1,1e3);p.lookAt(0,0,0),a=p.aspect>=1?1:1.5,l=3.5*a,u=2.5*a,d=4.5*a,p.position.set(l,u,d);var f=3158069,m=new i.GridHelper(100,40,f,f);m.position.y=-2,r.add(m);var g={scene:r,camera:p,lights:c,grid:m,add:function(t){r.add(t)},remove:function(t){r.remove(t)},resize:function(t,e){p.aspect=t/e,p.updateProjectionMatrix()}},v={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"};class x{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const y=new i.OrthographicCamera(-1,1,1,-1,0,1),A=new i.BufferGeometry;A.setAttribute("position",new i.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),A.setAttribute("uv",new i.Float32BufferAttribute([0,2,0,0,2,0],2));class b{constructor(t){this._mesh=new i.Mesh(A,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,y)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class _ extends x{constructor(t,e){super(),this.textureID=void 0!==e?e:"tDiffuse",t instanceof i.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=i.UniformsUtils.clone(t.uniforms),this.material=new i.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new b(this.material)}render(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class w extends x{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,n){const i=t.getContext(),r=t.state;let o,s;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0),this.inverse?(o=0,s=1):(o=1,s=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),r.buffers.stencil.setClear(s),r.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}class N extends x{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}new i.OrthographicCamera(-1,1,1,-1,0,1);const T=new i.BufferGeometry;T.setAttribute("position",new i.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),T.setAttribute("uv",new i.Float32BufferAttribute([0,2,0,0,2,0],2));class S extends x{constructor(t,e,n,r,o){super(),this.scene=t,this.camera=e,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new i.Color}render(t,e,n){const i=t.autoClear;let r,o;t.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),r=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),t.autoClear=i}}var F={glsl:"\n\t\nvec4 pack( float value ) {\n\n\tif ( value == 0.0 ) return vec4( 0.0, 0.0, 0.0, 0.0 );\n\n\tfloat mag = abs( value );\n\t\n\tfloat exponent = floor( log2( mag ) );\n\texponent += float( exp2( exponent ) <= mag / 2.0 );\n\texponent -= float( exp2( exponent ) > mag );\n\n\tfloat mantissa = ( exponent > 100.0 )\n\t\t? mag / 1024.0 / exp2( exponent - 10.0 ) - 1.0\n\t\t: mag / float( exp2( exponent ) ) - 1.0;\n\n\tfloat r = exponent + 127.0;\n\tmantissa *= 256.0;\n\n\tfloat g = floor( mantissa );\n\tmantissa -= g;\n\tmantissa *= 256.0;\n\n\tfloat b = floor( mantissa );\n\tmantissa -= b;\n\tmantissa *= 128.0;\n\n\tfloat a = floor( mantissa ) * 2.0 + float( value < 0.0 );\n\n\treturn vec4( r, g, b, a ) / 255.0;\n\n}\n\nfloat unpack( vec4 value ) {\n\n\tfloat r = floor( value.r * 255.0 + 0.5 );\n\tfloat g = floor( value.g * 255.0 + 0.5 );\n\tfloat b = floor( value.b * 255.0 + 0.5 );\n\tfloat a = floor( value.a * 255.0 + 0.5 );\n\n\tfloat exponent = r - 127.0;\n\tfloat sign = 1.0 - mod( a, 2.0 ) * 2.0;\n\tfloat mantissa = float( r > 0.0 ) + g / 256.0 + b / 65536.0\n\t\t+ floor( a / 2.0 ) / 8388608.0;\n\treturn sign * mantissa * exp2( exponent );\n\n}\n\n",pack:function(t,e){var n,i,r,o,s,a,l;e||(e=new Uint8Array(4*t.length));for(var u=0,d=0,c=t.length;u<c;u++)0!==(n=t[u])&&(i=Math.abs(n),r=Math.floor(Math.log2(i)),r+=(o=Math.pow(2,r))<=i/2,s=(r-=o>i)>100?i/1024/Math.pow(2,r-10)-1:i/o-1,e[d]=r+127,s*=256,a=Math.floor(s),e[d+1]=a,s=256*(s-a),l=Math.floor(s),e[d+2]=l,s=128*(s-l),e[d+3]=2*Math.floor(s)+(n<0)),d+=4;return e},unpack:function(t,e){var n,i,r,o,s,a;e||(e=new Float32Array(t.length/4));for(var l=0,u=0,d=t.length;l<d;l+=4)n=t[l],i=t[l+1],r=t[l+2],s=n-127,a=(1-(o=t[l+3])%2*2)*((n>0)+i/256+r/65536+Math.floor(o/2)/8388608)*Math.pow(2,s),e[u]=a,u++}};function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var E=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.DEFAULT_FRAGMENT,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(L(this,t),!t.renderer)throw new Error("Use TextureComputer.init( renderer ) before instancing.");this._shader=n,this._uniforms=i,this.data=e}var e,n,r;return e=t,n=[{key:"compute",value:function(){this.renderTarget=this.renderTarget===this._rt1?this._rt2:this._rt1,t.render(this.material,this.renderTarget),this.material.uniforms.tData.value=this.renderTarget.texture}},{key:"fill",value:function(t){this._data.fill(t),F.pack(this._data,this.tData.image.data)}},{key:"dispose",value:function(){this._rt1.dispose(),this._rt2.dispose(),this.tData.dispose()}},{key:"data",get:function(){return t.renderer.readRenderTargetPixels(this.renderTarget,0,0,this._size,this._size,this._buffer),F.unpack(this._buffer,this._data),this._data},set:function(e){var n=Array.isArray(e),i=n?t.getRequiredSize(e.length):t.getRequiredSize(e);this._size=i,this.tData=t.createTexture(i),this._buffer=this.tData.image.data,this._data=n?e:new Float32Array(i*i),n&&F.pack(e,this.tData.image.data),this.uniforms=this._uniforms,this._rt1=t.createRenderTarget(i),this._rt2=t.createRenderTarget(i),this.renderTarget=this._rt1}},{key:"shader",get:function(){return this._shader},set:function(e){this._shader=e,this.material=new i.ShaderMaterial({uniforms:this._uniforms,vertexShader:t.DEFAULT_VERTEX,fragmentShader:e});var n=this.size.toFixed(1);this.material.defines.resolution="vec2( ".concat(n,", ").concat(n," )")}},{key:"uniforms",get:function(){return this._uniforms},set:function(t){t.tData={value:this.tData},this._uniforms=t,this.shader=this._shader}},{key:"size",get:function(){return this._size}},{key:"texture",get:function(){return this.material.uniforms.tData.value}}],n&&P(e.prototype,n),r&&P(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();E.init=function(t){return E.renderer||(E.renderer=t,E.scene=new i.Scene,E.camera=new i.Camera,E.mesh=new i.Mesh(new i.PlaneBufferGeometry(2,2)),E.scene.add(E.mesh)),E.checkHardwareCompatibility()},E.checkHardwareCompatibility=function(){return E.isCompatible=!0,0===E.renderer.capabilities.maxVertexTextures&&(console.warn("No support for vertex textures."),E.isCompatible=!1),E.isCompatible||window.alert("Incompatible hardware."),E.isCompatible},E.render=function(t,e){E.mesh.material=t,E.renderer.setRenderTarget(e),E.renderer.render(E.scene,E.camera),E.renderer.setRenderTarget(null)},E.DEFAULT_VERTEX="\n\n    void main() {\n\n        gl_Position = vec4( position, 1.0 );\n\n    }\n\n",E.DEFAULT_FRAGMENT="\n\n    uniform sampler2D tData;\n\n    ".concat(F.GLSL,"\n\n    void main() {\n        \n        vec2 uv = gl_FragCoord.xy / resolution.xy;\n        float data = unpack( texture2D( tData, uv ) );\n\n        // Modify data...\n\n        gl_FragColor = pack( data );\n\n    }\n\n"),E.createTexture=function(t){return new i.DataTexture(new Uint8Array(t*t*4),t,t,i.RGBAFormat,i.UnsignedByteType)},E.createRenderTarget=function(t){return new i.WebGLRenderTarget(t,t,{wrapS:i.ClampToEdgeWrapping,wrapT:i.ClampToEdgeWrapping,minFilter:i.NearestFilter,magFilter:i.NearestFilter,stencilBuffer:!1,depthBuffer:!1,format:i.RGBAFormat,type:i.UnsignedByteType})},E.getRequiredSize=function(t){if(isNaN(t)||!isFinite(t)||!Number.isInteger(t)||t<1)throw new RangeError("Length must be a natural number.");for(var e=1,n=2;n*n<t;)n=Math.pow(2,e),e++;return n},E.round=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=Math.pow(10,e);return Math.round(t*n)/n};class O{constructor(t={}){this.name=t.name,this.type=t.type,this.node=t.node,this.needsUpdate=t.needsUpdate}get value(){return this.node.value}set value(t){this.node.value=t}}const I={elements:["x","y","z","w"],addShortcuts:function(){function t(t,e,n){return n?{get:function(){return this[t][e][n]},set:function(i){this[t][e][n]=i}}:{get:function(){return this[t][e]},set:function(n){this[t][e]=n}}}return function(e,n,i){const r={};for(let e=0;e<i.length;++e){const o=i[e].split("."),s=o[0],a=o[1];r[s]=t(n,s,a)}Object.defineProperties(e,r)}}()},C={nodes:{},keywords:{},add:function(t){this.nodes[t.name]=t},addKeyword:function(t,e,n){n=void 0===n||n,this.keywords[t]={callback:e,cache:n}},remove:function(t){delete this.nodes[t.name]},removeKeyword:function(t){delete this.keywords[t]},get:function(t){return this.nodes[t]},getKeyword:function(t,e){return this.keywords[t].callback.call(this,e)},getKeywordData:function(t){return this.keywords[t]},contains:function(t){return void 0!==this.nodes[t]},containsKeyword:function(t){return void 0!==this.keywords[t]}};class R{constructor(t){this.uuid=i.MathUtils.generateUUID(),this.name="",this.type=t,this.userData={}}analyze(t,e={}){t.analyzing=!0,this.build(t.addFlow(e.slot,e.cache,e.context),"v4"),t.clearVertexNodeCode(),t.clearFragmentNodeCode(),t.removeFlow(),t.analyzing=!1}analyzeAndFlow(t,e,n={}){return this.analyze(t,n),this.flow(t,e,n)}flow(t,e,n={}){t.addFlow(n.slot,n.cache,n.context);const i={};return i.result=this.build(t,e),i.code=t.clearNodeCode(),i.extra=t.context.extra,t.removeFlow(),i}build(t,e,n){e=e||this.getType(t,e);const i=t.getNodeData(n||this);return t.analyzing&&this.appendDepsNode(t,i,e),-1===t.nodes.indexOf(this)&&t.nodes.push(this),void 0!==this.updateFrame&&-1===t.updaters.indexOf(this)&&t.updaters.push(this),this.generate(t,e,n)}generate(){}getHash(){let t,e,n="{";for(t in this)e=this[t],e instanceof R&&(n+='"'+t+'":'+e.getHash()+",");if(this.hashProperties)for(let i=0;i<this.hashProperties.length;i++)t=this.hashProperties[i],e=this[t],n+='"'+t+'":"'+String(e)+'",';return n+='"id":"'+this.uuid+'"}',n}appendDepsNode(t,e,n){e.deps=(e.deps||0)+1;const i=t.getTypeLength(n);(i>(e.outputMax||0)||this.getType(t,n))&&(e.outputMax=i,e.output=n)}setName(t){return this.name=t,this}getName(){return this.name}getType(t,e){return"sampler2D"===e||"samplerCube"===e?e:this.type}getJSONNode(t){if(!(void 0===t||"string"==typeof t)&&void 0!==t.nodes[this.uuid])return t.nodes[this.uuid]}copy(t){return void 0!==t.name&&(this.name=t.name),void 0!==t.userData&&(this.userData=JSON.parse(JSON.stringify(t.userData))),this}createJSONNode(t){const e=void 0===t||"string"==typeof t,n={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return n.uuid=this.uuid,n.nodeType=this.nodeType,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.nodes[this.uuid]=n),n}toJSON(t){return this.getJSONNode(t)||this.createJSONNode(t)}}R.prototype.isNode=!0,R.prototype.hashProperties=void 0;class M extends R{constructor(t,e={}){super(t),this.shared=void 0===e.shared||e.shared,this.unique=void 0!==e.unique&&e.unique}build(t,e,n,r){if(e=e||this.getType(t),this.getShared(t,e)){const o=this.getUnique(t,e);o&&void 0===this.constructor.uuid&&(this.constructor.uuid=i.MathUtils.generateUUID()),n=t.getUuid(n||this.getUuid(),!o);const s=t.getNodeData(n),a=s.output||this.getType(t);if(t.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,s,e),this.generate(t,e,n)):super.build(t,e,n);if(o)return s.name=s.name||super.build(t,e,n),s.name;if(!this.getLabel()&&(!this.getShared(t,a)||t.context.ignoreCache||1===s.deps))return super.build(t,e,n);n=this.getUuid(!1);let l=this.getTemp(t,n);if(l)return t.format(l,a,e);{l=M.prototype.generate.call(this,t,e,n,s.output,r);const i=this.generate(t,a,n);return t.addNodeCode(l+" = "+i+";"),t.format(l,a,e)}}return super.build(t,e,n)}getShared(t,e){return"sampler2D"!==e&&"samplerCube"!==e&&this.shared}getUnique(){return this.unique}setLabel(t){return this.label=t,this}getLabel(){return this.label}getUuid(t){let e=(t||null==t)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(e=this.scope+"-"+e),e}getTemp(t,e){e=e||this.uuid;const n=t.getVars()[e];return n?n.name:void 0}generate(t,e,n,i,r){return this.getShared(t,e)||console.error("THREE.TempNode is not shared!"),n=n||this.uuid,t.getTempVar(n,i||this.getType(t),r,this.getLabel()).name}}const U=/^\s*([a-z_0-9]+)\s+([a-z_0-9]+)\s*\(([\s\S]*?)\)/i,D=/[a-z_0-9]+/gi;class X extends M{constructor(t,e,n,i,r){super(r),this.isMethod=void 0===r,this.isInterface=!1,this.parse(t,e,n,i)}getShared(){return!this.isMethod}getType(t){return t.getTypeByFormat(this.type)}getInputByName(t){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}getIncludeByName(t){let e=this.includes.length;for(;e--;)if(this.includes[e].name===t)return this.includes[e]}generate(t,e){let n,i=0,r=this.src;for(let e=0;e<this.includes.length;e++)t.include(this.includes[e],this);for(const e in this.extensions)t.extensions[e]=!0;const o=[];for(;n=D.exec(this.src);)o.push(n);for(let e=0;e<o.length;e++){const n=o[e],s=n[0],a=!this.isMethod||!this.getInputByName(s);let l=s;if(this.keywords[s]||this.useKeywords&&a&&C.containsKeyword(s)){let e=this.keywords[s];if(!e){const n=C.getKeywordData(s);n.cache&&(e=t.keywords[s]),e=e||C.getKeyword(s,t),n.cache&&(t.keywords[s]=e)}l=e.build(t)}s!==l&&(r=r.substring(0,n.index+i)+l+r.substring(n.index+s.length+i),i+=l.length-s.length),void 0===this.getIncludeByName(l)&&C.contains(l)&&t.include(C.get(l))}return"source"===e?r:this.isMethod?(this.isInterface||t.include(this,!1,r),this.name):t.format("( "+r+" )",this.getType(t),e)}parse(t,e,n,i){if(this.src=t||"",this.includes=e||[],this.extensions=n||{},this.keywords=i||{},this.isMethod){const t=this.src.match(U);if(this.inputs=[],t&&4==t.length){this.type=t[1],this.name=t[2];const e=t[3].match(D);if(e){let t=0;for(;t<e.length;){let n,i=e[t++];"in"===i||"out"===i||"inout"===i?n=e[t++]:(n=i,i="");const r=e[t++];this.inputs.push({name:r,type:n,qualifier:i})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}copy(t){return super.copy(t),this.isMethod=t.isMethod,this.useKeywords=t.useKeywords,this.parse(t.src,t.includes,t.extensions,t.keywords),void 0!==t.type&&(this.type=t.type),this}toJSON(t){let e=this.getJSONNode(t);if(!e){e=this.createJSONNode(t),e.src=this.src,e.isMethod=this.isMethod,e.useKeywords=this.useKeywords,this.isMethod||(e.type=this.type),e.extensions=JSON.parse(JSON.stringify(this.extensions)),e.keywords={};for(const n in this.keywords)e.keywords[n]=this.keywords[n].toJSON(t).uuid;if(this.includes.length){e.includes=[];for(let n=0;n<this.includes.length;n++)e.includes.push(this.includes[n].toJSON(t).uuid)}}return e}}X.prototype.nodeType="Function",X.prototype.useKeywords=!0;const z=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i;class k extends M{constructor(t,e){super(),this.parse(t||k.PI,e)}getType(t){return t.getTypeByFormat(this.type)}parse(t,e){this.src=t||"";let n,i,r="";const o=this.src.match(z);this.useDefine=e||"#"===this.src.charAt(0),o&&o.length>1?(i=o[1],n=o[2],r=o[3]):(n=this.src,i="f"),this.name=n,this.type=i,this.value=r}build(t,e){return"source"!==e?(t.include(this),t.format(this.name,this.getType(t),e)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":this.useDefine?this.src:void 0}generate(t,e){return t.format(this.name,this.getType(t),e)}copy(t){return super.copy(t),this.parse(t.src,t.useDefine),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.src=this.src,!0===e.useDefine&&(e.useDefine=!0)),e}}k.prototype.nodeType="Const",k.PI="PI",k.PI2="PI2",k.RECIPROCAL_PI="RECIPROCAL_PI",k.RECIPROCAL_PI2="RECIPROCAL_PI2",k.LOG2="LOG2",k.EPSILON="EPSILON";const Y=/^struct\s*([a-z_0-9]+)\s*{\s*((.|\n)*?)}/gim,J=/\s*(\w*?)\s*(\w*?)(\=|\;)/gim;class B extends M{constructor(t){super(),this.parse(t)}getType(t){return t.getTypeByFormat(this.name)}getInputByName(t){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}generate(t,e){return"source"===e?this.src+";":t.format("( "+this.src+" )",this.getType(t),e)}parse(t=""){this.src=t,this.inputs=[];const e=Y.exec(this.src);if(e){const t=e[2];let n;for(;n=J.exec(t);)this.inputs.push({type:n[1],name:n[2]});this.name=e[1]}else this.name="";this.type=this.name}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.src=this.src),e}}B.prototype.nodeType="Struct";class V extends M{constructor(t,e){(e=e||{}).shared=void 0!==e.shared&&e.shared,super(t,e),this.readonly=!1}setReadonly(t){return this.readonly=t,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}copy(t){return super.copy(t),void 0!==t.readonly&&(this.readonly=t.readonly),this}createJSONNode(t){const e=super.createJSONNode(t);return!0===this.readonly&&(e.readonly=this.readonly),e}generate(t,e,n,i,r,o){n=t.getUuid(n||this.getUuid()),i=i||this.getType(t);const s=t.getNodeData(n);return this.getReadonly(t)&&void 0!==this.generateReadonly?this.generateReadonly(t,e,n,i,r,o):t.isShader("vertex")?(s.vertex||(s.vertex=t.createVertexUniform(i,this,r,o,this.getLabel())),t.format(s.vertex.name,i,e)):(s.fragment||(s.fragment=t.createFragmentUniform(i,this,r,o,this.getLabel())),t.format(s.fragment.name,i,e))}}class H extends V{constructor(t,e){super("v2"),this.value=t instanceof i.Vector2?t:new i.Vector2(t,e)}generateReadonly(t,e,n,i){return t.format("vec2( "+this.x+", "+this.y+" )",i,e)}copy(t){return super.copy(t),this.value.copy(t),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.x=this.x,e.y=this.y,!0===this.readonly&&(e.readonly=!0)),e}}H.prototype.nodeType="Vector2",I.addShortcuts(H.prototype,"value",["x","y"]);class Q extends V{constructor(t,e,n){super("v3"),this.value=t instanceof i.Vector3?t:new i.Vector3(t,e,n)}generateReadonly(t,e,n,i){return t.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",i,e)}copy(t){return super.copy(t),this.value.copy(t),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.x=this.x,e.y=this.y,e.z=this.z,!0===this.readonly&&(e.readonly=!0)),e}}Q.prototype.nodeType="Vector3",I.addShortcuts(Q.prototype,"value",["x","y","z"]);class G extends V{constructor(t,e,n,r){super("v4"),this.value=t instanceof i.Vector4?t:new i.Vector4(t,e,n,r)}generateReadonly(t,e,n,i){return t.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",i,e)}copy(t){return super.copy(t),this.value.copy(t),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,!0===this.readonly&&(e.readonly=!0)),e}}G.prototype.nodeType="Vector4",I.addShortcuts(G.prototype,"value",["x","y","z","w"]);class j extends M{constructor(t){super("v2",{shared:!1}),this.index=t||0}generate(t,e){t.requires.uv[this.index]=!0;const n=this.index>0?this.index+1:"",i=t.isShader("vertex")?"uv"+n:"vUv"+n;return t.format(i,this.getType(t),e)}copy(t){return super.copy(t),this.index=t.index,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.index=this.index),e}}j.prototype.nodeType="UV",C.addKeyword("uv",(function(){return new j})),C.addKeyword("uv2",(function(){return new j(1)}));class $ extends V{constructor(t){super("f"),this.value=t||0}generateReadonly(t,e,n,i){return t.format(this.value+(this.value%1?"":".0"),i,e)}copy(t){return super.copy(t),this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value,!0===this.readonly&&(e.readonly=!0)),e}}$.prototype.nodeType="Float";class q extends X{constructor(t,e,n,i,r){super(t,r,i,n,e)}}q.prototype.nodeType="Expression";class W extends M{constructor(t,e){super("v4"),this.input=t,this.method=e||W.LINEAR_TO_LINEAR}generate(t,e){const n=this.input.build(t,"v4"),i=this.getType(t),r=W.Nodes[this.method],o=t.include(r);if(o===W.LINEAR_TO_LINEAR)return t.format(n,i,e);if(2===r.inputs.length){const r=this.factor.build(t,"f");return t.format(o+"( "+n+", "+r+" )",i,e)}return t.format(o+"( "+n+" )",i,e)}fromEncoding(t){const e=W.getEncodingComponents(t);this.method="LinearTo"+e[0],this.factor=e[1]}fromDecoding(t){const e=W.getEncodingComponents(t);this.method=e[0]+"ToLinear",this.factor=e[1]}copy(t){return super.copy(t),this.input=t.input,this.method=t.method,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.input=this.input.toJSON(t).uuid,e.method=this.method),e}}W.Nodes=function(){const t=new X("\n\t\tvec4 LinearToLinear( in vec4 value ) {\n\n\t\t\treturn value;\n\n\t\t}"),e=new X("\n\t\tvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\n\t\t\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n\n\t\t}"),n=new X("\n\t\tvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\n\t\t\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n\n\t\t}"),i=new X("\n\t\tvec4 sRGBToLinear( in vec4 value ) {\n\n\t\t\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n\n\t\t}"),r=new X("\n\t\tvec4 LinearTosRGB( in vec4 value ) {\n\n\t\t\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n\n\t\t}"),o=new X("\n\t\tvec4 RGBEToLinear( in vec4 value ) {\n\n\t\t\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n\n\t\t}"),s=new X("\n\t\tvec4 LinearToRGBE( in vec4 value ) {\n\n\t\t\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\t\t\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\t\t\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n\n\t\t}"),a=new X("\n\t\tvec3 RGBMToLinear( in vec4 value, in float maxRange ) {\n\n\t\t\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n\n\t\t}"),l=new X("\n\t\tvec3 LinearToRGBM( in vec4 value, in float maxRange ) {\n\n\t\t\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\t\t\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\t\t\tM            = ceil( M * 255.0 ) / 255.0;\n\t\t\treturn vec4( value.rgb / ( M * maxRange ), M );\n\n\t\t}"),u=new X("\n\t\tvec3 RGBDToLinear( in vec4 value, in float maxRange ) {\n\n\t\t\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n\n\t\t}"),d=new X("\n\t\tvec3 LinearToRGBD( in vec4 value, in float maxRange ) {\n\n\t\t\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\t\t\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\t\t\tD            = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\t\t\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n\n\t\t}"),c=new k("const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );"),h=new X("\n\t\tvec4 LinearToLogLuv( in vec4 value ) {\n\n\t\t\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\t\t\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\t\t\tvec4 vResult;\n\t\t\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\t\t\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\t\t\tvResult.w = fract(Le);\n\t\t\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\t\t\treturn vResult;\n\n\t\t}",[c]),p=new k("const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );");return{LinearToLinear:t,GammaToLinear:e,LinearToGamma:n,sRGBToLinear:i,LinearTosRGB:r,RGBEToLinear:o,LinearToRGBE:s,RGBMToLinear:a,LinearToRGBM:l,RGBDToLinear:u,LinearToRGBD:d,cLogLuvM:c,LinearToLogLuv:h,cLogLuvInverseM:p,LogLuvToLinear:new X("\n\t\tvec4 LogLuvToLinear( in vec4 value ) {\n\n\t\t\tfloat Le = value.z * 255.0 + value.w;\n\t\t\tvec3 Xp_Y_XYZp;\n\t\t\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\t\t\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\t\t\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\t\t\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\t\t\treturn vec4( max(vRGB, 0.0), 1.0 );\n\n\t\t}",[p])}}(),W.LINEAR_TO_LINEAR="LinearToLinear",W.GAMMA_TO_LINEAR="GammaToLinear",W.LINEAR_TO_GAMMA="LinearToGamma",W.SRGB_TO_LINEAR="sRGBToLinear",W.LINEAR_TO_SRGB="LinearTosRGB",W.RGBE_TO_LINEAR="RGBEToLinear",W.LINEAR_TO_RGBE="LinearToRGBE",W.RGBM_TO_LINEAR="RGBMToLinear",W.LINEAR_TO_RGBM="LinearToRGBM",W.RGBD_TO_LINEAR="RGBDToLinear",W.LINEAR_TO_RGBD="LinearToRGBD",W.LINEAR_TO_LOG_LUV="LinearToLogLuv",W.LOG_LUV_TO_LINEAR="LogLuvToLinear",W.getEncodingComponents=function(t){switch(t){case i.LinearEncoding:return["Linear"];case i.sRGBEncoding:return["sRGB"];case i.RGBEEncoding:return["RGBE"];case i.RGBM7Encoding:return["RGBM",new $(7).setReadonly(!0)];case i.RGBM16Encoding:return["RGBM",new $(16).setReadonly(!0)];case i.RGBDEncoding:return["RGBD",new $(256).setReadonly(!0)];case i.GammaEncoding:return["Gamma",new q("float( GAMMA_FACTOR )","f")]}},W.prototype.nodeType="ColorSpace",W.prototype.hashProperties=["method"];class K extends V{constructor(t,e,n,i){super("v4",{shared:!0}),this.value=t,this.uv=e||new j,this.bias=n,this.project=void 0!==i&&i}getTexture(t,e){return super.generate(t,e,this.value.uuid,"t")}generate(t,e){if("sampler2D"===e)return this.getTexture(t,e);const n=this.getTexture(t,e),i=this.uv.build(t,this.project?"v4":"v2");let r,o,s=this.bias?this.bias.build(t,"f"):void 0;void 0===s&&t.context.bias&&(s=t.context.bias.setTexture(this).build(t,"f")),r=this.project?"texture2DProj":s?"tex2DBias":"tex2D",o=s?r+"( "+n+", "+i+", "+s+" )":r+"( "+n+", "+i+" )";const a={include:t.isShader("vertex"),ignoreCache:!0},l=this.getType(t);return t.addContext(a),this.colorSpace=this.colorSpace||new W(new q("",l)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(o),o=this.colorSpace.build(t,l),t.removeContext(),t.format(o,l,e)}copy(t){return super.copy(t),t.value&&(this.value=t.value),this.uv=t.uv,t.bias&&(this.bias=t.bias),void 0!==t.project&&(this.project=t.project),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.value&&(e.value=this.value.uuid),e.uv=this.uv.toJSON(t).uuid,e.project=this.project,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e}}K.prototype.nodeType="Texture";class Z extends M{constructor(t){super("v3"),this.scope=t||Z.LOCAL}getType(){return this.scope===Z.PROJECTION?"v4":this.type}getShared(){switch(this.scope){case Z.LOCAL:case Z.WORLD:return!1}return!0}generate(t,e){let n;switch(this.scope){case Z.LOCAL:t.isShader("vertex")?n="transformed":(t.requires.position=!0,n="vPosition");break;case Z.WORLD:if(t.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";t.requires.worldPosition=!0,n="vWPosition";break;case Z.VIEW:n=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Z.PROJECTION:n=t.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return t.format(n,this.getType(t),e)}copy(t){return super.copy(t),this.scope=t.scope,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.scope=this.scope),e}}Z.LOCAL="local",Z.WORLD="world",Z.VIEW="view",Z.PROJECTION="projection",Z.prototype.nodeType="Position",C.addKeyword("position",(function(){return new Z})),C.addKeyword("worldPosition",(function(){return new Z(Z.WORLD)})),C.addKeyword("viewPosition",(function(){return new Z(Z.VIEW)}));class tt extends M{constructor(t){super("v3"),this.scope=t||tt.VIEW}getShared(){return this.scope===tt.WORLD}build(t,e,n,i){const r=t.context[this.scope+"Normal"];return r?r.build(t,e,n,i):super.build(t,e,n)}generate(t,e){let n;switch(this.scope){case tt.VIEW:n=t.isShader("vertex")?"transformedNormal":"geometryNormal";break;case tt.LOCAL:t.isShader("vertex")?n="objectNormal":(t.requires.normal=!0,n="vObjectNormal");break;case tt.WORLD:t.isShader("vertex")?n="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(t.requires.worldNormal=!0,n="vWNormal")}return t.format(n,this.getType(t),e)}copy(t){return super.copy(t),this.scope=t.scope,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.scope=this.scope),e}}tt.LOCAL="local",tt.WORLD="world",tt.VIEW="view",tt.prototype.nodeType="Normal",C.addKeyword("viewNormal",(function(){return new tt(tt.VIEW)})),C.addKeyword("localNormal",(function(){return new tt(tt.NORMAL)})),C.addKeyword("worldNormal",(function(){return new tt(tt.WORLD)}));class et extends M{constructor(t){super("v3"),this.scope=t||et.CUBE}getUnique(t){return!t.context.viewNormal}getType(){return this.scope===et.SPHERE?"v2":this.type}generate(t,e){const n=this.getUnique(t);if(t.isShader("fragment")){let i,r,o;switch(this.scope){case et.VECTOR:const e=new tt(tt.VIEW),s=t.context.roughness,a=e.build(t,"v3"),l=new Z(Z.VIEW).build(t,"v3"),u=s?s.build(t,"f"):void 0;let d=`reflect( -normalize( ${l} ), ${a} )`;u&&(d=`normalize( mix( ${d}, ${a}, ${u} * ${u} ) )`),r=`inverseTransformDirection( ${d}, viewMatrix )`,n?(t.addNodeCode(`vec3 reflectVec = ${r};`),i="reflectVec"):i=r;break;case et.CUBE:o=new et(et.VECTOR).build(t,"v3"),r="vec3( -"+o+".x, "+o+".yz )",n?(t.addNodeCode(`vec3 reflectCubeVec = ${r};`),i="reflectCubeVec"):i=r;break;case et.SPHERE:o=new et(et.VECTOR).build(t,"v3"),r="normalize( ( viewMatrix * vec4( "+o+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5",n?(t.addNodeCode(`vec2 reflectSphereVec = ${r};`),i="reflectSphereVec"):i=r}return t.format(i,this.getType(t),e)}return console.warn("THREE.ReflectNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.type,e)}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.scope=this.scope),e}}et.CUBE="cube",et.SPHERE="sphere",et.VECTOR="vector",et.prototype.nodeType="Reflect";class nt extends V{constructor(t,e,n){super("v4",{shared:!0}),this.value=t,this.uv=e||new et,this.bias=n}getTexture(t,e){return super.generate(t,e,this.value.uuid,"tc")}generate(t,e){if("samplerCube"===e)return this.getTexture(t,e);const n=this.getTexture(t,e),i=this.uv.build(t,"v3");let r,o=this.bias?this.bias.build(t,"f"):void 0;void 0===o&&t.context.bias&&(o=t.context.bias.setTexture(this).build(t,"f")),r=o?"texCubeBias( "+n+", "+i+", "+o+" )":"texCube( "+n+", "+i+" )";const s={include:t.isShader("vertex"),ignoreCache:!0},a=this.getType(t);return t.addContext(s),this.colorSpace=this.colorSpace||new W(new q("",a)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(r),r=this.colorSpace.build(t,a),t.removeContext(),t.format(r,a,e)}copy(t){return super.copy(t),t.value&&(this.value=t.value),this.uv=t.uv,t.bias&&(this.bias=t.bias),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.uuid,e.uv=this.uv.toJSON(t).uuid,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e}}nt.prototype.nodeType="CubeTexture";class it extends M{constructor(t,e){super(),this.setFunction(t,e)}setFunction(t,e=[]){this.value=t,this.inputs=e}getFunction(){return this.value}getType(t){return this.value.getType(t)}generate(t,e){const n=this.getType(t),i=this.value;let r=i.build(t,e)+"( ";const o=[];for(let e=0;e<i.inputs.length;e++){const n=i.inputs[e],r=this.inputs[e]||this.inputs[n.name];o.push(r.build(t,t.getTypeByFormat(n.type)))}return r+=o.join(", ")+" )",t.format(r,n,e)}copy(t){super.copy(t);for(const e in t.inputs)this.inputs[e]=t.inputs[e];return this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);if(!e){const n=this.value;if(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,n.inputs.length){e.inputs={};for(let i=0;i<n.inputs.length;i++){const r=n.inputs[i],o=this.inputs[i]||this.inputs[r.name];e.inputs[r.name]=o.toJSON(t).uuid}}}return e}}it.prototype.nodeType="FunctionCall";class rt extends M{constructor(t,e,n){super(),this.a=t,this.b=e,this.op=n}getType(t){const e=this.a.getType(t),n=this.b.getType(t);return t.isTypeMatrix(e)?"v4":t.getTypeLength(n)>t.getTypeLength(e)?n:e}generate(t,e){const n=this.getType(t),i=this.a.build(t,n),r=this.b.build(t,n);return t.format("( "+i+" "+this.op+" "+r+" )",n,e)}copy(t){return super.copy(t),this.a=t.a,this.b=t.b,this.op=t.op,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.op=this.op),e}}rt.ADD="+",rt.SUB="-",rt.MUL="*",rt.DIV="/",rt.prototype.nodeType="Operator";class ot extends M{constructor(t,e,n,i){super(),this.a=t,"string"!=typeof e?this.b=e:i=e,"string"!=typeof n?this.c=n:i=n,this.method=i}getNumInputs(){switch(this.method){case ot.MIX:case ot.CLAMP:case ot.REFRACT:case ot.SMOOTHSTEP:case ot.FACEFORWARD:return 3;case ot.MIN:case ot.MAX:case ot.MOD:case ot.STEP:case ot.REFLECT:case ot.DISTANCE:case ot.DOT:case ot.CROSS:case ot.POW:return 2;default:return 1}}getInputType(t){const e=t.getTypeLength(this.a.getType(t)),n=this.b?t.getTypeLength(this.b.getType(t)):0,i=this.c?t.getTypeLength(this.c.getType(t)):0;return e>n&&e>i?this.a.getType(t):n>i?this.b.getType(t):this.c.getType(t)}getType(t){switch(this.method){case ot.LENGTH:case ot.DISTANCE:case ot.DOT:return"f";case ot.CROSS:return"v3"}return this.getInputType(t)}generate(t,e){let n,i,r;const o=this.a?t.getTypeLength(this.a.getType(t)):0,s=this.b?t.getTypeLength(this.b.getType(t)):0,a=this.c?t.getTypeLength(this.c.getType(t)):0,l=this.getInputType(t),u=this.getType(t);switch(this.method){case ot.NEGATE:return t.format("( -"+this.a.build(t,l)+" )",l,e);case ot.INVERT:return t.format("( 1.0 - "+this.a.build(t,l)+" )",l,e);case ot.CROSS:n=this.a.build(t,"v3"),i=this.b.build(t,"v3");break;case ot.STEP:n=this.a.build(t,1===o?"f":l),i=this.b.build(t,l);break;case ot.MIN:case ot.MAX:case ot.MOD:n=this.a.build(t,l),i=this.b.build(t,1===s?"f":l);break;case ot.REFRACT:n=this.a.build(t,l),i=this.b.build(t,l),r=this.c.build(t,"f");break;case ot.MIX:n=this.a.build(t,l),i=this.b.build(t,l),r=this.c.build(t,1===a?"f":l);break;default:n=this.a.build(t,l),this.b&&(i=this.b.build(t,l)),this.c&&(r=this.c.build(t,l))}const d=[];d.push(n),i&&d.push(i),r&&d.push(r);const c=this.getNumInputs(t);if(d.length!==c)throw Error(`Arguments not match used in "${this.method}". Require ${c}, currently ${d.length}.`);return t.format(this.method+"( "+d.join(", ")+" )",u,e)}copy(t){return super.copy(t),this.a=t.a,this.b=t.b,this.c=t.c,this.method=t.method,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.a=this.a.toJSON(t).uuid,this.b&&(e.b=this.b.toJSON(t).uuid),this.c&&(e.c=this.c.toJSON(t).uuid),e.method=this.method),e}}ot.RAD="radians",ot.DEG="degrees",ot.EXP="exp",ot.EXP2="exp2",ot.LOG="log",ot.LOG2="log2",ot.SQRT="sqrt",ot.INV_SQRT="inversesqrt",ot.FLOOR="floor",ot.CEIL="ceil",ot.NORMALIZE="normalize",ot.FRACT="fract",ot.SATURATE="saturate",ot.SIN="sin",ot.COS="cos",ot.TAN="tan",ot.ASIN="asin",ot.ACOS="acos",ot.ARCTAN="atan",ot.ABS="abs",ot.SIGN="sign",ot.LENGTH="length",ot.NEGATE="negate",ot.INVERT="invert",ot.MIN="min",ot.MAX="max",ot.MOD="mod",ot.STEP="step",ot.REFLECT="reflect",ot.DISTANCE="distance",ot.DOT="dot",ot.CROSS="cross",ot.POW="pow",ot.MIX="mix",ot.CLAMP="clamp",ot.REFRACT="refract",ot.SMOOTHSTEP="smoothstep",ot.FACEFORWARD="faceforward",ot.prototype.nodeType="Math",ot.prototype.hashProperties=["method"];class st extends M{constructor(t,e,n){super("v4"),this.value=t,this.uv=e,this.bias=n}bilinearCubeUV(t,e,n,i){const r=new it(st.Nodes.bilinearCubeUV,[e,n,i]);this.colorSpaceTL=this.colorSpaceTL||new W(new q("","v4")),this.colorSpaceTL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(r.build(t)+".tl"),this.colorSpaceTR=this.colorSpaceTR||new W(new q("","v4")),this.colorSpaceTR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(r.build(t)+".tr"),this.colorSpaceBL=this.colorSpaceBL||new W(new q("","v4")),this.colorSpaceBL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(r.build(t)+".bl"),this.colorSpaceBR=this.colorSpaceBR||new W(new q("","v4")),this.colorSpaceBR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(r.build(t)+".br");const o={include:t.isShader("vertex"),ignoreCache:!0};t.addContext(o),this.colorSpaceTLExp=new q(this.colorSpaceTL.build(t,"v4"),"v4"),this.colorSpaceTRExp=new q(this.colorSpaceTR.build(t,"v4"),"v4"),this.colorSpaceBLExp=new q(this.colorSpaceBL.build(t,"v4"),"v4"),this.colorSpaceBRExp=new q(this.colorSpaceBR.build(t,"v4"),"v4"),t.removeContext();const s=new q("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return s.keywords.cubeUV_TL=this.colorSpaceTLExp,s.keywords.cubeUV_TR=this.colorSpaceTRExp,s.keywords.cubeUV_BL=this.colorSpaceBLExp,s.keywords.cubeUV_BR=this.colorSpaceBRExp,s.keywords.cubeUV=r,s}generate(t,e){if(t.isShader("fragment")){const n=this.uv,i=this.bias||t.context.roughness,r=new it(st.Nodes.roughnessToMip,[i]),o=new ot(r,st.Nodes.m0,st.Nodes.cubeUV_maxMipLevel,ot.CLAMP),s=new ot(o,ot.FLOOR),a=new ot(o,ot.FRACT),l=this.bilinearCubeUV(t,this.value,n,s),u=this.bilinearCubeUV(t,this.value,n,new rt(s,new $(1).setReadonly(!0),rt.ADD)),d=new ot(l,u,a,ot.MIX);return t.format(d.build(t),"v4",e)}return console.warn("THREE.TextureCubeUVNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,e.uv=this.uv.toJSON(t).uuid,e.bias=this.bias.toJSON(t).uuid),e}}st.Nodes=function(){const t=new B("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),e=new k("float cubeUV_maxMipLevel 8.0",!0),n=new k("float cubeUV_minMipLevel 4.0",!0),i=new k("float cubeUV_maxTileSize 256.0",!0),r=new k("float cubeUV_minTileSize 16.0",!0),o=new X("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");o.useKeywords=!1;const s=new X("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");s.useKeywords=!1;const a=new X("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[t,o,s,e,n,i,r]);a.useKeywords=!1;const l=new k("float r0 1.0",!0),u=new k("float v0 0.339",!0),d=new k("float m0 -2.0",!0),c=new k("float r1 0.8",!0),h=new k("float v1 0.276",!0),p=new k("float m1 -1.0",!0),f=new k("float r4 0.4",!0),m=new k("float v4 0.046",!0),g=new k("float m4 2.0",!0),v=new k("float r5 0.305",!0),x=new k("float v5 0.016",!0),y=new k("float m5 3.0",!0),A=new k("float r6 0.21",!0),b=new k("float v6 0.0038",!0),_=new k("float m6 4.0",!0);return{bilinearCubeUV:a,roughnessToMip:new X("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[l,u,d,c,h,p,f,m,g,v,x,y,A,b,_]),m0:d,cubeUV_maxMipLevel:e}}(),st.prototype.nodeType="TextureCubeUV";class at extends M{constructor(t,e,n){super("v4"),this.value=t,this.radianceNode=new st(this.value,e||new et(et.VECTOR),n),this.irradianceNode=new st(this.value,new tt(tt.WORLD),new $(1).setReadonly(!0))}generate(t,e){if(t.isShader("fragment")){t.require("irradiance"),t.context.bias&&t.context.bias.setTexture(this.value);return("irradiance"===t.slot?this.irradianceNode:this.radianceNode).build(t,e)}return console.warn("THREE.TextureCubeNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}copy(t){return super.copy(t),this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid),e}}at.prototype.nodeType="TextureCube";const lt=I.elements,ut=["float","vec2","vec3","vec4"],dt={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b"},ct={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"};class ht{constructor(){this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.requires={uv:[],color:[],lights:!1,fog:!1,transparent:!1,irradiance:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode="\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\t#define texCube(a, b) textureCube(a, b)\n\t\t\t\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)\n\n\t\t\t\t#define tex2D(a, b) texture2D(a, b)\n\t\t\t\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)\n\n\t\t\t#else\n\n\t\t\t\t#define texCube(a, b) textureCube(a, b)\n\t\t\t\t#define texCubeBias(a, b, c) textureCube(a, b, c)\n\n\t\t\t\t#define tex2D(a, b) texture2D(a, b)\n\t\t\t\t#define tex2DBias(a, b, c) texture2D(a, b, c)\n\n\t\t\t#endif\n\n\t\t\t#include <packing>\n\t\t\t#include <common>",this.parsCode={vertex:"",fragment:""},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={},this.updaters=[],this.nodes=[],this.analyzing=!1}build(t,e){this.buildShader("vertex",t),this.buildShader("fragment",e);for(let t=0;t<this.requires.uv.length;t++)if(this.requires.uv[t]){const e=t>0?t+1:"";this.addVaryCode("varying vec2 vUv"+e+";"),t>0&&this.addVertexParsCode("attribute vec2 uv"+e+";"),this.addVertexFinalCode("vUv"+e+" = uv"+e+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVaryCode("varying vec3 vWPosition;"),this.addVertexFinalCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this}buildShader(t,e){this.resultCode[t]=e.build(this.setShader(t),"v4")}setMaterial(t,e){return this.material=t,this.renderer=e,this.requires.lights=t.lights,this.requires.fog=t.fog,this.mergeDefines(t.defines),this}addFlow(t,e,n){return this.addSlot(t).addCache(e).addContext(n)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(t){return this.cache=t||"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(t){return this.context=Object.assign({},this.context,t),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(t=""){return this.slot=t,this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addVertexCode(t){this.addCode(t,"vertex")}addFragmentCode(t){this.addCode(t,"fragment")}addCode(t,e){this.code[e||this.shader]+=t+"\n"}addVertexNodeCode(t){this.addNodeCode(t,"vertex")}addFragmentNodeCode(t){this.addNodeCode(t,"fragment")}addNodeCode(t,e){this.nodeCode[e||this.shader]+=t+"\n"}clearNodeCode(t){t=t||this.shader;const e=this.nodeCode[t];return this.nodeCode[t]="",e}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(t){this.addFinalCode(t,"vertex")}addFragmentFinalCode(t){this.addFinalCode(t,"fragment")}addFinalCode(t,e){this.finalCode[e||this.shader]+=t+"\n"}addVertexParsCode(t){this.addParsCode(t,"vertex")}addFragmentParsCode(t){this.addParsCode(t,"fragment")}addParsCode(t,e){this.parsCode[e||this.shader]+=t+"\n"}addVaryCode(t){this.addVertexParsCode(t),this.addFragmentParsCode(t)}isCache(t){return-1!==this.caches.indexOf(t)}isSlot(t){return-1!==this.slots.indexOf(t)}define(t,e){this.defines[t]=void 0===e?1:e}require(t){this.requires[t]=!0}isDefined(t){return void 0!==this.defines[t]}getVar(t,e,n,i="varying",r="V",o=""){const s=this.getVars(i);let a=s[t];if(!a){const i=s.length;a={name:n||"node"+r+i+(o?"_"+o:""),type:e},s.push(a),s[t]=a}return a}getTempVar(t,e,n,i){return this.getVar(t,e,n,this.shader,"T",i)}getAttribute(t,e){if(!this.attributes[t]){const n=this.getVar(t,e);this.addVertexParsCode("attribute "+e+" "+t+";"),this.addVertexFinalCode(n.name+" = "+t+";"),this.attributes[t]={varying:n,name:t,type:e}}return this.attributes[t]}getCode(t){return[this.prefixCode,this.parsCode[t],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[t],"uniform"),this.getIncludesCode("consts",t),this.getIncludesCode("structs",t),this.getIncludesCode("functions",t),"void main() {",this.getVarListCode(this.getVars(t)),this.code[t],this.resultCode[t],this.finalCode[t],"}"].join("\n")}getVarListCode(t,e=""){let n="";for(let i=0,r=t.length;i<r;++i){const r=t[i],o=r.type,s=r.name,a=this.getFormatByType(o);if(void 0===a)throw new Error("Node pars "+a+" not found.");n+=e+" "+a+" "+s+";\n"}return n}getVars(t){return this.inputs.vars[t||this.shader]}getNodeData(t){const e=t.isNode?t.uuid:t;return this.nodeData[e]=this.nodeData[e]||{}}createUniform(t,e,n,i,r,o){const s=this.inputs.uniforms,a=s.list.length,l=new O({type:e,name:i||"nodeU"+a+(o?"_"+o:""),node:n,needsUpdate:r});return s.list.push(l),s[t].push(l),s[t][l.name]=l,this.uniforms[l.name]=l,l}createVertexUniform(t,e,n,i,r){return this.createUniform("vertex",t,e,n,i,r)}createFragmentUniform(t,e,n,i,r){return this.createUniform("fragment",t,e,n,i,r)}include(t,e,n){let i;if(t="string"==typeof t?C.get(t):t,!1===this.context.include)return t.name;t instanceof X?i=this.includes.functions:t instanceof k?i=this.includes.consts:t instanceof B&&(i=this.includes.structs);const r=i[this.shader]=i[this.shader]||[];if(t){let i=r[t.name];if(i||(i=r[t.name]={node:t,deps:[]},r.push(i),i.src=t.build(this,"source")),t instanceof X&&e&&r[e.name]&&-1==r[e.name].deps.indexOf(t)&&(r[e.name].deps.push(t),t.includes&&t.includes.length)){let n=0;do{this.include(t.includes[n++],e)}while(n<t.includes.length)}return n&&(i.src=n),t.name}throw new Error("Include not found.")}colorToVectorProperties(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(t){return t.replace(/c/g,"v3")}getIncludes(t,e){return this.includes[t][e||this.shader]}getIncludesCode(t,e){let n=this.getIncludes(t,e);if(!n)return"";let i="";n=n.sort(pt);for(let t=0;t<n.length;t++)n[t].src&&(i+=n[t].src+"\n");return i}getConstructorFromLength(t){return ut[t-1]}isTypeMatrix(t){return/^m/.test(t)}getTypeLength(t){return"f"===t?1:parseInt(this.colorToVector(t).substr(1))}getTypeFromLength(t){return 1===t?"f":"v"+t}findNode(){for(let t=0;t<arguments.length;t++){const e=arguments[t];if(void 0!==e&&e.isNode)return e}}resolve(){for(let t=0;t<arguments.length;t++){const e=arguments[t];if(void 0!==e){if(e.isNode)return e;if(e.isTexture)switch(e.mapping){case i.CubeReflectionMapping:case i.CubeRefractionMapping:return new nt(e);case i.CubeUVReflectionMapping:case i.CubeUVRefractionMapping:return new at(new K(e));default:return new K(e)}else{if(e.isVector2)return new H(e);if(e.isVector3)return new Q(e);if(e.isVector4)return new G(e)}}}}format(t,e,n){switch(this.colorToVector(n+" <- "+e)){case"f <- v2":case"f <- v3":case"f <- v4":return t+".x";case"f <- i":case"f <- b":return"float( "+t+" )";case"v2 <- f":return"vec2( "+t+" )";case"v2 <- v3":case"v2 <- v4":return t+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+t+" ) )";case"v3 <- f":return"vec3( "+t+" )";case"v3 <- v2":return"vec3( "+t+", 0.0 )";case"v3 <- v4":return t+".xyz";case"v4 <- f":return"vec4( "+t+" )";case"v4 <- v2":return"vec4( "+t+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+t+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+t+" ) )";case"i <- f":case"i <- b":return"int( "+t+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+t+".x )";case"b <- f":return"( "+t+" != 0.0 )";case"b <- v2":return"( "+t+" != vec2( 0.0 ) )";case"b <- v3":return"( "+t+" != vec3( 0.0 ) )";case"b <- v4":return"( "+t+" != vec4( 0.0 ) )";case"b <- i":return"( "+t+" != 0 )"}return t}getTypeByFormat(t){return dt[t]||t}getFormatByType(t){return ct[t]||t}getUuid(t,e){return(e=void 0===e||e)&&this.cache&&(t=this.cache+"-"+t),t}getElementByIndex(t){return lt[t]}getIndexByElement(t){return lt.indexOf(t)}isShader(t){return this.shader===t}setShader(t){return this.shader=t,this}mergeDefines(t){for(const e in t)this.defines[e]=t[e];return this.defines}mergeUniform(t){for(const e in t)this.uniforms[e]=t[e];return this.uniforms}getTextureEncodingFromMap(t){let e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=i.LinearEncoding,e===i.LinearEncoding&&this.context.gamma&&(e=i.GammaEncoding),e}}function pt(t,e){return t.deps.length-e.deps.length}class ft extends V{constructor(t,e,n){super("c"),this.value=t instanceof i.Color?t:new i.Color(t||0,e,n)}generateReadonly(t,e,n,i){return t.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",i,e)}copy(t){return super.copy(t),this.value.copy(t),this}toJSON(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).r=this.r,e.g=this.g,e.b=this.b,!0===this.readonly&&(e.readonly=!0)),e}}ft.prototype.nodeType="Color",I.addShortcuts(ft.prototype,"value",["r","g","b"]);class mt extends R{constructor(t){super("v4"),this.value=t}generate(t){const e=this.value.analyzeAndFlow(t,this.type);let n=e.code+"\n";return t.isShader("vertex")?n+="gl_Position = "+e.result+";":n+="gl_FragColor = "+e.result+";",n}copy(t){return super.copy(t),this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid),e}}mt.prototype.nodeType="Raw";class gt extends i.ShaderMaterial{constructor(t,e){super(),this.vertex=t||new mt(new Z(Z.PROJECTION)),this.fragment=e||new mt(new ft(16711680)),this.updaters=[],this.type="NodeMaterial"}get properties(){return this.fragment.properties}get needsUpdate(){return this.needsCompile}set needsUpdate(t){!0===t&&this.version++,this.needsCompile=t}onBeforeCompile(t,e){this.build({renderer:e}),t.defines=this.defines,t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.extensionDerivatives=!0===this.extensions.derivatives,t.extensionFragDepth=!0===this.extensions.fragDepth,t.extensionDrawBuffers=!0===this.extensions.drawBuffers,t.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}customProgramCacheKey(){return this.getHash()}getHash(){let t="{";return t+='"vertex":'+this.vertex.getHash()+",",t+='"fragment":'+this.fragment.getHash(),t+="}",t}updateFrame(t){for(let e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])}build(t={}){const e=t.builder||new ht;return e.setMaterial(this,t.renderer),e.build(this.vertex,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters,this.fog=e.requires.fog,this.lights=e.requires.lights,this.transparent=e.requires.transparent||this.blending>i.NormalBlending,this}copy(t){const e=this.uuid;for(const e in t)this[e]=t[e];return this.uuid=e,void 0!==t.userData&&(this.userData=JSON.parse(JSON.stringify(t.userData))),this}toJSON(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.materials&&(t.materials={}),!t.materials[this.uuid]){const e={};e.uuid=this.uuid,e.type=this.type,t.materials[e.uuid]=e,""!==this.name&&(e.name=this.name),void 0!==this.size&&(e.size=this.size),void 0!==this.sizeAttenuation&&(e.sizeAttenuation=this.sizeAttenuation),this.blending!==i.NormalBlending&&(e.blending=this.blending),!0===this.flatShading&&(e.flatShading=this.flatShading),this.side!==i.FrontSide&&(e.side=this.side),this.vertexColors!==i.NoColors&&(e.vertexColors=this.vertexColors),this.depthFunc!==i.LessEqualDepth&&(e.depthFunc=this.depthFunc),!1===this.depthTest&&(e.depthTest=this.depthTest),!1===this.depthWrite&&(e.depthWrite=this.depthWrite),1!==this.linewidth&&(e.linewidth=this.linewidth),void 0!==this.dashSize&&(e.dashSize=this.dashSize),void 0!==this.gapSize&&(e.gapSize=this.gapSize),void 0!==this.scale&&(e.scale=this.scale),!0===this.dithering&&(e.dithering=!0),!0===this.wireframe&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(e.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(e.wireframeLinejoin=this.wireframeLinejoin),this.alphaTest>0&&(e.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(e.premultipliedAlpha=this.premultipliedAlpha),!1===this.visible&&(e.visible=!1),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.fog=this.fog,e.lights=this.lights,e.vertex=this.vertex.toJSON(t).uuid,e.fragment=this.fragment.toJSON(t).uuid}return t.material=this.uuid,t}}gt.prototype.isNodeMaterial=!0;class vt extends K{constructor(t){super(void 0,t)}getUnique(){return!0}getTexture(t,e){return V.prototype.generate.call(this,t,e,this.getUuid(),"t","renderTexture")}}vt.prototype.nodeType="Screen";class xt extends _{constructor(){super(),this.name="",this.uuid=i.MathUtils.generateUUID(),this.userData={},this.textureID="renderTexture",this.input=new vt,this.material=new gt,this.needsUpdate=!0}render(){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.input,this.needsUpdate=!1),this.uniforms=this.material.uniforms,super.render(...arguments)}copy(t){return this.input=t.input,this}toJSON(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.passes&&(t.passes={}),!t.passes[this.uuid]){var e={};e.uuid=this.uuid,e.type="NodePass",t.passes[this.uuid]=e,""!==this.name&&(e.name=this.name),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.input=this.input.toJSON(t).uuid}return t.pass=this.uuid,t}}(class extends R{constructor(t,e){super(t),this.value=e}getType(t){return t.getTypeByFormat(this.type)}generate(t,e){const n=t.getVar(this.uuid,this.type);return this.value&&t.isShader("vertex")&&t.addNodeCode(n.name+" = "+this.value.build(t,this.getType(t))+";"),t.format(n.name,this.getType(t),e)}copy(t){return super.copy(t),this.type=t.type,this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.type=this.type,this.value&&(e.value=this.value.toJSON(t).uuid)),e}}).prototype.nodeType="Var";(class extends R{constructor(t,e){super(e),this.name=t}getAttributeType(t){return"number"==typeof this.type?t.getConstructorFromLength(this.type):this.type}getType(t){const e=this.getAttributeType(t);return t.getTypeByFormat(e)}generate(t,e){const n=this.getAttributeType(t),i=t.getAttribute(this.name,n),r=t.isShader("vertex")?this.name:i.varying.name;return t.format(r,this.getType(t),e)}copy(t){return super.copy(t),this.type=t.type,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.type=this.type),e}}).prototype.nodeType="Attribute";(class extends V{constructor(t){super("b"),this.value=Boolean(t)}generateReadonly(t,e,n,i){return t.format(this.value,i,e)}copy(t){return super.copy(t),this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value,!0===this.readonly&&(e.readonly=!0)),e}}).prototype.nodeType="Bool";class yt extends V{constructor(t){super("i"),this.value=Math.floor(t||0)}generateReadonly(t,e,n,i){return t.format(this.value,i,e)}copy(t){return super.copy(t),this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value,!0===this.readonly&&(e.readonly=!0)),e}}yt.prototype.nodeType="Int";class At extends V{constructor(t){super("m3"),this.value=t||new i.Matrix3}get elements(){return this.value.elements}set elements(t){this.value.elements=t}generateReadonly(t,e,n,i){return t.format("mat3( "+this.value.elements.join(", ")+" )",i,e)}copy(t){return super.copy(t),this.value.fromArray(t.elements),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.elements=this.value.elements.concat()),e}}At.prototype.nodeType="Matrix3";class bt extends V{constructor(t){super("m4"),this.value=t||new i.Matrix4}get elements(){return this.value.elements}set elements(t){this.value.elements=t}generateReadonly(t,e,n,i){return t.format("mat4( "+this.value.elements.join(", ")+" )",i,e)}copy(t){return super.copy(t),this.scope.value.fromArray(t.elements),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.elements=this.value.elements.concat()),e}}bt.prototype.nodeType="Matrix4";(class extends M{constructor(t){super("v4"),t&&this.setMirror(t)}setMirror(t){this.mirror=t,this.textureMatrix=new bt(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new Z(Z.LOCAL),this.uv=new rt(this.textureMatrix,this.localPosition,rt.MUL),this.uvResult=new rt(null,this.uv,rt.ADD),this.texture=new K(this.mirror.material.uniforms.tDiffuse.value,this.uv,null,!0)}generate(t,e){return t.isShader("fragment")?(this.uvResult.a=this.offset,this.texture.uv=this.offset?this.uvResult:this.uv,"sampler2D"===e?this.texture.build(t,e):t.format(this.texture.build(t,this.type),this.type,e)):(console.warn("THREE.ReflectorNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.type,e))}copy(t){return V.prototype.copy.call(this,t),this.scope.mirror=t.mirror,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.mirror=this.mirror.uuid,this.offset&&(e.offset=this.offset.toJSON(t).uuid)),e}}).prototype.nodeType="Reflector";class _t extends V{constructor(t,e,n){super(n),this.object=t,this.property=e}get value(){return this.object[this.property]}set value(t){this.object[this.property]=t}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value,e.property=this.property),e}}_t.prototype.nodeType="Property";(class extends K{constructor(t,e,n,r={}){const o=new i.WebGLRenderTarget(t,e,r);super(o.texture),this.input=n,this.clear=void 0===r.clear||r.clear,this.renderTarget=o,this.material=new gt,this.camera=new i.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new i.Scene,this.quad=new i.Mesh(new i.PlaneGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.render=!0}build(t,e,n){const i=new ht;return i.nodes=t.nodes,i.updaters=t.updaters,this.material.fragment.value=this.input,this.material.build({builder:i}),super.build(t,e,n)}updateFramesaveTo(t){if(this.saveTo.render=!1,this.saveTo!==this.saveToCurrent){this.saveToMaterial&&this.saveToMaterial.dispose();const t=new gt;t.fragment.value=this,t.build();const e=new i.Scene,n=new i.Mesh(new i.PlaneGeometry(2,2),t);n.frustumCulled=!1,e.add(n),this.saveToScene=e,this.saveToMaterial=t}this.saveToCurrent=this.saveTo,t.renderer.setRenderTarget(this.saveTo.renderTarget),this.saveTo.clear&&t.renderer.clear(),t.renderer.render(this.saveToScene,this.camera)}updateFrame(t){t.renderer?(this.saveTo&&!1===this.saveTo.render&&this.updateFramesaveTo(t),this.render&&(this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=t.renderTexture),t.renderer.setRenderTarget(this.renderTarget),this.clear&&t.renderer.clear(),t.renderer.render(this.scene,this.camera)),this.saveTo&&!0===this.saveTo.render&&this.updateFramesaveTo(t)):console.warn("RTTNode need a renderer in NodeFrame")}copy(t){return super.copy(t),this.saveTo=t.saveTo,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=super.toJSON(t),this.saveTo&&(e.saveTo=this.saveTo.toJSON(t).uuid)),e}}).prototype.nodeType="RTT";var wt=["color","color2"],Nt=["vColor","vColor2"];(class extends M{constructor(t){super("v4",{shared:!1}),this.index=t||0}generate(t,e){t.requires.color[this.index]=!0;const n=t.isShader("vertex")?wt[this.index]:Nt[this.index];return t.format(n,this.getType(t),e)}copy(t){return super.copy(t),this.index=t.index,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.index=this.index),e}}).prototype.nodeType="Colors";class Tt extends M{constructor(t,e){super("v3"),this.setScope(t||Tt.POSITION),this.setCamera(e)}setCamera(t){this.camera=t,this.updateFrame=void 0!==t?this.onUpdateFrame:void 0}setScope(t){if(this.scope===Tt.DEPTH)delete this.near,delete this.far;if(this.scope=t,t===Tt.DEPTH){const t=this.camera;this.near=new $(t?t.near:1),this.far=new $(t?t.far:1200)}}getType(){return this.scope===Tt.DEPTH?"f":this.type}getUnique(){switch(this.scope){case Tt.DEPTH:case Tt.TO_VERTEX:return!0}return!1}getShared(){return this.scope!==Tt.POSITION}generate(t,e){let n;switch(this.scope){case Tt.POSITION:n="cameraPosition";break;case Tt.DEPTH:n=t.include(Tt.Nodes.depthColor)+"( "+this.near.build(t,"f")+", "+this.far.build(t,"f")+" )";break;case Tt.TO_VERTEX:n="normalize( "+new Z(Z.WORLD).build(t,"v3")+" - cameraPosition )"}return t.format(n,this.getType(t),e)}onUpdateFrame(){if(this.scope===Tt.DEPTH){const t=this.camera;this.near.value=t.near,this.far.value=t.far}}copy(t){if(super.copy(t),this.setScope(t.scope),t.camera&&this.setCamera(t.camera),t.scope===Tt.DEPTH)this.near.number=t.near,this.far.number=t.far;return this}toJSON(t){let e=this.getJSONNode(t);if(!e&&(e=this.createJSONNode(t),e.scope=this.scope,this.camera&&(e.camera=this.camera.uuid),this.scope===Tt.DEPTH))e.near=this.near.value,e.far=this.far.value;return e}}Tt.Nodes={depthColor:new X("\n\t\tfloat depthColor( float mNear, float mFar ) {\n\n\t\t\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t\t\t#else\n\n\t\t\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t\t\t#endif\n\n\t\t\treturn 1.0 - smoothstep( mNear, mFar, depth );\n\n\t\t}")},Tt.POSITION="position",Tt.DEPTH="depth",Tt.TO_VERTEX="toVertex",Tt.prototype.nodeType="Camera";class St extends M{constructor(t){super("v3",{shared:!1}),this.scope=t||St.TOTAL}generate(t,e){return t.isCache("light")?t.format("reflectedLight.directDiffuse",this.type,e):(console.warn('THREE.LightNode is only compatible in "light" channel.'),t.format("vec3( 0.0 )",this.type,e))}copy(t){return super.copy(t),this.scope=t.scope,this}toJSON(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e}}St.TOTAL="total",St.prototype.nodeType="Light";class Ft extends H{constructor(){super(),this.size=new i.Vector2}updateFrame(t){if(t.renderer){t.renderer.getSize(this.size);const e=t.renderer.getPixelRatio();this.x=this.size.width*e,this.y=this.size.height*e}else console.warn("ResolutionNode need a renderer in NodeFrame")}copy(t){return super.copy(t),this.renderer=t.renderer,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.renderer=this.renderer.uuid),e}}Ft.prototype.nodeType="Resolution";(class extends M{constructor(t){super("v2"),this.resolution=t||new Ft}generate(t,e){let n;return t.isShader("fragment")?n="( gl_FragCoord.xy / "+this.resolution.build(t,"v2")+")":(console.warn("THREE.ScreenUVNode is not compatible with "+t.shader+" shader."),n="vec2( 0.0 )"),t.format(n,this.getType(t),e)}copy(t){return super.copy(t),this.resolution=t.resolution,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.resolution=this.resolution.toJSON(t).uuid),e}}).prototype.nodeType="ScreenUV";class Lt extends M{constructor(t,e,n,i,r){super(),this.a=t,this.b=e,this.op=n,this.ifNode=i,this.elseNode=r}getType(t){if(this.ifNode){const e=this.ifNode.getType(t),n=this.elseNode.getType(t);return t.getTypeLength(n)>t.getTypeLength(e)?n:e}return"b"}getCondType(t){return t.getTypeLength(this.b.getType(t))>t.getTypeLength(this.a.getType(t))?this.b.getType(t):this.a.getType(t)}generate(t,e){const n=this.getType(t),i=this.getCondType(t),r=this.a.build(t,i),o=this.b.build(t,i);let s;if(this.ifNode){const e=this.ifNode.build(t,n),i=this.elseNode.build(t,n);s="( "+[r,this.op,o,"?",e,":",i].join(" ")+" )"}else s="( "+r+" "+this.op+" "+o+" )";return t.format(s,this.getType(t),e)}copy(t){return super.copy(t),this.a=t.a,this.b=t.b,this.op=t.op,this.ifNode=t.ifNode,this.elseNode=t.elseNode,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.op=this.op,e.ifNode&&(e.ifNode=this.ifNode.toJSON(t).uuid),e.elseNode&&(e.elseNode=this.elseNode.toJSON(t).uuid)),e}}Lt.EQUAL="==",Lt.NOT_EQUAL="!=",Lt.GREATER=">",Lt.GREATER_EQUAL=">=",Lt.LESS="<",Lt.LESS_EQUAL="<=",Lt.AND="&&",Lt.OR="||",Lt.prototype.nodeType="Cond";const Pt="\nvec3 mod289( vec3 x ) {\n\n\treturn x - floor( x * ( 1.0 / 289.0 ) ) * 289.0;\n\n}\n\nvec4 mod289( vec4 x ) {\n\n\treturn x - floor( x * ( 1.0 / 289.0 ) ) * 289.0;\n\n}\n\nvec4 permute( vec4 x ) {\n\n\treturn mod289( ( ( x * 34.0 ) + 1.0 ) * x );\n\n}\n\nvec4 taylorInvSqrt( vec4 r ) {\n\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n\n}\n\nvec2 fade( vec2 t ) {\n\n\treturn t * t * t * ( t * ( t * 6.0 - 15.0 ) + 10.0 );\n\n}\n\nvec3 fade( vec3 t ) {\n\n\treturn t * t * t * ( t * ( t * 6.0 - 15.0 ) + 10.0 );\n\n}\n".trim(),Et="\nfloat noise2d( vec2 P, float amplitude, float pivot ) {\n\n\tvec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n\tvec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n\tPi = mod289(Pi); // To avoid truncation effects in permutation\n\tvec4 ix = Pi.xzxz;\n\tvec4 iy = Pi.yyww;\n\tvec4 fx = Pf.xzxz;\n\tvec4 fy = Pf.yyww;\n\n\tvec4 i = permute(permute(ix) + iy);\n\n\tvec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n\tvec4 gy = abs(gx) - 0.5 ;\n\tvec4 tx = floor(gx + 0.5);\n\tgx = gx - tx;\n\n\tvec2 g00 = vec2(gx.x,gy.x);\n\tvec2 g10 = vec2(gx.y,gy.y);\n\tvec2 g01 = vec2(gx.z,gy.z);\n\tvec2 g11 = vec2(gx.w,gy.w);\n\n\tvec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n\tg00 *= norm.x;\n\tg01 *= norm.y;\n\tg10 *= norm.z;\n\tg11 *= norm.w;\n\n\tfloat n00 = dot(g00, vec2(fx.x, fy.x));\n\tfloat n10 = dot(g10, vec2(fx.y, fy.y));\n\tfloat n01 = dot(g01, vec2(fx.z, fy.z));\n\tfloat n11 = dot(g11, vec2(fx.w, fy.w));\n\n\tvec2 fade_xy = fade(Pf.xy);\n\tvec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n\tfloat n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n\treturn 2.3 * n_xy * amplitude + pivot;\n\n}\n".trim();class Ot extends M{constructor(t=new j,e=new $(1),n=new $(0)){super("f"),this.uv=t,this.amplitude=e,this.pivot=n}generate(t,e){const n=new it(Ot.Nodes.noise2d,[this.uv,this.amplitude,this.pivot]);return t.format(n.generate(t,e),this.getType(t),e)}copy(t){super.copy(t),this.uv=t.uv,this.amplitude=t.amplitude,this.pivot=t.pivot}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.uv=this.uv.toJSON(t).uuid,e.amplitude=this.amplitude.toJSON(t).uuid,e.pivot=this.pivot.toJSON(t).uuid),e}}Ot.prototype.nodeType="Noise2D",Ot.Nodes=function(){const t=new X(Pt),e=new X(Et);return e.includes=[t],{noiseCommon:t,noise2d:e}}();const It="\nfloat noise3d( vec3 P, float amplitude, float pivot ) {\n\n\tvec3 Pi0 = floor(P); // Integer part for indexing\n\tvec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n\tPi0 = mod289(Pi0);\n\tPi1 = mod289(Pi1);\n\tvec3 Pf0 = fract(P); // Fractional part for interpolation\n\tvec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n\tvec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\tvec4 iy = vec4(Pi0.yy, Pi1.yy);\n\tvec4 iz0 = Pi0.zzzz;\n\tvec4 iz1 = Pi1.zzzz;\n\n\tvec4 ixy = permute(permute(ix) + iy);\n\tvec4 ixy0 = permute(ixy + iz0);\n\tvec4 ixy1 = permute(ixy + iz1);\n\n\tvec4 gx0 = ixy0 * (1.0 / 7.0);\n\tvec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n\tgx0 = fract(gx0);\n\tvec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\tvec4 sz0 = step(gz0, vec4(0.0));\n\tgx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\tgy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n\tvec4 gx1 = ixy1 * (1.0 / 7.0);\n\tvec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n\tgx1 = fract(gx1);\n\tvec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\tvec4 sz1 = step(gz1, vec4(0.0));\n\tgx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\tgy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n\tvec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\tvec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\tvec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\tvec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\tvec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\tvec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\tvec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\tvec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n\tvec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\tg000 *= norm0.x;\n\tg010 *= norm0.y;\n\tg100 *= norm0.z;\n\tg110 *= norm0.w;\n\tvec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\tg001 *= norm1.x;\n\tg011 *= norm1.y;\n\tg101 *= norm1.z;\n\tg111 *= norm1.w;\n\n\tfloat n000 = dot(g000, Pf0);\n\tfloat n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\tfloat n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\tfloat n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\tfloat n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\tfloat n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\tfloat n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\tfloat n111 = dot(g111, Pf1);\n\n\tvec3 fade_xyz = fade(Pf0);\n\tvec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\tvec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\tfloat n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n\treturn 2.2 * n_xyz * amplitude + pivot;\n\n}\n".trim();class Ct extends M{constructor(t=new Z,e=new $(1),n=new $(0)){super("f"),this.position=t,this.amplitude=e,this.pivot=n}generate(t,e){const n=new it(Ct.Nodes.noise3d,[this.position,this.amplitude,this.pivot]);return t.format(n.generate(t,e),this.getType(t),e)}copy(t){super.copy(t),this.position=t.position,this.amplitude=t.amplitude,this.pivot=t.pivot}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.position=this.position.toJSON(t).uuid,e.amplitude=this.amplitude.toJSON(t).uuid,e.pivot=this.pivot.toJSON(t).uuid),e}}Ct.prototype.nodeType="Noise3D",Ct.Nodes=function(){const t=new X(It);return t.includes=[Ot.Nodes.noiseCommon],{noise3d:t}}();class Rt extends M{constructor(t){super("f"),this.uv=t||new j}generate(t,e){const n=t.include(Rt.Nodes.checker);return t.format(n+"( "+this.uv.build(t,"v2")+" )",this.getType(t),e)}copy(t){return super.copy(t),this.uv=t.uv,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.uv=this.uv.toJSON(t).uuid),e}}Rt.Nodes={checker:new X("\n\t\tfloat checker( vec2 uv ) {\n\n\t\t\tfloat cx = floor( uv.x );\n\t\t\tfloat cy = floor( uv.y );\n\t\t\tfloat result = mod( cx + cy, 2.0 );\n\n\t\t\treturn sign( result );\n\n\t\t}")},Rt.prototype.nodeType="Noise";const Mt="\nfloat fractal3d( vec3 p, float amplitude, int octaves, float lacunarity, float diminish ) {\n\n\tfloat result = 0.0;\n\n\tfor (int i = 0;  i < octaves; ++i) {\n\n\t\tresult += noise3d(p, amplitude, 0.0);\n\t\tamplitude *= diminish;\n\t\tp *= lacunarity;\n\n\t}\n\n\treturn result;\n\n}\n".trim();class Ut extends M{constructor(t=new Z,e=new $(1),n=3,i=2,r=.5){super("f"),this.position=t,this.amplitude=e,this.octaves=new yt(n).setReadonly(!0),this.lacunarity=new $(i).setReadonly(!0),this.diminish=new $(r).setReadonly(!0)}generate(t,e){const n=new it(Ut.Nodes.fractal3d,[this.position,this.amplitude,this.octaves,this.lacunarity,this.diminish]);return t.format(n.generate(t,e),this.getType(t),e)}copy(t){super.copy(t),this.position=t.position,this.amplitude=t.amplitude,this.octaves=t.octaves,this.lacunarity=t.lacunarity,this.diminish=t.diminish}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.position=this.position.toJSON(t).uuid,e.amplitude=this.amplitude.toJSON(t).uuid,e.octaves=this.octaves.toJSON(t).uuid,e.lacunarity=this.lacunarity.toJSON(t).uuid,e.diminish=this.diminish.toJSON(t).uuid),e}}Ut.prototype.nodeType="Fractal3D",Ut.Nodes=function(){const t=new X(Mt);return t.includes=[Ct.Nodes.noise3d],{fractal3d:t}}();class Dt extends M{constructor(t,e){super("v3"),this.value=t,this.scale=e||new H(1,1)}generate(t,e){if(t.isShader("fragment")){const n=t.include(Dt.Nodes.perturbNormal2Arb);this.normal=this.normal||new tt,this.position=this.position||new Z(Z.VIEW),this.uv=this.uv||new j;let r=this.scale.build(t,"v2");return t.material.side===i.BackSide&&(r="-"+r),t.format(n+"( -"+this.position.build(t,"v3")+", "+this.normal.build(t,"v3")+", "+this.value.build(t,"v3")+", "+this.uv.build(t,"v2")+", "+r+" )",this.getType(t),e)}return console.warn("THREE.NormalMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}copy(t){return super.copy(t),this.value=t.value,this.scale=t.scale,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,e.scale=this.scale.toJSON(t).uuid),e}}Dt.Nodes={perturbNormal2Arb:new X("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 vUv, vec2 normalScale ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = map * 2.0 - 1.0;\n\n\t\tmapN.xy *= normalScale;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t// Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331\n\n\t\t\tif ( dot( cross( S, T ), N ) < 0.0 ) mapN.xy *= - 1.0;\n\n\t\t#else\n\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}",null,{derivatives:!0})},Dt.prototype.nodeType="NormalMap";class Xt extends M{constructor(t,e){super("v3"),this.value=t,this.scale=e||new $(1),this.toNormalMap=!1}generate(t,e){if(t.isShader("fragment")){if(this.toNormalMap){const n=t.include(Xt.Nodes.bumpToNormal);return t.format(n+"( "+this.value.build(t,"sampler2D")+", "+this.value.uv.build(t,"v2")+", "+this.scale.build(t,"f")+" )",this.getType(t),e)}{const n=t.include(Xt.Nodes.dHdxy_fwd),i=t.include(Xt.Nodes.perturbNormalArb);this.normal=this.normal||new tt,this.position=this.position||new Z(Z.VIEW);const r=n+"( "+this.value.build(t,"sampler2D")+", "+this.value.uv.build(t,"v2")+", "+this.scale.build(t,"f")+" )";return t.format(i+"( -"+this.position.build(t,"v3")+", "+this.normal.build(t,"v3")+", "+r+" )",this.getType(t),e)}}return console.warn("THREE.BumpMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}copy(t){return super.copy(t),this.value=t.value,this.scale=t.scale,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,e.scale=this.scale.toJSON(t).uuid),e}}Xt.Nodes=function(){const t=new X("\n\n\t\tvec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {\n\n\t\t\tvec2 dSTdx = dFdx( vUv );\n\t\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\t\treturn vec2( dBx, dBy );\n\n\t\t}",null,{derivatives:!0});return{dHdxy_fwd:t,perturbNormalArb:new X("\n\n\t\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\t\tvec3 vN = surf_norm; // normalized\n\n\t\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\n\t\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t\t}",[t],{derivatives:!0}),bumpToNormal:new X("\n\t\tvec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {\n\n\t\t\tvec2 dSTdx = dFdx( uv );\n\t\t\tvec2 dSTdy = dFdy( uv );\n\n\t\t\tfloat Hll = texture2D( bumpMap, uv ).x;\n\t\t\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;\n\t\t\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;\n\n\t\t\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );\n\n\t\t}",null,{derivatives:!0})}}(),Xt.prototype.nodeType="BumpMap",Xt.prototype.hashProperties=["toNormalMap"];(class extends R{constructor(t,e){super(),this.code=t,this.value=e}getType(t){return this.value?this.value.getType(t):t.isShader("fragment")?"f":"void"}generate(t,e){const n=this.code.build(t,e)+";";return t.addNodeCode(n),t.isShader("vertex")?this.value?this.value.build(t,e):void 0:this.value?this.value.build(t,e):t.format("0.0","f",e)}copy(t){return super.copy(t),this.code=t.code,this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.code=this.code.toJSON(t).uuid,this.value&&(e.value=this.value.toJSON(t).uuid)),e}}).prototype.nodeType="Bypass";const zt=I.elements;(class extends M{constructor(t,e,n,i){super("f"),this.x=t,this.y=e,this.z=n,this.w=i}getNumElements(){let t=zt.length;for(;t--;)if(void 0!==this[zt[t]]){++t;break}return Math.max(t,2)}getType(t){return t.getTypeFromLength(this.getNumElements())}generate(t,e){const n=this.getType(t),i=this.getNumElements(),r=[];for(let e=0;e<i;e++){const n=this[zt[e]];r.push(n?n.build(t,"f"):"0.0")}const o=(i>1?t.getConstructorFromLength(i):"")+"( "+r.join(", ")+" )";return t.format(o,n,e)}copy(t){super.copy(t);for(const e in t.inputs)this[e]=t.inputs[e];return this}toJSON(t){let e=this.getJSONNode(t);if(!e){e=this.createJSONNode(t),e.inputs={};const n=this.getNumElements();for(let i=0;i<n;i++){const n=this[zt[i]];n&&(e.inputs[zt[i]]=n.toJSON(t).uuid)}}return e}}).prototype.nodeType="Join";class kt extends R{constructor(t,e){super(),this.node=t,this.components=e||"x"}getType(t){return t.getTypeFromLength(this.components.length)}generate(t,e){const n=this.node.getType(t),i=t.getTypeLength(n)-1;let r=this.node.build(t,n);if(i>0){let n=0;const o=t.colorToVectorProperties(this.components);let s;const a=o.length;for(s=0;s<a;s++)n=Math.max(n,t.getIndexByElement(o.charAt(s)));for(n>i&&(n=i),r+=".",s=0;s<a;s++){let e=t.getIndexByElement(o.charAt(s));e>n&&(e=n),r+=t.getElementByIndex(e)}return t.format(r,this.getType(t),e)}return t.format(r,n,e)}copy(t){return super.copy(t),this.node=t.node,this.components=t.components,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.node=this.node.toJSON(t).uuid,e.components=this.components),e}}kt.prototype.nodeType="Switch";const Yt="\nfloat remap( float value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\tfloat x = ( value - inLow ) / ( inHigh - inLow );\n\treturn outLow + ( outHigh - outLow ) * x;\n\n}\n\nvec2 remap( vec2 value, vec2 inLow, vec2 inHigh, vec2 outLow, vec2 outHigh ) {\n\n\treturn vec2(\n\t\tremap( value.x, inLow.x, inHigh.x, outLow.x, outHigh.x ),\n\t\tremap( value.y, inLow.y, inHigh.y, outLow.y, outHigh.y )\n\t);\n\n}\n\nvec2 remap( vec2 value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\treturn vec2(\n\t\tremap( value.x, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.y, inLow, inHigh, outLow, outHigh )\n\t);\n\n}\n\nvec3 remap( vec3 value, vec3 inLow, vec3 inHigh, vec3 outLow, vec3 outHigh ) {\n\n\treturn vec3(\n\t\tremap( value.x, inLow.x, inHigh.x, outLow.x, outHigh.x ),\n\t\tremap( value.y, inLow.y, inHigh.y, outLow.y, outHigh.y ),\n\t\tremap( value.z, inLow.z, inHigh.z, outLow.z, outHigh.z )\n\t);\n\n}\n\nvec3 remap( vec3 value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\treturn vec3(\n\t\tremap( value.x, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.y, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.z, inLow, inHigh, outLow, outHigh )\n\t);\n\n}\n\nvec4 remap( vec4 value, vec4 inLow, vec4 inHigh, vec4 outLow, vec4 outHigh ) {\n\n\treturn vec4(\n\t\tremap( value.x, inLow.x, inHigh.x, outLow.x, outHigh.x ),\n\t\tremap( value.y, inLow.y, inHigh.y, outLow.y, outHigh.y ),\n\t\tremap( value.z, inLow.z, inHigh.z, outLow.z, outHigh.z ),\n\t\tremap( value.w, inLow.w, inHigh.w, outLow.w, outHigh.w )\n\t);\n\n}\n\nvec4 remap( vec4 value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\treturn vec4(\n\t\tremap( value.x, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.y, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.z, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.w, inLow, inHigh, outLow, outHigh )\n\t);\n\n}\n".trim();class Jt extends M{constructor(t,e,n,i,r){super("f"),this.value=t,this.inLow=e,this.inHigh=n,this.outLow=i,this.outHigh=r}generate(t,e){const n=t.include(Jt.Nodes.remap);return t.format(n+"( "+[this.value.build(t),this.inLow.build(t),this.inHigh.build(t),this.outLow.build(t),this.outHigh.build(t)].join(", ")+" )",this.getType(t),e)}getType(t){return this.value.getType(t)}copy(t){super.copy(t),this.value=t.value,this.inLow=t.inLow,this.inHigh=t.inHigh,this.outLow=t.outLow,this.outHigh=t.outHigh}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,e.inLow=this.inLow.toJSON(t).uuid,e.inHigh=this.inHigh.toJSON(t).uuid,e.outLow=this.outLow.toJSON(t).uuid,e.outHigh=this.outHigh.toJSON(t).uuid),e}}Jt.prototype.nodeType="Remap",Jt.Nodes={remap:new X(Yt)};class Bt extends ${constructor(t,e,n){super(),this.scale=void 0!==t?t:1,this.scope=e||Bt.GLOBAL,this.timeScale=void 0!==n?n:void 0!==t}getReadonly(){return!1}getUnique(){return this.timeScale&&(this.scope===Bt.GLOBAL||this.scope===Bt.DELTA)}updateFrame(t){const e=this.timeScale?this.scale:1;switch(this.scope){case Bt.LOCAL:this.value+=t.delta*e;break;case Bt.DELTA:this.value=t.delta*e;break;default:this.value=t.time*e}}copy(t){return super.copy(t),this.scope=t.scope,this.scale=t.scale,this.timeScale=t.timeScale,this}toJSON(t){const e=super.toJSON(t);return e.scope=this.scope,e.scale=this.scale,e.timeScale=this.timeScale,e}}Bt.GLOBAL="global",Bt.LOCAL="local",Bt.DELTA="delta",Bt.prototype.nodeType="Timer",C.addKeyword("time",(function(){return new Bt}));(class extends Q{constructor(t,e){super(),this.params={},this.velocity=new i.Vector3,this.setTarget(t),this.setParams(e)}getReadonly(){return!1}setParams(t){if("elastic"===this.params.type)delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity;if(this.params=t||{},"elastic"===this.params.type)this.moment=new i.Vector3,this.speed=new i.Vector3,this.springVelocity=new i.Vector3,this.lastVelocity=new i.Vector3}setTarget(t){this.target&&(delete this.position,delete this.oldPosition),this.target=t,t&&(this.position=t.getWorldPosition(this.position||new i.Vector3),this.oldPosition=this.position.clone())}updateFrameVelocity(){this.target&&(this.position=this.target.getWorldPosition(this.position||new i.Vector3),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))}updateFrame(t){if(this.updateFrameVelocity(t),"elastic"===this.params.type){const e=t.delta*(this.params.fps||60),n=Math.pow(this.params.spring,e),i=Math.pow(this.params.damping,e);this.velocity.multiplyScalar(Math.exp(-this.params.damping*e)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(i).multiplyScalar(1-n)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(n),this.moment.add(this.springVelocity),this.moment.multiplyScalar(i),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment)}else this.value.copy(this.velocity)}copy(t){return super.copy(t),t.target&&this.setTarget(t.target),this.setParams(t.params),this}toJSON(t){const e=super.toJSON(t);return this.target&&(e.target=this.target.uuid),e.params=JSON.parse(JSON.stringify(this.params)),e}}).prototype.nodeType="Velocity";(class extends q{constructor(t,e){super("( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=t||new j,this.position=e||new At}generate(t,e){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.position,super.generate(t,e)}setUvTransform(t,e,n,i,r,o,s){o=void 0!==o?o:.5,s=void 0!==s?s:.5,this.position.value.setUvTransform(t,e,n,i,r,o,s)}copy(t){return super.copy(t),this.uv=t.uv,this.position=t.position,this}toJSON(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid,e.position=this.position.toJSON(t).uuid),e}}).prototype.nodeType="UVTransform";class Vt extends ${constructor(t){super(),this.texture=t,this.maxMIPLevel=0}get value(){if(0===this.maxMIPLevel){var t=this.texture.value.image;Array.isArray(t)&&(t=t[0]),this.maxMIPLevel=void 0!==t?Math.log(Math.max(t.width,t.height))*Math.LOG2E:0}return this.maxMIPLevel}set value(t){}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.texture=this.texture.uuid),e}}Vt.prototype.nodeType="MaxMIPLevel";class Ht extends M{constructor(t,e){super("f"),this.roughness=t,this.texture=e,this.maxMIPLevel=void 0}setTexture(t){return this.texture=t,this}generate(t,e){if(t.isShader("fragment")){this.maxMIPLevel=this.maxMIPLevel||new Vt,this.maxMIPLevel.texture=this.texture;const n=t.include(Ht.Nodes.getSpecularMIPLevel);return t.format(n+"( "+this.roughness.build(t,"f")+", "+this.maxMIPLevel.build(t,"f")+" )",this.type,e)}return console.warn("THREE.SpecularMIPLevelNode is not compatible with "+t.shader+" shader."),t.format("0.0",this.type,e)}copy(t){return super.copy(t),this.texture=t.texture,this.roughness=t.roughness,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.texture=this.texture,e.roughness=this.roughness),e}}Ht.Nodes={getSpecularMIPLevel:new X("\n\n\t\tfloat getSpecularMIPLevel( const in float roughness, const in float maxMIPLevelScalar ) {\n\n\t\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t\t}")},Ht.prototype.nodeType="SpecularMIPLevel";(class extends M{constructor(t){super(),this.slots=t||{}}getType(t,e){return e}generate(t,e){return this.slots[t.slot]?this.slots[t.slot].build(t,e):t.format("0.0","f",e)}copy(t){super.copy(t);for(const e in t.slots)this.slots[e]=t.slots[e];return this}toJSON(t){let e=this.getJSONNode(t);if(!e){e=this.createJSONNode(t),e.slots={};for(const n in this.slots){const i=this.slots[n];i&&(e.slots[n]=i.toJSON(t).uuid)}}return e}}).prototype.nodeType="SubSlot";class Qt extends M{constructor(t,e,n,i){super("v4"),this.value=t,this.uv=e||new j,this.radius=n||new H(1,1),this.size=i,this.blurX=!0,this.blurY=!0,this.horizontal=new $(1/64),this.vertical=new $(1/64)}updateFrame(){if(this.size)this.horizontal.value=this.radius.x/this.size.x,this.vertical.value=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){const t=this.value.value.image;this.horizontal.value=this.radius.x/t.width,this.vertical.value=this.radius.y/t.height}}generate(t,e){if(t.isShader("fragment")){const n=[];let i;const r=t.include(Qt.Nodes.blurX),o=t.include(Qt.Nodes.blurY);return this.blurX&&n.push(r+"( "+this.value.build(t,"sampler2D")+", "+this.uv.build(t,"v2")+", "+this.horizontal.build(t,"f")+" )"),this.blurY&&n.push(o+"( "+this.value.build(t,"sampler2D")+", "+this.uv.build(t,"v2")+", "+this.vertical.build(t,"f")+" )"),i=2==n.length?"( "+n.join(" + ")+" / 2.0 )":n.length?"( "+n[0]+" )":"vec4( 0.0 )",t.format(i,this.getType(t),e)}return console.warn("THREE.BlurNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}copy(t){return super.copy(t),this.value=t.value,this.uv=t.uv,this.radius=t.radius,void 0!==t.size&&(this.size=new i.Vector2(t.size.x,t.size.y)),this.blurX=t.blurX,this.blurY=t.blurY,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,e.uv=this.uv.toJSON(t).uuid,e.radius=this.radius.toJSON(t).uuid,this.size&&(e.size={x:this.size.x,y:this.size.y}),e.blurX=this.blurX,e.blurY=this.blurY),e}}Qt.Nodes={blurX:new X("\n\t\tvec4 blurX( sampler2D tex, vec2 uv, float s ) {\n\t\t\tvec4 sum = vec4( 0.0 );\n\t\t\tsum += texture2D( tex, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tex, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;\n\t\t\treturn sum * .667;\n\t\t}"),blurY:new X("\n\t\tvec4 blurY( sampler2D tex, vec2 uv, float s ) {\n\t\t\tvec4 sum = vec4( 0.0 );\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;\n\t\t\treturn sum * .667;\n\t\t}")},Qt.prototype.nodeType="Blur",Qt.prototype.hashProperties=["blurX","blurY"];class Gt extends M{constructor(t){super("f"),this.rgb=t}generate(t,e){const n=t.include(Gt.Nodes.luminance);return t.format(n+"( "+this.rgb.build(t,"v3")+" )",this.getType(t),e)}copy(t){return super.copy(t),this.rgb=t.rgb,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.rgb=this.rgb.toJSON(t).uuid),e}}Gt.Nodes=function(){const t=new k("vec3 LUMA vec3( 0.2125, 0.7154, 0.0721 )");return{LUMA:t,luminance:new X("\n\n\t\tfloat luminance( vec3 rgb ) {\n\n\t\t\treturn dot( rgb, LUMA );\n\n\t\t}",[t])}}(),Gt.prototype.nodeType="Luminance";class jt extends M{constructor(t,e,n){super("v3"),this.rgb=t,this.adjustment=e,this.method=n||jt.SATURATION}generate(t,e){const n=this.rgb.build(t,"v3"),i=this.adjustment.build(t,"f");switch(this.method){case jt.BRIGHTNESS:return t.format("( "+n+" + "+i+" )",this.getType(t),e);case jt.CONTRAST:return t.format("( "+n+" * "+i+" )",this.getType(t),e)}const r=t.include(jt.Nodes[this.method]);return t.format(r+"( "+n+", "+i+" )",this.getType(t),e)}copy(t){return super.copy(t),this.rgb=t.rgb,this.adjustment=t.adjustment,this.method=t.method,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.rgb=this.rgb.toJSON(t).uuid,e.adjustment=this.adjustment.toJSON(t).uuid,e.method=this.method),e}}jt.Nodes={hue:new X("\n\t\tvec3 hue(vec3 rgb, float adjustment) {\n\n\t\t\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);\n\t\t\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);\n\n\t\t\tvec3 yiq = RGBtoYIQ * rgb;\n\n\t\t\tfloat hue = atan(yiq.z, yiq.y) + adjustment;\n\t\t\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);\n\n\t\t\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));\n\n\t\t}"),saturation:new X("\n\t\tvec3 saturation(vec3 rgb, float adjustment) {\n\n\t\t\tvec3 intensity = vec3( luminance( rgb ) );\n\n\t\t\treturn mix( intensity, rgb, adjustment );\n\n\t\t}",[Gt.Nodes.luminance]),vibrance:new X("\n\n\t\tvec3 vibrance(vec3 rgb, float adjustment) {\n\n\t\t\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;\n\n\t\t\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));\n\t\t\tfloat amt = (mx - average) * (-3.0 * adjustment);\n\n\t\t\treturn mix(rgb.rgb, vec3(mx), amt);\n\n\t\t}")},jt.SATURATION="saturation",jt.HUE="hue",jt.VIBRANCE="vibrance",jt.BRIGHTNESS="brightness",jt.CONTRAST="contrast",jt.prototype.nodeType="ColorAdjustment",jt.prototype.hashProperties=["method"];class $t extends R{constructor(){super(),this.color=new ft(16777215)}generate(t){let e;if(t.isShader("vertex")){const n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0,i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>"];i.push("#include <begin_vertex>"),n&&i.push(n.code,n.result?"transformed = "+n.result+";":""),i.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <logdepthbuf_vertex>","#include <worldpos_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>"),e=i.join("\n")}else{this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.mask&&this.mask.analyze(t);const n=this.color.flow(t,"c",{slot:"color"}),i=this.alpha?this.alpha.flow(t,"f"):void 0,r=this.mask?this.mask.flow(t,"b"):void 0;t.requires.transparent=void 0!==i;const o=[n.code];r&&o.push(r.code,"if ( ! "+r.result+" ) discard;"),i&&o.push(i.code,"#ifdef ALPHATEST"," if ( "+i.result+" <= ALPHATEST ) discard;","#endif"),i?o.push("gl_FragColor = vec4("+n.result+", "+i.result+" );"):o.push("gl_FragColor = vec4("+n.result+", 1.0 );"),e=o.join("\n")}return e}copy(t){return super.copy(t),this.color=t.color,t.position&&(this.position=t.position),t.alpha&&(this.alpha=t.alpha),t.mask&&(this.mask=t.mask),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.color=this.color.toJSON(t).uuid,this.position&&(e.position=this.position.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.mask&&(e.mask=this.mask.toJSON(t).uuid)),e}}$t.prototype.nodeType="Basic";class qt extends R{constructor(){super(),this.color=new ft(15658734),this.spherical=!0}build(t){let e;if(t.define("SPRITE"),t.requires.lights=!1,t.requires.transparent=void 0!==this.alpha,t.isShader("vertex")){const n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(i.UniformsUtils.merge([i.UniformsLib.fog])),t.addParsCode("\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>"),e=["#include <clipping_planes_fragment>","#include <begin_vertex>"],n&&e.push(n.code,n.result?"transformed = "+n.result+";":""),e.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||e.push("modelMtx[1][1] = 1.0;"),e.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&e.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),e.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>")}else{t.addParsCode("\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <clipping_planes_pars_fragment>"),t.addCode("\n\t\t\t\t#include <clipping_planes_fragment>\n\t\t\t\t#include <logdepthbuf_fragment>"),this.mask&&this.mask.analyze(t),this.alpha&&this.alpha.analyze(t),this.color.analyze(t,{slot:"color"});const n=this.mask?this.mask.flow(t,"b"):void 0,i=this.alpha?this.alpha.flow(t,"f"):void 0,r=this.color.flow(t,"c",{slot:"color"});e=[],n&&e.push(n.code,"if ( ! "+n.result+" ) discard;"),i?e.push(i.code,"#ifdef ALPHATEST","if ( "+i.result+" <= ALPHATEST ) discard;","#endif",r.code,"gl_FragColor = vec4( "+r.result+", "+i.result+" );"):e.push(r.code,"gl_FragColor = vec4( "+r.result+", 1.0 );"),e.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>")}return e.join("\n")}copy(t){return super.copy(t),t.position&&(this.position=t.position),this.color=t.color,void 0!==t.spherical&&(this.spherical=t.spherical),t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,!1===this.spherical&&(e.spherical=!1),this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid)),e}}qt.prototype.nodeType="Sprite";class Wt extends R{constructor(){super(),this.color=new ft(15658734),this.specular=new ft(1118481),this.shininess=new $(30)}build(t){let e;if(t.define("PHONG"),t.requires.lights=!0,t.isShader("vertex")){const n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(i.UniformsUtils.merge([i.UniformsLib.fog,i.UniformsLib.lights])),t.addParsCode('\n\t\t\t\tvarying vec3 vViewPosition;\n\n\t\t\t\t//"#include <encodings_pars_fragment> // encoding functions\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <normal_pars_vertex>\n\t\t\t\t#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\t\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>');const r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <normal_vertex>","#include <begin_vertex>"];n&&r.push(n.code,n.result?"transformed = "+n.result+";":""),r.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),e=r.join("\n")}else{this.mask&&this.mask.analyze(t),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t),this.alpha&&this.alpha.analyze(t),this.normal&&this.normal.analyze(t),this.light&&this.light.analyze(t,{cache:"light"}),this.ao&&this.ao.analyze(t),this.ambient&&this.ambient.analyze(t),this.shadow&&this.shadow.analyze(t),this.emissive&&this.emissive.analyze(t,{slot:"emissive"}),this.environment&&this.environment.analyze(t,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.analyze(t);const n=this.mask?this.mask.flow(t,"b"):void 0,i=this.color.flow(t,"c",{slot:"color"}),r=this.specular.flow(t,"c"),o=this.shininess.flow(t,"f"),s=this.alpha?this.alpha.flow(t,"f"):void 0,a=this.normal?this.normal.flow(t,"v3"):void 0,l=this.light?this.light.flow(t,"v3",{cache:"light"}):void 0,u=this.ao?this.ao.flow(t,"f"):void 0,d=this.ambient?this.ambient.flow(t,"c"):void 0,c=this.shadow?this.shadow.flow(t,"c"):void 0,h=this.emissive?this.emissive.flow(t,"c",{slot:"emissive"}):void 0,p=this.environment?this.environment.flow(t,"c",{slot:"environment"}):void 0,f=this.environmentAlpha&&this.environment?this.environmentAlpha.flow(t,"f"):void 0;t.requires.transparent=void 0!==s,t.addParsCode("\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <bsdfs>\n\t\t\t\t#include <lights_pars_begin>\n\t\t\t\t#include <normal_pars_fragment>\n\t\t\t\t#include <lights_phong_pars_fragment>\n\t\t\t\t#include <shadowmap_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>");const m=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;"];n&&m.push(n.code,"if ( ! "+n.result+" ) discard;"),m.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",r.code,"\tvec3 specular = "+r.result+";",o.code,"\tfloat shininess = max( 0.0001, "+o.result+" );","\tfloat specularStrength = 1.0;"),s&&m.push(s.code,"#ifdef ALPHATEST","if ( "+s.result+" <= ALPHATEST ) discard;","#endif"),a&&m.push(a.code,"normal = "+a.result+";"),m.push("material.diffuseColor = "+(l?"vec3( 1.0 )":"diffuseColor")+";"),m.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),l&&(m.push(l.code,"reflectedLight.directDiffuse = "+l.result+";"),m.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),u&&m.push(u.code,"reflectedLight.indirectDiffuse *= "+u.result+";"),d&&m.push(d.code,"reflectedLight.indirectDiffuse += "+d.result+";"),c&&m.push(c.code,"reflectedLight.directDiffuse *= "+c.result+";","reflectedLight.directSpecular *= "+c.result+";"),h&&m.push(h.code,"reflectedLight.directDiffuse += "+h.result+";"),m.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),p&&(m.push(p.code),f?m.push(f.code,"outgoingLight = mix( outgoingLight, "+p.result+", "+f.result+" );"):m.push("outgoingLight = "+p.result+";")),s?m.push("gl_FragColor = vec4( outgoingLight, "+s.result+" );"):m.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),m.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>"),e=m.join("\n")}return e}copy(t){return super.copy(t),t.position&&(this.position=t.position),this.color=t.color,this.specular=t.specular,this.shininess=t.shininess,t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),t.normal&&(this.normal=t.normal),t.light&&(this.light=t.light),t.shadow&&(this.shadow=t.shadow),t.ao&&(this.ao=t.ao),t.emissive&&(this.emissive=t.emissive),t.ambient&&(this.ambient=t.ambient),t.environment&&(this.environment=t.environment),t.environmentAlpha&&(this.environmentAlpha=t.environmentAlpha),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.specular=this.specular.toJSON(t).uuid,e.shininess=this.shininess.toJSON(t).uuid,this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid),this.environmentAlpha&&(e.environmentAlpha=this.environmentAlpha.toJSON(t).uuid)),e}}Wt.prototype.nodeType="Phong";class Kt extends R{constructor(){super(),this.color=new ft(16777215),this.roughness=new $(1),this.metalness=new $(0)}build(t){let e;t.define("STANDARD");const n=this.clearcoat||this.clearcoatRoughness||this.clearCoatNormal;if(n&&t.define("CLEARCOAT"),t.requires.lights=!0,t.extensions.derivatives=!0,t.extensions.shaderTextureLOD=!0,t.isShader("vertex")){const n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(i.UniformsUtils.merge([i.UniformsLib.fog,i.UniformsLib.lights])),i.UniformsLib.LTC_1&&(t.uniforms.ltc_1={value:void 0},t.uniforms.ltc_2={value:void 0}),t.addParsCode('\n\t\t\t\tvarying vec3 vViewPosition;\n\n\t\t\t\t#ifndef FLAT_SHADED\n\n\t\t\t\t\tvarying vec3 vNormal;\n\n\t\t\t\t#endif\n\n\t\t\t\t//"#include <encodings_pars_fragment> // encoding functions\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\t\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>');const r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];n&&r.push(n.code,n.result?"transformed = "+n.result+";":""),r.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),e=r.join("\n")}else{const i=new q("material.roughness","f"),r=new q("material.clearcoatRoughness","f"),o={roughness:i,bias:new Ht(i),viewNormal:new q("normal","v3"),worldNormal:new q("inverseTransformDirection( geometry.normal, viewMatrix )","v3"),gamma:!0},s={gamma:!0},a={roughness:r,bias:new Ht(r),viewNormal:new q("clearcoatNormal","v3"),worldNormal:new q("inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )","v3"),gamma:!0};this.mask&&this.mask.analyze(t),this.color.analyze(t,{slot:"color",context:s}),this.roughness.analyze(t),this.metalness.analyze(t),this.alpha&&this.alpha.analyze(t),this.normal&&this.normal.analyze(t),this.clearcoat&&this.clearcoat.analyze(t),this.clearcoatRoughness&&this.clearcoatRoughness.analyze(t),this.clearcoatNormal&&this.clearcoatNormal.analyze(t),this.reflectivity&&this.reflectivity.analyze(t),this.light&&this.light.analyze(t,{cache:"light"}),this.ao&&this.ao.analyze(t),this.ambient&&this.ambient.analyze(t),this.shadow&&this.shadow.analyze(t),this.emissive&&this.emissive.analyze(t,{slot:"emissive"}),this.environment&&(this.environment.analyze(t,{cache:"radiance",context:o,slot:"radiance"}),t.requires.irradiance&&this.environment.analyze(t,{cache:"irradiance",context:o,slot:"irradiance"})),this.sheenTint&&this.sheenTint.analyze(t);const l=this.mask?this.mask.flow(t,"b"):void 0,u=this.color.flow(t,"c",{slot:"color",context:s}),d=this.roughness.flow(t,"f"),c=this.metalness.flow(t,"f"),h=this.alpha?this.alpha.flow(t,"f"):void 0,p=this.normal?this.normal.flow(t,"v3"):void 0,f=this.clearcoat?this.clearcoat.flow(t,"f"):void 0,m=this.clearcoatRoughness?this.clearcoatRoughness.flow(t,"f"):void 0,g=this.clearcoatNormal?this.clearcoatNormal.flow(t,"v3"):void 0,v=this.reflectivity?this.reflectivity.flow(t,"f"):void 0,x=this.light?this.light.flow(t,"v3",{cache:"light"}):void 0,y=this.ao?this.ao.flow(t,"f"):void 0,A=this.ambient?this.ambient.flow(t,"c"):void 0,b=this.shadow?this.shadow.flow(t,"c"):void 0,_=this.emissive?this.emissive.flow(t,"c",{slot:"emissive"}):void 0;let w;this.environment&&(w={radiance:this.environment.flow(t,"c",{cache:"radiance",context:o,slot:"radiance"})},t.requires.irradiance&&(w.irradiance=this.environment.flow(t,"c",{cache:"irradiance",context:o,slot:"irradiance"})));const N=n&&w?this.environment.flow(t,"c",{cache:"clearcoat",context:a,slot:"environment"}):void 0,T=this.sheenTint?this.sheenTint.flow(t,"c"):void 0;t.requires.transparent=void 0!==h,t.addParsCode("\n\t\t\t\tvarying vec3 vViewPosition;\n\n\t\t\t\t#define NODE_MAXIMUM_SPECULAR_COEFFICIENT 0.16\n\t\t\t\t#define NODE_DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n\t\t\t\t#ifndef FLAT_SHADED\n\n\t\t\t\t\tvarying vec3 vNormal;\n\n\t\t\t\t#endif\n\n\t\t\t\t#include <dithering_pars_fragment>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <bsdfs>\n\t\t\t\t#include <lights_pars_begin>\n\t\t\t\t#include <lights_physical_pars_fragment>\n\t\t\t\t#include <shadowmap_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>");const S=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\t#include <clearcoat_normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];l&&S.push(l.code,"if ( ! "+l.result+" ) discard;"),S.push(u.code,"\tvec3 diffuseColor = "+u.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",d.code,"\tfloat roughnessFactor = "+d.result+";",c.code,"\tfloat metalnessFactor = "+c.result+";"),h&&S.push(h.code,"#ifdef ALPHATEST","\tif ( "+h.result+" <= ALPHATEST ) discard;","#endif"),p&&S.push(p.code,"normal = "+p.result+";"),g&&S.push(g.code,"clearcoatNormal = "+g.result+";"),S.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),S.push("material.diffuseColor = "+(x?"vec3( 1.0 )":"diffuseColor * ( 1.0 - metalnessFactor )")+";","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),f?S.push(f.code,"material.clearcoat = saturate( "+f.result+" );"):n&&S.push("material.clearcoat = 0.0;"),m?S.push(m.code,"material.clearcoatRoughness = max( "+m.result+", 0.0525 );","material.clearcoatRoughness += geometryRoughness;","material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );"):n&&S.push("material.clearcoatRoughness = 0.0;"),T&&S.push("material.sheenTint = "+T.result+";"),v?S.push(v.code,"material.specularColor = mix( vec3( NODE_MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+v.result+" ) ), diffuseColor, metalnessFactor );"):S.push("material.specularColor = mix( vec3( NODE_DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),S.push("#include <lights_fragment_begin>"),x&&(S.push(x.code,"reflectedLight.directDiffuse = "+x.result+";"),S.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),y&&S.push(y.code,"reflectedLight.indirectDiffuse *= "+y.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+y.result+", material.roughness );"),A&&S.push(A.code,"reflectedLight.indirectDiffuse += "+A.result+";"),b&&S.push(b.code,"reflectedLight.directDiffuse *= "+b.result+";","reflectedLight.directSpecular *= "+b.result+";"),_&&S.push(_.code,"reflectedLight.directDiffuse += "+_.result+";"),w&&(S.push(w.radiance.code),t.requires.irradiance&&S.push(w.irradiance.code),N&&S.push(N.code,"clearcoatRadiance += "+N.result+";"),S.push("radiance += "+w.radiance.result+";"),t.requires.irradiance&&S.push("iblIrradiance += PI * "+w.irradiance.result+";")),S.push("#include <lights_fragment_end>"),S.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),h?S.push("gl_FragColor = vec4( outgoingLight, "+h.result+" );"):S.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),S.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>","#include <dithering_fragment>"),e=S.join("\n")}return e}copy(t){return super.copy(t),t.position&&(this.position=t.position),this.color=t.color,this.roughness=t.roughness,this.metalness=t.metalness,t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),t.normal&&(this.normal=t.normal),t.clearcoat&&(this.clearcoat=t.clearcoat),t.clearcoatRoughness&&(this.clearcoatRoughness=t.clearcoatRoughness),t.clearcoatNormal&&(this.clearcoatNormal=t.clearcoatNormal),t.reflectivity&&(this.reflectivity=t.reflectivity),t.light&&(this.light=t.light),t.shadow&&(this.shadow=t.shadow),t.ao&&(this.ao=t.ao),t.emissive&&(this.emissive=t.emissive),t.ambient&&(this.ambient=t.ambient),t.environment&&(this.environment=t.environment),t.sheenTint&&(this.sheenTint=t.sheenTint),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.roughness=this.roughness.toJSON(t).uuid,e.metalness=this.metalness.toJSON(t).uuid,this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.clearcoat&&(e.clearcoat=this.clearcoat.toJSON(t).uuid),this.clearcoatRoughness&&(e.clearcoatRoughness=this.clearcoatRoughness.toJSON(t).uuid),this.clearcoatNormal&&(e.clearcoatNormal=this.clearcoatNormal.toJSON(t).uuid),this.reflectivity&&(e.reflectivity=this.reflectivity.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid),this.sheenTint&&(e.sheenTint=this.sheenTint.toJSON(t).uuid)),e}}Kt.prototype.nodeType="Standard";class Zt extends Kt{constructor(){super(),this.properties={color:new i.Color(16777215),roughness:.5,metalness:.5,normalScale:new i.Vector2(1,1)},this.inputs={color:new _t(this.properties,"color","c"),roughness:new _t(this.properties,"roughness","f"),metalness:new _t(this.properties,"metalness","f"),normalScale:new _t(this.properties,"normalScale","v2")}}build(t){const e=this.properties,n=this.inputs;if(t.isShader("fragment")){const i=t.findNode(e.color,n.color),r=t.resolve(e.map);this.color=r?new rt(i,r,rt.MUL):i;const o=t.findNode(e.roughness,n.roughness),s=t.resolve(e.roughnessMap);this.roughness=s?new rt(o,new kt(s,"g"),rt.MUL):o;const a=t.findNode(e.metalness,n.metalness),l=t.resolve(e.metalnessMap);this.metalness=l?new rt(a,new kt(l,"b"),rt.MUL):a,e.normalMap?(this.normal=new Dt(t.resolve(e.normalMap)),this.normal.scale=t.findNode(e.normalScale,n.normalScale)):this.normal=void 0,this.environment=t.resolve(e.envMap)}return super.build(t)}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),console.warn(".toJSON not implemented in",this)),e}}Zt.prototype.nodeType="MeshStandard";I.addShortcuts(class extends gt{constructor(){const t=new $t;super(t,t),this.type="BasicNodeMaterial"}}.prototype,"fragment",["color","alpha","mask","position"]);I.addShortcuts(class extends gt{constructor(){const t=new qt;super(t,t),this.type="SpriteNodeMaterial"}}.prototype,"fragment",["color","alpha","mask","position","spherical"]);I.addShortcuts(class extends gt{constructor(){const t=new Wt;super(t,t),this.type="PhongNodeMaterial"}}.prototype,"fragment",["color","alpha","specular","shininess","normal","emissive","ambient","light","shadow","ao","environment","environmentAlpha","mask","position"]);I.addShortcuts(class extends gt{constructor(){const t=new Kt;super(t,t),this.type="StandardNodeMaterial"}}.prototype,"fragment",["color","alpha","roughness","metalness","reflectivity","clearcoat","clearcoatRoughness","clearcoatNormal","normal","emissive","ambient","light","shadow","ao","environment","mask","position","sheenTint"]);I.addShortcuts(class extends gt{constructor(){const t=new Zt;super(t,t),this.type="MeshStandardNodeMaterial"}}.prototype,"properties",["color","roughness","metalness","map","normalMap","normalScale","metalnessMap","roughnessMap","envMap"]);function te(t){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},te(t)}function ee(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ne(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ie(t,e){return ie=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ie(t,e)}function re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=se(t);if(e){var r=se(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return oe(this,n)}}function oe(t,e){if(e&&("object"===te(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function se(t){return se=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},se(t)}var ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ie(t,e)}(o,t);var e,n,i,r=re(o);function o(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.hue,i=void 0===n?0:n,s=e.saturation,a=void 0===s?1:s,l=e.vibrance,u=void 0===l?0:l,d=e.brightness,c=void 0===d?0:d,h=e.contrast,p=void 0===h?1:h;ee(this,o),t=r.call(this),i=new $(i),a=new $(a),u=new $(u),c=new $(c),p=new $(p);var f=new vt,m=new jt(f,i,jt.HUE),g=new jt(m,a,jt.SATURATION),v=new jt(g,u,jt.VIBRANCE),x=new jt(v,c,jt.BRIGHTNESS),y=new jt(x,p,jt.CONTRAST);return t.input=y,t._hue=i,t._saturation=a,t._vibrance=u,t._brightness=c,t._contrast=p,t}return e=o,(n=[{key:"brightness",get:function(){return this._brightness.value},set:function(t){this._brightness.value=t}},{key:"contrast",get:function(){return this._contrast.value},set:function(t){this._contrast.value=t}},{key:"hue",get:function(){return this._hue.value},set:function(t){this._hue.value=t}},{key:"saturation",get:function(){return this._saturation.value},set:function(t){this._saturation.value=t}},{key:"vibrance",get:function(){return this._vibrance.value},set:function(t){this._vibrance.value=t}}])&&ne(e.prototype,n),i&&ne(e,i),Object.defineProperty(e,"prototype",{writable:!1}),o}(xt);const le={uniforms:{tDiffuse:{value:null},resolution:{value:new i.Vector2(1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:'\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\t#define FXAA_PC 1\n\t\t#define FXAA_GLSL_100 1\n\t\t#define FXAA_QUALITY_PRESET 12\n\n\t\t#define FXAA_GREEN_AS_LUMA 1\n\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_PC_CONSOLE\n\t\t\t\t//\n\t\t\t\t// The console algorithm for PC is included\n\t\t\t\t// for developers targeting really low spec machines.\n\t\t\t\t// Likely better to just run FXAA_PC, and use a really low preset.\n\t\t\t\t//\n\t\t\t\t#define FXAA_PC_CONSOLE 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_120\n\t\t\t\t#define FXAA_GLSL_120 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_130\n\t\t\t\t#define FXAA_GLSL_130 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_3\n\t\t\t\t#define FXAA_HLSL_3 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_4\n\t\t\t\t#define FXAA_HLSL_4 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_5\n\t\t\t\t#define FXAA_HLSL_5 0\n\t\t#endif\n\t\t/*==========================================================================*/\n\t\t#ifndef FXAA_GREEN_AS_LUMA\n\t\t\t\t//\n\t\t\t\t// For those using non-linear color,\n\t\t\t\t// and either not able to get luma in alpha, or not wanting to,\n\t\t\t\t// this enables FXAA to run using green as a proxy for luma.\n\t\t\t\t// So with this enabled, no need to pack luma in alpha.\n\t\t\t\t//\n\t\t\t\t// This will turn off AA on anything which lacks some amount of green.\n\t\t\t\t// Pure red and blue or combination of only R and B, will get no AA.\n\t\t\t\t//\n\t\t\t\t// Might want to lower the settings for both,\n\t\t\t\t//\t\tfxaaConsoleEdgeThresholdMin\n\t\t\t\t//\t\tfxaaQualityEdgeThresholdMin\n\t\t\t\t// In order to insure AA does not get turned off on colors\n\t\t\t\t// which contain a minor amount of green.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_GREEN_AS_LUMA 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_EARLY_EXIT\n\t\t\t\t//\n\t\t\t\t// Controls algorithm\'s early exit path.\n\t\t\t\t// On PS3 turning this ON adds 2 cycles to the shader.\n\t\t\t\t// On 360 turning this OFF adds 10ths of a millisecond to the shader.\n\t\t\t\t// Turning this off on console will result in a more blurry image.\n\t\t\t\t// So this defaults to on.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_EARLY_EXIT 1\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_DISCARD\n\t\t\t\t//\n\t\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t\t//\n\t\t\t\t// 1 = Use discard on pixels which don\'t need AA.\n\t\t\t\t//\t\t For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t\t// 0 = Return unchanged color on pixels which don\'t need AA.\n\t\t\t\t//\n\t\t\t\t#define FXAA_DISCARD 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t//\n\t\t\t\t// Used for GLSL 120 only.\n\t\t\t\t//\n\t\t\t\t// 1 = GL API supports fast pixel offsets\n\t\t\t\t// 0 = do not use fast pixel offsets\n\t\t\t\t//\n\t\t\t\t#ifdef GL_EXT_gpu_shader4\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 0\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t//\n\t\t\t\t// 1 = API supports gather4 on alpha channel.\n\t\t\t\t// 0 = API does not support gather4 on alpha channel.\n\t\t\t\t//\n\t\t\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 0\n\t\t\t\t#endif\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFXAA QUALITY - TUNING KNOBS\n\t\t------------------------------------------------------------------------------\n\t\tNOTE the other tuning knobs are now in the shader function inputs!\n\t\t============================================================================*/\n\t\t#ifndef FXAA_QUALITY_PRESET\n\t\t\t\t//\n\t\t\t\t// Choose the quality preset.\n\t\t\t\t// This needs to be compiled into the shader as it effects code.\n\t\t\t\t// Best option to include multiple presets is to\n\t\t\t\t// in each shader define the preset, then include this file.\n\t\t\t\t//\n\t\t\t\t// OPTIONS\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n\t\t\t\t// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n\t\t\t\t// 39\t\t\t - no dither, very expensive\n\t\t\t\t//\n\t\t\t\t// NOTES\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n\t\t\t\t// 13 = about same speed as FXAA 3.9 and better than 12\n\t\t\t\t// 23 = closest to FXAA 3.9 visually and performance wise\n\t\t\t\t//\t_ = the lowest digit is directly related to performance\n\t\t\t\t// _\t= the highest digit is directly related to style\n\t\t\t\t//\n\t\t\t\t#define FXAA_QUALITY_PRESET 12\n\t\t#endif\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - PRESETS\n\n\t\t============================================================================*/\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - MEDIUM DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 10)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 3.0\n\t\t\t\t#define FXAA_QUALITY_P2 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 11)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 3.0\n\t\t\t\t#define FXAA_QUALITY_P3 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 12)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 4.0\n\t\t\t\t#define FXAA_QUALITY_P4 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 13)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 4.0\n\t\t\t\t#define FXAA_QUALITY_P5 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 14)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 4.0\n\t\t\t\t#define FXAA_QUALITY_P6 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 15)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 12.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - LOW DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 20)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 2.0\n\t\t\t\t#define FXAA_QUALITY_P2 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 21)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 22)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 23)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 24)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 3.0\n\t\t\t\t#define FXAA_QUALITY_P6 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 25)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 26)\n\t\t\t\t#define FXAA_QUALITY_PS 9\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 4.0\n\t\t\t\t#define FXAA_QUALITY_P8 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 27)\n\t\t\t\t#define FXAA_QUALITY_PS 10\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 4.0\n\t\t\t\t#define FXAA_QUALITY_P9 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 28)\n\t\t\t\t#define FXAA_QUALITY_PS 11\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 4.0\n\t\t\t\t#define FXAA_QUALITY_P10 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 29)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - EXTREME QUALITY\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 39)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.0\n\t\t\t\t#define FXAA_QUALITY_P2 1.0\n\t\t\t\t#define FXAA_QUALITY_P3 1.0\n\t\t\t\t#define FXAA_QUALITY_P4 1.0\n\t\t\t\t#define FXAA_QUALITY_P5 1.5\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI PORTING\n\n\t\t============================================================================*/\n\t\t#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard discard\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 vec2\n\t\t\t\t#define FxaaFloat3 vec3\n\t\t\t\t#define FxaaFloat4 vec4\n\t\t\t\t#define FxaaHalf float\n\t\t\t\t#define FxaaHalf2 vec2\n\t\t\t\t#define FxaaHalf3 vec3\n\t\t\t\t#define FxaaHalf4 vec4\n\t\t\t\t#define FxaaInt2 ivec2\n\t\t\t\t#define FxaaSat(x) clamp(x, 0.0, 1.0)\n\t\t\t\t#define FxaaTex sampler2D\n\t\t#else\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard clip(-1)\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 float2\n\t\t\t\t#define FxaaFloat3 float3\n\t\t\t\t#define FxaaFloat4 float4\n\t\t\t\t#define FxaaHalf half\n\t\t\t\t#define FxaaHalf2 half2\n\t\t\t\t#define FxaaHalf3 half3\n\t\t\t\t#define FxaaHalf4 half4\n\t\t\t\t#define FxaaSat(x) saturate(x)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t#define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n\t\t\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_120 == 1)\n\t\t\t\t// Requires,\n\t\t\t\t//\t#version 120\n\t\t\t\t// And at least,\n\t\t\t\t//\t#extension GL_EXT_gpu_shader4 : enable\n\t\t\t\t//\t(or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n\t\t\t\t#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n\t\t\t\t#if (FXAA_FAST_PIXEL_OFFSET == 1)\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n\t\t\t\t#else\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n\t\t\t\t#endif\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_130 == 1)\n\t\t\t\t// Requires "#version 130" or better\n\t\t\t\t#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_3 == 1)\n\t\t\t\t#define FxaaInt2 float2\n\t\t\t\t#define FxaaTex sampler2D\n\t\t\t\t#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n\t\t\t\t#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_4 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t\t\t#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n\t\t\t\t#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n\t\t\t\t#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t GREEN AS LUMA OPTION SUPPORT FUNCTION\n\t\t============================================================================*/\n\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n\t\t#else\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\t\t#endif\n\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA3 QUALITY - PC\n\n\t\t============================================================================*/\n\t\t#if (FXAA_PC == 1)\n\t\t/*--------------------------------------------------------------------------*/\n\t\tFxaaFloat4 FxaaPixelShader(\n\t\t\t\t//\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy} = center of pixel\n\t\t\t\tFxaaFloat2 pos,\n\t\t\t\t//\n\t\t\t\t// Used only for FXAA Console, and not used on the 360 version.\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy_} = upper left of pixel\n\t\t\t\t// {_zw} = lower right of pixel\n\t\t\t\tFxaaFloat4 fxaaConsolePosPos,\n\t\t\t\t//\n\t\t\t\t// Input color texture.\n\t\t\t\t// {rgb_} = color in linear or perceptual color space\n\t\t\t\t// if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t//\t\t {__a} = luma in perceptual color space (not linear)\n\t\t\t\tFxaaTex tex,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 2nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -1.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegOne,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 3nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -2.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegTwo,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x_} = 1.0/screenWidthInPixels\n\t\t\t\t// {_y} = 1.0/screenHeightInPixels\n\t\t\t\tFxaaFloat2 fxaaQualityRcpFrame,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// This effects sub-pixel AA quality and inversely sharpness.\n\t\t\t\t//\t Where N ranges between,\n\t\t\t\t//\t\t N = 0.50 (default)\n\t\t\t\t//\t\t N = 0.33 (sharper)\n\t\t\t\t// {x__} = -N/screenWidthInPixels\n\t\t\t\t// {_y_} = -N/screenHeightInPixels\n\t\t\t\t// {_z_} =\tN/screenWidthInPixels\n\t\t\t\t// {__w} =\tN/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Not used on 360, but used on PS3 and PC.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} = -2.0/screenWidthInPixels\n\t\t\t\t// {_y_} = -2.0/screenHeightInPixels\n\t\t\t\t// {_z_} =\t2.0/screenWidthInPixels\n\t\t\t\t// {__w} =\t2.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} =\t8.0/screenWidthInPixels\n\t\t\t\t// {_y_} =\t8.0/screenHeightInPixels\n\t\t\t\t// {_z_} = -4.0/screenWidthInPixels\n\t\t\t\t// {__w} = -4.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsole360RcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_SUBPIX define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Choose the amount of sub-pixel aliasing removal.\n\t\t\t\t// This can effect sharpness.\n\t\t\t\t//\t 1.00 - upper limit (softer)\n\t\t\t\t//\t 0.75 - default amount of filtering\n\t\t\t\t//\t 0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n\t\t\t\t//\t 0.25 - almost off\n\t\t\t\t//\t 0.00 - completely off\n\t\t\t\tFxaaFloat fxaaQualitySubpix,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// The minimum amount of local contrast required to apply algorithm.\n\t\t\t\t//\t 0.333 - too little (faster)\n\t\t\t\t//\t 0.250 - low quality\n\t\t\t\t//\t 0.166 - default\n\t\t\t\t//\t 0.125 - high quality\n\t\t\t\t//\t 0.063 - overkill (slower)\n\t\t\t\tFxaaFloat fxaaQualityEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t//\t 0.0833 - upper limit (default, the start of visible unfiltered edges)\n\t\t\t\t//\t 0.0625 - high quality (faster)\n\t\t\t\t//\t 0.0312 - visible limit (slower)\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaQualityEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only three safe values here: 2 and 4 and 8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// For all other platforms can be a non-power of two.\n\t\t\t\t//\t 8.0 is sharper (default!!!)\n\t\t\t\t//\t 4.0 is softer\n\t\t\t\t//\t 2.0 is really soft (good only for vector graphics inputs)\n\t\t\t\tFxaaFloat fxaaConsoleEdgeSharpness,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only two safe values here: 1/4 and 1/8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// Other platforms can use other values.\n\t\t\t\t//\t 0.125 leaves less aliasing, but is softer (default!!!)\n\t\t\t\t//\t 0.25 leaves more aliasing, and is sharper\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// This only applies when FXAA_EARLY_EXIT is 1.\n\t\t\t\t// This does not apply to PS3,\n\t\t\t\t// PS3 was simplified to avoid more shader instructions.\n\t\t\t\t//\t 0.06 - faster but more aliasing in darks\n\t\t\t\t//\t 0.05 - default\n\t\t\t\t//\t 0.04 - slower and less aliasing in darks\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Extra constants for 360 FXAA Console only.\n\t\t\t\t// Use zeros or anything else for other platforms.\n\t\t\t\t// These must be in physical constant registers and NOT immediates.\n\t\t\t\t// Immediates will result in compiler un-optimizing.\n\t\t\t\t// {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n\t\t\t\tFxaaFloat4 fxaaConsole360ConstDir\n\t\t) {\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posM;\n\t\t\t\tposM.x = pos.x;\n\t\t\t\tposM.y = pos.y;\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\t#define lumaM luma4A.w\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#define lumaE luma4A.z\n\t\t\t\t\t\t#define lumaS luma4A.x\n\t\t\t\t\t\t#define lumaSE luma4A.y\n\t\t\t\t\t\t#define lumaNW luma4B.w\n\t\t\t\t\t\t#define lumaN luma4B.z\n\t\t\t\t\t\t#define lumaW luma4B.x\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat maxSM = max(lumaS, lumaM);\n\t\t\t\tFxaaFloat minSM = min(lumaS, lumaM);\n\t\t\t\tFxaaFloat maxESM = max(lumaE, maxSM);\n\t\t\t\tFxaaFloat minESM = min(lumaE, minSM);\n\t\t\t\tFxaaFloat maxWN = max(lumaN, lumaW);\n\t\t\t\tFxaaFloat minWN = min(lumaN, lumaW);\n\t\t\t\tFxaaFloat rangeMax = max(maxWN, maxESM);\n\t\t\t\tFxaaFloat rangeMin = min(minWN, minESM);\n\t\t\t\tFxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n\t\t\t\tFxaaFloat range = rangeMax - rangeMin;\n\t\t\t\tFxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\t\t\t\tFxaaBool earlyExit = range < rangeMaxClamped;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(earlyExit)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\tFxaaDiscard;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\treturn rgbyM;\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 0)\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNS = lumaN + lumaS;\n\t\t\t\tFxaaFloat lumaWE = lumaW + lumaE;\n\t\t\t\tFxaaFloat subpixRcpRange = 1.0/range;\n\t\t\t\tFxaaFloat subpixNSWE = lumaNS + lumaWE;\n\t\t\t\tFxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n\t\t\t\tFxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNESE = lumaNE + lumaSE;\n\t\t\t\tFxaaFloat lumaNWNE = lumaNW + lumaNE;\n\t\t\t\tFxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n\t\t\t\tFxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNWSW = lumaNW + lumaSW;\n\t\t\t\tFxaaFloat lumaSWSE = lumaSW + lumaSE;\n\t\t\t\tFxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n\t\t\t\tFxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n\t\t\t\tFxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n\t\t\t\tFxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n\t\t\t\tFxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n\t\t\t\tFxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n\t\t\t\tFxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n\t\t\t\tFxaaBool horzSpan = edgeHorz >= edgeVert;\n\t\t\t\tFxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!horzSpan) lumaN = lumaW;\n\t\t\t\tif(!horzSpan) lumaS = lumaE;\n\t\t\t\tif(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n\t\t\t\tFxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat gradientN = lumaN - lumaM;\n\t\t\t\tFxaaFloat gradientS = lumaS - lumaM;\n\t\t\t\tFxaaFloat lumaNN = lumaN + lumaM;\n\t\t\t\tFxaaFloat lumaSS = lumaS + lumaM;\n\t\t\t\tFxaaBool pairN = abs(gradientN) >= abs(gradientS);\n\t\t\t\tFxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n\t\t\t\tif(pairN) lengthSign = -lengthSign;\n\t\t\t\tFxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posB;\n\t\t\t\tposB.x = posM.x;\n\t\t\t\tposB.y = posM.y;\n\t\t\t\tFxaaFloat2 offNP;\n\t\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\t\t\t\tif(!horzSpan) posB.x += lengthSign * 0.5;\n\t\t\t\tif( horzSpan) posB.y += lengthSign * 0.5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posN;\n\t\t\t\tposN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat2 posP;\n\t\t\t\tposP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n\t\t\t\tFxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n\t\t\t\tFxaaFloat subpixE = subpixC * subpixC;\n\t\t\t\tFxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!pairN) lumaNN = lumaSS;\n\t\t\t\tFxaaFloat gradientScaled = gradient * 1.0/4.0;\n\t\t\t\tFxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n\t\t\t\tFxaaFloat subpixF = subpixD * subpixE;\n\t\t\t\tFxaaBool lumaMLTZero = lumaMM < 0.0;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tlumaEndN -= lumaNN * 0.5;\n\t\t\t\tlumaEndP -= lumaNN * 0.5;\n\t\t\t\tFxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\tFxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n\t\t\t\tFxaaBool doneNP = (!doneN) || (!doneP);\n\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 3)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 4)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 5)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 6)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 7)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_QUALITY_PS > 8)\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 9)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 10)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 11)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 12)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat dstN = posM.x - posN.x;\n\t\t\t\tFxaaFloat dstP = posP.x - posM.x;\n\t\t\t\tif(!horzSpan) dstN = posM.y - posN.y;\n\t\t\t\tif(!horzSpan) dstP = posP.y - posM.y;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLength = (dstP + dstN);\n\t\t\t\tFxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLengthRcp = 1.0/spanLength;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool directionN = dstN < dstP;\n\t\t\t\tFxaaFloat dst = min(dstN, dstP);\n\t\t\t\tFxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n\t\t\t\tFxaaFloat subpixG = subpixF * subpixF;\n\t\t\t\tFxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n\t\t\t\tFxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n\t\t\t\tFxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n\t\t\t\tif(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n\t\t\t\tif( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\treturn FxaaTexTop(tex, posM);\n\t\t\t\t#else\n\t\t\t\t\t\treturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n\t\t\t\t#endif\n\t\t}\n\t\t/*==========================================================================*/\n\t\t#endif\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\tvUv,\n\t\t\t\tvec4(0.0),\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\tresolution,\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\t0.75,\n\t\t\t\t0.166,\n\t\t\t\t0.0833,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\tvec4(0.0)\n\t\t\t);\n\n\t\t\t// TODO avoid querying texture twice for same texel\n\t\t\tgl_FragColor.a = texture2D(tDiffuse, vUv).a;\n\t\t}'};function ue(t){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ue(t)}function de(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ce(t,e){return ce=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ce(t,e)}function he(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=fe(t);if(e){var r=fe(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return pe(this,n)}}function pe(t,e){if(e&&("object"===ue(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function fe(t){return fe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},fe(t)}var me,ge=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ce(t,e)}(o,t);var e,n,i,r=he(o);function o(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),r.call(this,le)}return e=o,(n=[{key:"setSize",value:function(t,e){var n=this.material.uniforms.resolution.value;n.x=1/t,n.y=1/e}}])&&de(e.prototype,n),i&&de(e,i),Object.defineProperty(e,"prototype",{writable:!1}),o}(_),ve=new i.WebGLRenderer({powerPreference:"high-performance",antialias:!1,stencil:!1,depth:!1});ve.toneMapping=i.ACESFilmicToneMapping,E.init(ve);var xe=ve.domElement;document.getElementById("main").appendChild(xe);var ye=new class{constructor(t,e){if(this.renderer=t,void 0===e){const n={minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBAFormat},r=t.getSize(new i.Vector2);this._pixelRatio=t.getPixelRatio(),this._width=r.width,this._height=r.height,(e=new i.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===v&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===_&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new _(v),this.clock=new i.Clock}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let n=!1;for(let e=0,i=this.passes.length;e<i;e++){const i=this.passes[e];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),i.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),i.needsSwap){if(n){const e=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),n.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==w&&(i instanceof w?n=!0:i instanceof N&&(n=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new i.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(n,i)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}(ve);me={renderer:ve,canvas:xe,composer:ye,init:function(){var t=g.scene,e=g.camera,n={render:new S(t,e),fxaa:new ge,adjustments:new ae};Object.values(n).forEach((function(t){return ye.addPass(t)})),me.post=n},resize:function(t,e,n){ve.setPixelRatio(n),ve.setSize(t,e),ye.setSize(t,e),Object.values(me.post).forEach((function(i){i.setSize&&i.setSize(t,e,n)}))},update:function(){ye.render()}};class Ae{constructor(t=.1,e=6){this.maxEdgeLength=t,this.maxIterations=e}modify(t){if(!0===t.isGeometry)return console.error("THREE.TessellateModifier no longer supports Geometry. Use BufferGeometry instead."),t;null!==t.index&&(t=t.toNonIndexed());const e=this.maxIterations,n=this.maxEdgeLength*this.maxEdgeLength,r=new i.Vector3,o=new i.Vector3,s=new i.Vector3,a=new i.Vector3,l=[r,o,s,a],u=new i.Vector3,d=new i.Vector3,c=new i.Vector3,h=new i.Vector3,p=[u,d,c,h],f=new i.Color,m=new i.Color,g=new i.Color,v=new i.Color,x=[f,m,g,v],y=new i.Vector2,A=new i.Vector2,b=new i.Vector2,_=new i.Vector2,w=[y,A,b,_],N=new i.Vector2,T=new i.Vector2,S=new i.Vector2,F=new i.Vector2,L=[N,T,S,F],P=t.attributes,E=void 0!==P.normal,O=void 0!==P.color,I=void 0!==P.uv,C=void 0!==P.uv2;let R=P.position.array,M=E?P.normal.array:null,U=O?P.color.array:null,D=I?P.uv.array:null,X=C?P.uv2.array:null,z=R,k=M,Y=U,J=D,B=X,V=0,H=!0;function Q(t,e,n){const i=l[t],r=l[e],o=l[n];if(z.push(i.x,i.y,i.z),z.push(r.x,r.y,r.z),z.push(o.x,o.y,o.z),E){const i=p[t],r=p[e],o=p[n];k.push(i.x,i.y,i.z),k.push(r.x,r.y,r.z),k.push(o.x,o.y,o.z)}if(O){const i=x[t],r=x[e],o=x[n];Y.push(i.x,i.y,i.z),Y.push(r.x,r.y,r.z),Y.push(o.x,o.y,o.z)}if(I){const i=w[t],r=w[e],o=w[n];J.push(i.x,i.y),J.push(r.x,r.y),J.push(o.x,o.y)}if(C){const i=L[t],r=L[e],o=L[n];B.push(i.x,i.y),B.push(r.x,r.y),B.push(o.x,o.y)}}for(;H&&V<e;){V++,H=!1,R=z,z=[],E&&(M=k,k=[]),O&&(U=Y,Y=[]),I&&(D=J,J=[]),C&&(X=B,B=[]);for(let t=0,e=0,i=R.length;t<i;t+=9,e+=6){r.fromArray(R,t+0),o.fromArray(R,t+3),s.fromArray(R,t+6),E&&(u.fromArray(M,t+0),d.fromArray(M,t+3),c.fromArray(M,t+6)),O&&(f.fromArray(U,t+0),m.fromArray(U,t+3),g.fromArray(U,t+6)),I&&(y.fromArray(D,e+0),A.fromArray(D,e+2),b.fromArray(D,e+4)),C&&(N.fromArray(X,e+0),T.fromArray(X,e+2),S.fromArray(X,e+4));const i=r.distanceToSquared(o),l=o.distanceToSquared(s),p=r.distanceToSquared(s);i>n||l>n||p>n?(H=!0,i>=l&&i>=p?(a.lerpVectors(r,o,.5),E&&h.lerpVectors(u,d,.5),O&&v.lerpColors(f,m,.5),I&&_.lerpVectors(y,A,.5),C&&F.lerpVectors(N,T,.5),Q(0,3,2),Q(3,1,2)):l>=i&&l>=p?(a.lerpVectors(o,s,.5),E&&h.lerpVectors(d,c,.5),O&&v.lerpColors(m,g,.5),I&&_.lerpVectors(A,b,.5),C&&F.lerpVectors(T,S,.5),Q(0,1,3),Q(3,2,0)):(a.lerpVectors(r,s,.5),E&&h.lerpVectors(u,c,.5),O&&v.lerpColors(f,g,.5),I&&_.lerpVectors(y,b,.5),C&&F.lerpVectors(N,S,.5),Q(0,1,3),Q(3,1,2))):Q(0,1,2)}}const G=new i.BufferGeometry;return G.setAttribute("position",new i.Float32BufferAttribute(z,3)),E&&G.setAttribute("normal",new i.Float32BufferAttribute(k,3)),O&&G.setAttribute("color",new i.Float32BufferAttribute(Y,3)),I&&G.setAttribute("uv",new i.Float32BufferAttribute(J,2)),C&&G.setAttribute("uv2",new i.Float32BufferAttribute(B,2)),G}}function be(t){var e,n=this,i=(e=4022871197,function(t){t=String(t);for(var n=0;n<t.length;n++){var i=.02519603282416938*(e+=t.charCodeAt(n));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)});n.random=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=i(" "),n.s1=i(" "),n.s2=i(" "),n.s0-=i(t),n.s0<0&&(n.s0+=1),n.s1-=i(t),n.s1<0&&(n.s1+=1),n.s2-=i(t),n.s2<0&&(n.s2+=1)}function _e(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function we(t){return _e(0,t)}const Ne={random:{int:_e,uint:we,item:function(t){return t[we(t.length-1)]},boolean:function(){return Math.random()<.5}}},Te=[["black","white","red","green","blue","pink","purple","orange","silver","golden","iron","stone","velvet","opal","ivory","coral","broken","pearl","silk","fire","ice","thunder","falling","rising","diamond","turquoise","ruby","emerald","onyx","lapis","jade","amber"],["shield","sword","spear","arrow","knight","king","queen","phoenix","box","garden","flower","apple","echo","gambit","fist","dragon","sun","moon","star","cloud","rain","wind","dawn","storm","eagle","tiger","lion","puma","wolf","panther","dove","fox"]],Se=[["loud","adorab","glad","zealous","grumpi","happi","polite","expert","awkward","warm","sincere","shy","quiet","lazi","mad","bold"].map((t=>`${t}ly`)),["beam","giggl","paint","smil","danc","laugh","sing","sneez","clapp","whistl","hopp","cheer","fly","greet","wav","juggl"].map((t=>`${t}ing`)),["smart","creative","bubbly","fun","cute","tiny","giant","laidback","upbeat","kind","cool","brave","dumb","tipsy","popular","generous"],["puppy","kitten","monkey","pumpkin","robot","nun","ninja","giraffe","baby","penguin","panda","koala","bear","wizard","pirate","knight"]],Fe="abcdefghijklmnopqrstuvwxyz".split(""),Le="aeiou".split(""),Pe=Fe.filter((t=>!Le.includes(t))),Ee={alphabet:Fe,vowels:Le,consonnants:Pe},Oe={CODENAME:"codename",DESCRIPTION:"description",GIBBERISH:"gibberish",SERIAL:"serial"};const Ie={NONE:"",DASH:"-",DOT:".",TILDE:"~",UNDERSCORE:"_"};let Ce="";function Re(t){return Ne.random.item(t)}function Me(){const{verbose:t,separator:e}=ke;return(t?[...Te.map(Re),Ne.random.uint(999)]:Te.map(Re)).join(e)}function Ue(){const{verbose:t,separator:e}=ke;return(t?Se:[Se[1],Se[3]]).map(Re).join(e)}function De(){const{verbose:t}=ke,{vowels:e,consonnants:n}=Ee,i=t?8:4;return Array.from({length:i},((t,i)=>{const r=i%2?e:n;return Ne.random.item(r)})).join("")}function Xe(){const{verbose:t}=ke,e=t?8:4,n=Ee.alphabet.filter((t=>!"ilo".includes(t)));return Array.from({length:e},(()=>ke.bool()?Ne.random.item(n).toUpperCase():Ne.random.int(1,9))).join("")}function ze(){const{mode:t}=ke,e={codename:Me,description:Ue,gibberish:De,serial:Xe}[t]||Me;return ke.seed=e(),ke.seed}const ke={modes:Oe,mode:Oe.CODENAME,separators:Ie,separator:Ie.NONE,verbose:!1,prng:new be(Ce),codename:Me,description:Ue,gibberish:De,serial:Xe,autoseed:ze,reset:function(){ke.prng=new be(ke.seed)},random:function(t=0,e=1,n=!1){const{prng:i}=ke,r=i.random();return isNaN(t)||isNaN(e)?r:n?Math.floor(r*(e-t+1)+t):r*(e-t)+t},int:function(t,e){return ke.random(t,e,!0)},uint:function(t){return ke.int(0,t)},item:function(t){return t[ke.uint(t.length-1)]},bool:function(){return ke.random()<.5},char:function(t){return t.charAt(ke.uint(t.length-1))},get seed(){return Ce},set seed(t){Ce=t,this.reset()}};ze();const Ye=ke;function Je(t){return function(t){if(Array.isArray(t))return Be(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Be(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Be(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Ve(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var He=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._f=e,this._category=n,this.update()}var e,n,i;return e=t,n=[{key:"update",value:function(){var e=this.f+this.category,n=t.glsl[e];n||(e="linear",n=t.glsl[e]),this._name=e,this._glsl=n}},{key:"f",get:function(){return this._f},set:function(t){this._f=t,this.update()}},{key:"category",get:function(){return this._category},set:function(t){this._category=t,this.update()}},{key:"name",get:function(){return this._name}},{key:"glsl",get:function(){return this._glsl}}],n&&Ve(e.prototype,n),i&&Ve(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Qe(t){let e,n,r,o=0;for(let i=0;i<t.length;++i){const s=t[i];if(s.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===e&&(e=s.array.constructor),e!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=s.itemSize),n!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=s.normalized),r!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;o+=s.array.length}const s=new e(o);let a=0;for(let e=0;e<t.length;++e)s.set(t[e].array,a),a+=t[e].array.length;return new i.BufferAttribute(s,n,r)}Object.assign(He,{get glsl(){return{linear:"float linear( float t ) {\r\n\treturn t;\r\n}",quadIn:"float quadIn( float t ) {\r\n\treturn t * t;\r\n}",quadOut:"float quadOut( float t ) {\r\n\treturn -t * ( t - 2.0 );\r\n}",quadInOut:"float quadInOut( float t ) {\r\n\tfloat p = 2.0 * t * t;\r\n\treturn t < 0.5 ? p : -p + ( 4.0 * t ) - 1.0;\r\n}",cubicIn:"float cubicIn( float t ) {\r\n\treturn t * t * t;\r\n}",cubicOut:"float cubicOut( float t ) {\r\n\tfloat f = t - 1.0;\r\n\treturn f * f * f + 1.0;\r\n}",cubicInOut:"float cubicInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t? 4.0 * t * t * t\r\n\t\t: 0.5 * pow( 2.0 * t - 2.0, 3.0 ) + 1.0;\r\n}",quartIn:"float quartIn( float t ) {\r\n\treturn pow( t, 4.0 );\r\n}",quartOut:"float quartOut( float t ) {\r\n\treturn pow( t - 1.0, 3.0 ) * ( 1.0 - t ) + 1.0;\r\n}",quartInOut:"float quartInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t? + 8.0 * pow( t, 4.0 )\r\n\t\t: - 8.0 * pow( t - 1.0, 4.0 ) + 1.0;\r\n}",quintIn:"float quintIn( float t ) {\r\n\treturn pow( t, 5.0 );\r\n}",quintOut:"float quintOut( float t ) {\r\n\treturn 1.0 - ( pow( 1.0 - t, 5.0 ) );\r\n}",quintInOut:"float quintInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t\t? +16.0 * pow( t, 5.0 )\r\n\t\t\t: -0.5 * pow( 2.0 * t - 2.0, 5.0 ) + 1.0;\r\n}",expoIn:"float expoIn( float t ) {\r\n\treturn t == 0.0 ? t : pow( 2.0, 10.0 * ( t - 1.0 ) );\r\n}",expoOut:"float expoOut( float t ) {\r\n\treturn t == 1.0 ? t : 1.0 - pow( 2.0, -10.0 * t );\r\n}",expoInOut:"float expoInOut( float t ) {\r\n\treturn t == 0.0 || t == 1.0\r\n\t\t? t\r\n\t\t: t < 0.5\r\n\t\t\t? +0.5 * pow( 2.0, ( 20.0 * t ) - 10.0 )\r\n\t\t\t: -0.5 * pow( 2.0, 10.0 - ( t * 20.0 ) ) + 1.0;\r\n}",circIn:"float circIn( float t ) {\r\n\treturn 1.0 - sqrt( 1.0 - t * t );\r\n}",circOut:"float circOut( float t ) {\r\n\treturn sqrt( ( 2.0 - t ) * t );\r\n}",circInOut:"float circInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t? 0.5 * ( 1.0 - sqrt( 1.0 - 4.0 * t * t ) )\r\n\t\t: 0.5 * ( sqrt( ( 3.0 - 2.0 * t ) * ( 2.0 * t - 1.0 ) ) + 1.0 );\r\n}",sineIn:"#ifndef HALF_PI\r\n#define HALF_PI 1.5707963267948966\r\n#endif\r\n\r\nfloat sineIn( float t ) {\r\n\treturn sin( ( t - 1.0 ) * HALF_PI ) + 1.0;\r\n}",sineOut:"#ifndef HALF_PI\r\n#define HALF_PI 1.5707963267948966\r\n#endif\r\n\r\nfloat sineOut( float t ) {\r\n\treturn sin( t * HALF_PI );\r\n}",sineInOut:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\nfloat sineInOut( float t ) {\r\n\treturn -0.5 * ( cos( PI * t ) - 1.0 );\r\n}",backIn:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\nfloat backIn( float t ) {\r\n\treturn pow( t, 3.0 ) - t * sin( t * PI );\r\n}",backOut:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\nfloat backOut( float t ) {\r\n\tfloat f = 1.0 - t;\r\n\treturn 1.0 - ( pow( f, 3.0 ) - f * sin( f * PI ) );\r\n}",backInOut:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\nfloat backInOut( float t ) {\r\n\tfloat f = t < 0.5\r\n\t\t? 2.0 * t\r\n\t\t: 1.0 - ( 2.0 * t - 1.0 );\r\n\r\n\tfloat g = pow( f, 3.0 ) - f * sin( f * PI );\r\n\r\n\treturn t < 0.5\r\n\t\t? 0.5 * g\r\n\t\t: 0.5 * ( 1.0 - g ) + 0.5;\r\n}",bounceIn:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\n#ifndef bounceOut\r\nfloat bounceOut( float t ) {\r\n\tconst float a = 4.0 / 11.0;\r\n\tconst float b = 8.0 / 11.0;\r\n\tconst float c = 9.0 / 10.0;\r\n\r\n\tconst float ca = 4356.0 / 361.0;\r\n\tconst float cb = 35442.0 / 1805.0;\r\n\tconst float cc = 16061.0 / 1805.0;\r\n\r\n\tfloat t2 = t * t;\r\n\r\n\treturn t < a\r\n\t\t? 7.5625 * t2\r\n\t\t: t < b\r\n\t\t\t? 9.075 * t2 - 9.9 * t + 3.4\r\n\t\t\t: t < c\r\n\t\t\t\t? ca * t2 - cb * t + cc\r\n\t\t\t\t: 10.8 * t * t - 20.52 * t + 10.72;\r\n}\r\n#endif\r\n\r\nfloat bounceIn( float t ) {\r\n\treturn 1.0 - bounceOut( 1.0 - t );\r\n}",bounceOut:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\nfloat bounceOut( float t ) {\r\n\tconst float a = 4.0 / 11.0;\r\n\tconst float b = 8.0 / 11.0;\r\n\tconst float c = 9.0 / 10.0;\r\n\r\n\tconst float ca = 4356.0 / 361.0;\r\n\tconst float cb = 35442.0 / 1805.0;\r\n\tconst float cc = 16061.0 / 1805.0;\r\n\r\n\tfloat t2 = t * t;\r\n\r\n\treturn t < a\r\n\t\t? 7.5625 * t2\r\n\t\t: t < b\r\n\t\t\t? 9.075 * t2 - 9.9 * t + 3.4\r\n\t\t\t: t < c\r\n\t\t\t\t? ca * t2 - cb * t + cc\r\n\t\t\t\t: 10.8 * t * t - 20.52 * t + 10.72;\r\n}",bounceInOut:"#ifndef PI\r\n#define PI 3.141592653589793\r\n#endif\r\n\r\n#ifndef bounceOut\r\nfloat bounceOut( float t ) {\r\n\tconst float a = 4.0 / 11.0;\r\n\tconst float b = 8.0 / 11.0;\r\n\tconst float c = 9.0 / 10.0;\r\n\r\n\tconst float ca = 4356.0 / 361.0;\r\n\tconst float cb = 35442.0 / 1805.0;\r\n\tconst float cc = 16061.0 / 1805.0;\r\n\r\n\tfloat t2 = t * t;\r\n\r\n\treturn t < a\r\n\t\t? 7.5625 * t2\r\n\t\t: t < b\r\n\t\t\t? 9.075 * t2 - 9.9 * t + 3.4\r\n\t\t\t: t < c\r\n\t\t\t\t? ca * t2 - cb * t + cc\r\n\t\t\t\t: 10.8 * t * t - 20.52 * t + 10.72;\r\n}\r\n#endif\r\n\r\nfloat bounceInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t? 0.5 * ( 1.0 - bounceOut( 1.0 - t * 2.0 ) )\r\n\t\t: 0.5 * bounceOut( t * 2.0 - 1.0 ) + 0.5;\r\n}",elasticIn:"#ifndef HALF_PI\r\n#define HALF_PI 1.5707963267948966\r\n#endif\r\n\r\nfloat elasticIn( float t ) {\r\n\treturn sin( 13.0 * t * HALF_PI ) * pow( 2.0, 10.0 * ( t - 1.0 ) );\r\n}",elasticOut:"#ifndef HALF_PI\r\n#define HALF_PI 1.5707963267948966\r\n#endif\r\n\r\nfloat elasticOut( float t ) {\r\n\treturn sin( -13.0 * ( t + 1.0 ) * HALF_PI ) * pow( 2.0, -10.0 * t ) + 1.0;\r\n}",elasticInOut:"#ifndef HALF_PI\r\n#define HALF_PI 1.5707963267948966\r\n#endif\r\n\r\nfloat elasticInOut( float t ) {\r\n\treturn t < 0.5\r\n\t\t? 0.5 * sin( +13.0 * HALF_PI * 2.0 * t ) * pow( 2.0, 10.0 * ( 2.0 * t - 1.0 ) )\r\n\t\t: 0.5 * sin( -13.0 * HALF_PI * ( ( 2.0 * t - 1.0 ) + 1.0 ) ) * \r\n\t\t\tpow( 2.0, -10.0 * ( 2.0 * t - 1.0 ) ) + 1.0;\r\n}"}},get functions(){return Je(new Set(Object.keys(He.glsl).map((function(t){return t.replace(/([a-z]*)(InOut|In|Out)/,"$1")}))))},get categories(){return["In","Out","InOut"]}});function Ge(t){return Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ge(t)}function je(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function $e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qe(t,e){return qe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},qe(t,e)}function We(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Ze(t);if(e){var r=Ze(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Ke(this,n)}}function Ke(t,e){if(e&&("object"===Ge(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ze(t){return Ze=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ze(t)}var tn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qe(t,e)}(o,t);var e,n,i,r=We(o);function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.min,i=void 0===n?0:n,s=e.max,a=void 0===s?1:s,l=e.scale,u=void 0===l?1:l,d=e.seed,c=void 0===d?Math.random():d;return $e(this,o),r.call(this,t,o.shader,{uMin:{value:i},uMax:{value:a},uScale:{value:u},uSeed:{value:c}})}return e=o,n&&je(e.prototype,n),i&&je(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(E);function en(t){return en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},en(t)}function nn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function on(t,e){return on=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},on(t,e)}function sn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=un(t);if(e){var r=un(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return an(this,n)}}function an(t,e){if(e&&("object"===en(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ln(t)}function ln(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function un(t){return un=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},un(t)}tn.formatUniforms=function(t){return{uMin:{value:t.min},uMax:{value:t.max},uScale:{value:t.scale},uSeed:{value:t.seed}}},tn.shader="\n\n\tuniform float uMin;\n\tuniform float uMax;\n\tuniform float uScale;\n\tuniform float uSeed;\n\tuniform sampler2D tData;\n\n    ".concat(F.glsl,"\n\t").concat("//\tSimplex 3D Noise \n//\tby Ian McEwan, Ashima Arts\n//\nvec4 permute( vec4 x ){ return mod( ( ( x * 34.0 ) + 1.0 ) * x, 289.0 ); }\nvec4 taylorInvSqrt( vec4 r ){ return 1.79284291400159 - 0.85373472095314 * r; }\n\nfloat simplex3D( float vx, float vy, float vz ) {\n\n\tvec3 v = vec3( vx, vy, vz );\n\t\n\tconst vec2 C = vec2( 1.0/6.0, 1.0/3.0   );\n\tconst vec4 D = vec4( 0.0, 0.5, 1.0, 2.0 );\n\n\t// First corner\n\tvec3 i  = floor( v + dot( v, C.yyy ) );\n\tvec3 x0 =   v - i + dot( i, C.xxx ) ;\n\n\t// Other corners\n\tvec3 g = step( x0.yzx, x0.xyz );\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min(  g.xyz, l.zxy );\n\tvec3 i2 = max(  g.xyz, l.zxy );\n\n\t// x0 = x0 - 0. + 0.0 * C \n\tvec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\tvec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\tvec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\n\t// Permutations\n\ti = mod( i, 289.0 ); \n\tvec4 p = permute( permute( permute(\n\t\t\t i.z + vec4( 0.0, i1.z, i2.z, 1.0 ) )\n\t\t   + i.y + vec4( 0.0, i1.y, i2.y, 1.0 ) ) \n\t\t   + i.x + vec4( 0.0, i1.x, i2.x, 1.0 ) );\n\n\t// Gradients\n\t// ( N*N points uniformly over a square, mapped onto an octahedron.)\n  \tfloat n_ = 1.0/7.0; // N=7\n  \tvec3  ns = n_ * D.wyz - D.xzx;\n\n  \tvec4 j = p - 49.0 * floor( p * ns.z *ns.z ); //  mod( p,N*N)\n\n  \tvec4 x_ = floor( j * ns.z );\n  \tvec4 y_ = floor( j - 7.0 * x_ ); // mod( j,N)\n\n  \tvec4 x = x_ *ns.x + ns.yyyy;\n  \tvec4 y = y_ *ns.x + ns.yyyy;\n  \tvec4 h = 1.0 - abs( x ) - abs( y );\n\n  \tvec4 b0 = vec4( x.xy, y.xy );\n  \tvec4 b1 = vec4( x.zw, y.zw );\n\n  \tvec4 s0 = floor( b0 )*2.0 + 1.0;\n  \tvec4 s1 = floor( b1 )*2.0 + 1.0;\n  \tvec4 sh = -step( h, vec4( 0.0 ) );\n\n  \tvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  \tvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  \tvec3 p0 = vec3( a0.xy,h.x );\n  \tvec3 p1 = vec3( a0.zw,h.y );\n  \tvec3 p2 = vec3( a1.xy,h.z );\n  \tvec3 p3 = vec3( a1.zw,h.w );\n\n\t//Normalise gradients\n  \tvec4 norm = taylorInvSqrt( \n\t\tvec4( dot( p0, p0 ), dot( p1, p1 ), dot( p2, p2 ), dot( p3, p3 ) )\n\t);\n  \tp0 *= norm.x;\n  \tp1 *= norm.y;\n  \tp2 *= norm.z;\n  \tp3 *= norm.w;\n\n\t// Mix final noise value\n  \tvec4 m = max( \n\t\t0.6 - vec4( dot( x0, x0 ), dot( x1, x1 ), dot( x2, x2 ), dot( x3, x3 ) ), \n\t\t0.0\n\t);\n  \tm = m * m;\n  \treturn 42.0 * dot( \n\t\tm*m,\n\t\tvec4( dot( p0,x0 ), dot( p1,x1 ), dot( p2,x2 ), dot( p3,x3 ) )\n\t);\n\n}","\n\n    void main() {\n        \n        vec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\t\tfloat noise = 0.5 + simplex3D( \n\t\t\tuv.x * uScale, \n\t\t\tuv.y * uScale, \n\t\t\tuSeed * uScale\n\t\t) / 2.0;\n\n\t\tfloat data = noise * ( uMax - uMin ) + uMin;\n\n        gl_FragColor = pack( data );\n\n    }\n\n");var dn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&on(t,e)}(s,t);var e,n,r,o=sn(s);function s(t,e){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.density,a=i.reversed,l=i.easing,u=i.maxEdgeLength,d=i.maxIterations,c=i.spread,h=i.turbulence,p=i.stagger,f=i.dynamics,m=i.delay,g=i.wind,v=i.duration;nn(this,s);var x=new Ae(u,d);return t=x.modify(t),t=s.densify(t,r),(n=o.call(this,t,e)).options={reversed:a,easing:l,spread:c,turbulence:h,delay:m,duration:v,stagger:p,dynamics:f,wind:g},n.setAttributes(),n.setChunks(),n.material.onBeforeCompile=n.onBeforeCompile.bind(ln(n)),n}return e=s,n=[{key:"setAttributes",value:function(){for(var t=this.geometry,e=t.attributes.position.array,n=t.attributes.position.count,r=Math.ceil(n/3),o=new Float32Array(n),a=new Float32Array(2*n),l=new Float32Array(3*n),u=s.computeCentroid,d=0;d<r;d++)for(var c=3*d,h=2*c,p=3*c,f=d%r/r,m=~~(d/r)/r,g=Math.random(),v=0;v<3;v++){o[c+v]=g;var x=h+2*v;a[x]=f,a[x+1]=m;var y=p+3*v;l[y]=u(p,e),l[y+1]=u(p+1,e),l[y+2]=u(p+2,e)}t.setAttribute("aNoise",new i.BufferAttribute(o,1)),t.setAttribute("aDataCoord",new i.BufferAttribute(a,2)),t.setAttribute("aCentroid",new i.BufferAttribute(l,3));var A=new tn(r),b=new tn(r),_=new tn(r);this.gpgpu={x:A,y:b,z:_},this.compute()}},{key:"compute",value:function(){var t=this.gpgpu,e=this.shader,n=this.options,i=n.spread,r={uMin:{value:-i},uMax:{value:i},uScale:{value:n.turbulence}};if(Object.values(t).forEach((function(t){t.uniforms=JSON.parse(JSON.stringify(r)),t.uniforms.uSeed={value:Ye.random()},t.compute()})),e){var o=e.uniforms;o.tNoiseX.value=t.x.texture,o.tNoiseY.value=t.y.texture,o.tNoiseZ.value=t.z.texture}}},{key:"setChunks",value:function(){var t=this.options,e=t.easing,n="\n\n\t\t\tuniform float uTime;\n\t\t\tuniform float uStagger;\n\t\t\tuniform float uDynamics;\n\t\t\tuniform float uDelay;\n\t\t\tuniform float uDuration;\n\t\t\tuniform vec3 uWind;\n\t\t\tuniform sampler2D tNoiseX;\n\t\t\tuniform sampler2D tNoiseY;\n\t\t\tuniform sampler2D tNoiseZ;\n\n\t\t\tattribute float aNoise;\n\t\t\tattribute vec2 aDataCoord;\n\t\t\tattribute vec3 aCentroid;\n\n\t\t\t".concat(F.glsl,"\n\t\t\t").concat(e.glsl,"\n\t\t"),i=t.reversed?"progress = 1.0 - progress;":"",r="\n\n\t\t\tfloat bias = 0.9;\n\t\t\tfloat noiseDuration = clamp(\n\t\t\t\t( 1.0 - aNoise ) * uDynamics * uDuration,\n\t\t\t\t0.0,\n\t\t\t\t0.9 * uDuration\n\t\t\t);\n\t\t\tfloat duration = uDuration - noiseDuration;\n\n\t\t\tfloat noiseDelay = aNoise * uStagger;\n\t\t\tfloat delay = uDelay + noiseDelay;\n\n\t\t\tfloat time = clamp( uTime - delay, 0.0, duration );\n\t\t\tfloat progress =  clamp( time / duration, 0.0, 1.0 );\n\t\t\t".concat(i,"\n\t\t\tprogress = ").concat(e.name,"( progress );\n\t\t\n\t\t\tfloat scale = clamp( 1.0 - progress, 0.0, 1.0 );\n\t\t\ttransformed -= aCentroid;\n\t\t\ttransformed *= scale;\n\t\t\ttransformed += aCentroid;\n\t\t\n\t\t\tfloat noiseX = unpack( texture2D( tNoiseX, aDataCoord ) );\n\t\t\tfloat noiseY = unpack( texture2D( tNoiseY, aDataCoord ) );\n\t\t\tfloat noiseZ = unpack( texture2D( tNoiseZ, aDataCoord ) );\n\t\t\t\n\t\t\ttransformed.x += ( noiseX + uWind.x ) * progress;\n\t\t\ttransformed.y += ( noiseY + uWind.y ) * progress;\n\t\t\ttransformed.z += ( noiseZ + uWind.z ) * progress;\n\n\t\t");this.chunks={declarations:n,modifications:r},this.material.dispose()}},{key:"onBeforeCompile",value:function(t){var e=this.gpgpu,n=this.options,i=n.duration,r=n.stagger,o=n.dynamics,s=n.delay,a=n.wind;Object.assign(t.uniforms,{uTime:{value:0},uStagger:{value:r},uDynamics:{value:o},uDelay:{value:s},uDuration:{value:i},uWind:{value:a},tNoiseX:{value:e.x.texture},tNoiseY:{value:e.y.texture},tNoiseZ:{value:e.z.texture}});var l="void main()",u="#include <begin_vertex>",d=this.chunks,c=d.declarations,h=d.modifications,p=t.vertexShader;p=(p=p.replace(l,c+l)).replace(u,u+h),t.vertexShader=p,this.shader=t}},{key:"update",value:function(t){this.shader.uniforms.uTime.value=t}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose(),Object.values(this.gpgpu).forEach((function(t){return t.dispose()}))}},{key:"totalVertices",get:function(){return this.geometry.attributes.position.count}}],n&&rn(e.prototype,n),r&&rn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(i.Mesh);dn.densify=function(t,e){if(e<2||!Number.isInteger(e)||!Number.isFinite(e))return t;t.computeBoundingBox();var n=t.boundingBox,r=.01*Math.min(n.max.x-n.min.x,n.max.y-n.min.y,n.max.z-n.min.z),o=Array.from({length:e-1},(function(e,n){var i=t.clone(),o=1-r*(n+1);return i.scale(o,o,o),i}));return o.unshift(t),function(t,e=!1){const n=null!==t[0].index,r=new Set(Object.keys(t[0].attributes)),o=new Set(Object.keys(t[0].morphAttributes)),s={},a={},l=t[0].morphTargetsRelative,u=new i.BufferGeometry;let d=0;for(let i=0;i<t.length;++i){const c=t[i];let h=0;if(n!==(null!==c.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const t in c.attributes){if(!r.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+'. All geometries must have compatible attributes; make sure "'+t+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[t]&&(s[t]=[]),s[t].push(c.attributes[t]),h++}if(h!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". Make sure all geometries have the same number of attributes."),null;if(l!==c.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const t in c.morphAttributes){if(!o.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[t]&&(a[t]=[]),a[t].push(c.morphAttributes[t])}if(u.userData.mergedUserData=u.userData.mergedUserData||[],u.userData.mergedUserData.push(c.userData),e){let t;if(n)t=c.index.count;else{if(void 0===c.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". The geometry must have either an index or a position attribute"),null;t=c.attributes.position.count}u.addGroup(d,t,i),d+=t}}if(n){let e=0;const n=[];for(let i=0;i<t.length;++i){const r=t[i].index;for(let t=0;t<r.count;++t)n.push(r.getX(t)+e);e+=t[i].attributes.position.count}u.setIndex(n)}for(const t in s){const e=Qe(s[t]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+t+" attribute."),null;u.setAttribute(t,e)}for(const t in a){const e=a[t][0].length;if(0===e)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[t]=[];for(let n=0;n<e;++n){const e=[];for(let i=0;i<a[t].length;++i)e.push(a[t][i][n]);const i=Qe(e);if(!i)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+t+" morphAttribute."),null;u.morphAttributes[t].push(i)}}return u}(o)},dn.computeCentroid=function(t,e){return(e[t]+e[t+3]+e[t+6])/3};
/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.16.0
 * @author George Michael Brower
 * @license MIT
 */
class cn{constructor(t,e,n,i,r="div"){this.parent=t,this.object=e,this.property=n,this._disabled=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(i),this.$name=document.createElement("div"),this.$name.classList.add("name"),cn.nextNameID=cn.nextNameID||0,this.$name.id="lil-gui-name-"+ ++cn.nextNameID,this.$widget=document.createElement(r),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(n)}name(t){return this._name=t,this.$name.innerHTML=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),void 0!==this._onChange&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),void 0!==this._onFinishChange&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled||(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t)),this}options(t){const e=this.parent.add(this.object,this.property,t);return e.name(this._name),this.destroy(),e}min(t){return this}max(t){return this}step(t){return this}listen(t=!0){return this._listening=t,void 0!==this._listenCallbackID&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback),this.updateDisplay()}getValue(){return this.object[this.property]}setValue(t){return this.object[this.property]=t,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class hn extends cn{constructor(t,e,n){super(t,e,n,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",(()=>{this.setValue(this.$input.checked),this._callOnFinishChange()})),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function pn(t){let e,n;return(e=t.match(/(#|0x)?([a-f0-9]{6})/i))?n=e[2]:(e=t.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?n=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=t.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!n&&"#"+n}const fn={isPrimitive:!0,match:t=>"string"==typeof t,fromHexString:pn,toHexString:pn},mn={isPrimitive:!0,match:t=>"number"==typeof t,fromHexString:t=>parseInt(t.substring(1),16),toHexString:t=>"#"+t.toString(16).padStart(6,0)},gn={isPrimitive:!1,match:Array.isArray,fromHexString(t,e,n=1){const i=mn.fromHexString(t);e[0]=(i>>16&255)/255*n,e[1]=(i>>8&255)/255*n,e[2]=(255&i)/255*n},toHexString:([t,e,n],i=1)=>mn.toHexString(t*(i=255/i)<<16^e*i<<8^n*i<<0)},vn={isPrimitive:!1,match:t=>Object(t)===t,fromHexString(t,e,n=1){const i=mn.fromHexString(t);e.r=(i>>16&255)/255*n,e.g=(i>>8&255)/255*n,e.b=(255&i)/255*n},toHexString:({r:t,g:e,b:n},i=1)=>mn.toHexString(t*(i=255/i)<<16^e*i<<8^n*i<<0)},xn=[fn,mn,gn,vn];class yn extends cn{constructor(t,e,n,i){var r;super(t,e,n,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(r=this.initialValue,xn.find((t=>t.match(r)))),this._rgbScale=i,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",(()=>{this._setValueFromHexString(this.$input.value)})),this.$input.addEventListener("blur",(()=>{this._callOnFinishChange()})),this.$text.addEventListener("input",(()=>{const t=pn(this.$text.value);t&&this._setValueFromHexString(t)})),this.$text.addEventListener("focus",(()=>{this._textFocused=!0,this.$text.select()})),this.$text.addEventListener("blur",(()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()})),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const e=this._format.fromHexString(t);this.setValue(e)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class An extends cn{constructor(t,e,n){super(t,e,n,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",(t=>{t.preventDefault(),this.getValue().call(this.object)})),this.$button.addEventListener("touchstart",(()=>{})),this.$disable=this.$button}}class bn extends cn{constructor(t,e,n,i,r,o){super(t,e,n,"number"),this._initInput(),this.min(i),this.max(r);const s=void 0!==o;this.step(s?o:this._getImplicitStep(),s),this.updateDisplay()}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,e=!0){return this._step=t,this._stepExplicit=e,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let e=(t-this._min)/(this._max-this._min);e=Math.max(0,Math.min(e,1)),this.$fill.style.width=100*e+"%"}return this._inputFocused||(this.$input.value=t),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=t=>{const e=parseFloat(this.$input.value);isNaN(e)||(this._snapClampSetValue(e+t),this.$input.value=this.getValue())};let e,n,i,r,o,s=!1;const a=t=>{if(s){const i=t.clientX-e,r=t.clientY-n;Math.abs(r)>5?(t.preventDefault(),this.$input.blur(),s=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(i)>5&&l()}if(!s){const e=t.clientY-i;o-=e*this._step*this._arrowKeyMultiplier(t),r+o>this._max?o=this._max-r:r+o<this._min&&(o=this._min-r),this._snapClampSetValue(r+o)}i=t.clientY},l=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",l)};this.$input.addEventListener("input",(()=>{const t=parseFloat(this.$input.value);isNaN(t)||this.setValue(this._clamp(t))})),this.$input.addEventListener("keydown",(e=>{"Enter"===e.code&&this.$input.blur(),"ArrowUp"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e))),"ArrowDown"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e)*-1))})),this.$input.addEventListener("wheel",(e=>{this._inputFocused&&(e.preventDefault(),t(this._step*this._normalizeMouseWheel(e)))})),this.$input.addEventListener("mousedown",(t=>{e=t.clientX,n=i=t.clientY,s=!0,r=this.getValue(),o=0,window.addEventListener("mousemove",a),window.addEventListener("mouseup",l)})),this.$input.addEventListener("focus",(()=>{this._inputFocused=!0})),this.$input.addEventListener("blur",(()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()}))}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=t=>{const e=this.$slider.getBoundingClientRect();let n=(i=t,r=e.left,o=e.right,s=this._min,a=this._max,(i-r)/(o-r)*(a-s)+s);var i,r,o,s,a;this._snapClampSetValue(n)},e=e=>{t(e.clientX)},n=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)};let i,r,o=!1;const s=e=>{e.preventDefault(),this._setDraggingStyle(!0),t(e.touches[0].clientX),o=!1},a=e=>{if(o){const t=e.touches[0].clientX-i,n=e.touches[0].clientY-r;Math.abs(t)>Math.abs(n)?s(e):(window.removeEventListener("touchmove",a),window.removeEventListener("touchend",l))}else e.preventDefault(),t(e.touches[0].clientX)},l=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",l)},u=this._callOnFinishChange.bind(this);let d;this.$slider.addEventListener("mousedown",(i=>{this._setDraggingStyle(!0),t(i.clientX),window.addEventListener("mousemove",e),window.addEventListener("mouseup",n)})),this.$slider.addEventListener("touchstart",(t=>{t.touches.length>1||(this._hasScrollBar?(i=t.touches[0].clientX,r=t.touches[0].clientY,o=!0):s(t),window.addEventListener("touchmove",a),window.addEventListener("touchend",l))})),this.$slider.addEventListener("wheel",(t=>{if(Math.abs(t.deltaX)<Math.abs(t.deltaY)&&this._hasScrollBar)return;t.preventDefault();const e=this._normalizeMouseWheel(t)*this._step;this._snapClampSetValue(this.getValue()+e),this.$input.value=this.getValue(),clearTimeout(d),d=setTimeout(u,400)}))}_setDraggingStyle(t,e="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle(`lil-gui-${e}`,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:e,deltaY:n}=t;Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(e=0,n=-t.wheelDelta/120,n*=this._stepExplicit?1:10);return e+-n}_arrowKeyMultiplier(t){let e=this._stepExplicit?1:10;return t.shiftKey?e*=10:t.altKey&&(e/=10),e}_snap(t){const e=Math.round(t/this._step)*this._step;return parseFloat(e.toPrecision(15))}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return void 0!==this._min}get _hasMax(){return void 0!==this._max}}class _n extends cn{constructor(t,e,n,i){super(t,e,n,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(i)?i:Object.values(i),this._names=Array.isArray(i)?i:Object.keys(i),this._names.forEach((t=>{const e=document.createElement("option");e.innerHTML=t,this.$select.appendChild(e)})),this.$select.addEventListener("change",(()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()})),this.$select.addEventListener("focus",(()=>{this.$display.classList.add("focus")})),this.$select.addEventListener("blur",(()=>{this.$display.classList.remove("focus")})),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const t=this.getValue(),e=this._values.indexOf(t);return this.$select.selectedIndex=e,this.$display.innerHTML=-1===e?t:this._names[e],this}}class wn extends cn{constructor(t,e,n){super(t,e,n,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",(()=>{this.setValue(this.$input.value)})),this.$input.addEventListener("keydown",(t=>{"Enter"===t.code&&this.$input.blur()})),this.$input.addEventListener("blur",(()=>{this._callOnFinishChange()})),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let Nn=!1;class Tn{constructor({parent:t,autoPlace:e=void 0===t,container:n,width:i,title:r="Controls",injectStyles:o=!0,touchStyles:s=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",(()=>this.openAnimated(this._closed))),this.$title.addEventListener("keydown",(t=>{"Enter"!==t.code&&"Space"!==t.code||(t.preventDefault(),this.$title.click())})),this.$title.addEventListener("touchstart",(()=>{})),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(r),s&&this.domElement.classList.add("allow-touch-styles"),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),!Nn&&o&&(!function(t){const e=document.createElement("style");e.innerHTML=t;const n=document.querySelector("head link[rel=stylesheet], head style");n?document.head.insertBefore(e,n):document.head.appendChild(e)}('.lil-gui {\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  line-height: 1;\n  font-weight: normal;\n  font-style: normal;\n  text-align: left;\n  background-color: var(--background-color);\n  color: var(--text-color);\n  user-select: none;\n  -webkit-user-select: none;\n  touch-action: manipulation;\n  --background-color: #1f1f1f;\n  --text-color: #ebebeb;\n  --title-background-color: #111111;\n  --title-text-color: #ebebeb;\n  --widget-color: #424242;\n  --hover-color: #4f4f4f;\n  --focus-color: #595959;\n  --number-color: #2cc9ff;\n  --string-color: #a2db3c;\n  --font-size: 11px;\n  --input-font-size: 11px;\n  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;\n  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;\n  --padding: 4px;\n  --spacing: 4px;\n  --widget-height: 20px;\n  --name-width: 45%;\n  --slider-knob-width: 2px;\n  --slider-input-width: 27%;\n  --color-input-width: 27%;\n  --slider-input-min-width: 45px;\n  --color-input-min-width: 45px;\n  --folder-indent: 7px;\n  --widget-padding: 0 0 0 3px;\n  --widget-border-radius: 2px;\n  --checkbox-size: calc(0.75 * var(--widget-height));\n  --scrollbar-width: 5px;\n}\n.lil-gui, .lil-gui * {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n.lil-gui.root {\n  width: var(--width, 245px);\n  display: flex;\n  flex-direction: column;\n}\n.lil-gui.root > .title {\n  background: var(--title-background-color);\n  color: var(--title-text-color);\n}\n.lil-gui.root > .children {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.lil-gui.root > .children::-webkit-scrollbar {\n  width: var(--scrollbar-width);\n  height: var(--scrollbar-width);\n  background: var(--background-color);\n}\n.lil-gui.root > .children::-webkit-scrollbar-thumb {\n  border-radius: var(--scrollbar-width);\n  background: var(--focus-color);\n}\n@media (pointer: coarse) {\n  .lil-gui.allow-touch-styles {\n    --widget-height: 28px;\n    --padding: 6px;\n    --spacing: 6px;\n    --font-size: 13px;\n    --input-font-size: 16px;\n    --folder-indent: 10px;\n    --scrollbar-width: 7px;\n    --slider-input-min-width: 50px;\n    --color-input-min-width: 65px;\n  }\n}\n.lil-gui.force-touch-styles {\n  --widget-height: 28px;\n  --padding: 6px;\n  --spacing: 6px;\n  --font-size: 13px;\n  --input-font-size: 16px;\n  --folder-indent: 10px;\n  --scrollbar-width: 7px;\n  --slider-input-min-width: 50px;\n  --color-input-min-width: 65px;\n}\n.lil-gui.autoPlace {\n  max-height: 100%;\n  position: fixed;\n  top: 0;\n  right: 15px;\n  z-index: 1001;\n}\n\n.lil-gui .controller {\n  display: flex;\n  align-items: center;\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n}\n.lil-gui .controller.disabled {\n  opacity: 0.5;\n}\n.lil-gui .controller.disabled, .lil-gui .controller.disabled * {\n  pointer-events: none !important;\n}\n.lil-gui .controller > .name {\n  min-width: var(--name-width);\n  flex-shrink: 0;\n  white-space: pre;\n  padding-right: var(--spacing);\n  line-height: var(--widget-height);\n}\n.lil-gui .controller .widget {\n  position: relative;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  min-height: var(--widget-height);\n}\n.lil-gui .controller.string input {\n  color: var(--string-color);\n}\n.lil-gui .controller.boolean .widget {\n  cursor: pointer;\n}\n.lil-gui .controller.color .display {\n  width: 100%;\n  height: var(--widget-height);\n  border-radius: var(--widget-border-radius);\n  position: relative;\n}\n@media (hover: hover) {\n  .lil-gui .controller.color .display:hover:before {\n    content: " ";\n    display: block;\n    position: absolute;\n    border-radius: var(--widget-border-radius);\n    border: 1px solid #fff9;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n  }\n}\n.lil-gui .controller.color input[type=color] {\n  opacity: 0;\n  width: 100%;\n  height: 100%;\n  cursor: pointer;\n}\n.lil-gui .controller.color input[type=text] {\n  margin-left: var(--spacing);\n  font-family: var(--font-family-mono);\n  min-width: var(--color-input-min-width);\n  width: var(--color-input-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.option select {\n  opacity: 0;\n  position: absolute;\n  width: 100%;\n  max-width: 100%;\n}\n.lil-gui .controller.option .display {\n  position: relative;\n  pointer-events: none;\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  line-height: var(--widget-height);\n  max-width: 100%;\n  overflow: hidden;\n  word-break: break-all;\n  padding-left: 0.55em;\n  padding-right: 1.75em;\n  background: var(--widget-color);\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .display.focus {\n    background: var(--focus-color);\n  }\n}\n.lil-gui .controller.option .display.active {\n  background: var(--focus-color);\n}\n.lil-gui .controller.option .display:after {\n  font-family: "lil-gui";\n  content: "";\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  padding-right: 0.375em;\n}\n.lil-gui .controller.option .widget,\n.lil-gui .controller.option select {\n  cursor: pointer;\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .widget:hover .display {\n    background: var(--hover-color);\n  }\n}\n.lil-gui .controller.number input {\n  color: var(--number-color);\n}\n.lil-gui .controller.number.hasSlider input {\n  margin-left: var(--spacing);\n  width: var(--slider-input-width);\n  min-width: var(--slider-input-min-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.number .slider {\n  width: 100%;\n  height: var(--widget-height);\n  background-color: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  padding-right: var(--slider-knob-width);\n  overflow: hidden;\n  cursor: ew-resize;\n  touch-action: pan-y;\n}\n@media (hover: hover) {\n  .lil-gui .controller.number .slider:hover {\n    background-color: var(--hover-color);\n  }\n}\n.lil-gui .controller.number .slider.active {\n  background-color: var(--focus-color);\n}\n.lil-gui .controller.number .slider.active .fill {\n  opacity: 0.95;\n}\n.lil-gui .controller.number .fill {\n  height: 100%;\n  border-right: var(--slider-knob-width) solid var(--number-color);\n  box-sizing: content-box;\n}\n\n.lil-gui-dragging .lil-gui {\n  --hover-color: var(--widget-color);\n}\n.lil-gui-dragging * {\n  cursor: ew-resize !important;\n}\n\n.lil-gui-dragging.lil-gui-vertical * {\n  cursor: ns-resize !important;\n}\n\n.lil-gui .title {\n  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);\n  height: var(--title-height);\n  line-height: calc(var(--title-height) - 4px);\n  font-weight: 600;\n  padding: 0 var(--padding);\n  -webkit-tap-highlight-color: transparent;\n  cursor: pointer;\n  outline: none;\n  text-decoration-skip: objects;\n}\n.lil-gui .title:before {\n  font-family: "lil-gui";\n  content: "";\n  padding-right: 2px;\n  display: inline-block;\n}\n.lil-gui .title:active {\n  background: var(--title-background-color);\n  opacity: 0.75;\n}\n@media (hover: hover) {\n  body:not(.lil-gui-dragging) .lil-gui .title:hover {\n    background: var(--title-background-color);\n    opacity: 0.85;\n  }\n  .lil-gui .title:focus {\n    text-decoration: underline var(--focus-color);\n  }\n}\n.lil-gui.root > .title:focus {\n  text-decoration: none !important;\n}\n.lil-gui.closed > .title:before {\n  content: "";\n}\n.lil-gui.closed > .children {\n  transform: translateY(-7px);\n  opacity: 0;\n}\n.lil-gui.closed:not(.transition) > .children {\n  display: none;\n}\n.lil-gui.transition > .children {\n  transition-duration: 300ms;\n  transition-property: height, opacity, transform;\n  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);\n  overflow: hidden;\n  pointer-events: none;\n}\n.lil-gui .children:empty:before {\n  content: "Empty";\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n  display: block;\n  height: var(--widget-height);\n  font-style: italic;\n  line-height: var(--widget-height);\n  opacity: 0.5;\n}\n.lil-gui.root > .children > .lil-gui > .title {\n  border: 0 solid var(--widget-color);\n  border-width: 1px 0;\n  transition: border-color 300ms;\n}\n.lil-gui.root > .children > .lil-gui.closed > .title {\n  border-bottom-color: transparent;\n}\n.lil-gui + .controller {\n  border-top: 1px solid var(--widget-color);\n  margin-top: 0;\n  padding-top: var(--spacing);\n}\n.lil-gui .lil-gui .lil-gui > .title {\n  border: none;\n}\n.lil-gui .lil-gui .lil-gui > .children {\n  border: none;\n  margin-left: var(--folder-indent);\n  border-left: 2px solid var(--widget-color);\n}\n.lil-gui .lil-gui .controller {\n  border: none;\n}\n\n.lil-gui input {\n  -webkit-tap-highlight-color: transparent;\n  border: 0;\n  outline: none;\n  font-family: var(--font-family);\n  font-size: var(--input-font-size);\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  background: var(--widget-color);\n  color: var(--text-color);\n  width: 100%;\n}\n@media (hover: hover) {\n  .lil-gui input:hover {\n    background: var(--hover-color);\n  }\n  .lil-gui input:active {\n    background: var(--focus-color);\n  }\n}\n.lil-gui input:disabled {\n  opacity: 1;\n}\n.lil-gui input[type=text],\n.lil-gui input[type=number] {\n  padding: var(--widget-padding);\n}\n.lil-gui input[type=text]:focus,\n.lil-gui input[type=number]:focus {\n  background: var(--focus-color);\n}\n.lil-gui input::-webkit-outer-spin-button,\n.lil-gui input::-webkit-inner-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n.lil-gui input[type=number] {\n  -moz-appearance: textfield;\n}\n.lil-gui input[type=checkbox] {\n  appearance: none;\n  -webkit-appearance: none;\n  height: var(--checkbox-size);\n  width: var(--checkbox-size);\n  border-radius: var(--widget-border-radius);\n  text-align: center;\n  cursor: pointer;\n}\n.lil-gui input[type=checkbox]:checked:before {\n  font-family: "lil-gui";\n  content: "";\n  font-size: var(--checkbox-size);\n  line-height: var(--checkbox-size);\n}\n@media (hover: hover) {\n  .lil-gui input[type=checkbox]:focus {\n    box-shadow: inset 0 0 0 1px var(--focus-color);\n  }\n}\n.lil-gui button {\n  -webkit-tap-highlight-color: transparent;\n  outline: none;\n  cursor: pointer;\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  color: var(--text-color);\n  width: 100%;\n  height: var(--widget-height);\n  text-transform: none;\n  background: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  border: 1px solid var(--widget-color);\n  text-align: center;\n  line-height: calc(var(--widget-height) - 4px);\n}\n@media (hover: hover) {\n  .lil-gui button:hover {\n    background: var(--hover-color);\n    border-color: var(--hover-color);\n  }\n  .lil-gui button:focus {\n    border-color: var(--focus-color);\n  }\n}\n.lil-gui button:active {\n  background: var(--focus-color);\n}\n\n@font-face {\n  font-family: "lil-gui";\n  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");\n}'),Nn=!0),n?n.appendChild(this.domElement):e&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),i&&this.domElement.style.setProperty("--width",i+"px"),this.domElement.addEventListener("keydown",(t=>t.stopPropagation())),this.domElement.addEventListener("keyup",(t=>t.stopPropagation()))}add(t,e,n,i,r){if(Object(n)===n)return new _n(this,t,e,n);const o=t[e];switch(typeof o){case"number":return new bn(this,t,e,n,i,r);case"boolean":return new hn(this,t,e);case"string":return new wn(this,t,e);case"function":return new An(this,t,e)}console.error("gui.add failed\n\tproperty:",e,"\n\tobject:",t,"\n\tvalue:",o)}addColor(t,e,n=1){return new yn(this,t,e,n)}addFolder(t){return new Tn({parent:this,title:t})}load(t,e=!0){return t.controllers&&this.controllers.forEach((e=>{e instanceof An||e._name in t.controllers&&e.load(t.controllers[e._name])})),e&&t.folders&&this.folders.forEach((e=>{e._title in t.folders&&e.load(t.folders[e._title])})),this}save(t=!0){const e={controllers:{},folders:{}};return this.controllers.forEach((t=>{if(!(t instanceof An)){if(t._name in e.controllers)throw new Error(`Cannot save GUI with duplicate property "${t._name}"`);e.controllers[t._name]=t.save()}})),t&&this.folders.forEach((t=>{if(t._title in e.folders)throw new Error(`Cannot save GUI with duplicate folder "${t._title}"`);e.folders[t._title]=t.save()})),e}open(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame((()=>{const e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const n=t=>{t.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",n))};this.$children.addEventListener("transitionend",n);const i=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame((()=>{this.$children.style.height=i+"px"}))})),this}title(t){return this._title=t,this.$title.innerHTML=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach((t=>t.reset())),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),void 0!==this._onChange&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),void 0!==this._onFinishChange&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach((t=>t.destroy()))}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach((e=>{t=t.concat(e.controllersRecursive())})),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach((e=>{t=t.concat(e.foldersRecursive())})),t}}function Sn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,r,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);s=!0);}catch(t){a=!0,r=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Fn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fn(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var Ln,Pn={debug:!0,grid:!0,maxEdgeLength:.05,maxIterations:6,geometry:"torus",density:4,spread:2,turbulence:12,stagger:300,dynamics:.5,wind:new i.Vector3(0,0,0),easing:new He,easingFunction:"circ",easingCategory:"In",reversed:!1,duration:1e3,loopDuration:3e3,delay:850},En={density:{min:1,max:10,step:1},spread:{min:1,max:10,step:.1},turbulence:{min:1,max:20,step:.1},stagger:{min:0,max:500,step:5},dynamics:{min:0,max:1,step:.01},x:{min:-5,max:5,step:.1},y:{min:-5,max:5,step:.1},z:{min:-5,max:5,step:.1},delay:{min:0,max:1e3,step:50},duration:{min:500,max:5e3,step:50},loopDuration:{min:1e3,max:7500,step:50}},On=JSON.parse(JSON.stringify(En));["x","y","z","loopDuration","defaultSeed"].forEach((function(t){return delete On[t]})),On.density.min=2,On.density.max=6,On.duration.min=1e3,Ln={title:"Disintegrator",defaultSeed:"keda",ranges:En,reset:function(){Object.entries(Pn).forEach((function(t){var e=Sn(t,2),n=e[0],i=e[1];Ln[n]=i}));var t=Ln,e=t.easingFunction,n=t.easingCategory;Ln.easing=new He(e,n),Ln.wind.x=0,Ln.wind.y=0,Ln.wind.z=-4},random:On};var In,Cn,Rn=new Tn;function Mn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,r,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);s=!0);}catch(t){a=!0,r=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Un(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Un(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Un(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Dn(){var t=Cn,e=t.loopDuration,n=t.duration,i=t.stagger,r=t.delay;0!==e&&(Cn.loopDuration=n+i+2*r)}Rn.init=function(){function t(t,e,n,i){if(Ln.ranges[n]){var r=Ln.ranges[n],o=r.min,s=r.max,a=r.step;return t.add(e,n,o,s).step(a)}return t.add(e,n,i)}var e=Rn.addFolder("Geometry");t(e,Cn,"geometry",Object.keys(Cn.geometries)),t(e,Cn,"density").onFinishChange(Cn.generate),e.open();var n=Rn.addFolder("Noise");t(n,Cn,"spread"),t(n,Cn,"turbulence"),t(n,Cn,"stagger"),t(n,Cn,"dynamics"),n.open();var i=Rn.addFolder("Wind");t(i,Cn.wind,"x"),t(i,Cn.wind,"y"),t(i,Cn.wind,"z"),t(i,Cn,"zeroWind"),i.open();var r=Rn.addFolder("Animation");t(r,Cn,"easingFunction",He.functions),t(r,Cn,"easingCategory",He.categories),t(r,Cn,"reversed"),t(r,Cn,"duration"),t(r,Cn,"loopDuration").listen(),t(r,Cn,"delay"),r.open();var o=Rn.addFolder("Settings");t(o,Cn,"grid"),t(o,Cn,"reset"),t(o,Cn,"random"),o.open(),Rn.updateDisplay=function(){return Rn.controllersRecursive().forEach((function(t){return t.updateDisplay()}))},Rn.close()},In={load:function(){return window.location.hash.replace("#","")},save:function(t){window.location.hash=t}},Ye.seed=Ln.defaultSeed;var Xn={box:function(){return new i.BoxBufferGeometry(1.5,1.5,1.5,64,64,64)},circle:function(){return new i.CircleBufferGeometry(1.1,720)},cylinder:function(){return new i.CylinderBufferGeometry(.9,.9,1.5,96,96)},tetra:function(){var t=new i.TetrahedronBufferGeometry(1.5);return t.rotateX(i.MathUtils.degToRad(15)),function(t){return new Ae(.01,arguments.length>1&&void 0!==arguments[1]?arguments[1]:6).modify(t)}(t,14)},plane:function(){return new i.PlaneBufferGeometry(2,2,160,160)},sphere:function(){return new i.SphereBufferGeometry(1.1,128,128)},torus:function(){return new i.TorusBufferGeometry(.8,.35,128,128)},torusKnot:function(){return new i.TorusKnotBufferGeometry(.68,.28,256,64)}};function zn(){var t;!function(){var t=Cn.mesh;t&&(t.dispose(),g.remove(t),delete Cn.mesh)}();var e=Xn[Ln.geometry]();"tetra"!==Ln.geometry&&(e=e.toNonIndexed());var n=new i.MeshStandardMaterial({side:i.DoubleSide}),r=new dn(e,n,Ln);Cn.mesh=r,g.add(r),Ln.debug&&console.log({vertices:r.totalVertices}),Dn(),null===(t=Rn.updateDisplay)||void 0===t||t.call(Rn),Cn.ticker&&Cn.ticker.reset();var o=Ye.seed&&Ye.seed!==Ln.defaultSeed?" #".concat(Ye.seed):"";document.title=Ln.title+o}function kn(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Ln.wind.x=0,Ln.wind.y=0,Ln.wind.z=0,t&&Rn.updateDisplay()}Cn={geometries:Xn,init:function t(){var e=Cn,n=e.reset,i=e.random,r=In.load();r?r!==Ye.seed&&i(r):n(),window.addEventListener("hashchange",t)},generate:zn,random:function(t){t?Ye.seed=t:(Ye.autoseed(),In.save(Ye.seed));var e=function(t,e,n){return Math.round(Ye.random(t,e)/n)*n},n=Ye.item(Object.keys(Cn.geometries).filter((function(t){return t!==Ln.geometry})));if(Ln.reset(),Ln.geometry=n,Object.entries(Ln.random).forEach((function(t){var n=Mn(t,2),i=n[0],r=n[1],o=r.min,s=r.max,a=r.step;Ln[i]=e(o,s,a)})),kn(!1),Ye.random()>.25){var i=Ye.item(["x","y","z"]),r=Ln.ranges[i],o=r.min,s=r.max,a=r.step;Ln.wind[i]=e(o,s,a)}var l=["back","bounce","elastic"];Ln.easingFunction=Ye.item(He.functions.filter((function(t){return!l.includes(t)}))),Ln.easingCategory=Ye.item(["In","InOut"]),Ln.easing.f=Ln.easingFunction,Ln.easing.category=Ln.easingCategory,zn()},reset:function(){Ye.seed=Ln.initialSeed,Ln.reset(),Cn.grid=Ln.grid,In.save(""),zn()},update:function(t){var e=Cn,n=e.mesh,i=e.ticker,r=e.loopDuration;n&&n.update(t),r>0&&t>r&&i.reset()},zeroWind:kn,get geometry(){return Ln.geometry},set geometry(t){Ln.geometry=t,zn()},get density(){return Ln.density},set density(t){Ln.density=t},get spread(){return Ln.spread},set spread(t){Ln.spread=t,Cn.mesh.options.spread=t,Cn.mesh.compute()},get turbulence(){return Ln.turbulence},set turbulence(t){Ln.turbulence=t,Cn.mesh.options.turbulence=t,Cn.mesh.compute()},get delay(){return Ln.delay},set delay(t){Ln.delay=t,Cn.mesh.shader.uniforms.uDelay.value=t,Dn()},get duration(){return Ln.duration},set duration(t){Ln.duration=t,Cn.mesh.shader.uniforms.uDuration.value=t,Dn()},get stagger(){return Ln.stagger},set stagger(t){Ln.stagger=t,Cn.mesh.shader.uniforms.uStagger.value=t,Dn()},get dynamics(){return Ln.dynamics},set dynamics(t){Ln.dynamics=t,Cn.mesh.shader.uniforms.uDynamics.value=t},get wind(){return Ln.wind},set wind(t){Ln.wind=t},get loopDuration(){return Ln.loopDuration},set loopDuration(t){Ln.loopDuration=t},get reversed(){return Ln.reversed},set reversed(t){Ln.reversed=t,Cn.mesh.options.reversed=t,Cn.mesh.setChunks()},get easingFunction(){return Ln.easingFunction},set easingFunction(t){Ln.easingFunction=t,Ln.easing.f=t,Cn.mesh.setChunks()},get easingCategory(){return Ln.easingCategory},set easingCategory(t){Ln.easingCategory=t,Ln.easing.category=t,Cn.mesh.setChunks()},get grid(){return Ln.grid},set grid(t){Ln.grid=t,g.grid.visible=t}};const Yn={type:"change"},Jn={type:"start"},Bn={type:"end"};class Vn extends i.EventDispatcher{constructor(t,e){super(),void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new i.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:i.MOUSE.ROTATE,MIDDLE:i.MOUSE.DOLLY,RIGHT:i.MOUSE.PAN},this.touches={ONE:i.TOUCH.ROTATE,TWO:i.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",V),this._domElementKeyEvents=t},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Yn),n.update(),o=r.NONE},this.update=function(){const e=new i.Vector3,h=(new i.Quaternion).setFromUnitVectors(t.up,new i.Vector3(0,1,0)),p=h.clone().invert(),f=new i.Vector3,m=new i.Quaternion,g=2*Math.PI;return function(){const t=n.object.position;e.copy(t).sub(n.target),e.applyQuaternion(h),a.setFromVector3(e),n.autoRotate&&o===r.NONE&&N(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(a.theta+=l.theta*n.dampingFactor,a.phi+=l.phi*n.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let i=n.minAzimuthAngle,v=n.maxAzimuthAngle;return isFinite(i)&&isFinite(v)&&(i<-Math.PI?i+=g:i>Math.PI&&(i-=g),v<-Math.PI?v+=g:v>Math.PI&&(v-=g),a.theta=i<=v?Math.max(i,Math.min(v,a.theta)):a.theta>(i+v)/2?Math.max(i,a.theta):Math.min(v,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=u,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius)),!0===n.enableDamping?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),e.setFromSpherical(a),e.applyQuaternion(p),t.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(l.theta*=1-n.dampingFactor,l.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(l.set(0,0,0),d.set(0,0,0)),u=1,!!(c||f.distanceToSquared(n.object.position)>s||8*(1-m.dot(n.object.quaternion))>s)&&(n.dispatchEvent(Yn),f.copy(n.object.position),m.copy(n.object.quaternion),c=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",H),n.domElement.removeEventListener("pointerdown",z),n.domElement.removeEventListener("pointercancel",J),n.domElement.removeEventListener("wheel",B),n.domElement.removeEventListener("pointermove",k),n.domElement.removeEventListener("pointerup",Y),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",V)};const n=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=r.NONE;const s=1e-6,a=new i.Spherical,l=new i.Spherical;let u=1;const d=new i.Vector3;let c=!1;const h=new i.Vector2,p=new i.Vector2,f=new i.Vector2,m=new i.Vector2,g=new i.Vector2,v=new i.Vector2,x=new i.Vector2,y=new i.Vector2,A=new i.Vector2,b=[],_={};function w(){return Math.pow(.95,n.zoomSpeed)}function N(t){l.theta-=t}function T(t){l.phi-=t}const S=function(){const t=new i.Vector3;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),d.add(t)}}(),F=function(){const t=new i.Vector3;return function(e,i){!0===n.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),d.add(t)}}(),L=function(){const t=new i.Vector3;return function(e,i){const r=n.domElement;if(n.object.isPerspectiveCamera){const o=n.object.position;t.copy(o).sub(n.target);let s=t.length();s*=Math.tan(n.object.fov/2*Math.PI/180),S(2*e*s/r.clientHeight,n.object.matrix),F(2*i*s/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(S(e*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),F(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function P(t){n.object.isPerspectiveCamera?u/=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*t)),n.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function E(t){n.object.isPerspectiveCamera?u*=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/t)),n.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function O(t){h.set(t.clientX,t.clientY)}function I(t){m.set(t.clientX,t.clientY)}function C(){if(1===b.length)h.set(b[0].pageX,b[0].pageY);else{const t=.5*(b[0].pageX+b[1].pageX),e=.5*(b[0].pageY+b[1].pageY);h.set(t,e)}}function R(){if(1===b.length)m.set(b[0].pageX,b[0].pageY);else{const t=.5*(b[0].pageX+b[1].pageX),e=.5*(b[0].pageY+b[1].pageY);m.set(t,e)}}function M(){const t=b[0].pageX-b[1].pageX,e=b[0].pageY-b[1].pageY,n=Math.sqrt(t*t+e*e);x.set(0,n)}function U(t){if(1==b.length)p.set(t.pageX,t.pageY);else{const e=j(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);p.set(n,i)}f.subVectors(p,h).multiplyScalar(n.rotateSpeed);const e=n.domElement;N(2*Math.PI*f.x/e.clientHeight),T(2*Math.PI*f.y/e.clientHeight),h.copy(p)}function D(t){if(1===b.length)g.set(t.pageX,t.pageY);else{const e=j(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);g.set(n,i)}v.subVectors(g,m).multiplyScalar(n.panSpeed),L(v.x,v.y),m.copy(g)}function X(t){const e=j(t),i=t.pageX-e.x,r=t.pageY-e.y,o=Math.sqrt(i*i+r*r);y.set(0,o),A.set(0,Math.pow(y.y/x.y,n.zoomSpeed)),P(A.y),x.copy(y)}function z(t){!1!==n.enabled&&(0===b.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",k),n.domElement.addEventListener("pointerup",Y)),function(t){b.push(t)}(t),"touch"===t.pointerType?function(t){switch(G(t),b.length){case 1:switch(n.touches.ONE){case i.TOUCH.ROTATE:if(!1===n.enableRotate)return;C(),o=r.TOUCH_ROTATE;break;case i.TOUCH.PAN:if(!1===n.enablePan)return;R(),o=r.TOUCH_PAN;break;default:o=r.NONE}break;case 2:switch(n.touches.TWO){case i.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&M(),n.enablePan&&R(),o=r.TOUCH_DOLLY_PAN;break;case i.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&M(),n.enableRotate&&C(),o=r.TOUCH_DOLLY_ROTATE;break;default:o=r.NONE}break;default:o=r.NONE}o!==r.NONE&&n.dispatchEvent(Jn)}(t):function(t){let e;switch(t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case i.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(t){x.set(t.clientX,t.clientY)}(t),o=r.DOLLY;break;case i.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;I(t),o=r.PAN}else{if(!1===n.enableRotate)return;O(t),o=r.ROTATE}break;case i.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;O(t),o=r.ROTATE}else{if(!1===n.enablePan)return;I(t),o=r.PAN}break;default:o=r.NONE}o!==r.NONE&&n.dispatchEvent(Jn)}(t))}function k(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){switch(G(t),o){case r.TOUCH_ROTATE:if(!1===n.enableRotate)return;U(t),n.update();break;case r.TOUCH_PAN:if(!1===n.enablePan)return;D(t),n.update();break;case r.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&X(t),n.enablePan&&D(t)}(t),n.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&X(t),n.enableRotate&&U(t)}(t),n.update();break;default:o=r.NONE}}(t):function(t){if(!1===n.enabled)return;switch(o){case r.ROTATE:if(!1===n.enableRotate)return;!function(t){p.set(t.clientX,t.clientY),f.subVectors(p,h).multiplyScalar(n.rotateSpeed);const e=n.domElement;N(2*Math.PI*f.x/e.clientHeight),T(2*Math.PI*f.y/e.clientHeight),h.copy(p),n.update()}(t);break;case r.DOLLY:if(!1===n.enableZoom)return;!function(t){y.set(t.clientX,t.clientY),A.subVectors(y,x),A.y>0?P(w()):A.y<0&&E(w()),x.copy(y),n.update()}(t);break;case r.PAN:if(!1===n.enablePan)return;!function(t){g.set(t.clientX,t.clientY),v.subVectors(g,m).multiplyScalar(n.panSpeed),L(v.x,v.y),m.copy(g),n.update()}(t)}}(t))}function Y(t){!1!==n.enabled&&(t.pointerType,n.dispatchEvent(Bn),o=r.NONE,Q(t),0===b.length&&(n.domElement.releasePointerCapture(t.pointerId),n.domElement.removeEventListener("pointermove",k),n.domElement.removeEventListener("pointerup",Y)))}function J(t){Q(t)}function B(t){!1===n.enabled||!1===n.enableZoom||o!==r.NONE&&o!==r.ROTATE||(t.preventDefault(),n.dispatchEvent(Jn),function(t){t.deltaY<0?E(w()):t.deltaY>0&&P(w()),n.update()}(t),n.dispatchEvent(Bn))}function V(t){!1!==n.enabled&&!1!==n.enablePan&&function(t){let e=!1;switch(t.code){case n.keys.UP:L(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:L(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:L(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:L(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}(t)}function H(t){!1!==n.enabled&&t.preventDefault()}function Q(t){delete _[t.pointerId];for(let e=0;e<b.length;e++)if(b[e].pointerId==t.pointerId)return void b.splice(e,1)}function G(t){let e=_[t.pointerId];void 0===e&&(e=new i.Vector2,_[t.pointerId]=e),e.set(t.pageX,t.pageY)}function j(t){const e=t.pointerId===b[0].pointerId?b[1]:b[0];return _[e.pointerId]}n.domElement.addEventListener("contextmenu",H),n.domElement.addEventListener("pointerdown",z),n.domElement.addEventListener("pointercancel",J),n.domElement.addEventListener("wheel",B,{passive:!1}),this.update()}}var Hn,Qn=!0;function Gn(){var t=window,e=t.innerWidth,n=t.innerHeight,i=t.devicePixelRatio,r=e,o=n;[g,me].forEach((function(t){return t.resize(r,o,Math.min(i,2))}))}function jn(t){[me,Cn].forEach((function(e){return e.update(t)}))}Hn={init:function(){var t=new Vn(g.camera,me.canvas);t.screenSpacePanning=!1,t.minDistance=4,t.maxDistance=20,t.maxPolarAngle=Math.PI/2,Hn.orbit=t,document.getElementById("random").addEventListener("click",(function(){Cn.random()}));var e=[document.getElementById("overlay"),document.getElementById("footer"),document.querySelector(".dg")];window.addEventListener("keyup",(function(t){var n={" ":function(){return Cn.random()},h:function(){return t=(Qn=!Qn)?"visible":"hidden",void e.forEach((function(e){return e.style.visibility=t}));var t}}[t.key];n&&n()}))}},function(){me.init(),Cn.init(),Rn.init(),Hn.init(),window.addEventListener("resize",Gn),Gn();var t=new n(jn,0);Cn.ticker=t,t.start()}()})();